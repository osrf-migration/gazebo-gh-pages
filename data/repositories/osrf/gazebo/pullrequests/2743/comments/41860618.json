{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2743/comments/41860618.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2743/_/diff#comment-41860618"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2743, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2743.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2743"}}, "title": "Send message to subscribers only once per connection"}, "content": {"raw": "If you make the following change and then run `test::integration::transport.cc` you will see \"Advertisement on /gazebo/default/test\" printed once for `ThreadedSinglePubSub` and twice for `ThreadedMultiSubSinglePub` even though both have only a single publisher.\n~~~\ndiff -r 40c062da7dcc gazebo/transport/ConnectionManager.cc\n--- a/gazebo/transport/ConnectionManager.cc\tTue Jul 25 14:09:17 2017 -0700\n+++ b/gazebo/transport/ConnectionManager.cc\tMon Jul 31 15:01:19 2017 -0700\n@@ -403,6 +403,7 @@\n   {\n     msgs::Publish pub;\n     pub.ParseFromString(packet.serialized_data());\n+    std::cerr << \"Advertisement on \" << pub.topic() << \"\\n\";\n     if (pub.host() != this->serverConn->GetLocalAddress() ||\n         pub.port() != this->serverConn->GetLocalPort())\n     {\n~~~", "markup": "markdown", "html": "<p>If you make the following change and then run <code>test::integration::transport.cc</code> you will see \"Advertisement on /gazebo/default/test\" printed once for <code>ThreadedSinglePubSub</code> and twice for <code>ThreadedMultiSubSinglePub</code> even though both have only a single publisher.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 40c062da7dcc gazebo/transport/ConnectionManager.cc</span>\n<span class=\"gd\">--- a/gazebo/transport/ConnectionManager.cc Tue Jul 25 14:09:17 2017 -0700</span>\n<span class=\"gi\">+++ b/gazebo/transport/ConnectionManager.cc Mon Jul 31 15:01:19 2017 -0700</span>\n<span class=\"gu\">@@ -403,6 +403,7 @@</span>\n   {\n     msgs::Publish pub;\n     pub.ParseFromString(packet.serialized_data());\n<span class=\"gi\">+    std::cerr &lt;&lt; &quot;Advertisement on &quot; &lt;&lt; pub.topic() &lt;&lt; &quot;\\n&quot;;</span>\n     if (pub.host() != this-&gt;serverConn-&gt;GetLocalAddress() ||\n         pub.port() != this-&gt;serverConn-&gt;GetLocalPort())\n     {\n</pre></div>", "type": "rendered"}, "created_on": "2017-07-31T22:05:13.941689+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "updated_on": "2017-07-31T22:05:13.944286+00:00", "type": "pullrequest_comment", "id": 41860618}