{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/100187922.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-100187922"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "One of the jenkins builds now has a different backtrace in `gzTest.Model` that implicates `gazebo::transport::Publisher::OnPublishComplete`:\n\n* https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/834/testReport/junit/(root)/gzTest/Model/\n\n~~~\n327: [ RUN      ] gzTest.Model\n327: [Msg] Waiting for master.\n327: [Msg] Connected to gazebo master @ http://127.0.0.1:11345\n327: [Msg] Publicized address: 172.17.0.2\n327: tools/gz_TEST.cc:439: Failure\n327: Value of: \"Unable to get info on model[my_box_0] in the world[default]\\n\"\n327: Expected: modelInfo\n327: Which is: \"gz: /usr/include/boost/thread/pthread/mutex.hpp:111: boost::mutex::~mutex(): Assertion `!res' failed.\\nUnable to get info on model[my_box_0] in the world[default]\\nAborted (core dumped)\\n\"\n*** Error in `gzserver': double free or corruption (fasttop): 0x00007f9d4c639900 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f9df7ae87e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f9df7af137a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f9df7af553c]\nbuild/gazebo/transport/libgazebo_transport.so.9(_ZN6gazebo9transport9Publisher17OnPublishCompleteEj+0xb6)[0x7f9df68f8c06]\nbuild/gazebo/transport/libgazebo_transport.so.9(_ZN6gazebo9transport10Connection9PostWriteEv+0x46)[0x7f9df68caaa6]\nbuild/gazebo/transport/libgazebo_transport.so.9(_ZN6gazebo9transport10Connection7OnWriteERKN5boost6system10error_codeE+0x3c)[0x7f9df68cbe2c]\n~~~\n\nI'm looking into it", "markup": "markdown", "html": "<p>One of the jenkins builds now has a different backtrace in <code>gzTest.Model</code> that implicates <code>gazebo::transport::Publisher::OnPublishComplete</code>:</p>\n<ul>\n<li><a href=\"https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/834/testReport/junit/(root)/gzTest/Model/\" rel=\"nofollow\" class=\"ap-connect-link\">https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/834/testReport/junit/(root)/gzTest/Model/</a></li>\n</ul>\n<div class=\"codehilite\"><pre><span></span>327: [ RUN      ] gzTest.Model\n327: [Msg] Waiting for master.\n327: [Msg] Connected to gazebo master @ http://127.0.0.1:11345\n327: [Msg] Publicized address: 172.17.0.2\n327: tools/gz_TEST.cc:439: Failure\n327: Value of: &quot;Unable to get info on model[my_box_0] in the world[default]\\n&quot;\n327: Expected: modelInfo\n327: Which is: &quot;gz: /usr/include/boost/thread/pthread/mutex.hpp:111: boost::mutex::~mutex(): Assertion `!res&#39; failed.\\nUnable to get info on model[my_box_0] in the world[default]\\nAborted (core dumped)\\n&quot;\n*** Error in `gzserver&#39;: double free or corruption (fasttop): 0x00007f9d4c639900 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f9df7ae87e5]\n/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f9df7af137a]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f9df7af553c]\nbuild/gazebo/transport/libgazebo_transport.so.9(_ZN6gazebo9transport9Publisher17OnPublishCompleteEj+0xb6)[0x7f9df68f8c06]\nbuild/gazebo/transport/libgazebo_transport.so.9(_ZN6gazebo9transport10Connection9PostWriteEv+0x46)[0x7f9df68caaa6]\nbuild/gazebo/transport/libgazebo_transport.so.9(_ZN6gazebo9transport10Connection7OnWriteERKN5boost6system10error_codeE+0x3c)[0x7f9df68cbe2c]\n</pre></div>\n\n\n<p>I'm looking into it</p>", "type": "rendered"}, "created_on": "2019-04-26T17:54:25.801918+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-04-26T17:54:25.816088+00:00", "type": "pullrequest_comment", "id": 100187922}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/100189059.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-100189059"}}, "parent": {"id": 100187922, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/100187922.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-100187922"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "I made a relevant comment on pull request #3014\n\n* #!/osrf/gazebo/pull-requests/3014/wip-address-gzserver-shutdown-speed/diff#comment-100189015", "markup": "markdown", "html": "<p>I made a relevant comment on <a href=\"#!/osrf/gazebo/pull-requests/3014/wip-address-gzserver-shutdown-speed\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #3014</a></p>\n<ul>\n<li><a href=\"#!/osrf/gazebo/pull-requests/3014/wip-address-gzserver-shutdown-speed/diff#comment-100189015\" rel=\"nofollow\" class=\"ap-connect-link\">#!/osrf/gazebo/pull-requests/3014/wip-address-gzserver-shutdown-speed/diff#comment-100189015</a></li>\n</ul>", "type": "rendered"}, "created_on": "2019-04-26T18:06:41.232279+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-04-26T18:06:41.244430+00:00", "type": "pullrequest_comment", "id": 100189059}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/105826619.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-105826619"}}, "parent": {"id": 100189059, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/100189059.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-100189059"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "we got a report that gzserver crashes with the same backtrace when objects are deleted. \n\nI have been testing this branch but I was still seeing the crash. I added a simple check in [master\\_ProcessMessage\\_race\\_ian](#!/osrf/gazebo/branch/master_ProcessMessage_race_ian?dest=master_ProcessMessage_race#diff) branch which seems to help and I have not been able to reproduce the crash now \\(or maybe it\u2019s just harder to reproduce\\). \n\nI have a script and a test world to help me reproduce the crash [here](https://bitbucket.org/snippets/iche033/Ke6og7).  \n\n1. launch boxes.world. Note that gzclient must be started. Having gzserver alone does not cause the crash for me\n\n    1. `gazebo --verbose boxes.world`\n    \n2. Run delete.sh to delete models in the world\n\n    1. `sh delete.sh`\n    \n\n", "markup": "markdown", "html": "<p>we got a report that gzserver crashes with the same backtrace when objects are deleted. </p>\n<p>I have been testing this branch but I was still seeing the crash. I added a simple check in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/branch/master_ProcessMessage_race_ian?dest=master_ProcessMessage_race#diff\" rel=\"nofollow\">master_ProcessMessage_race_ian</a> branch which seems to help and I have not been able to reproduce the crash now (or maybe it\u2019s just harder to reproduce). </p>\n<p>I have a script and a test world to help me reproduce the crash <a data-is-external-link=\"true\" href=\"https://bitbucket.org/snippets/iche033/Ke6og7\" rel=\"nofollow\">here</a>.  </p>\n<ol>\n<li>\n<p>launch boxes.world. Note that gzclient must be started. Having gzserver alone does not cause the crash for me</p>\n<ol>\n<li><code>gazebo --verbose boxes.world</code></li>\n</ol>\n</li>\n<li>\n<p>Run delete.sh to delete models in the world</p>\n<ol>\n<li><code>sh delete.sh</code></li>\n</ol>\n</li>\n</ol>", "type": "rendered"}, "created_on": "2019-06-14T19:47:58.601675+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2019-06-14T19:47:58.610841+00:00", "type": "pullrequest_comment", "id": 105826619}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/107049362.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-107049362"}}, "parent": {"id": 105826619, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/105826619.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-105826619"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "I just did some testing against the 9.9.0 debs with your script, and I've seen a few backtraces at the following places in `Publisher::OnPublishComplete`:\n\n* [Publisher.cc:243](#!/osrf/gazebo/src/gazebo9_9.9.0/gazebo/transport/Publisher.cc#lines-243)\n* [Publisher.cc:252](#!/osrf/gazebo/src/gazebo9_9.9.0/gazebo/transport/Publisher.cc#lines-252)\n\nWith this branch, I only tend to see backtraces in [~Publisher](#!/osrf/gazebo/src/87af797edfef683ee2e5b20e267e446fb3b514ea/gazebo/transport/Publisher.cc#lines-55), with the following console message:\n\n~~~\ngzserver: /usr/include/boost/thread/pthread/mutex.hpp:111: boost::mutex::~mutex(): Assertion `!res' failed.\n~~~\n\nI'm about to start testing with your branch.", "markup": "markdown", "html": "<p>I just did some testing against the 9.9.0 debs with your script, and I've seen a few backtraces at the following places in <code>Publisher::OnPublishComplete</code>:</p>\n<ul>\n<li><a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/gazebo9_9.9.0/gazebo/transport/Publisher.cc#lines-243\" rel=\"nofollow\">Publisher.cc:243</a></li>\n<li><a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/gazebo9_9.9.0/gazebo/transport/Publisher.cc#lines-252\" rel=\"nofollow\">Publisher.cc:252</a></li>\n</ul>\n<p>With this branch, I only tend to see backtraces in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/87af797edfef683ee2e5b20e267e446fb3b514ea/gazebo/transport/Publisher.cc#lines-55\" rel=\"nofollow\">~Publisher</a>, with the following console message:</p>\n<div class=\"codehilite\"><pre><span></span>gzserver: /usr/include/boost/thread/pthread/mutex.hpp:111: boost::mutex::~mutex(): Assertion `!res&#39; failed.\n</pre></div>\n\n\n<p>I'm about to start testing with your branch.</p>", "type": "rendered"}, "created_on": "2019-06-25T23:56:40.444127+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-06-25T23:56:40.457732+00:00", "type": "pullrequest_comment", "id": 107049362}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/107050295.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-107050295"}}, "parent": {"id": 107049362, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/107049362.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-107049362"}}, "depth": 4}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "ok, I've tested your branch 7 times in a row without failures, so I'm going to merge it in here", "markup": "markdown", "html": "<p>ok, I've tested your branch 7 times in a row without failures, so I'm going to merge it in here</p>", "type": "rendered"}, "created_on": "2019-06-26T00:14:44.279490+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-06-26T00:14:44.291728+00:00", "type": "pullrequest_comment", "id": 107050295}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/107051171.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-107051171"}}, "parent": {"id": 107050295, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/107050295.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-107050295"}}, "depth": 5}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "nice, thanks for testing it!", "markup": "markdown", "html": "<p>nice, thanks for testing it!</p>", "type": "rendered"}, "created_on": "2019-06-26T00:34:06.672933+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2019-06-26T00:34:06.682767+00:00", "type": "pullrequest_comment", "id": 107051171}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103/comments/107051495.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103/_/diff#comment-107051495"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3103, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3103.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3103"}}, "title": "Fix race conditions in Master::ProcessMessage and Publisher::OnPublishComplete"}, "content": {"raw": "I'll update the pull request title and changelog to reflect the change to `Publisher::OnPublishComplete`", "markup": "markdown", "html": "<p>I'll update the pull request title and changelog to reflect the change to <code>Publisher::OnPublishComplete</code></p>", "type": "rendered"}, "created_on": "2019-06-26T00:41:56.180414+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2019-06-26T00:41:56.187844+00:00", "type": "pullrequest_comment", "id": 107051495}], "page": 1, "size": 7}