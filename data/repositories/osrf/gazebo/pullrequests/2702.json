{"rendered": {"description": {"raw": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](data/bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "markup": "markdown", "html": "<p>It was reported that setting a body-fixed friction direction is not working (issue <a href=\"#!/osrf/gazebo/issues/2068/directional-friction-still-broken\" rel=\"nofollow\" title=\"Directional friction still broken.\" class=\"ap-connect-link\"><s>#2068</s></a>). This was confusing to me, since we have an extensive test of friction direction parameters in <code>physics_friction.cc</code>:</p>\n<p><img alt=\"friction direction test\" src=\"data/bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif\" /></p>\n<p>It turns out that friction direction parameters are indeed broken in certain cases, and it is related to the <code>Collision::GetWorldPose</code> function that is called in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124\" rel=\"nofollow\">ODEPhysics::Collide</a>. Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.</p>\n<p>I believe the problem is that <code>Collision::GetWorldPose</code> is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the <code>collision_pose_offset</code> test world and a failing expectation to <code>INTEGRATION_physics_collision</code>. I also added a pair of spheres to the <code>friction_dir_test</code> world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.</p>\n<p>The fix is in <a href=\"#!/osrf/gazebo/commits/57c8d6f\" rel=\"nofollow\" class=\"ap-connect-link\">57c8d6f</a>, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.</p>\n<p>While nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in <a href=\"#!/osrf/gazebo/commits/14473f4\" rel=\"nofollow\" class=\"ap-connect-link\">14473f4</a>.</p>", "type": "rendered"}, "title": {"raw": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "markup": "markdown", "html": "<p>Fix Collision::GetWorldPose for non-canonical links (and friction directions, <a href=\"#!/osrf/gazebo/issues/2068/directional-friction-still-broken\" rel=\"nofollow\" title=\"Directional friction still broken.\" class=\"ap-connect-link\"><s>#2068</s></a>)</p>", "type": "rendered"}}, "type": "pullrequest", "description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](data/bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2702/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/diffstat/osrf/gazebo:e792330fb540%0D0d4129391f78?from_pullrequest_id=2702"}, "commits": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/commits.json"}, "self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "comments": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2702/merge"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}, "activity": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/diff/osrf/gazebo:e792330fb540%0D0d4129391f78?from_pullrequest_id=2702"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2702/approve"}, "statuses": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/statuses_page=1.json"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "close_source_branch": true, "reviewers": [], "id": 2702, "destination": {"commit": {"hash": "0d4129391f78", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0d4129391f78.json"}, "html": {"href": "#!/osrf/gazebo/commits/0d4129391f78"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "created_on": "2017-05-03T01:16:04.956320+00:00", "summary": {"raw": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](data/bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "markup": "markdown", "html": "<p>It was reported that setting a body-fixed friction direction is not working (issue <a href=\"#!/osrf/gazebo/issues/2068/directional-friction-still-broken\" rel=\"nofollow\" title=\"Directional friction still broken.\" class=\"ap-connect-link\"><s>#2068</s></a>). This was confusing to me, since we have an extensive test of friction direction parameters in <code>physics_friction.cc</code>:</p>\n<p><img alt=\"friction direction test\" src=\"data/bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif\" /></p>\n<p>It turns out that friction direction parameters are indeed broken in certain cases, and it is related to the <code>Collision::GetWorldPose</code> function that is called in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124\" rel=\"nofollow\">ODEPhysics::Collide</a>. Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.</p>\n<p>I believe the problem is that <code>Collision::GetWorldPose</code> is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the <code>collision_pose_offset</code> test world and a failing expectation to <code>INTEGRATION_physics_collision</code>. I also added a pair of spheres to the <code>friction_dir_test</code> world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.</p>\n<p>The fix is in <a href=\"#!/osrf/gazebo/commits/57c8d6f\" rel=\"nofollow\" class=\"ap-connect-link\">57c8d6f</a>, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.</p>\n<p>While nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in <a href=\"#!/osrf/gazebo/commits/14473f4\" rel=\"nofollow\" class=\"ap-connect-link\">14473f4</a>.</p>", "type": "rendered"}, "source": {"commit": {"hash": "86b57532d9f1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/86b57532d9f1.json"}, "html": {"href": "#!/osrf/gazebo/commits/86b57532d9f1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "comment_count": 18, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2017-06-23T18:49:31.640645+00:00", "type": "participant", "approved": true, "user": {"display_name": "Shane Loretz", "uuid": "{656e3311-aad9-45a1-aaf7-b0ee0e84b287}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D"}, "html": {"href": "https://bitbucket.org/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:684383ab-ac95-4859-a350-4a6f41a94a22/c7a1ebf5-cade-4115-9f26-9d3facb776db/128"}}, "nickname": "Shane Loretz", "type": "user", "account_id": "557058:684383ab-ac95-4859-a350-4a6f41a94a22"}}, {"role": "PARTICIPANT", "participated_on": "2017-06-09T21:23:26.242866+00:00", "type": "participant", "approved": true, "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}}, {"role": "PARTICIPANT", "participated_on": "2017-11-27T16:15:34.268078+00:00", "type": "participant", "approved": false, "user": {"display_name": "Martin Pecka", "uuid": "{41691c43-4ae0-49ba-ba45-3c36439f5af2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D"}, "html": {"href": "https://bitbucket.org/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d1ad32a09564f856909994613fdbc37cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMP-1.png"}}, "nickname": "peci1", "type": "user", "account_id": "557058:434ecab2-e510-4ede-8f9a-1c2a5a4032e1"}}, {"role": "PARTICIPANT", "participated_on": "2017-06-27T18:39:21.303314+00:00", "type": "participant", "approved": false, "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}, {"role": "PARTICIPANT", "participated_on": "2017-05-31T18:51:11.307373+00:00", "type": "participant", "approved": false, "user": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}}, {"role": "PARTICIPANT", "participated_on": "2017-06-05T09:37:06.338366+00:00", "type": "participant", "approved": false, "user": {"display_name": "Andrea Ruzzenenti", "uuid": "{e1b5ee2b-de45-4d4a-a5e6-a8ac3fbf68e7}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be1b5ee2b-de45-4d4a-a5e6-a8ac3fbf68e7%7D"}, "html": {"href": "https://bitbucket.org/%7Be1b5ee2b-de45-4d4a-a5e6-a8ac3fbf68e7%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/23c771650185f3cd68d95b67cb829a12d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsAR-5.png"}}, "nickname": "aerydna", "type": "user", "account_id": "557058:4cda65f8-5ec6-402e-9da4-1c7f61e1a152"}}, {"role": "PARTICIPANT", "participated_on": "2017-06-28T16:49:02.755395+00:00", "type": "participant", "approved": true, "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}], "reason": "", "updated_on": "2017-11-27T16:15:34.302101+00:00", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "merge_commit": {"hash": "e792330fb540", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/e792330fb540.json"}, "html": {"href": "#!/osrf/gazebo/commits/e792330fb540"}}}, "closed_by": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}