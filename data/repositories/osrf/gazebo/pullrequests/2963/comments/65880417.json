{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2963/comments/65880417.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2963/_/diff#comment-65880417"}}, "parent": {"id": 65878557, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2963/comments/65878557.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2963/_/diff#comment-65878557"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2963, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2963.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2963"}}, "title": "Fix gazebo_ros_pkgs barrel distortion test"}, "content": {"raw": "[https://bitbucket.org/kev-the-dev/gazebo/src/cb19cc9963b39ea734cdf0ca9b5bd6029985df4f/test/integration/camera\\_sensor.cc](https://bitbucket.org/kev-the-dev/gazebo/src/cb19cc9963b39ea734cdf0ca9b5bd6029985df4f/test/integration/camera_sensor.cc)\n\n^ I cleared everything else out but the distortion test.\n\n\u200c\n\n    Thread 1 \"INTEGRATION_cam\" hit Breakpoint 2, CameraSensor_CheckDistortion_Test::TestBody (this=0x783980)\n        at /home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:761\n    761\t  this->ImageCompare(images[2], images[4], width, height, 3,\n    (gdb) print cams[2]->Camera()->LensDistortion()->Crop()\n    $1 = true\n    (gdb) print cams[2]->Camera()->LensDistortion()->dataPtr->distortionScale\n    $2 = {_vptr.Vector2 = 0x7ffff6d220e8 <vtable for ignition::math::v4::Vector2<double>+16>, static Zero = <optimized out>, static One = {\n        _vptr.Vector2 = 0x7ffff5df8928 <vtable for ignition::math::v4::Vector2<double>+16>, static Zero = <optimized out>, \n        static One = <same as static member of an already seen type>, data = {1, 1}}, data = {0.64874999999999994, 0.64874999999999994}}\n    (gdb) print cams[4]->Camera()->LensDistortion()->Crop()\n    $3 = false\n    (gdb) print cams[4]->Camera()->LensDistortion()->dataPtr->distortionScale\n    $4 = {_vptr.Vector2 = 0x7ffff6d220e8 <vtable for ignition::math::v4::Vector2<double>+16>, static Zero = <optimized out>, static One = {\n        _vptr.Vector2 = 0x7ffff5df8928 <vtable for ignition::math::v4::Vector2<double>+16>, static Zero = <optimized out>, \n        static One = <same as static member of an already seen type>, data = {1, 1}}, data = {1, 1}}\n    (gdb) continue\n    Continuing.\n    /home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:763: Failure\n    Expected: (diffSum) != (0u), actual: 0 vs 0\n    /home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:768: Failure\n    Expected: (diffSum) != (0u), actual: 0 vs 0\n    /home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:795: Failure\n    Expected: (colorSums[4]) > (colorSums[2]), actual: 15455772 vs 15455772\n    /home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:796: Failure\n    Expected: (colorSums[5]) > (colorSums[3]), actual: 18624009 vs 18624009\n    \n\ncam\\[2\\] and cam\\[4\\] are setup the same but SetCrop\\(false\\) is called in cam\\[4\\]. They have different distortionScales \\(so` CalculateAndApplyDistortionScale`was called\\), but no pixel differences.  I\u2019m not really sure what scene this test is in, perhaps the border is already black\u2026", "markup": "markdown", "html": "<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/kev-the-dev/gazebo/src/cb19cc9963b39ea734cdf0ca9b5bd6029985df4f/test/integration/camera_sensor.cc\" rel=\"nofollow\">https://bitbucket.org/kev-the-dev/gazebo/src/cb19cc9963b39ea734cdf0ca9b5bd6029985df4f/test/integration/camera_sensor.cc</a></p>\n<p>^ I cleared everything else out but the distortion test.</p>\n<p>\u200c</p>\n<div class=\"codehilite\"><pre><span></span>Thread 1 &quot;INTEGRATION_cam&quot; hit Breakpoint 2, CameraSensor_CheckDistortion_Test::TestBody (this=0x783980)\n    at /home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:761\n761   this-&gt;ImageCompare(images[2], images[4], width, height, 3,\n(gdb) print cams[2]-&gt;Camera()-&gt;LensDistortion()-&gt;Crop()\n$1 = true\n(gdb) print cams[2]-&gt;Camera()-&gt;LensDistortion()-&gt;dataPtr-&gt;distortionScale\n$2 = {_vptr.Vector2 = 0x7ffff6d220e8 &lt;vtable for ignition::math::v4::Vector2&lt;double&gt;+16&gt;, static Zero = &lt;optimized out&gt;, static One = {\n    _vptr.Vector2 = 0x7ffff5df8928 &lt;vtable for ignition::math::v4::Vector2&lt;double&gt;+16&gt;, static Zero = &lt;optimized out&gt;, \n    static One = &lt;same as static member of an already seen type&gt;, data = {1, 1}}, data = {0.64874999999999994, 0.64874999999999994}}\n(gdb) print cams[4]-&gt;Camera()-&gt;LensDistortion()-&gt;Crop()\n$3 = false\n(gdb) print cams[4]-&gt;Camera()-&gt;LensDistortion()-&gt;dataPtr-&gt;distortionScale\n$4 = {_vptr.Vector2 = 0x7ffff6d220e8 &lt;vtable for ignition::math::v4::Vector2&lt;double&gt;+16&gt;, static Zero = &lt;optimized out&gt;, static One = {\n    _vptr.Vector2 = 0x7ffff5df8928 &lt;vtable for ignition::math::v4::Vector2&lt;double&gt;+16&gt;, static Zero = &lt;optimized out&gt;, \n    static One = &lt;same as static member of an already seen type&gt;, data = {1, 1}}, data = {1, 1}}\n(gdb) continue\nContinuing.\n/home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:763: Failure\nExpected: (diffSum) != (0u), actual: 0 vs 0\n/home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:768: Failure\nExpected: (diffSum) != (0u), actual: 0 vs 0\n/home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:795: Failure\nExpected: (colorSums[4]) &gt; (colorSums[2]), actual: 15455772 vs 15455772\n/home/kallen/catkin_ws/gazebo/test/integration/camera_sensor.cc:796: Failure\nExpected: (colorSums[5]) &gt; (colorSums[3]), actual: 18624009 vs 18624009\n</pre></div>\n\n\n<p>cam[2] and cam[4] are setup the same but SetCrop(false) is called in cam[4]. They have different distortionScales (so<code>CalculateAndApplyDistortionScale</code>was called), but no pixel differences.  I\u2019m not really sure what scene this test is in, perhaps the border is already black\u2026</p>", "type": "rendered"}, "created_on": "2018-05-31T21:27:08.322832+00:00", "user": {"display_name": "Kevin Allen", "uuid": "{29f672ad-72f4-434e-bb0e-c6f2f69974f2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B29f672ad-72f4-434e-bb0e-c6f2f69974f2%7D"}, "html": {"href": "https://bitbucket.org/%7B29f672ad-72f4-434e-bb0e-c6f2f69974f2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/355d0415f6040ffb168f44275ac2ee2fd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsKA-1.png"}}, "nickname": "kev-the-dev", "type": "user", "account_id": "5b04a6cf8a69f52b3ba2e5db"}, "updated_on": "2018-05-31T21:27:08.509421+00:00", "type": "pullrequest_comment", "id": 65880417}