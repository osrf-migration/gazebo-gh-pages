{"pagelen": 50, "values": [{"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to [fix another build machine](http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64/1174/), so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "8300d38fdb9d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/8300d38fdb9d.json"}, "html": {"href": "#!/osrf/gazebo/commits/8300d38fdb9d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "c3aa63cd6663", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/c3aa63cd6663.json"}, "html": {"href": "#!/osrf/gazebo/commits/c3aa63cd6663"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "MERGED", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-27T22:13:33.151274+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to [fix another build machine](http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64/1174/), so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "8300d38fdb9d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/8300d38fdb9d.json"}, "html": {"href": "#!/osrf/gazebo/commits/8300d38fdb9d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "c3aa63cd6663", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/c3aa63cd6663.json"}, "html": {"href": "#!/osrf/gazebo/commits/c3aa63cd6663"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-27T22:12:37.253745+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"approval": {"date": "2014-10-27T21:37:02.639951+00:00", "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3621902.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3621902"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "Just a note: obviously if the test is invoked direcatly through the binary (`./test/integration/INTEGRATION_world_clone`) our clean up is not going to work. But that's not under the scope of this request.", "markup": "markdown", "html": "<p>Just a note: obviously if the test is invoked direcatly through the binary (<code>./test/integration/INTEGRATION_world_clone</code>) our clean up is not going to work. But that's not under the scope of this request.</p>", "type": "rendered"}, "created_on": "2014-10-27T21:37:00.037261+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": "2014-10-27T21:37:00.050305+00:00", "type": "pullrequest_comment", "id": 3621902}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to [fix another build machine](http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64/1174/), so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "10d0f2dc6899", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/10d0f2dc6899.json"}, "html": {"href": "#!/osrf/gazebo/commits/10d0f2dc6899"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "6dade5a2a7d8", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/6dade5a2a7d8.json"}, "html": {"href": "#!/osrf/gazebo/commits/6dade5a2a7d8"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-27T17:49:11.454287+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3599560.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3599560"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "In 5f8f92cd1258, I made some changes that will make `UNIT_gz_TEST` a little more robust. Currently, many of its subtests spawn `gzserver` processes during an `init` function call, and then tear them down during `fini`. One of the tests, however, was aborting under certain conditions, which caused the gzserver processes to persist. In 5f8f92cd1258, I replace an `ASSERT_EQ` with `EXPECT_EQ` and companion `if` block, and also use `EXPECT_NO_THROW` around `boost::lexical_cast`.\n\nTo test this, add the following to `gz_TEST.cc` to cause a failure:\n~~~\ndiff -r 10d0f2dc6899 tools/gz_TEST.cc\n--- a/tools/gz_TEST.cc\tThu Oct 23 11:47:37 2014 -0700\n+++ b/tools/gz_TEST.cc\tFri Oct 24 12:21:09 2014 -0700\n@@ -361,7 +361,7 @@\n         != std::string::npos);\n \n     // Get the pose of the model.\n-    modelInfo = custom_exec_str(\"gz model -m my_box -p\");\n+    modelInfo = custom_exec_str(\"ls\");\n     boost::algorithm::trim(modelInfo);\n \n     // Split the string into parts.\n~~~", "markup": "markdown", "html": "<p>In <a href=\"#!/osrf/gazebo/commits/5f8f92cd1258\" rel=\"nofollow\" class=\"ap-connect-link\">5f8f92cd1258</a>, I made some changes that will make <code>UNIT_gz_TEST</code> a little more robust. Currently, many of its subtests spawn <code>gzserver</code> processes during an <code>init</code> function call, and then tear them down during <code>fini</code>. One of the tests, however, was aborting under certain conditions, which caused the gzserver processes to persist. In <a href=\"#!/osrf/gazebo/commits/5f8f92cd1258\" rel=\"nofollow\" class=\"ap-connect-link\">5f8f92cd1258</a>, I replace an <code>ASSERT_EQ</code> with <code>EXPECT_EQ</code> and companion <code>if</code> block, and also use <code>EXPECT_NO_THROW</code> around <code>boost::lexical_cast</code>.</p>\n<p>To test this, add the following to <code>gz_TEST.cc</code> to cause a failure:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 10d0f2dc6899 tools/gz_TEST.cc</span>\n<span class=\"gd\">--- a/tools/gz_TEST.cc  Thu Oct 23 11:47:37 2014 -0700</span>\n<span class=\"gi\">+++ b/tools/gz_TEST.cc  Fri Oct 24 12:21:09 2014 -0700</span>\n<span class=\"gu\">@@ -361,7 +361,7 @@</span>\n         != std::string::npos);\n\n     // Get the pose of the model.\n<span class=\"gd\">-    modelInfo = custom_exec_str(&quot;gz model -m my_box -p&quot;);</span>\n<span class=\"gi\">+    modelInfo = custom_exec_str(&quot;ls&quot;);</span>\n     boost::algorithm::trim(modelInfo);\n\n     // Split the string into parts.\n</pre></div>", "type": "rendered"}, "created_on": "2014-10-24T19:21:36.725083+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-10-24T19:21:36.736975+00:00", "type": "pullrequest_comment", "id": 3599560}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to [fix another build machine](http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64/1174/), so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "10d0f2dc6899", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/10d0f2dc6899.json"}, "html": {"href": "#!/osrf/gazebo/commits/10d0f2dc6899"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "5f8f92cd1258", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/5f8f92cd1258.json"}, "html": {"href": "#!/osrf/gazebo/commits/5f8f92cd1258"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-24T19:16:17.925956+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3565889.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3565889"}}, "parent": {"id": 3529182, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3529182.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3529182"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "another: http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64-gpu-ati/571/console", "markup": "markdown", "html": "<p>another: <a href=\"http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64-gpu-ati/571/console\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64-gpu-ati/571/console</a></p>", "type": "rendered"}, "created_on": "2014-10-22T20:14:11.092549+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-10-22T20:14:11.101890+00:00", "type": "pullrequest_comment", "id": 3565889}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"approval": {"date": "2014-10-22T19:15:00.155944+00:00", "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3565073.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3565073"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "confirmed that no there are no more leftover gzserver processes after the fix", "markup": "markdown", "html": "<p>confirmed that no there are no more leftover gzserver processes after the fix</p>", "type": "rendered"}, "created_on": "2014-10-22T19:14:57.652351+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2014-10-22T19:14:57.661302+00:00", "type": "pullrequest_comment", "id": 3565073}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3529976.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3529976"}}, "parent": {"id": 3529182, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3529182.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3529182"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "another: http://build.osrfoundation.org/job/gazebo-any-devel-trusty-amd64-gpu-nvidia/247/console", "markup": "markdown", "html": "<p>another: <a href=\"http://build.osrfoundation.org/job/gazebo-any-devel-trusty-amd64-gpu-nvidia/247/console\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-any-devel-trusty-amd64-gpu-nvidia/247/console</a></p>", "type": "rendered"}, "created_on": "2014-10-21T00:24:22.299760+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-10-21T00:24:22.308762+00:00", "type": "pullrequest_comment", "id": 3529976}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3529195.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3529195"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "[no unexpected failures in jenkins](http://build.osrfoundation.org/view/gazebo/job/gazebo-any-devel-trusty-amd64-gpu-nvidia/239/)", "markup": "markdown", "html": "<p><a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/view/gazebo/job/gazebo-any-devel-trusty-amd64-gpu-nvidia/239/\" rel=\"nofollow\">no unexpected failures in jenkins</a></p>", "type": "rendered"}, "created_on": "2014-10-20T22:55:13.319457+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-10-20T22:55:13.330406+00:00", "type": "pullrequest_comment", "id": 3529195}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232/comments/3529182.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232/_/diff#comment-3529182"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}, "content": {"raw": "Here's another build I had to fix manually:\n\nhttp://build.osrfoundation.org/job/gazebo-default-BTprofile-precise-amd64/592/", "markup": "markdown", "html": "<p>Here's another build I had to fix manually:</p>\n<p><a href=\"http://build.osrfoundation.org/job/gazebo-default-BTprofile-precise-amd64/592/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-default-BTprofile-precise-amd64/592/</a></p>", "type": "rendered"}, "created_on": "2014-10-20T22:54:09.577122+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-10-20T22:54:09.588636+00:00", "type": "pullrequest_comment", "id": 3529182}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to [fix another build machine](http://build.osrfoundation.org/job/gazebo-default-devel-precise-amd64/1174/), so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "e158b5e5c9d1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/e158b5e5c9d1.json"}, "html": {"href": "#!/osrf/gazebo/commits/e158b5e5c9d1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "d1f76681b06f", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d1f76681b06f.json"}, "html": {"href": "#!/osrf/gazebo/commits/d1f76681b06f"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-16T17:32:10.602682+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to fix another build machine, so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "e158b5e5c9d1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/e158b5e5c9d1.json"}, "html": {"href": "#!/osrf/gazebo/commits/e158b5e5c9d1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "d1f76681b06f", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d1f76681b06f.json"}, "html": {"href": "#!/osrf/gazebo/commits/d1f76681b06f"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-16T17:31:12.546173+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}, {"update": {"description": "As documented in #1299, there can be rogue `gzserver` processes left over from failures of the `INTEGRATION_world_clone` test. It happens only occasionally, but when it does happen, it causes all other tests to fail and ties up the build machine until we manually log in to the machine to kill the process.\r\n\r\nThis pull request modifies the `tools/check_test_ran.py` script to check for leftover `gzserver` processes from the clone test and kill them. It only runs directly after the `INTEGRATION_world_clone` test.\r\n\r\nTo test this, apply the following patch to cause a test failure:\r\n~~~\r\ndiff -r 7cf2bfe6c08a test/integration/CMakeLists.txt\r\n--- a/test/integration/CMakeLists.txt   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/CMakeLists.txt   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -92,6 +92,8 @@\r\n   set_tests_properties(${TEST_TYPE}_factory PROPERTIES TIMEOUT 500)\r\n   set_tests_properties(${TEST_TYPE}_physics PROPERTIES TIMEOUT 500)\r\n\r\n+  set_tests_properties(${TEST_TYPE}_world_clone PROPERTIES TIMEOUT 10)\r\n+\r\n   # Add plugin dependency\r\n   add_dependencies(${TEST_TYPE}_joint_test SpringTestPlugin)\r\n endif()\r\ndiff -r 7cf2bfe6c08a test/integration/world_clone.cc\r\n--- a/test/integration/world_clone.cc   Fri Oct 10 11:41:12 2014 -0700\r\n+++ b/test/integration/world_clone.cc   Tue Oct 14 15:23:37 2014 -0700\r\n@@ -195,7 +195,7 @@\r\n   // Check that the cloned world contains the camera topics.\r\n   output = custom_exec_str(\"gz topic -l\");\r\n   EXPECT_NE(output.find(\"/gazebo/default/camera/\"), std::string::npos);\r\n-\r\n+FAIL();\r\n   // Kill the cloned server. In the case of no presence of gzserver ps will\r\n   // return the own ps process so it probably will do nothing. No effect.\r\n   // This should work on Linux and Mac\r\n~~~\r\nand then run the following command:\r\n~~~\r\n$ make test ARGS=\"-VV -R INTEGRATION_world_clone\"\r\n...\r\n$ ps ax | grep 'gzserver.*clone'\r\n~~~\r\nApply the patch to default to see the failure, apply it to this branch to see the fix.\r\n\r\nI was going to wait for a time when there were fewer open pull requests, but I just had to fix another build machine, so I decided it would be helpful sooner than later.", "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)", "destination": {"commit": {"hash": "e158b5e5c9d1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/e158b5e5c9d1.json"}, "html": {"href": "#!/osrf/gazebo/commits/e158b5e5c9d1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "d1f76681b06f", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d1f76681b06f.json"}, "html": {"href": "#!/osrf/gazebo/commits/d1f76681b06f"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "issue_1299"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2014-10-16T17:31:11.996830+00:00"}, "pull_request": {"type": "pullrequest", "id": 1232, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/1232.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/1232"}}, "title": "Kill rogue gzservers left over from failed INTEGRATION_world_clone tests (#1299)"}}]}