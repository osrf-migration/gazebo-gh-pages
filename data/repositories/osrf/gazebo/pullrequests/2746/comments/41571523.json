{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2746/comments/41571523.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2746/_/diff#comment-41571523"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2746, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2746.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2746"}}, "title": "Fix issue with visuals in gzclient after an entity gets deleted"}, "content": {"raw": "Hi @ocrave , thanks for the pull request! I'm wondering if there is a way to write a test for this. \n\nI'm trying to understand the problem, I think you're suggesting that when an entity is deleted and its `visPub` is destroyed, `rendering::Scene`'s `visSub` is destroyed/unsubscribed? Or is it not unsubscribed, but still stops receiving messages?\n\nI did a quick test to see if it was being unsubscribed and it looks like it isn't. What I did:\n\n1. Added print outs to the subscriber:\n\n        diff -r 40c062da7dcc gazebo/transport/Subscriber.cc\n        --- a/gazebo/transport/Subscriber.cc  Tue Jul 25 14:09:17 2017 -0700\n        +++ b/gazebo/transport/Subscriber.cc  Wed Jul 26 11:36:25 2017 -0700\n        @@ -40,6 +40,7 @@\n         //////////////////////////////////////////////////\n         Subscriber::~Subscriber()\n         {\n        +gzdbg << \"Destroy \" << this->topic << std::endl;\n           this->Unsubscribe();\n           this->node.reset();\n         }\n        @@ -53,6 +54,7 @@\n         //////////////////////////////////////////////////\n         void Subscriber::Unsubscribe() const\n         {\n        +gzdbg << \"Unsub \" << this->topic << std::endl;\n           if (this->node)\n           {\n             TopicManager::Instance()->Unsubscribe(this->topic, this->node);\n\n1. Started the blank world:\n\n        gazebo --verbose worlds/blank.world\n\n1. Checked that there is a subscriber but no publisher yet:\n\n        gz topic -i /gazebo/default/visual\n\n1. Then inserted a box and checked that there is now a publisher\n\n1. Deleted the box, the print outs don't show up and I can verify from the command line that there is still a subscriber, but no more publisher", "markup": "markdown", "html": "<p>Hi @ocrave , thanks for the pull request! I'm wondering if there is a way to write a test for this. </p>\n<p>I'm trying to understand the problem, I think you're suggesting that when an entity is deleted and its <code>visPub</code> is destroyed, <code>rendering::Scene</code>'s <code>visSub</code> is destroyed/unsubscribed? Or is it not unsubscribed, but still stops receiving messages?</p>\n<p>I did a quick test to see if it was being unsubscribed and it looks like it isn't. What I did:</p>\n<ol>\n<li>\n<p>Added print outs to the subscriber:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 40c062da7dcc gazebo/transport/Subscriber.cc</span>\n<span class=\"gd\">--- a/gazebo/transport/Subscriber.cc  Tue Jul 25 14:09:17 2017 -0700</span>\n<span class=\"gi\">+++ b/gazebo/transport/Subscriber.cc  Wed Jul 26 11:36:25 2017 -0700</span>\n<span class=\"gu\">@@ -40,6 +40,7 @@</span>\n //////////////////////////////////////////////////\n Subscriber::~Subscriber()\n {\n<span class=\"gi\">+gzdbg &lt;&lt; &quot;Destroy &quot; &lt;&lt; this-&gt;topic &lt;&lt; std::endl;</span>\n   this-&gt;Unsubscribe();\n   this-&gt;node.reset();\n }\n<span class=\"gu\">@@ -53,6 +54,7 @@</span>\n //////////////////////////////////////////////////\n void Subscriber::Unsubscribe() const\n {\n<span class=\"gi\">+gzdbg &lt;&lt; &quot;Unsub &quot; &lt;&lt; this-&gt;topic &lt;&lt; std::endl;</span>\n   if (this-&gt;node)\n   {\n     TopicManager::Instance()-&gt;Unsubscribe(this-&gt;topic, this-&gt;node);\n</pre></div>\n\n\n</li>\n<li>\n<p>Started the blank world:</p>\n<div class=\"codehilite\"><pre><span></span>gazebo --verbose worlds/blank.world\n</pre></div>\n\n\n</li>\n<li>\n<p>Checked that there is a subscriber but no publisher yet:</p>\n<div class=\"codehilite\"><pre><span></span>gz topic -i /gazebo/default/visual\n</pre></div>\n\n\n</li>\n<li>\n<p>Then inserted a box and checked that there is now a publisher</p>\n</li>\n<li>\n<p>Deleted the box, the print outs don't show up and I can verify from the command line that there is still a subscriber, but no more publisher</p>\n</li>\n</ol>", "type": "rendered"}, "created_on": "2017-07-26T18:40:59.166963+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2017-07-26T18:40:59.230228+00:00", "type": "pullrequest_comment", "id": 41571523}