{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/673/comments/565634.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/673/_/diff#comment-565634"}}, "parent": {"id": 565480, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/673/comments/565480.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/673/_/diff#comment-565480"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 673, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/673.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/673"}}, "title": "Fix force torque unit test issue #813"}, "content": {"raw": "looking at it, stepping through physics, the behavior of the dropping block looks correct all the way through impact, but the reported pose got crazy upon contact:\n~~~\nError [physics.cc:235] m[link_offset_box] i[688/1195] pm[0 0 0.533389 0 0 0] pb[1000 1000 0.533389 0 0 0] v[0 0 -6.9482]\nError [physics.cc:235] m[link_offset_box] i[689/1195] pm[0 0 0.526431 0 0 0] pb[1000 1000 0.526431 0 0 0] v[0 0 -6.958]\nError [physics.cc:235] m[link_offset_box] i[690/1195] pm[0 0 0.519463 0 0 0] pb[1000 1000 0.519463 0 0 0] v[0 0 -6.9678]\nError [physics.cc:235] m[link_offset_box] i[691/1195] pm[0 0 0.512486 0 0 0] pb[1000 1000 0.512486 0 0 0] v[0 0 -6.9776]\nError [physics.cc:235] m[link_offset_box] i[692/1195] pm[0 0 0.505498 0 0 0] pb[1000 1000 0.505498 0 0 0] v[0 0 -6.9874]\nError [physics.cc:235] m[link_offset_box] i[693/1195] pm[0.000318 0.000528 -1.39407 0.000947 -0.000947 -1e-06] pb[1000 1000 0.499053 0.000947 -0.000947 -1e-06] v[-0.473194 -0.473203 -6.44511]\nError [physics.cc:235] m[link_offset_box] i[694/1195] pm[6.7e-05 0.000324 -1.01597 0.000758 -0.000758 -0] pb[1000 1000 0.499242 0.000758 -0.000758 -0] v[0.094656 0.094657 0.18932]\nError [physics.cc:235] m[link_offset_box] i[695/1195] pm[0.123397 -0.123368 -0.616764 0.000453 -0.000663 0.000123] pb[1000 1000 0.499442 0.000453 -0.000663 0.000123] v[0.082727 0.065305 0.19934]\nError [physics.cc:235] m[link_offset_box] i[696/1195] pm[0.246597 -0.246726 -0.236697 0.000159 -0.000577 0.000247] pb[1000 1000 0.499632 0.000159 -0.000577 0.000247] v[0.083066 0.065628 0.190008]\nError [physics.cc:235] m[link_offset_box] i[697/1195] pm[0.369672 -0.369776 0.124767 -0.000127 -0.000502 0.00037] pb[1000 1000 0.499812 -0.000127 -0.000502 0.00037] v[0.083394 0.065942 0.180663]\n~~~\n\nNotice that `pb` is the pose of the link named `body` and `pm` is the pose of the model.\n\n`pb` appears correct, but `pm` is incorrect after contact.  The error in `pm` might be amplifying any small errors in block orientation to report back a pose that is `sqrt(2)*100` meters away from the body.\n\nWith the friction turned off (as friction coefficient was ignored before this pull request), the test passes.  On contact, the model pose still oscillates quite a bit (e.g. z goes as high as +6.4m).\n~~~\nError [physics.cc:235] m[link_offset_box] i[692/1195] pm[0 0 0.505498 0 0 0] pb[1000 1000 0.505498 0 0 0] v[0 0 -6.9874]\nError [physics.cc:235] m[link_offset_box] i[693/1195] pm[0.001915 0.001915 -2.26872 0.001384 -0.001384 -1e-06] pb[1000 1000 0.498616 0.001384 -0.001384 -1e-06] v[0 0 -6.88187]\nError [physics.cc:235] m[link_offset_box] i[694/1195] pm[0.001224 0.001224 -1.71421 0.001107 -0.001107 -1e-06] pb[1000 1000 0.498893 0.001107 -0.001107 -1e-06] v[0 0 0.276543]\nError [physics.cc:235] m[link_offset_box] i[695/1195] pm[0.000704 0.000704 -1.17934 0.000839 -0.000839 -0] pb[1000 1000 0.49916 0.000839 -0.000839 -0] v[0 0 0.26756]\nError [physics.cc:235] m[link_offset_box] i[696/1195] pm[0.000337 0.000337 -0.662429 0.000581 -0.000581 -0] pb[1000 1000 0.499419 0.000581 -0.000581 -0] v[0 0 0.258508]\nError [physics.cc:235] m[link_offset_box] i[697/1195] pm[0.00011 0.00011 -0.163491 0.000332 -0.000332 -0] pb[1000 1000 0.499668 0.000332 -0.000332 -0] v[0 0 0.249456]\nError [physics.cc:235] m[link_offset_box] i[698/1195] pm[8e-06 8e-06 0.317462 9.1e-05 -9.1e-05 -0] pb[1000 1000 0.499909 9.1e-05 -9.1e-05 -0] v[0 0 0.240405]\nError [physics.cc:235] m[link_offset_box] i[699/1195] pm[2e-05 2e-05 0.780419 -0.00014 0.00014 -0] pb[1000 1000 0.50014 -0.00014 0.00014 -0] v[0 0 0.231355]\nError [physics.cc:235] m[link_offset_box] i[700/1195] pm[0.000131 0.000131 1.22537 -0.000363 0.000363 -0] pb[1000 1000 0.500362 -0.000363 0.000363 -0] v[0 0 0.222305]\nError [physics.cc:235] m[link_offset_box] i[701/1195] pm[0.000332 0.000332 1.6523 -0.000576 0.000576 -0] pb[1000 1000 0.500576 -0.000576 0.000576 -0] v[0 0 0.213256]\nError [physics.cc:235] m[link_offset_box] i[702/1195] pm[0.000609 0.000609 2.06119 -0.00078 0.00078 -0] pb[1000 1000 0.50078 -0.00078 0.00078 -0] v[0 0 0.204207]\nError [physics.cc:235] m[link_offset_box] i[703/1195] pm[0.000952 0.000952 2.45205 -0.000976 0.000976 -0] pb[1000 1000 0.500975 -0.000976 0.000976 -0] v[0 0 0.195159]\nError [physics.cc:235] m[link_offset_box] i[704/1195] pm[0.00135 0.00135 2.82486 -0.001162 0.001162 -1e-06] pb[1000 1000 0.501161 -0.001162 0.001162 -1e-06] v[0 0 0.186112]\nError [physics.cc:235] m[link_offset_box] i[705/1195] pm[0.001793 0.001793 3.17962 -0.001339 0.001339 -1e-06] pb[1000 1000 0.501338 -0.001339 0.001339 -1e-06] v[0 0 0.177065]\nError [physics.cc:235] m[link_offset_box] i[706/1195] pm[0.002272 0.002272 3.51631 -0.001507 0.001507 -1e-06] pb[1000 1000 0.501506 -0.001507 0.001507 -1e-06] v[0 0 0.168018]\nError [physics.cc:235] m[link_offset_box] i[707/1195] pm[0.002778 0.002778 3.83492 -0.001667 0.001667 -1e-06] pb[1000 1000 0.501665 -0.001667 0.001667 -1e-06] v[0 0 0.158972]\nError [physics.cc:235] m[link_offset_box] i[708/1195] pm[0.003301 0.003301 4.13545 -0.001817 0.001817 -2e-06] pb[1000 1000 0.501815 -0.001817 0.001817 -2e-06] v[0 0 0.149927]\nError [physics.cc:235] m[link_offset_box] i[709/1195] pm[0.003834 0.003834 4.41789 -0.001958 0.001958 -2e-06] pb[1000 1000 0.501956 -0.001958 0.001958 -2e-06] v[0 0 0.140882]\nError [physics.cc:235] m[link_offset_box] i[710/1195] pm[0.004368 0.004368 4.68223 -0.00209 0.00209 -2e-06] pb[1000 1000 0.502088 -0.00209 0.00209 -2e-06] v[0 0 0.131837]\nError [physics.cc:235] m[link_offset_box] i[711/1195] pm[0.004898 0.004898 4.92847 -0.002213 0.002213 -2e-06] pb[1000 1000 0.502211 -0.002213 0.002213 -2e-06] v[0 0 0.122793]\nError [physics.cc:235] m[link_offset_box] i[712/1195] pm[0.005416 0.005416 5.1566 -0.002327 0.002327 -3e-06] pb[1000 1000 0.502324 -0.002327 0.002327 -3e-06] v[0 0 0.113749]\nError [physics.cc:235] m[link_offset_box] i[713/1195] pm[0.005915 0.005915 5.36662 -0.002432 0.002432 -3e-06] pb[1000 1000 0.502429 -0.002432 0.002432 -3e-06] v[0 0 0.104705]\nError [physics.cc:235] m[link_offset_box] i[714/1195] pm[0.006391 0.006391 5.55851 -0.002528 0.002528 -3e-06] pb[1000 1000 0.502525 -0.002528 0.002528 -3e-06] v[0 0 0.095661]\nError [physics.cc:235] m[link_offset_box] i[715/1195] pm[0.006837 0.006837 5.73228 -0.002615 0.002615 -3e-06] pb[1000 1000 0.502611 -0.002615 0.002615 -3e-06] v[0 0 0.086618]\nError [physics.cc:235] m[link_offset_box] i[716/1195] pm[0.00725 0.00725 5.88793 -0.002693 0.002693 -4e-06] pb[1000 1000 0.502689 -0.002693 0.002693 -4e-06] v[0 0 0.077575]\nError [physics.cc:235] m[link_offset_box] i[717/1195] pm[0.007625 0.007625 6.02544 -0.002761 0.002761 -4e-06] pb[1000 1000 0.502758 -0.002761 0.002761 -4e-06] v[0 0 0.068533]\nError [physics.cc:235] m[link_offset_box] i[718/1195] pm[0.007958 0.007958 6.14481 -0.002821 0.002821 -4e-06] pb[1000 1000 0.502817 -0.002821 0.002821 -4e-06] v[0 0 0.05949]\nError [physics.cc:235] m[link_offset_box] i[719/1195] pm[0.008246 0.008246 6.24605 -0.002872 0.002872 -4e-06] pb[1000 1000 0.502867 -0.002872 0.002872 -4e-06] v[0 0 0.050448]\nError [physics.cc:235] m[link_offset_box] i[720/1195] pm[0.008486 0.008486 6.32914 -0.002913 0.002913 -4e-06] pb[1000 1000 0.502909 -0.002913 0.002913 -4e-06] v[0 0 0.041406]\nError [physics.cc:235] m[link_offset_box] i[721/1195] pm[0.008676 0.008676 6.39409 -0.002946 0.002946 -4e-06] pb[1000 1000 0.502941 -0.002946 0.002946 -4e-06] v[0 0 0.032364]\nError [physics.cc:235] m[link_offset_box] i[722/1195] pm[0.008815 0.008815 6.4409 -0.002969 0.002969 -4e-06] pb[1000 1000 0.502965 -0.002969 0.002969 -4e-06] v[0 0 0.023322]\nError [physics.cc:235] m[link_offset_box] i[723/1195] pm[0.0089 0.0089 6.46956 -0.002983 0.002983 -4e-06] pb[1000 1000 0.502979 -0.002983 0.002983 -4e-06] v[0 0 0.01428]\nError [physics.cc:235] m[link_offset_box] i[724/1195] pm[0.008931 0.008931 6.48007 -0.002989 0.002989 -4e-06] pb[1000 1000 0.502984 -0.002989 0.002989 -4e-06] v[0 0 0.005238]\nError [physics.cc:235] m[link_offset_box] i[725/1195] pm[0.008909 0.008909 6.47244 -0.002985 0.002985 -4e-06] pb[1000 1000 0.50298 -0.002985 0.002985 -4e-06] v[0 0 -0.003804]\nError [physics.cc:235] m[link_offset_box] i[726/1195] pm[0.008832 0.008832 6.44666 -0.002972 0.002972 -4e-06] pb[1000 1000 0.502967 -0.002972 0.002972 -4e-06] v[0 0 -0.012845]\nError [physics.cc:235] m[link_offset_box] i[727/1195] pm[0.008702 0.008702 6.40273 -0.00295 0.00295 -4e-06] pb[1000 1000 0.502946 -0.00295 0.00295 -4e-06] v[0 0 -0.021887]\nError [physics.cc:235] m[link_offset_box] i[728/1195] pm[0.00852 0.00852 6.34066 -0.002919 0.002919 -4e-06] pb[1000 1000 0.502915 -0.002919 0.002919 -4e-06] v[0 0 -0.030929]\nError [physics.cc:235] m[link_offset_box] i[729/1195] pm[0.008287 0.008287 6.26044 -0.002879 0.002879 -4e-06] pb[1000 1000 0.502875 -0.002879 0.002879 -4e-06] v[0 0 -0.039971]\nError [physics.cc:235] m[link_offset_box] i[730/1195] pm[0.008007 0.008007 6.16208 -0.00283 0.00283 -4e-06] pb[1000 1000 0.502826 -0.00283 0.00283 -4e-06] v[0 0 -0.049013]\nError [physics.cc:235] m[link_offset_box] i[731/1195] pm[0.007681 0.007681 6.04559 -0.002771 0.002771 -4e-06] pb[1000 1000 0.502768 -0.002771 0.002771 -4e-06] v[0 0 -0.058056]\nError [physics.cc:235] m[link_offset_box] i[732/1195] pm[0.007312 0.007312 5.91096 -0.002704 0.002704 -4e-06] pb[1000 1000 0.5027 -0.002704 0.002704 -4e-06] v[0 0 -0.067098]\nError [physics.cc:235] m[link_offset_box] i[733/1195] pm[0.006905 0.006905 5.75819 -0.002628 0.002628 -3e-06] pb[1000 1000 0.502624 -0.002628 0.002628 -3e-06] v[0 0 -0.076141]\nError [physics.cc:235] m[link_offset_box] i[734/1195] pm[0.006464 0.006464 5.58729 -0.002542 0.002542 -3e-06] pb[1000 1000 0.502539 -0.002542 0.002542 -3e-06] v[0 0 -0.085184]\nError [physics.cc:235] m[link_offset_box] i[735/1195] pm[0.005992 0.005992 5.39827 -0.002448 0.002448 -3e-06] pb[1000 1000 0.502445 -0.002448 0.002448 -3e-06] v[0 0 -0.094227]\nError [physics.cc:235] m[link_offset_box] i[736/1195] pm[0.005496 0.005496 5.19113 -0.002344 0.002344 -3e-06] pb[1000 1000 0.502342 -0.002344 0.002344 -3e-06] v[0 0 -0.10327]\nError [physics.cc:235] m[link_offset_box] i[737/1195] pm[0.004981 0.004981 4.96588 -0.002232 0.002232 -2e-06] pb[1000 1000 0.502229 -0.002232 0.002232 -2e-06] v[0 0 -0.112314]\nError [physics.cc:235] m[link_offset_box] i[738/1195] pm[0.004453 0.004453 4.72251 -0.00211 0.00211 -2e-06] pb[1000 1000 0.502108 -0.00211 0.00211 -2e-06] v[0 0 -0.121358]\nError [physics.cc:235] m[link_offset_box] i[739/1195] pm[0.003919 0.003919 4.46104 -0.00198 0.00198 -2e-06] pb[1000 1000 0.501978 -0.00198 0.00198 -2e-06] v[0 0 -0.130402]\nError [physics.cc:235] m[link_offset_box] i[740/1195] pm[0.003385 0.003385 4.18147 -0.00184 0.00184 -2e-06] pb[1000 1000 0.501838 -0.00184 0.00184 -2e-06] v[0 0 -0.139446]\nError [physics.cc:235] m[link_offset_box] i[741/1195] pm[0.00286 0.00286 3.88381 -0.001691 0.001691 -1e-06] pb[1000 1000 0.50169 -0.001691 0.001691 -1e-06] v[0 0 -0.148492]\nError [physics.cc:235] m[link_offset_box] i[742/1195] pm[0.002351 0.002351 3.56807 -0.001533 0.001533 -1e-06] pb[1000 1000 0.501532 -0.001533 0.001533 -1e-06] v[0 0 -0.157537]\nError [physics.cc:235] m[link_offset_box] i[743/1195] pm[0.001867 0.001867 3.23425 -0.001366 0.001366 -1e-06] pb[1000 1000 0.501366 -0.001366 0.001366 -1e-06] v[0 0 -0.166583]\nError [physics.cc:235] m[link_offset_box] i[744/1195] pm[0.001417 0.001417 2.88236 -0.001191 0.001191 -1e-06] pb[1000 1000 0.50119 -0.001191 0.001191 -1e-06] v[0 0 -0.175629]\nError [physics.cc:235] m[link_offset_box] i[745/1195] pm[0.001011 0.001011 2.51241 -0.001006 0.001006 -1e-06] pb[1000 1000 0.501005 -0.001006 0.001006 -1e-06] v[0 0 -0.184676]\nError [physics.cc:235] m[link_offset_box] i[746/1195] pm[0.000659 0.000659 2.12442 -0.000812 0.000812 -0] pb[1000 1000 0.500811 -0.000812 0.000812 -0] v[0 0 -0.193724]\nError [physics.cc:235] m[link_offset_box] i[747/1195] pm[0.000371 0.000371 1.71838 -0.000609 0.000609 -0] pb[1000 1000 0.500609 -0.000609 0.000609 -0] v[0 0 -0.202771]\nError [physics.cc:235] m[link_offset_box] i[748/1195] pm[0.000158 0.000158 1.29431 -0.000397 0.000397 -0] pb[1000 1000 0.500397 -0.000397 0.000397 -0] v[0 0 -0.21182]\nError [physics.cc:235] m[link_offset_box] i[749/1195] pm[3.1e-05 3.1e-05 0.852223 -0.000176 0.000176 -0] pb[1000 1000 0.500176 -0.000176 0.000176 -0] v[0 0 -0.220869]\nError [physics.cc:235] m[link_offset_box] i[750/1195] pm[0 0 0.5 0 -0 -0] pb[1000 1000 0.5 0 -0 -0] v[0 0 -0.176017]\n~~~\nWhen the block finally settles, the converged resting pose puts model pose back to (0, 0, 0.5).  This seems to indicate we don't have the enough contact resolution for modeling perfectly inelastic contact behavior (with split impulse), whereas for reference, the position correction projection in ode has less transitional noise on contact:\n~~~\nrror [physics.cc:235] m[link_offset_box] i[692/1195] pm[0 0 0.505498 0 0 0] pb[1000 1000 0.505498 0 0 0] v[0 0 -6.9874]\nError [physics.cc:235] m[link_offset_box] i[693/1195] pm[0 0 0.498501 0 0 0] pb[1000 1000 0.498501 0 0 0] v[0 0 -6.9972]\nError [physics.cc:235] m[link_offset_box] i[694/1195] pm[6e-06 -1e-06 0.50896 2e-06 1.1e-05 0] pb[1000 1000 0.500001 2e-06 1.1e-05 0] v[0.004529 -0.000833 0.010775]\nError [physics.cc:235] m[link_offset_box] i[695/1195] pm[0.000113 -0.000107 0.511856 1e-06 1.3e-05 0] pb[1000 1000 0.500006 1e-06 1.3e-05 0] v[0.000795 0.000553 0.00533]\nError [physics.cc:235] m[link_offset_box] i[696/1195] pm[0.000208 -0.0002 0.514755 -3e-06 1.1e-05 0] pb[1000 1000 0.500003 -3e-06 1.1e-05 0] v[-0.000652 0.001999 -0.002784]\nError [physics.cc:235] m[link_offset_box] i[697/1195] pm[-1.1e-05 1e-05 0.498484 -1e-06 -3e-06 -0] pb[1000 1000 0.499998 -1e-06 -3e-06 -0] v[-0.007152 -0.00081 -0.004999]\nError [physics.cc:235] m[link_offset_box] i[698/1195] pm[-1e-05 1e-05 0.499579 -0 -0 -0] pb[1000 1000 0.5 -0 -0 -0] v[0.001252 -0.000706 0.001558]\nError [physics.cc:235] m[link_offset_box] i[699/1195] pm[-3.1e-05 3.5e-05 0.508457 0 9e-06 -0] pb[1000 1000 0.499996 0 9e-06 -0] v[0.004545 -0.000127 -0.0044]\nError [physics.cc:235] m[link_offset_box] i[700/1195] pm[-3.6e-05 3.6e-05 0.500437 0 0 -0] pb[1000 1000 0.5 0 0 -0] v[-0.004082 7e-05 0.004401]\nError [physics.cc:235] m[link_offset_box] i[701/1195] pm[-4.1e-05 3.7e-05 0.490923 -0 -9e-06 -0] pb[1000 1000 0.499995 -0 -9e-06 -0] v[-0.004774 2e-05 -0.004592]\nError [physics.cc:235] m[link_offset_box] i[702/1195] pm[-3.7e-05 3.7e-05 0.499389 -0 -1e-06 -0] pb[1000 1000 0.5 -0 -1e-06 -0] v[0.004173 5.3e-05 0.004567]\nError [physics.cc:235] m[link_offset_box] i[703/1195] pm[-2.5e-05 2.9e-05 0.508959 -0 9e-06 -0] pb[1000 1000 0.499996 -0 9e-06 -0] v[0.004816 -2.2e-05 -0.004483]\nError [physics.cc:235] m[link_offset_box] i[704/1195] pm[-2.8e-05 2.8e-05 0.500526 -0 0 -0] pb[1000 1000 0.5 -0 0 -0] v[-0.004208 -1e-05 0.00451]\nError [physics.cc:235] m[link_offset_box] i[705/1195] pm[-3.5e-05 3.1e-05 0.49091 -0 -9e-06 -0] pb[1000 1000 0.499995 -0 -9e-06 -0] v[-0.004797 -7e-06 -0.004604]\nError [physics.cc:235] m[link_offset_box] i[706/1195] pm[-3.2e-05 3.2e-05 0.499534 -0 -0 -0] pb[1000 1000 0.5 -0 -0 -0] v[0.0043 8e-06 0.004604]\nError [physics.cc:235] m[link_offset_box] i[707/1195] pm[-2.4e-05 2.9e-05 0.509124 -0 9e-06 -0] pb[1000 1000 0.499995 -0 9e-06 -0] v[0.004804 -4e-06 -0.004608]\n~~~\nHard-coding inner iterations to 300 reduced errors in bullet and made the test pass.  (All 16 tests in `test/integration/physics.cc` pass now).", "markup": "markdown", "html": "<p>looking at it, stepping through physics, the behavior of the dropping block looks correct all the way through impact, but the reported pose got crazy upon contact:</p>\n<div class=\"codehilite\"><pre><span></span>Error [physics.cc:235] m[link_offset_box] i[688/1195] pm[0 0 0.533389 0 0 0] pb[1000 1000 0.533389 0 0 0] v[0 0 -6.9482]\nError [physics.cc:235] m[link_offset_box] i[689/1195] pm[0 0 0.526431 0 0 0] pb[1000 1000 0.526431 0 0 0] v[0 0 -6.958]\nError [physics.cc:235] m[link_offset_box] i[690/1195] pm[0 0 0.519463 0 0 0] pb[1000 1000 0.519463 0 0 0] v[0 0 -6.9678]\nError [physics.cc:235] m[link_offset_box] i[691/1195] pm[0 0 0.512486 0 0 0] pb[1000 1000 0.512486 0 0 0] v[0 0 -6.9776]\nError [physics.cc:235] m[link_offset_box] i[692/1195] pm[0 0 0.505498 0 0 0] pb[1000 1000 0.505498 0 0 0] v[0 0 -6.9874]\nError [physics.cc:235] m[link_offset_box] i[693/1195] pm[0.000318 0.000528 -1.39407 0.000947 -0.000947 -1e-06] pb[1000 1000 0.499053 0.000947 -0.000947 -1e-06] v[-0.473194 -0.473203 -6.44511]\nError [physics.cc:235] m[link_offset_box] i[694/1195] pm[6.7e-05 0.000324 -1.01597 0.000758 -0.000758 -0] pb[1000 1000 0.499242 0.000758 -0.000758 -0] v[0.094656 0.094657 0.18932]\nError [physics.cc:235] m[link_offset_box] i[695/1195] pm[0.123397 -0.123368 -0.616764 0.000453 -0.000663 0.000123] pb[1000 1000 0.499442 0.000453 -0.000663 0.000123] v[0.082727 0.065305 0.19934]\nError [physics.cc:235] m[link_offset_box] i[696/1195] pm[0.246597 -0.246726 -0.236697 0.000159 -0.000577 0.000247] pb[1000 1000 0.499632 0.000159 -0.000577 0.000247] v[0.083066 0.065628 0.190008]\nError [physics.cc:235] m[link_offset_box] i[697/1195] pm[0.369672 -0.369776 0.124767 -0.000127 -0.000502 0.00037] pb[1000 1000 0.499812 -0.000127 -0.000502 0.00037] v[0.083394 0.065942 0.180663]\n</pre></div>\n\n\n<p>Notice that <code>pb</code> is the pose of the link named <code>body</code> and <code>pm</code> is the pose of the model.</p>\n<p><code>pb</code> appears correct, but <code>pm</code> is incorrect after contact.  The error in <code>pm</code> might be amplifying any small errors in block orientation to report back a pose that is <code>sqrt(2)*100</code> meters away from the body.</p>\n<p>With the friction turned off (as friction coefficient was ignored before this pull request), the test passes.  On contact, the model pose still oscillates quite a bit (e.g. z goes as high as +6.4m).</p>\n<div class=\"codehilite\"><pre><span></span>Error [physics.cc:235] m[link_offset_box] i[692/1195] pm[0 0 0.505498 0 0 0] pb[1000 1000 0.505498 0 0 0] v[0 0 -6.9874]\nError [physics.cc:235] m[link_offset_box] i[693/1195] pm[0.001915 0.001915 -2.26872 0.001384 -0.001384 -1e-06] pb[1000 1000 0.498616 0.001384 -0.001384 -1e-06] v[0 0 -6.88187]\nError [physics.cc:235] m[link_offset_box] i[694/1195] pm[0.001224 0.001224 -1.71421 0.001107 -0.001107 -1e-06] pb[1000 1000 0.498893 0.001107 -0.001107 -1e-06] v[0 0 0.276543]\nError [physics.cc:235] m[link_offset_box] i[695/1195] pm[0.000704 0.000704 -1.17934 0.000839 -0.000839 -0] pb[1000 1000 0.49916 0.000839 -0.000839 -0] v[0 0 0.26756]\nError [physics.cc:235] m[link_offset_box] i[696/1195] pm[0.000337 0.000337 -0.662429 0.000581 -0.000581 -0] pb[1000 1000 0.499419 0.000581 -0.000581 -0] v[0 0 0.258508]\nError [physics.cc:235] m[link_offset_box] i[697/1195] pm[0.00011 0.00011 -0.163491 0.000332 -0.000332 -0] pb[1000 1000 0.499668 0.000332 -0.000332 -0] v[0 0 0.249456]\nError [physics.cc:235] m[link_offset_box] i[698/1195] pm[8e-06 8e-06 0.317462 9.1e-05 -9.1e-05 -0] pb[1000 1000 0.499909 9.1e-05 -9.1e-05 -0] v[0 0 0.240405]\nError [physics.cc:235] m[link_offset_box] i[699/1195] pm[2e-05 2e-05 0.780419 -0.00014 0.00014 -0] pb[1000 1000 0.50014 -0.00014 0.00014 -0] v[0 0 0.231355]\nError [physics.cc:235] m[link_offset_box] i[700/1195] pm[0.000131 0.000131 1.22537 -0.000363 0.000363 -0] pb[1000 1000 0.500362 -0.000363 0.000363 -0] v[0 0 0.222305]\nError [physics.cc:235] m[link_offset_box] i[701/1195] pm[0.000332 0.000332 1.6523 -0.000576 0.000576 -0] pb[1000 1000 0.500576 -0.000576 0.000576 -0] v[0 0 0.213256]\nError [physics.cc:235] m[link_offset_box] i[702/1195] pm[0.000609 0.000609 2.06119 -0.00078 0.00078 -0] pb[1000 1000 0.50078 -0.00078 0.00078 -0] v[0 0 0.204207]\nError [physics.cc:235] m[link_offset_box] i[703/1195] pm[0.000952 0.000952 2.45205 -0.000976 0.000976 -0] pb[1000 1000 0.500975 -0.000976 0.000976 -0] v[0 0 0.195159]\nError [physics.cc:235] m[link_offset_box] i[704/1195] pm[0.00135 0.00135 2.82486 -0.001162 0.001162 -1e-06] pb[1000 1000 0.501161 -0.001162 0.001162 -1e-06] v[0 0 0.186112]\nError [physics.cc:235] m[link_offset_box] i[705/1195] pm[0.001793 0.001793 3.17962 -0.001339 0.001339 -1e-06] pb[1000 1000 0.501338 -0.001339 0.001339 -1e-06] v[0 0 0.177065]\nError [physics.cc:235] m[link_offset_box] i[706/1195] pm[0.002272 0.002272 3.51631 -0.001507 0.001507 -1e-06] pb[1000 1000 0.501506 -0.001507 0.001507 -1e-06] v[0 0 0.168018]\nError [physics.cc:235] m[link_offset_box] i[707/1195] pm[0.002778 0.002778 3.83492 -0.001667 0.001667 -1e-06] pb[1000 1000 0.501665 -0.001667 0.001667 -1e-06] v[0 0 0.158972]\nError [physics.cc:235] m[link_offset_box] i[708/1195] pm[0.003301 0.003301 4.13545 -0.001817 0.001817 -2e-06] pb[1000 1000 0.501815 -0.001817 0.001817 -2e-06] v[0 0 0.149927]\nError [physics.cc:235] m[link_offset_box] i[709/1195] pm[0.003834 0.003834 4.41789 -0.001958 0.001958 -2e-06] pb[1000 1000 0.501956 -0.001958 0.001958 -2e-06] v[0 0 0.140882]\nError [physics.cc:235] m[link_offset_box] i[710/1195] pm[0.004368 0.004368 4.68223 -0.00209 0.00209 -2e-06] pb[1000 1000 0.502088 -0.00209 0.00209 -2e-06] v[0 0 0.131837]\nError [physics.cc:235] m[link_offset_box] i[711/1195] pm[0.004898 0.004898 4.92847 -0.002213 0.002213 -2e-06] pb[1000 1000 0.502211 -0.002213 0.002213 -2e-06] v[0 0 0.122793]\nError [physics.cc:235] m[link_offset_box] i[712/1195] pm[0.005416 0.005416 5.1566 -0.002327 0.002327 -3e-06] pb[1000 1000 0.502324 -0.002327 0.002327 -3e-06] v[0 0 0.113749]\nError [physics.cc:235] m[link_offset_box] i[713/1195] pm[0.005915 0.005915 5.36662 -0.002432 0.002432 -3e-06] pb[1000 1000 0.502429 -0.002432 0.002432 -3e-06] v[0 0 0.104705]\nError [physics.cc:235] m[link_offset_box] i[714/1195] pm[0.006391 0.006391 5.55851 -0.002528 0.002528 -3e-06] pb[1000 1000 0.502525 -0.002528 0.002528 -3e-06] v[0 0 0.095661]\nError [physics.cc:235] m[link_offset_box] i[715/1195] pm[0.006837 0.006837 5.73228 -0.002615 0.002615 -3e-06] pb[1000 1000 0.502611 -0.002615 0.002615 -3e-06] v[0 0 0.086618]\nError [physics.cc:235] m[link_offset_box] i[716/1195] pm[0.00725 0.00725 5.88793 -0.002693 0.002693 -4e-06] pb[1000 1000 0.502689 -0.002693 0.002693 -4e-06] v[0 0 0.077575]\nError [physics.cc:235] m[link_offset_box] i[717/1195] pm[0.007625 0.007625 6.02544 -0.002761 0.002761 -4e-06] pb[1000 1000 0.502758 -0.002761 0.002761 -4e-06] v[0 0 0.068533]\nError [physics.cc:235] m[link_offset_box] i[718/1195] pm[0.007958 0.007958 6.14481 -0.002821 0.002821 -4e-06] pb[1000 1000 0.502817 -0.002821 0.002821 -4e-06] v[0 0 0.05949]\nError [physics.cc:235] m[link_offset_box] i[719/1195] pm[0.008246 0.008246 6.24605 -0.002872 0.002872 -4e-06] pb[1000 1000 0.502867 -0.002872 0.002872 -4e-06] v[0 0 0.050448]\nError [physics.cc:235] m[link_offset_box] i[720/1195] pm[0.008486 0.008486 6.32914 -0.002913 0.002913 -4e-06] pb[1000 1000 0.502909 -0.002913 0.002913 -4e-06] v[0 0 0.041406]\nError [physics.cc:235] m[link_offset_box] i[721/1195] pm[0.008676 0.008676 6.39409 -0.002946 0.002946 -4e-06] pb[1000 1000 0.502941 -0.002946 0.002946 -4e-06] v[0 0 0.032364]\nError [physics.cc:235] m[link_offset_box] i[722/1195] pm[0.008815 0.008815 6.4409 -0.002969 0.002969 -4e-06] pb[1000 1000 0.502965 -0.002969 0.002969 -4e-06] v[0 0 0.023322]\nError [physics.cc:235] m[link_offset_box] i[723/1195] pm[0.0089 0.0089 6.46956 -0.002983 0.002983 -4e-06] pb[1000 1000 0.502979 -0.002983 0.002983 -4e-06] v[0 0 0.01428]\nError [physics.cc:235] m[link_offset_box] i[724/1195] pm[0.008931 0.008931 6.48007 -0.002989 0.002989 -4e-06] pb[1000 1000 0.502984 -0.002989 0.002989 -4e-06] v[0 0 0.005238]\nError [physics.cc:235] m[link_offset_box] i[725/1195] pm[0.008909 0.008909 6.47244 -0.002985 0.002985 -4e-06] pb[1000 1000 0.50298 -0.002985 0.002985 -4e-06] v[0 0 -0.003804]\nError [physics.cc:235] m[link_offset_box] i[726/1195] pm[0.008832 0.008832 6.44666 -0.002972 0.002972 -4e-06] pb[1000 1000 0.502967 -0.002972 0.002972 -4e-06] v[0 0 -0.012845]\nError [physics.cc:235] m[link_offset_box] i[727/1195] pm[0.008702 0.008702 6.40273 -0.00295 0.00295 -4e-06] pb[1000 1000 0.502946 -0.00295 0.00295 -4e-06] v[0 0 -0.021887]\nError [physics.cc:235] m[link_offset_box] i[728/1195] pm[0.00852 0.00852 6.34066 -0.002919 0.002919 -4e-06] pb[1000 1000 0.502915 -0.002919 0.002919 -4e-06] v[0 0 -0.030929]\nError [physics.cc:235] m[link_offset_box] i[729/1195] pm[0.008287 0.008287 6.26044 -0.002879 0.002879 -4e-06] pb[1000 1000 0.502875 -0.002879 0.002879 -4e-06] v[0 0 -0.039971]\nError [physics.cc:235] m[link_offset_box] i[730/1195] pm[0.008007 0.008007 6.16208 -0.00283 0.00283 -4e-06] pb[1000 1000 0.502826 -0.00283 0.00283 -4e-06] v[0 0 -0.049013]\nError [physics.cc:235] m[link_offset_box] i[731/1195] pm[0.007681 0.007681 6.04559 -0.002771 0.002771 -4e-06] pb[1000 1000 0.502768 -0.002771 0.002771 -4e-06] v[0 0 -0.058056]\nError [physics.cc:235] m[link_offset_box] i[732/1195] pm[0.007312 0.007312 5.91096 -0.002704 0.002704 -4e-06] pb[1000 1000 0.5027 -0.002704 0.002704 -4e-06] v[0 0 -0.067098]\nError [physics.cc:235] m[link_offset_box] i[733/1195] pm[0.006905 0.006905 5.75819 -0.002628 0.002628 -3e-06] pb[1000 1000 0.502624 -0.002628 0.002628 -3e-06] v[0 0 -0.076141]\nError [physics.cc:235] m[link_offset_box] i[734/1195] pm[0.006464 0.006464 5.58729 -0.002542 0.002542 -3e-06] pb[1000 1000 0.502539 -0.002542 0.002542 -3e-06] v[0 0 -0.085184]\nError [physics.cc:235] m[link_offset_box] i[735/1195] pm[0.005992 0.005992 5.39827 -0.002448 0.002448 -3e-06] pb[1000 1000 0.502445 -0.002448 0.002448 -3e-06] v[0 0 -0.094227]\nError [physics.cc:235] m[link_offset_box] i[736/1195] pm[0.005496 0.005496 5.19113 -0.002344 0.002344 -3e-06] pb[1000 1000 0.502342 -0.002344 0.002344 -3e-06] v[0 0 -0.10327]\nError [physics.cc:235] m[link_offset_box] i[737/1195] pm[0.004981 0.004981 4.96588 -0.002232 0.002232 -2e-06] pb[1000 1000 0.502229 -0.002232 0.002232 -2e-06] v[0 0 -0.112314]\nError [physics.cc:235] m[link_offset_box] i[738/1195] pm[0.004453 0.004453 4.72251 -0.00211 0.00211 -2e-06] pb[1000 1000 0.502108 -0.00211 0.00211 -2e-06] v[0 0 -0.121358]\nError [physics.cc:235] m[link_offset_box] i[739/1195] pm[0.003919 0.003919 4.46104 -0.00198 0.00198 -2e-06] pb[1000 1000 0.501978 -0.00198 0.00198 -2e-06] v[0 0 -0.130402]\nError [physics.cc:235] m[link_offset_box] i[740/1195] pm[0.003385 0.003385 4.18147 -0.00184 0.00184 -2e-06] pb[1000 1000 0.501838 -0.00184 0.00184 -2e-06] v[0 0 -0.139446]\nError [physics.cc:235] m[link_offset_box] i[741/1195] pm[0.00286 0.00286 3.88381 -0.001691 0.001691 -1e-06] pb[1000 1000 0.50169 -0.001691 0.001691 -1e-06] v[0 0 -0.148492]\nError [physics.cc:235] m[link_offset_box] i[742/1195] pm[0.002351 0.002351 3.56807 -0.001533 0.001533 -1e-06] pb[1000 1000 0.501532 -0.001533 0.001533 -1e-06] v[0 0 -0.157537]\nError [physics.cc:235] m[link_offset_box] i[743/1195] pm[0.001867 0.001867 3.23425 -0.001366 0.001366 -1e-06] pb[1000 1000 0.501366 -0.001366 0.001366 -1e-06] v[0 0 -0.166583]\nError [physics.cc:235] m[link_offset_box] i[744/1195] pm[0.001417 0.001417 2.88236 -0.001191 0.001191 -1e-06] pb[1000 1000 0.50119 -0.001191 0.001191 -1e-06] v[0 0 -0.175629]\nError [physics.cc:235] m[link_offset_box] i[745/1195] pm[0.001011 0.001011 2.51241 -0.001006 0.001006 -1e-06] pb[1000 1000 0.501005 -0.001006 0.001006 -1e-06] v[0 0 -0.184676]\nError [physics.cc:235] m[link_offset_box] i[746/1195] pm[0.000659 0.000659 2.12442 -0.000812 0.000812 -0] pb[1000 1000 0.500811 -0.000812 0.000812 -0] v[0 0 -0.193724]\nError [physics.cc:235] m[link_offset_box] i[747/1195] pm[0.000371 0.000371 1.71838 -0.000609 0.000609 -0] pb[1000 1000 0.500609 -0.000609 0.000609 -0] v[0 0 -0.202771]\nError [physics.cc:235] m[link_offset_box] i[748/1195] pm[0.000158 0.000158 1.29431 -0.000397 0.000397 -0] pb[1000 1000 0.500397 -0.000397 0.000397 -0] v[0 0 -0.21182]\nError [physics.cc:235] m[link_offset_box] i[749/1195] pm[3.1e-05 3.1e-05 0.852223 -0.000176 0.000176 -0] pb[1000 1000 0.500176 -0.000176 0.000176 -0] v[0 0 -0.220869]\nError [physics.cc:235] m[link_offset_box] i[750/1195] pm[0 0 0.5 0 -0 -0] pb[1000 1000 0.5 0 -0 -0] v[0 0 -0.176017]\n</pre></div>\n\n\n<p>When the block finally settles, the converged resting pose puts model pose back to (0, 0, 0.5).  This seems to indicate we don't have the enough contact resolution for modeling perfectly inelastic contact behavior (with split impulse), whereas for reference, the position correction projection in ode has less transitional noise on contact:</p>\n<div class=\"codehilite\"><pre><span></span>rror [physics.cc:235] m[link_offset_box] i[692/1195] pm[0 0 0.505498 0 0 0] pb[1000 1000 0.505498 0 0 0] v[0 0 -6.9874]\nError [physics.cc:235] m[link_offset_box] i[693/1195] pm[0 0 0.498501 0 0 0] pb[1000 1000 0.498501 0 0 0] v[0 0 -6.9972]\nError [physics.cc:235] m[link_offset_box] i[694/1195] pm[6e-06 -1e-06 0.50896 2e-06 1.1e-05 0] pb[1000 1000 0.500001 2e-06 1.1e-05 0] v[0.004529 -0.000833 0.010775]\nError [physics.cc:235] m[link_offset_box] i[695/1195] pm[0.000113 -0.000107 0.511856 1e-06 1.3e-05 0] pb[1000 1000 0.500006 1e-06 1.3e-05 0] v[0.000795 0.000553 0.00533]\nError [physics.cc:235] m[link_offset_box] i[696/1195] pm[0.000208 -0.0002 0.514755 -3e-06 1.1e-05 0] pb[1000 1000 0.500003 -3e-06 1.1e-05 0] v[-0.000652 0.001999 -0.002784]\nError [physics.cc:235] m[link_offset_box] i[697/1195] pm[-1.1e-05 1e-05 0.498484 -1e-06 -3e-06 -0] pb[1000 1000 0.499998 -1e-06 -3e-06 -0] v[-0.007152 -0.00081 -0.004999]\nError [physics.cc:235] m[link_offset_box] i[698/1195] pm[-1e-05 1e-05 0.499579 -0 -0 -0] pb[1000 1000 0.5 -0 -0 -0] v[0.001252 -0.000706 0.001558]\nError [physics.cc:235] m[link_offset_box] i[699/1195] pm[-3.1e-05 3.5e-05 0.508457 0 9e-06 -0] pb[1000 1000 0.499996 0 9e-06 -0] v[0.004545 -0.000127 -0.0044]\nError [physics.cc:235] m[link_offset_box] i[700/1195] pm[-3.6e-05 3.6e-05 0.500437 0 0 -0] pb[1000 1000 0.5 0 0 -0] v[-0.004082 7e-05 0.004401]\nError [physics.cc:235] m[link_offset_box] i[701/1195] pm[-4.1e-05 3.7e-05 0.490923 -0 -9e-06 -0] pb[1000 1000 0.499995 -0 -9e-06 -0] v[-0.004774 2e-05 -0.004592]\nError [physics.cc:235] m[link_offset_box] i[702/1195] pm[-3.7e-05 3.7e-05 0.499389 -0 -1e-06 -0] pb[1000 1000 0.5 -0 -1e-06 -0] v[0.004173 5.3e-05 0.004567]\nError [physics.cc:235] m[link_offset_box] i[703/1195] pm[-2.5e-05 2.9e-05 0.508959 -0 9e-06 -0] pb[1000 1000 0.499996 -0 9e-06 -0] v[0.004816 -2.2e-05 -0.004483]\nError [physics.cc:235] m[link_offset_box] i[704/1195] pm[-2.8e-05 2.8e-05 0.500526 -0 0 -0] pb[1000 1000 0.5 -0 0 -0] v[-0.004208 -1e-05 0.00451]\nError [physics.cc:235] m[link_offset_box] i[705/1195] pm[-3.5e-05 3.1e-05 0.49091 -0 -9e-06 -0] pb[1000 1000 0.499995 -0 -9e-06 -0] v[-0.004797 -7e-06 -0.004604]\nError [physics.cc:235] m[link_offset_box] i[706/1195] pm[-3.2e-05 3.2e-05 0.499534 -0 -0 -0] pb[1000 1000 0.5 -0 -0 -0] v[0.0043 8e-06 0.004604]\nError [physics.cc:235] m[link_offset_box] i[707/1195] pm[-2.4e-05 2.9e-05 0.509124 -0 9e-06 -0] pb[1000 1000 0.499995 -0 9e-06 -0] v[0.004804 -4e-06 -0.004608]\n</pre></div>\n\n\n<p>Hard-coding inner iterations to 300 reduced errors in bullet and made the test pass.  (All 16 tests in <code>test/integration/physics.cc</code> pass now).</p>", "type": "rendered"}, "created_on": "2013-09-13T17:58:55.672873+00:00", "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "updated_on": "2013-09-17T06:36:33.402082+00:00", "type": "pullrequest_comment", "id": 565634}