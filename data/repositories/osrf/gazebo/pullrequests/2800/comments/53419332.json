{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2800/comments/53419332.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2800/_/diff#comment-53419332"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2800, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2800.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2800"}}, "title": "Download a model from Ignition Fuel"}, "content": {"raw": "I'm getting a `[Msg] Waiting for model database update to complete...` msg if I try to insert a fuel's model before the old model database (gazebosim.org) has finished loading. \n\nThe problem is to do with the [createEntity](#!/osrf/gazebo/src/fb56ebf1d7c47c2e696b310bcaa3f3f7b9a7cf9b/gazebo/gui/InsertModelWidget.cc?fileviewer=file-view-default#InsertModelWidget.cc-304) event fired after locating the model. It triggers other places in gui to look for the model  in the old model database. Here's part of the backtrace leading up to that msg\n\n~~~\nThread 1 \"gzclient\" hit Breakpoint 1, gazebo::common::ModelDatabase::GetModels[abi:cxx11]() (this=this@entry=0x7ffff7dcc0b0 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:328\n328\t        gzmsg << \"Waiting for model database update to complete...\\n\";\n(gdb) bt\n#0  gazebo::common::ModelDatabase::GetModels[abi:cxx11]() (this=this@entry=0x7ffff7dcc0b0 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:328\n#1  0x00007ffff6e46513 in gazebo::common::ModelDatabase::HasModel (this=this@entry=0x7ffff7dcc0b0 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>, _modelURI=\"model://beer/materials/scripts\") at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:153\n#2  0x00007ffff6e46a59 in gazebo::common::ModelDatabase::GetModelPath (this=this@entry=0x7ffff7dcc0b0 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>, _uri=\"model://beer/materials/scripts\", _forceDownload=_forceDownload@entry=true) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:412\n#3  0x00007ffff6e71230 in gazebo::common::SystemPaths::FindFileURI (this=this@entry=0x7ffff7dcc380 <SingletonT<gazebo::common::SystemPaths>::GetInstance()::t>, _uri=\"model://beer/materials/scripts\") at /home/docker/ws/src/gazebo/gazebo/common/SystemPaths.cc:320\n#4  0x00007ffff6e70066 in gazebo::common::SystemPaths::FindFile (this=this@entry=0x7ffff7dcc380 <SingletonT<gazebo::common::SystemPaths>::GetInstance()::t>, _filename=\"model://beer/materials/scripts\", _searchLocalPath=_searchLocalPath@entry=true) at /home/docker/ws/src/gazebo/gazebo/common/SystemPaths.cc:344\n#5  0x00007ffff6e28cf7 in gazebo::common::find_file (_file=\"model://beer/materials/scripts\") at /home/docker/ws/src/gazebo/gazebo/common/CommonIface.cc:153\n#6  0x00007ffff6e28e6b in gazebo::common::find_file_path (_file=\"model://beer/materials/scripts\") at /home/docker/ws/src/gazebo/gazebo/common/CommonIface.cc:165\n#7  0x00007ffff5071bb1 in gazebo::rendering::RenderEngine::AddResourcePath (this=this@entry=0x7ffff7dcafe0 <SingletonT<gazebo::rendering::RenderEngine>::GetInstance()::t>, _uri=\"model://beer/materials/scripts\") at /home/docker/ws/src/gazebo/gazebo/rendering/RenderEngine.cc:471\n#8  0x00007ffff50e0fa4 in gazebo::rendering::Visual::Load (this=0x5695dd0) at /home/docker/ws/src/gazebo/gazebo/rendering/Visual.cc:474\n#9  0x00007ffff50ccbd2 in gazebo::rendering::Visual::Load (this=this@entry=0x5695dd0, _sdf=std::shared_ptr (count 3, weak 3) 0x56513c0) at /home/docker/ws/src/gazebo/gazebo/rendering/Visual.cc:341\n#10 0x00007ffff72bba82 in gazebo::gui::ModelMaker::CreateModelFromSDF (this=this@entry=0x18ca560, _modelElem=std::shared_ptr (count 5, weak 2) 0x5487c30) at /home/docker/ws/src/gazebo/gazebo/gui/ModelMaker.cc:285\n#11 0x00007ffff72bda87 in gazebo::gui::ModelMaker::Init (this=this@entry=0x18ca560) at /home/docker/ws/src/gazebo/gazebo/gui/ModelMaker.cc:213\n#12 0x00007ffff72be350 in gazebo::gui::ModelMaker::InitFromFile (this=0x18ca560, _filename=\"/home/docker/.ignition/fuel/models/chapulinaaa/beer/model.sdf\") at /home/docker/ws/src/gazebo/gazebo/gui/ModelMaker.cc:120\n#13 0x00007ffff7237005 in gazebo::gui::GLWidget::OnCreateEntity (this=0x171f420, _type=\"model\", _data=\"/home/docker/.ignition/fuel/models/chapulinaaa/beer/model.sdf\") at /home/docker/ws/src/gazebo/gazebo/gui/GLWidget.cc:1010\n~~~\n\nYou maybe able to just put an `#ifdef` around [this line in common::SystemPaths::FindFileURI](#!/osrf/gazebo/src/fb56ebf1d7c47c2e696b310bcaa3f3f7b9a7cf9b/gazebo/common/SystemPaths.cc?at=fuel_download&fileviewer=file-view-default#SystemPaths.cc-320) and see if that fixes the problem", "markup": "markdown", "html": "<p>I'm getting a <code>[Msg] Waiting for model database update to complete...</code> msg if I try to insert a fuel's model before the old model database (gazebosim.org) has finished loading. </p>\n<p>The problem is to do with the <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/fb56ebf1d7c47c2e696b310bcaa3f3f7b9a7cf9b/gazebo/gui/InsertModelWidget.cc?fileviewer=file-view-default#InsertModelWidget.cc-304\" rel=\"nofollow\">createEntity</a> event fired after locating the model. It triggers other places in gui to look for the model  in the old model database. Here's part of the backtrace leading up to that msg</p>\n<div class=\"codehilite\"><pre><span></span>Thread 1 &quot;gzclient&quot; hit Breakpoint 1, gazebo::common::ModelDatabase::GetModels[abi:cxx11]() (this=this@entry=0x7ffff7dcc0b0 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:328\n328         gzmsg &lt;&lt; &quot;Waiting for model database update to complete...\\n&quot;;\n(gdb) bt\n#0  gazebo::common::ModelDatabase::GetModels[abi:cxx11]() (this=this@entry=0x7ffff7dcc0b0 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:328\n#1  0x00007ffff6e46513 in gazebo::common::ModelDatabase::HasModel (this=this@entry=0x7ffff7dcc0b0 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;, _modelURI=&quot;model://beer/materials/scripts&quot;) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:153\n#2  0x00007ffff6e46a59 in gazebo::common::ModelDatabase::GetModelPath (this=this@entry=0x7ffff7dcc0b0 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;, _uri=&quot;model://beer/materials/scripts&quot;, _forceDownload=_forceDownload@entry=true) at /home/docker/ws/src/gazebo/gazebo/common/ModelDatabase.cc:412\n#3  0x00007ffff6e71230 in gazebo::common::SystemPaths::FindFileURI (this=this@entry=0x7ffff7dcc380 &lt;SingletonT&lt;gazebo::common::SystemPaths&gt;::GetInstance()::t&gt;, _uri=&quot;model://beer/materials/scripts&quot;) at /home/docker/ws/src/gazebo/gazebo/common/SystemPaths.cc:320\n#4  0x00007ffff6e70066 in gazebo::common::SystemPaths::FindFile (this=this@entry=0x7ffff7dcc380 &lt;SingletonT&lt;gazebo::common::SystemPaths&gt;::GetInstance()::t&gt;, _filename=&quot;model://beer/materials/scripts&quot;, _searchLocalPath=_searchLocalPath@entry=true) at /home/docker/ws/src/gazebo/gazebo/common/SystemPaths.cc:344\n#5  0x00007ffff6e28cf7 in gazebo::common::find_file (_file=&quot;model://beer/materials/scripts&quot;) at /home/docker/ws/src/gazebo/gazebo/common/CommonIface.cc:153\n#6  0x00007ffff6e28e6b in gazebo::common::find_file_path (_file=&quot;model://beer/materials/scripts&quot;) at /home/docker/ws/src/gazebo/gazebo/common/CommonIface.cc:165\n#7  0x00007ffff5071bb1 in gazebo::rendering::RenderEngine::AddResourcePath (this=this@entry=0x7ffff7dcafe0 &lt;SingletonT&lt;gazebo::rendering::RenderEngine&gt;::GetInstance()::t&gt;, _uri=&quot;model://beer/materials/scripts&quot;) at /home/docker/ws/src/gazebo/gazebo/rendering/RenderEngine.cc:471\n#8  0x00007ffff50e0fa4 in gazebo::rendering::Visual::Load (this=0x5695dd0) at /home/docker/ws/src/gazebo/gazebo/rendering/Visual.cc:474\n#9  0x00007ffff50ccbd2 in gazebo::rendering::Visual::Load (this=this@entry=0x5695dd0, _sdf=std::shared_ptr (count 3, weak 3) 0x56513c0) at /home/docker/ws/src/gazebo/gazebo/rendering/Visual.cc:341\n#10 0x00007ffff72bba82 in gazebo::gui::ModelMaker::CreateModelFromSDF (this=this@entry=0x18ca560, _modelElem=std::shared_ptr (count 5, weak 2) 0x5487c30) at /home/docker/ws/src/gazebo/gazebo/gui/ModelMaker.cc:285\n#11 0x00007ffff72bda87 in gazebo::gui::ModelMaker::Init (this=this@entry=0x18ca560) at /home/docker/ws/src/gazebo/gazebo/gui/ModelMaker.cc:213\n#12 0x00007ffff72be350 in gazebo::gui::ModelMaker::InitFromFile (this=0x18ca560, _filename=&quot;/home/docker/.ignition/fuel/models/chapulinaaa/beer/model.sdf&quot;) at /home/docker/ws/src/gazebo/gazebo/gui/ModelMaker.cc:120\n#13 0x00007ffff7237005 in gazebo::gui::GLWidget::OnCreateEntity (this=0x171f420, _type=&quot;model&quot;, _data=&quot;/home/docker/.ignition/fuel/models/chapulinaaa/beer/model.sdf&quot;) at /home/docker/ws/src/gazebo/gazebo/gui/GLWidget.cc:1010\n</pre></div>\n\n\n<p>You maybe able to just put an <code>#ifdef</code> around <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/fb56ebf1d7c47c2e696b310bcaa3f3f7b9a7cf9b/gazebo/common/SystemPaths.cc?at=fuel_download&amp;fileviewer=file-view-default#SystemPaths.cc-320\" rel=\"nofollow\">this line in common::SystemPaths::FindFileURI</a> and see if that fixes the problem</p>", "type": "rendered"}, "created_on": "2018-01-11T04:09:33.486270+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2018-01-11T04:10:33.950831+00:00", "type": "pullrequest_comment", "id": 53419332}