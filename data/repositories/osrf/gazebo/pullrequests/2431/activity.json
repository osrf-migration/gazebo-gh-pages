{"pagelen": 50, "values": [{"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate so that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "225036f6ff77", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/225036f6ff77.json"}, "html": {"href": "#!/osrf/gazebo/commits/225036f6ff77"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "1c041032db9a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/1c041032db9a.json"}, "html": {"href": "#!/osrf/gazebo/commits/1c041032db9a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "MERGED", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-10-10T18:26:47.460438+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"approval": {"date": "2016-10-10T18:14:06.978868+00:00", "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"approval": {"date": "2016-10-10T14:23:05.560146+00:00", "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24905679.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24905679"}}, "parent": {"id": 24905678, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24905678.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24905678"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "[homebrew](http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/687/) is clean too", "markup": "markdown", "html": "<p><a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/687/\" rel=\"nofollow\">homebrew</a> is clean too</p>", "type": "rendered"}, "created_on": "2016-10-08T21:52:45.847749+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-10-08T21:52:45.852948+00:00", "type": "pullrequest_comment", "id": 24905679}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24905678.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24905678"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "latest [nvidia build](http://build.osrfoundation.org/job/gazebo-ci-pr_any-trusty-amd64-gpu-nvidia/659/) is clean", "markup": "markdown", "html": "<p>latest <a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-trusty-amd64-gpu-nvidia/659/\" rel=\"nofollow\">nvidia build</a> is clean</p>", "type": "rendered"}, "created_on": "2016-10-08T21:51:27.324705+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-10-08T21:51:27.329229+00:00", "type": "pullrequest_comment", "id": 24905678}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24903304.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24903304"}}, "parent": {"id": 24672750, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24672750.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24672750"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "a56a7e6", "markup": "markdown", "html": "<p><a href=\"#!/osrf/gazebo/commits/a56a7e6\" rel=\"nofollow\" class=\"ap-connect-link\">a56a7e6</a></p>", "type": "rendered"}, "created_on": "2016-10-08T11:07:06.180541+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-10-08T11:07:06.182555+00:00", "type": "pullrequest_comment", "id": 24903304}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24903303.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24903303"}}, "parent": {"id": 24672046, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24672046.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24672046"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "1c04103", "markup": "markdown", "html": "<p><a href=\"#!/osrf/gazebo/commits/1c04103\" rel=\"nofollow\" class=\"ap-connect-link\">1c04103</a></p>", "type": "rendered"}, "created_on": "2016-10-08T11:06:58.054150+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-10-08T11:06:58.058650+00:00", "type": "pullrequest_comment", "id": 24903303}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate so that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "225036f6ff77", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/225036f6ff77.json"}, "html": {"href": "#!/osrf/gazebo/commits/225036f6ff77"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "1c041032db9a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/1c041032db9a.json"}, "html": {"href": "#!/osrf/gazebo/commits/1c041032db9a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-10-08T11:05:59.446652+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate so that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "483ff016f764", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/483ff016f764.json"}, "html": {"href": "#!/osrf/gazebo/commits/483ff016f764"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "d83feea41ab9", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d83feea41ab9.json"}, "html": {"href": "#!/osrf/gazebo/commits/d83feea41ab9"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-10-06T17:27:09.560602+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24672750.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24672750"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "`Model::LoadJoint` will also throw if the scoped name of the joint already exists, and there may be other cases farther down the stack that throw as well. \n\nI recommend adding a `throw/catch` around `this->LoadJoint(_sdf)`. If an exception occurs, then output an error message an return a null pointer. \n\nAttempting to create a joint should not cause Gazebo to enter an irrecoverable state (as indicated by an exception).", "markup": "markdown", "html": "<p><code>Model::LoadJoint</code> will also throw if the scoped name of the joint already exists, and there may be other cases farther down the stack that throw as well. </p>\n<p>I recommend adding a <code>throw/catch</code> around <code>this-&gt;LoadJoint(_sdf)</code>. If an exception occurs, then output an error message an return a null pointer. </p>\n<p>Attempting to create a joint should not cause Gazebo to enter an irrecoverable state (as indicated by an exception).</p>", "type": "rendered"}, "created_on": "2016-10-04T14:18:53.939914+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {}, "updated_on": "2016-10-04T14:18:53.942733+00:00", "type": "pullrequest_comment", "id": 24672750}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/24672046.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-24672046"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "This is one of the cases where we can pass in a raw pointer, instead of a shared pointer. The function is not taking or sharing ownership of `_joint`.", "markup": "markdown", "html": "<p>This is one of the cases where we can pass in a raw pointer, instead of a shared pointer. The function is not taking or sharing ownership of <code>_joint</code>.</p>", "type": "rendered"}, "created_on": "2016-10-04T14:10:39.524272+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {}, "updated_on": "2016-10-04T14:10:39.530125+00:00", "type": "pullrequest_comment", "id": 24672046}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate so that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "5443e2a2924f", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/5443e2a2924f.json"}, "html": {"href": "#!/osrf/gazebo/commits/5443e2a2924f"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "dda7f31f3e70", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/dda7f31f3e70.json"}, "html": {"href": "#!/osrf/gazebo/commits/dda7f31f3e70"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-10-03T22:25:31.000705+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23362542.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23362542"}}, "parent": {"id": 23250145, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23250145.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23250145"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "got it, sounds good then. not an issue.", "markup": "markdown", "html": "<p>got it, sounds good then. not an issue.</p>", "type": "rendered"}, "created_on": "2016-09-06T22:04:51.343513+00:00", "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "updated_on": "2016-09-06T22:04:51.349494+00:00", "type": "pullrequest_comment", "id": 23362542}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23250256.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23250256"}}, "parent": {"id": 23249728, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249728.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249728"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "there were test failures when running `DetachUnpaused` in which it couldn't find the harness joint. it was especially pronounced on machines without a gpu, since the tests load much faster when it doesn't have to load the rendering subsystem. what would happen is that this function (`ServerFixture::LoadArgs`) would start a `Server` in a separate thread and this loop waits for it to be ready before returning. If you wait for `physics::get_world()` to return a non-null pointer, it can return during the World constructor, but before `World::Load` and `World::Init` have been called. If you wait for `Server::GetInitialized` to be true, then `World::Init` will have finished, which seemed to be enough for the HarnessPlugin and harness joint to be created", "markup": "markdown", "html": "<p>there were test failures when running <code>DetachUnpaused</code> in which it couldn't find the harness joint. it was especially pronounced on machines without a gpu, since the tests load much faster when it doesn't have to load the rendering subsystem. what would happen is that this function (<code>ServerFixture::LoadArgs</code>) would start a <code>Server</code> in a separate thread and this loop waits for it to be ready before returning. If you wait for <code>physics::get_world()</code> to return a non-null pointer, it can return during the World constructor, but before <code>World::Load</code> and <code>World::Init</code> have been called. If you wait for <code>Server::GetInitialized</code> to be true, then <code>World::Init</code> will have finished, which seemed to be enough for the HarnessPlugin and harness joint to be created</p>", "type": "rendered"}, "created_on": "2016-09-02T22:45:19.530151+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-09-02T22:45:19.536549+00:00", "type": "pullrequest_comment", "id": 23250256}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23250174.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23250174"}}, "parent": {"id": 23249797, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249797.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249797"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "for this `DetachUnpaused` test, we have less control over the sim-time when this expectation is evaluated, and the harness is using a PID which lets it bounce around a bit. If we waited much longer (1 second or more), we could possibly have a tighter bound on the velocity, but I didn't bother", "markup": "markdown", "html": "<p>for this <code>DetachUnpaused</code> test, we have less control over the sim-time when this expectation is evaluated, and the harness is using a PID which lets it bounce around a bit. If we waited much longer (1 second or more), we could possibly have a tighter bound on the velocity, but I didn't bother</p>", "type": "rendered"}, "created_on": "2016-09-02T22:39:31.037117+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-09-02T22:39:31.042417+00:00", "type": "pullrequest_comment", "id": 23250174}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23250145.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23250145"}}, "parent": {"id": 23249936, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249936.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249936"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "I don't know if model load time is relevant to the Detach race condition", "markup": "markdown", "html": "<p>I don't know if model load time is relevant to the Detach race condition</p>", "type": "rendered"}, "created_on": "2016-09-02T22:37:10.756868+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-09-02T22:37:10.761463+00:00", "type": "pullrequest_comment", "id": 23250145}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23250135.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23250135"}}, "parent": {"id": 23249936, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249936.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249936"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "I didn't compute statistics, but it felt like it was at least 50% failures when running the `DetachUnpaused` test with ef4cc51 ", "markup": "markdown", "html": "<p>I didn't compute statistics, but it felt like it was at least 50% failures when running the <code>DetachUnpaused</code> test with <a href=\"#!/osrf/gazebo/commits/ef4cc51\" rel=\"nofollow\" class=\"ap-connect-link\">ef4cc51</a> </p>", "type": "rendered"}, "created_on": "2016-09-02T22:36:33.905943+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-09-02T22:36:33.910938+00:00", "type": "pullrequest_comment", "id": 23250135}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249936.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249936"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "what's the current rate that detach fails without the patch?\n\nshould we create a larger model in `harness.world` such that model load time is not insignificant?", "markup": "markdown", "html": "<p>what's the current rate that detach fails without the patch?</p>\n<p>should we create a larger model in <code>harness.world</code> such that model load time is not insignificant?</p>", "type": "rendered"}, "created_on": "2016-09-02T22:25:34.037858+00:00", "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "updated_on": "2016-09-02T22:25:34.043129+00:00", "type": "pullrequest_comment", "id": 23249936}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249797.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249797"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "why is the tolerance not closer to machine zero?", "markup": "markdown", "html": "<p>why is the tolerance not closer to machine zero?</p>", "type": "rendered"}, "created_on": "2016-09-02T22:17:07.889276+00:00", "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "inline": {}, "updated_on": "2016-09-02T22:17:07.891751+00:00", "type": "pullrequest_comment", "id": 23249797}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/23249728.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-23249728"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "a little explanation on why the chain of tests here? thanks.", "markup": "markdown", "html": "<p>a little explanation on why the chain of tests here? thanks.</p>", "type": "rendered"}, "created_on": "2016-09-02T22:14:04.377408+00:00", "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "inline": {}, "updated_on": "2016-09-02T22:14:04.379233+00:00", "type": "pullrequest_comment", "id": 23249728}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/22935185.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-22935185"}}, "parent": {"id": 22930708, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/22930708.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-22930708"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "just some unrelated test failures", "markup": "markdown", "html": "<p>just some unrelated test failures</p>", "type": "rendered"}, "created_on": "2016-08-27T03:45:20.984719+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-08-27T03:45:20.988650+00:00", "type": "pullrequest_comment", "id": 22935185}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431/comments/22930708.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431/_/diff#comment-22930708"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}, "content": {"raw": "Added some extra waits in c22e72b since the test was sometimes starting before the plugin had loaded the harness joint and failing. It's especially frequent when running the test without a display. It should be fixed now, and I've started a new batch of jenkins jobs", "markup": "markdown", "html": "<p>Added some extra waits in <a href=\"#!/osrf/gazebo/commits/c22e72b\" rel=\"nofollow\" class=\"ap-connect-link\">c22e72b</a> since the test was sometimes starting before the plugin had loaded the harness joint and failing. It's especially frequent when running the test without a display. It should be fixed now, and I've started a new batch of jenkins jobs</p>", "type": "rendered"}, "created_on": "2016-08-26T21:02:37.730032+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-08-26T21:02:37.732495+00:00", "type": "pullrequest_comment", "id": 22930708}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate to that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "02e26301d687", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/02e26301d687.json"}, "html": {"href": "#!/osrf/gazebo/commits/02e26301d687"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "dda7f31f3e70", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/dda7f31f3e70.json"}, "html": {"href": "#!/osrf/gazebo/commits/dda7f31f3e70"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-08-26T21:00:52.866616+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate to that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "02e26301d687", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/02e26301d687.json"}, "html": {"href": "#!/osrf/gazebo/commits/02e26301d687"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "c22e72b3822b", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/c22e72b3822b.json"}, "html": {"href": "#!/osrf/gazebo/commits/c22e72b3822b"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-08-26T20:59:09.362719+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate to that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "02e26301d687", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/02e26301d687.json"}, "html": {"href": "#!/osrf/gazebo/commits/02e26301d687"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "a999191e3c6a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a999191e3c6a.json"}, "html": {"href": "#!/osrf/gazebo/commits/a999191e3c6a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-08-22T22:10:03.031010+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}, {"update": {"description": "The `HarnessPlugin` suffers from a race condition when calling detaching the harness joint, as described in #2034. This pull request reduces the likelihood of that race condition and fixes several other things as well.\r\n\r\n1. The `HarnessPlugin` has an example world [worlds/harness.world](#!/osrf/gazebo/src/gazebo7/worlds/harness.world),\r\nbut it didn't have a test, so I've added an integration test.\r\n\r\n2. In order to write the test, I wanted to be able to get a `JointPtr` for the harness joint by calling `Model::GetJoint`, but that wasn't possible since the joint wasn't being added to the `Model::joints` vector (similar to issue #1217). The `Model::CreateJoint()` function added in pull request #1938 couldn't be used easily by the `HarnessPlugin` though since it doesn't take an `sdf::ElementPtr` as in input. So, I added a new `Model::CreateJoint(sdf::ElementPtr)` function in 784ecce and use it in the `HarnessPlugin` in 48a49d5.\r\n\r\n3. Using the new `CreateJoint` function temporarily broke harness detachment, so I had to add `JointController::RemoveJoint` (da0f4f4) and add a `Joint::Fini` call in `Model::RemoveJoint` (deb6ef3). That was able to fix the harness detachment.\r\n\r\n3. The new test verifies both the velocity and detach topics. To address the race condition, the `DetachUnpaused` test unthrottles the real-time update rate to that failures are more common. To see these failures, build ef4cc51 and run the test several times.\r\n\r\n4. I fixed the race condition in #2034 by setting `winchIndex` to `-1` in `OnDetach` then calling the `Detach` function from the `Update` function if the `winchIndex` is less than zero. This ensures the joint will be deleted in the main World::Runloop thread.\r\n\r\n5. Though not reported in an issue, I noticed that gazebo would crash if sent additional velocity or detachment messages after the joint had already been detached, so I fixed that in 9092468.", "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)", "destination": {"commit": {"hash": "02e26301d687", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/02e26301d687.json"}, "html": {"href": "#!/osrf/gazebo/commits/02e26301d687"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "a999191e3c6a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a999191e3c6a.json"}, "html": {"href": "#!/osrf/gazebo/commits/a999191e3c6a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "harness_test"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-08-22T22:10:02.863909+00:00"}, "pull_request": {"type": "pullrequest", "id": 2431, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2431.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2431"}}, "title": "Add test for HarnessPlugin, reduce likelihood of race condition (#2034)"}}]}