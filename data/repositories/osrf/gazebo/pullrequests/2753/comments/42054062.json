{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2753/comments/42054062.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2753/_/diff#comment-42054062"}}, "parent": {"id": 41584784, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2753/comments/41584784.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2753/_/diff#comment-41584784"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2753, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2753.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2753"}}, "title": "Fix Issue 1011 -- DARTUniversalJoint"}, "content": {"raw": "I just got a backtrace from `INTEGRATION_joint_spawn` subtest 24, with a dart revolute joint. It appears to fail during `World::LoadModel` when trying to call `dtJoint->getNumDofs()`. I believe the dtJoint data is allocated during `Model::Init`, which comes after `Model::Load`. Before this PR, I believe `Joint::DOF()` was called instead, which seems safer. There are some functions that get called before `Init`, so we have to be careful in these functions not to access data structures that haven't yet been allocated.\n\n~~~\nThread 32 \"INTEGRATION_joi\" received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fff693f5700 (LWP 14661)]\n0x00007ffff71ef26d in gazebo::physics::DARTJoint::LowerLimit (this=0x7fff3c1bee00, _index=0) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/dart/DARTJoint.cc:421\n421\t        this->dataPtr->dtJoint->getNumDofs());\n(gdb) bt\n#0  0x00007ffff71ef26d in gazebo::physics::DARTJoint::LowerLimit (this=0x7fff3c1bee00, _index=0) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/dart/DARTJoint.cc:421\n#1  0x00007ffff72949fb in gazebo::physics::Joint::FillMsg (this=0x7fff3c1bee00, _msg=...) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/Joint.cc:635\n#2  0x00007ffff72db9ad in gazebo::physics::Model::FillMsg (this=0x7fff3c003ee0, _msg=...) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/Model.cc:1225\n#3  0x00007ffff7326e0e in gazebo::physics::World::LoadModel (this=this@entry=0x7fffbc674900, _sdf=std::shared_ptr (count 4, weak 5) 0x7fff3c5ca310, _parent=...) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:1068\n#4  0x00007ffff732b8c5 in gazebo::physics::World::ProcessFactoryMsgs (this=this@entry=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:2075\n#5  0x00007ffff73309bc in gazebo::physics::World::ProcessMessages (this=this@entry=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:2488\n#6  0x00007ffff7332bc8 in gazebo::physics::World::Step (this=this@entry=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:705\n#7  0x00007ffff73330cd in gazebo::physics::World::RunLoop (this=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:496\n#8  0x00007ffff52f3c80 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#9  0x00007ffff7bc16ba in start_thread (arg=0x7fff693f5700) at pthread_create.c:333\n#10 0x00007ffff4a593dd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n~~~", "markup": "markdown", "html": "<p>I just got a backtrace from <code>INTEGRATION_joint_spawn</code> subtest 24, with a dart revolute joint. It appears to fail during <code>World::LoadModel</code> when trying to call <code>dtJoint-&gt;getNumDofs()</code>. I believe the dtJoint data is allocated during <code>Model::Init</code>, which comes after <code>Model::Load</code>. Before this PR, I believe <code>Joint::DOF()</code> was called instead, which seems safer. There are some functions that get called before <code>Init</code>, so we have to be careful in these functions not to access data structures that haven't yet been allocated.</p>\n<div class=\"codehilite\"><pre><span></span>Thread 32 &quot;INTEGRATION_joi&quot; received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fff693f5700 (LWP 14661)]\n0x00007ffff71ef26d in gazebo::physics::DARTJoint::LowerLimit (this=0x7fff3c1bee00, _index=0) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/dart/DARTJoint.cc:421\n421         this-&gt;dataPtr-&gt;dtJoint-&gt;getNumDofs());\n(gdb) bt\n#0  0x00007ffff71ef26d in gazebo::physics::DARTJoint::LowerLimit (this=0x7fff3c1bee00, _index=0) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/dart/DARTJoint.cc:421\n#1  0x00007ffff72949fb in gazebo::physics::Joint::FillMsg (this=0x7fff3c1bee00, _msg=...) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/Joint.cc:635\n#2  0x00007ffff72db9ad in gazebo::physics::Model::FillMsg (this=0x7fff3c003ee0, _msg=...) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/Model.cc:1225\n#3  0x00007ffff7326e0e in gazebo::physics::World::LoadModel (this=this@entry=0x7fffbc674900, _sdf=std::shared_ptr (count 4, weak 5) 0x7fff3c5ca310, _parent=...) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:1068\n#4  0x00007ffff732b8c5 in gazebo::physics::World::ProcessFactoryMsgs (this=this@entry=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:2075\n#5  0x00007ffff73309bc in gazebo::physics::World::ProcessMessages (this=this@entry=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:2488\n#6  0x00007ffff7332bc8 in gazebo::physics::World::Step (this=this@entry=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:705\n#7  0x00007ffff73330cd in gazebo::physics::World::RunLoop (this=0x7fffbc674900) at /data_fast/scpeters/ws/gazebo9/src/gazebo/gazebo/physics/World.cc:496\n#8  0x00007ffff52f3c80 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#9  0x00007ffff7bc16ba in start_thread (arg=0x7fff693f5700) at pthread_create.c:333\n#10 0x00007ffff4a593dd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n</pre></div>", "type": "rendered"}, "created_on": "2017-08-02T23:37:44.178150+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-08-02T23:37:44.180386+00:00", "type": "pullrequest_comment", "id": 42054062}