{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3026/comments/84573584.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3026/_/diff#comment-84573584"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 3026, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/3026.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/3026"}}, "title": "Improve gpu laser and its sensor shutdown"}, "content": {"raw": "I made a simple gpu sensor model with GpuRaySensor plugin for testing. I\u2019m still getting a segfault deleting this model with a similar backtrace as the one @scpeters posted. \n\n    <?xml version=\"1.0\" ?>\n    <sdf version=\"1.5\">\n      <model name=\"hokuyo_gpu\">\n        <pose>0 0 0.035 0 0 0</pose>\n        <link name=\"link\">\n          <inertial>\n            <mass>0.1</mass>\n          </inertial>\n          <visual name=\"visual\">\n            <geometry>\n              <mesh>\n                <uri>model://hokuyo/meshes/hokuyo.dae</uri>\n              </mesh>\n            </geometry>\n          </visual>\n          <collision name=\"collision-base\">\n            <pose>0 0 -0.0145 0 0 0</pose>\n            <geometry>\n              <box>\n                <size>0.05 0.05 0.041</size>\n              </box>\n            </geometry>\n          </collision>\n          <collision name=\"collision-top\">\n            <pose>0 0 0.0205 0 0 0</pose>\n            <geometry>\n              <cylinder>\n                <radius>0.021</radius>\n                <length>0.029</length>\n              </cylinder>\n            </geometry>\n          </collision>\n          <sensor name=\"laser\" type=\"gpu_ray\">\n            <pose>0.01 0 0.0175 0 -0 0</pose>\n            <ray>\n              <scan>\n                <horizontal>\n                  <samples>10</samples>\n                  <resolution>1</resolution>\n                  <min_angle>-0.1</min_angle>\n                  <max_angle>0.1</max_angle>\n                </horizontal>\n              </scan>\n              <range>\n                <min>0.1</min>\n                <max>10</max>\n                <resolution>0.01</resolution>\n              </range>\n            </ray>\n            <always_on>1</always_on>\n            <update_rate>30</update_rate>\n            <visualize>true</visualize>\n    \n            <plugin name=\"gpu\" filename=\"libGpuRayPlugin.so\"/>\n          </sensor>\n        </link>\n      </model>\n    </sdf>", "markup": "markdown", "html": "<p>I made a simple gpu sensor model with GpuRaySensor plugin for testing. I\u2019m still getting a segfault deleting this model with a similar backtrace as the one @scpeters posted. </p>\n<div class=\"codehilite\"><pre><span></span><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>\n<span class=\"nt\">&lt;sdf</span> <span class=\"na\">version=</span><span class=\"s\">&quot;1.5&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;model</span> <span class=\"na\">name=</span><span class=\"s\">&quot;hokuyo_gpu&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;pose&gt;</span>0 0 0.035 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;link&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;inertial&gt;</span>\n        <span class=\"nt\">&lt;mass&gt;</span>0.1<span class=\"nt\">&lt;/mass&gt;</span>\n      <span class=\"nt\">&lt;/inertial&gt;</span>\n      <span class=\"nt\">&lt;visual</span> <span class=\"na\">name=</span><span class=\"s\">&quot;visual&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;geometry&gt;</span>\n          <span class=\"nt\">&lt;mesh&gt;</span>\n            <span class=\"nt\">&lt;uri&gt;</span>model://hokuyo/meshes/hokuyo.dae<span class=\"nt\">&lt;/uri&gt;</span>\n          <span class=\"nt\">&lt;/mesh&gt;</span>\n        <span class=\"nt\">&lt;/geometry&gt;</span>\n      <span class=\"nt\">&lt;/visual&gt;</span>\n      <span class=\"nt\">&lt;collision</span> <span class=\"na\">name=</span><span class=\"s\">&quot;collision-base&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;pose&gt;</span>0 0 -0.0145 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n        <span class=\"nt\">&lt;geometry&gt;</span>\n          <span class=\"nt\">&lt;box&gt;</span>\n            <span class=\"nt\">&lt;size&gt;</span>0.05 0.05 0.041<span class=\"nt\">&lt;/size&gt;</span>\n          <span class=\"nt\">&lt;/box&gt;</span>\n        <span class=\"nt\">&lt;/geometry&gt;</span>\n      <span class=\"nt\">&lt;/collision&gt;</span>\n      <span class=\"nt\">&lt;collision</span> <span class=\"na\">name=</span><span class=\"s\">&quot;collision-top&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;pose&gt;</span>0 0 0.0205 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n        <span class=\"nt\">&lt;geometry&gt;</span>\n          <span class=\"nt\">&lt;cylinder&gt;</span>\n            <span class=\"nt\">&lt;radius&gt;</span>0.021<span class=\"nt\">&lt;/radius&gt;</span>\n            <span class=\"nt\">&lt;length&gt;</span>0.029<span class=\"nt\">&lt;/length&gt;</span>\n          <span class=\"nt\">&lt;/cylinder&gt;</span>\n        <span class=\"nt\">&lt;/geometry&gt;</span>\n      <span class=\"nt\">&lt;/collision&gt;</span>\n      <span class=\"nt\">&lt;sensor</span> <span class=\"na\">name=</span><span class=\"s\">&quot;laser&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;gpu_ray&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;pose&gt;</span>0.01 0 0.0175 0 -0 0<span class=\"nt\">&lt;/pose&gt;</span>\n        <span class=\"nt\">&lt;ray&gt;</span>\n          <span class=\"nt\">&lt;scan&gt;</span>\n            <span class=\"nt\">&lt;horizontal&gt;</span>\n              <span class=\"nt\">&lt;samples&gt;</span>10<span class=\"nt\">&lt;/samples&gt;</span>\n              <span class=\"nt\">&lt;resolution&gt;</span>1<span class=\"nt\">&lt;/resolution&gt;</span>\n              <span class=\"nt\">&lt;min_angle&gt;</span>-0.1<span class=\"nt\">&lt;/min_angle&gt;</span>\n              <span class=\"nt\">&lt;max_angle&gt;</span>0.1<span class=\"nt\">&lt;/max_angle&gt;</span>\n            <span class=\"nt\">&lt;/horizontal&gt;</span>\n          <span class=\"nt\">&lt;/scan&gt;</span>\n          <span class=\"nt\">&lt;range&gt;</span>\n            <span class=\"nt\">&lt;min&gt;</span>0.1<span class=\"nt\">&lt;/min&gt;</span>\n            <span class=\"nt\">&lt;max&gt;</span>10<span class=\"nt\">&lt;/max&gt;</span>\n            <span class=\"nt\">&lt;resolution&gt;</span>0.01<span class=\"nt\">&lt;/resolution&gt;</span>\n          <span class=\"nt\">&lt;/range&gt;</span>\n        <span class=\"nt\">&lt;/ray&gt;</span>\n        <span class=\"nt\">&lt;always_on&gt;</span>1<span class=\"nt\">&lt;/always_on&gt;</span>\n        <span class=\"nt\">&lt;update_rate&gt;</span>30<span class=\"nt\">&lt;/update_rate&gt;</span>\n        <span class=\"nt\">&lt;visualize&gt;</span>true<span class=\"nt\">&lt;/visualize&gt;</span>\n\n        <span class=\"nt\">&lt;plugin</span> <span class=\"na\">name=</span><span class=\"s\">&quot;gpu&quot;</span> <span class=\"na\">filename=</span><span class=\"s\">&quot;libGpuRayPlugin.so&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/sensor&gt;</span>\n    <span class=\"nt\">&lt;/link&gt;</span>\n  <span class=\"nt\">&lt;/model&gt;</span>\n<span class=\"nt\">&lt;/sdf&gt;</span>\n</pre></div>", "type": "rendered"}, "created_on": "2018-12-05T01:05:43.478907+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2018-12-05T01:05:43.491241+00:00", "type": "pullrequest_comment", "id": 84573584}