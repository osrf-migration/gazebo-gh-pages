{"pagelen": 50, "values": [{"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/48138515.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-48138515"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "I think this led to issue #2367 after merging forward to gazebo8", "markup": "markdown", "html": "<p>I think this led to issue <a href=\"#!/osrf/gazebo/issues/2367/physicsengines-factorytestclone-1-failing\" rel=\"nofollow\" title=\"PhysicsEngines/FactoryTest.Clone/1 failing on gazebo8 and default\" class=\"ap-connect-link\"><s>#2367</s></a> after merging forward to gazebo8</p>", "type": "rendered"}, "created_on": "2017-10-26T19:00:34.670057+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-10-26T19:00:34.672114+00:00", "type": "pullrequest_comment", "id": 48138515}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "bf9987f6b601", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/bf9987f6b601"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/bf9987f6b601"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "MERGED", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-09-08T16:33:42.308409+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44566399.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44566399"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Thanks for your quick responses to comments!", "markup": "markdown", "html": "<p>Thanks for your quick responses to comments!</p>", "type": "rendered"}, "created_on": "2017-09-08T16:32:47.891760+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-09-08T16:32:47.896146+00:00", "type": "pullrequest_comment", "id": 44566399}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44565768.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44565768"}}, "parent": {"id": 44565271, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44565271.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44565271"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Yes, oops [bf9987f](https://bitbucket.org/pchorak/gazebo/commits/bf9987f)", "markup": "markdown", "html": "<p>Yes, oops <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/bf9987f\" rel=\"nofollow\">bf9987f</a></p>", "type": "rendered"}, "created_on": "2017-09-08T16:23:57.744868+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "inline": {}, "updated_on": "2017-09-08T16:23:57.748602+00:00", "type": "pullrequest_comment", "id": 44565768}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "bf9987f6b601", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/bf9987f6b601"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/bf9987f6b601"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-09-08T16:21:58.153401+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44565271.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44565271"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "oops", "markup": "markdown", "html": "<p>oops</p>", "type": "rendered"}, "created_on": "2017-09-08T16:17:01.912600+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-09-08T16:17:01.915676+00:00", "type": "pullrequest_comment", "id": 44565271}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44564865.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44564865"}}, "parent": {"id": 44562466, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44562466.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44562466"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Oops, thanks. [cb5a144](https://bitbucket.org/pchorak/gazebo/commits/cb5a144)", "markup": "markdown", "html": "<p>Oops, thanks. <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/cb5a144\" rel=\"nofollow\">cb5a144</a></p>", "type": "rendered"}, "created_on": "2017-09-08T16:11:13.661392+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "inline": {}, "updated_on": "2017-09-08T16:11:13.664462+00:00", "type": "pullrequest_comment", "id": 44564865}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "cb5a14474c39", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/cb5a14474c39"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/cb5a14474c39"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-09-08T16:10:02.793735+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "cb5a14474c39", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/cb5a14474c39"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/cb5a14474c39"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-09-08T16:09:55.187714+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44562466.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44562466"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "parrent", "markup": "markdown", "html": "<p>parrent</p>", "type": "rendered"}, "created_on": "2017-09-08T15:41:48.521765+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-09-08T15:41:48.525819+00:00", "type": "pullrequest_comment", "id": 44562466}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44562454.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44562454"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "parrent", "markup": "markdown", "html": "<p>parrent</p>", "type": "rendered"}, "created_on": "2017-09-08T15:41:41.426951+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-09-08T15:41:41.430163+00:00", "type": "pullrequest_comment", "id": 44562454}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44552048.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44552048"}}, "parent": {"id": 44500796, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44500796.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44500796"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "More comments in [503d17f](https://bitbucket.org/pchorak/gazebo/commits/503d17f).", "markup": "markdown", "html": "<p>More comments in <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/503d17f\" rel=\"nofollow\">503d17f</a>.</p>", "type": "rendered"}, "created_on": "2017-09-08T14:07:36.935686+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "inline": {}, "updated_on": "2017-09-08T14:07:36.938268+00:00", "type": "pullrequest_comment", "id": 44552048}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "503d17f8e930", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/503d17f8e930"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/503d17f8e930"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-09-08T14:05:40.504085+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "503d17f8e930", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/503d17f8e930"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/503d17f8e930"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-09-08T14:05:34.536202+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"approval": {"date": "2017-09-08T01:22:10.087042+00:00", "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "user": {"display_name": "Ying Lu", "uuid": "{11ec131e-4af6-4228-beaf-167b1c8d1c2c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D"}, "html": {"href": "https://bitbucket.org/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:659bfe31-d941-44f5-aa6d-00058b070ea8/c88d5925-8a09-40c7-8684-c02aeafe0f59/128"}}, "nickname": "rosebudflyaway", "type": "user", "account_id": "557058:659bfe31-d941-44f5-aa6d-00058b070ea8"}}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44500840.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44500840"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "I reviewed both functionality and physics transformations. It's good except one place I didn't quite work out the equations where I left comments. ", "markup": "markdown", "html": "<p>I reviewed both functionality and physics transformations. It's good except one place I didn't quite work out the equations where I left comments. </p>", "type": "rendered"}, "created_on": "2017-09-08T01:22:01.901796+00:00", "user": {"display_name": "Ying Lu", "uuid": "{11ec131e-4af6-4228-beaf-167b1c8d1c2c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D"}, "html": {"href": "https://bitbucket.org/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:659bfe31-d941-44f5-aa6d-00058b070ea8/c88d5925-8a09-40c7-8684-c02aeafe0f59/128"}}, "nickname": "rosebudflyaway", "type": "user", "account_id": "557058:659bfe31-d941-44f5-aa6d-00058b070ea8"}, "updated_on": "2017-09-08T01:22:01.904131+00:00", "type": "pullrequest_comment", "id": 44500840}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/44500796.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-44500796"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "I kind of understand the idea here is to transform from the child frame to the parent frame. Would it be possible to add more explicit comments? \n", "markup": "markdown", "html": "<p>I kind of understand the idea here is to transform from the child frame to the parent frame. Would it be possible to add more explicit comments? </p>", "type": "rendered"}, "created_on": "2017-09-08T01:20:08.424140+00:00", "user": {"display_name": "Ying Lu", "uuid": "{11ec131e-4af6-4228-beaf-167b1c8d1c2c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D"}, "html": {"href": "https://bitbucket.org/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:659bfe31-d941-44f5-aa6d-00058b070ea8/c88d5925-8a09-40c7-8684-c02aeafe0f59/128"}}, "nickname": "rosebudflyaway", "type": "user", "account_id": "557058:659bfe31-d941-44f5-aa6d-00058b070ea8"}, "inline": {}, "updated_on": "2017-09-08T01:20:08.427170+00:00", "type": "pullrequest_comment", "id": 44500796}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/42047282.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-42047282"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Nice work!", "markup": "markdown", "html": "<p>Nice work!</p>", "type": "rendered"}, "created_on": "2017-08-02T21:03:27.764713+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-08-02T21:03:27.767951+00:00", "type": "pullrequest_comment", "id": 42047282}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"approval": {"date": "2017-08-02T21:03:18.569276+00:00", "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41761551.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41761551"}}, "parent": {"id": 41760924, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41760924.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41760924"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Oops, I forgot this one isn't for default. Fixing with [b62d64c](https://bitbucket.org/pchorak/gazebo/commits/b62d64c).", "markup": "markdown", "html": "<p>Oops, I forgot this one isn't for default. Fixing with <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/b62d64c\" rel=\"nofollow\">b62d64c</a>.</p>", "type": "rendered"}, "created_on": "2017-07-28T23:40:14.422635+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "inline": {}, "updated_on": "2017-07-28T23:40:14.496324+00:00", "type": "pullrequest_comment", "id": 41761551}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "5f41b719c1fe", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/5f41b719c1fe.json"}, "html": {"href": "#!/osrf/gazebo/commits/5f41b719c1fe"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "498cb3a99d79", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/498cb3a99d79"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/498cb3a99d79"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-07-28T23:39:21.754269+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41760924.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41760924"}}, "parent": {"id": 41760575, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41760575.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41760575"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "hm...I think adding another private field to `BulletLink` breaks ABI since we haven't made a Private data class for `BulletLink` yet and this PR targets gazebo7. Using the `sdf` object for data storage isn't ideal either, since it involves lots of string manipulation. We could forward-port this portion of the fix to default so ABI changes are ok", "markup": "markdown", "html": "<p>hm...I think adding another private field to <code>BulletLink</code> breaks ABI since we haven't made a Private data class for <code>BulletLink</code> yet and this PR targets gazebo7. Using the <code>sdf</code> object for data storage isn't ideal either, since it involves lots of string manipulation. We could forward-port this portion of the fix to default so ABI changes are ok</p>", "type": "rendered"}, "created_on": "2017-07-28T23:04:16.321117+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-07-28T23:04:16.324283+00:00", "type": "pullrequest_comment", "id": 41760924}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41760696.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41760696"}}, "parent": {"id": 41743492, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41743492.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41743492"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Should be fixed in [4ff8ac1](https://bitbucket.org/pchorak/gazebo/commits/4ff8ac1)", "markup": "markdown", "html": "<p>Should be fixed in <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/4ff8ac1\" rel=\"nofollow\">4ff8ac1</a></p>", "type": "rendered"}, "created_on": "2017-07-28T22:54:59.463937+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "updated_on": "2017-07-28T22:54:59.536912+00:00", "type": "pullrequest_comment", "id": 41760696}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41760575.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41760575"}}, "parent": {"id": 41753715, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41753715.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41753715"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "[4ff8ac1](https://bitbucket.org/pchorak/gazebo/commits/4ff8ac1) restores the deleted code. It also stores the initial inertial pose so it can determine whether the pose has changed. This also makes it possible to check whether diagonalizing the new inertia tensor would result in the correct pose (e.g. if the tensor has the same principal axes as the original).\n\nI considered using the sdf inertial element `this->sdf->GetElement(\"inertial\")` to obtain the initial pose but decided to add a new dedicated field in case the sdf element changed.", "markup": "markdown", "html": "<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/4ff8ac1\" rel=\"nofollow\">4ff8ac1</a> restores the deleted code. It also stores the initial inertial pose so it can determine whether the pose has changed. This also makes it possible to check whether diagonalizing the new inertia tensor would result in the correct pose (e.g. if the tensor has the same principal axes as the original).</p>\n<p>I considered using the sdf inertial element <code>this-&gt;sdf-&gt;GetElement(\"inertial\")</code> to obtain the initial pose but decided to add a new dedicated field in case the sdf element changed.</p>", "type": "rendered"}, "created_on": "2017-07-28T22:50:39.387408+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "inline": {}, "updated_on": "2017-07-28T22:50:39.552234+00:00", "type": "pullrequest_comment", "id": 41760575}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "5f41b719c1fe", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/5f41b719c1fe.json"}, "html": {"href": "#!/osrf/gazebo/commits/5f41b719c1fe"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "4ff8ac169ed5", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/4ff8ac169ed5"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/4ff8ac169ed5"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-07-28T22:29:40.722109+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41753715.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41753715"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "This function is incomplete because it ignores off-diagonal inertia elements and changes in the center of mass frame, but I don't think we should disable all of it since it does allow the mass and diagonal inertia matrix elements to be updated. So I would prefer to restore the deleted code, which will fix the broken tests.\n\nWe could also change the message to `gzwarn`. It would be best if there were two messages, one mentioning ignored off-diagonal terms and one for ignored changes in inertial frame, but I'm not sure how to detect changes in inertial frame with the current code.", "markup": "markdown", "html": "<p>This function is incomplete because it ignores off-diagonal inertia elements and changes in the center of mass frame, but I don't think we should disable all of it since it does allow the mass and diagonal inertia matrix elements to be updated. So I would prefer to restore the deleted code, which will fix the broken tests.</p>\n<p>We could also change the message to <code>gzwarn</code>. It would be best if there were two messages, one mentioning ignored off-diagonal terms and one for ignored changes in inertial frame, but I'm not sure how to detect changes in inertial frame with the current code.</p>", "type": "rendered"}, "created_on": "2017-07-28T19:57:09.784547+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-07-28T19:57:09.787429+00:00", "type": "pullrequest_comment", "id": 41753715}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "5f41b719c1fe", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/5f41b719c1fe.json"}, "html": {"href": "#!/osrf/gazebo/commits/5f41b719c1fe"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "22919577b6ad", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/22919577b6ad"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/22919577b6ad"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-07-28T16:59:56.017294+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41743492.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41743492"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Tests are failing because of [7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe7c2e0a5c1f1688c911412df05f2ab42c1):\n\n* PhysicsEngines/InertiaMsgsTest.SetMass/1\n\n* PhysicsEngines/InertiaMsgsTest.SetPendulumInertia/1", "markup": "markdown", "html": "<p>Tests are failing because of <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/7377dfe7c2e0a5c1f1688c911412df05f2ab42c1\" rel=\"nofollow\">7377dfe</a>:</p>\n<ul>\n<li>\n<p>PhysicsEngines/InertiaMsgsTest.SetMass/1</p>\n</li>\n<li>\n<p>PhysicsEngines/InertiaMsgsTest.SetPendulumInertia/1</p>\n</li>\n</ul>", "type": "rendered"}, "created_on": "2017-07-28T16:55:29.056088+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "updated_on": "2017-07-28T16:56:50.190272+00:00", "type": "pullrequest_comment", "id": 41743492}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments/41680569.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757/_/diff#comment-41680569"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}, "content": {"raw": "Note: I did not modify `BulletUniversalJoint.cc` or  `BulletHinge2Joint.cc` because they do not use the inertial pose in the same way. They appear to take axes given in the world frame.", "markup": "markdown", "html": "<p>Note: I did not modify <code>BulletUniversalJoint.cc</code> or  <code>BulletHinge2Joint.cc</code> because they do not use the inertial pose in the same way. They appear to take axes given in the world frame.</p>", "type": "rendered"}, "created_on": "2017-07-27T23:21:30.274332+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "updated_on": "2017-07-27T23:21:30.342373+00:00", "type": "pullrequest_comment", "id": 41680569}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\nf00c768 diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly (aaa38dd corrects the relative pose calculations). c527a76 adjusts the joint axes accordingly.\r\n\r\n67f74c7 fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now (7377dfe). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "fc29f3e4a64a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/fc29f3e4a64a.json"}, "html": {"href": "#!/osrf/gazebo/commits/fc29f3e4a64a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "22919577b6ad", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/22919577b6ad"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/22919577b6ad"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-07-27T23:10:38.191971+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\nf00c768 diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly (aaa38dd corrects the relative pose calculations). c527a76 adjusts the joint axes accordingly.\r\n\r\n67f74c7 fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it was a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now (7377dfe). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "fc29f3e4a64a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/fc29f3e4a64a.json"}, "html": {"href": "#!/osrf/gazebo/commits/fc29f3e4a64a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "22919577b6ad", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/22919577b6ad"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/22919577b6ad"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-07-27T23:08:12.406864+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}, {"update": {"description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\nf00c768 diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly (aaa38dd corrects the relative pose calculations). c527a76 adjusts the joint axes accordingly.\r\n\r\n67f74c7 fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it was a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now (7377dfe). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "title": "Support off-diagonal inertia terms in bullet", "destination": {"commit": {"hash": "fc29f3e4a64a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/fc29f3e4a64a.json"}, "html": {"href": "#!/osrf/gazebo/commits/fc29f3e4a64a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "22919577b6ad", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/22919577b6ad"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/22919577b6ad"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "state": "OPEN", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "date": "2017-07-27T23:08:12.373320+00:00"}, "pull_request": {"type": "pullrequest", "id": 2757, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}}, "title": "Support off-diagonal inertia terms in bullet"}}]}