{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2697/comments/43062892.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2697/_/diff#comment-43062892"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2697, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2697.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2697"}}, "title": "HarnessPlugin: PIMPL and allow re-attaching"}, "content": {"raw": "There is an issue with multiple joints...\n\nStart Gazebo with the test world modified as follows:\n~~~\ndiff -r 2c58f1f33766 worlds/harness.world\n--- a/worlds/harness.world  Wed Aug 16 01:11:12 2017 +0000\n+++ b/worlds/harness.world  Thu Aug 17 17:35:52 2017 -0700\n@@ -47,7 +47,19 @@\n           <parent>world</parent>\n           <child>link</child>\n           <axis>\n-            <xyz>1 1 1</xyz>\n+            <xyz>1 0 0</xyz>\n+            <dynamics>\n+              <damping>10</damping>\n+            </dynamics>\n+          </axis>\n+        </joint>\n+\n+        <joint name=\"joint2\" type=\"prismatic\">\n+          <pose>0 0 2 0 0 0</pose>\n+          <parent>world</parent>\n+          <child>link</child>\n+          <axis>\n+            <xyz>0 0 1</xyz>\n             <dynamics>\n               <damping>10</damping>\n             </dynamics>\n@@ -75,7 +87,7 @@\n         <winch>\n           <!-- This must be a joint specified within\n                the body of this plugin. -->\n-          <joint>joint1</joint>\n+          <joint>joint2</joint>\n\n           <!-- PID value for velocity control of the winch. These values\n                are tuned to work with this box model. -->\n@@ -102,7 +114,7 @@\n         <!-- Joint to detach. Once the joint is detached, it cannot be\n              reattached. This must be a joint specified within the\n              body of this plugin. -->\n-        <detach>joint1</detach>\n+        <detach>joint2</detach>\n       </plugin>\n     </model>\n\n~~~\n\nIn another terminal call:\n~~~\n./harness_detach\n./harness_attach 0 0 2 0 0 0\n~~~\n\nResult:\n~~~\n[Wrn] [Model.cc:1594] Model [box] already has a joint named [joint1], skipping creating joint.\ngzserver: /usr/include/boost/smart_ptr/shared_ptr.hpp:648: typename boost::detail::sp_member_access<T>::type boost::shared_ptr<T>::operator->() const [with T = gazebo::physics::Joint; typename boost::detail::sp_member_access<T>::type = gazebo::physics::Joint*]: Assertion `px != 0' failed.\n~~~", "markup": "markdown", "html": "<p>There is an issue with multiple joints...</p>\n<p>Start Gazebo with the test world modified as follows:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 2c58f1f33766 worlds/harness.world</span>\n<span class=\"gd\">--- a/worlds/harness.world  Wed Aug 16 01:11:12 2017 +0000</span>\n<span class=\"gi\">+++ b/worlds/harness.world  Thu Aug 17 17:35:52 2017 -0700</span>\n<span class=\"gu\">@@ -47,7 +47,19 @@</span>\n           &lt;parent&gt;world&lt;/parent&gt;\n           &lt;child&gt;link&lt;/child&gt;\n           &lt;axis&gt;\n<span class=\"gd\">-            &lt;xyz&gt;1 1 1&lt;/xyz&gt;</span>\n<span class=\"gi\">+            &lt;xyz&gt;1 0 0&lt;/xyz&gt;</span>\n<span class=\"gi\">+            &lt;dynamics&gt;</span>\n<span class=\"gi\">+              &lt;damping&gt;10&lt;/damping&gt;</span>\n<span class=\"gi\">+            &lt;/dynamics&gt;</span>\n<span class=\"gi\">+          &lt;/axis&gt;</span>\n<span class=\"gi\">+        &lt;/joint&gt;</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+        &lt;joint name=&quot;joint2&quot; type=&quot;prismatic&quot;&gt;</span>\n<span class=\"gi\">+          &lt;pose&gt;0 0 2 0 0 0&lt;/pose&gt;</span>\n<span class=\"gi\">+          &lt;parent&gt;world&lt;/parent&gt;</span>\n<span class=\"gi\">+          &lt;child&gt;link&lt;/child&gt;</span>\n<span class=\"gi\">+          &lt;axis&gt;</span>\n<span class=\"gi\">+            &lt;xyz&gt;0 0 1&lt;/xyz&gt;</span>\n             &lt;dynamics&gt;\n               &lt;damping&gt;10&lt;/damping&gt;\n             &lt;/dynamics&gt;\n<span class=\"gu\">@@ -75,7 +87,7 @@</span>\n         &lt;winch&gt;\n           &lt;!-- This must be a joint specified within\n                the body of this plugin. --&gt;\n<span class=\"gd\">-          &lt;joint&gt;joint1&lt;/joint&gt;</span>\n<span class=\"gi\">+          &lt;joint&gt;joint2&lt;/joint&gt;</span>\n\n           &lt;!-- PID value for velocity control of the winch. These values\n                are tuned to work with this box model. --&gt;\n<span class=\"gu\">@@ -102,7 +114,7 @@</span>\n         &lt;!-- Joint to detach. Once the joint is detached, it cannot be\n              reattached. This must be a joint specified within the\n              body of this plugin. --&gt;\n<span class=\"gd\">-        &lt;detach&gt;joint1&lt;/detach&gt;</span>\n<span class=\"gi\">+        &lt;detach&gt;joint2&lt;/detach&gt;</span>\n       &lt;/plugin&gt;\n     &lt;/model&gt;\n</pre></div>\n\n\n<p>In another terminal call:</p>\n<div class=\"codehilite\"><pre><span></span>./harness_detach\n./harness_attach 0 0 2 0 0 0\n</pre></div>\n\n\n<p>Result:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"cp\">[</span><span class=\"nx\">Wrn</span><span class=\"cp\">]</span> <span class=\"cp\">[</span><span class=\"nx\">Model.cc</span><span class=\"p\">:</span><span class=\"mi\">1594</span><span class=\"cp\">]</span> <span class=\"nt\">Model</span> <span class=\"cp\">[</span><span class=\"nx\">box</span><span class=\"cp\">]</span> <span class=\"nt\">already</span> <span class=\"nt\">has</span> <span class=\"nt\">a</span> <span class=\"nt\">joint</span> <span class=\"nt\">named</span> <span class=\"cp\">[</span><span class=\"nx\">joint1</span><span class=\"cp\">]</span><span class=\"o\">,</span> <span class=\"nt\">skipping</span> <span class=\"nt\">creating</span> <span class=\"nt\">joint</span><span class=\"o\">.</span>\n<span class=\"nt\">gzserver</span><span class=\"o\">:</span> <span class=\"o\">/</span><span class=\"nt\">usr</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">boost</span><span class=\"o\">/</span><span class=\"nt\">smart_ptr</span><span class=\"o\">/</span><span class=\"nt\">shared_ptr</span><span class=\"p\">.</span><span class=\"nc\">hpp</span><span class=\"p\">:</span><span class=\"nd\">648</span><span class=\"o\">:</span> <span class=\"nt\">typename</span> <span class=\"nt\">boost</span><span class=\"p\">::</span><span class=\"nd\">detail</span><span class=\"p\">::</span><span class=\"nd\">sp_member_access</span><span class=\"o\">&lt;</span><span class=\"nt\">T</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"nd\">type</span> <span class=\"nt\">boost</span><span class=\"p\">::</span><span class=\"nd\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"nt\">T</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"nd\">operator-</span><span class=\"o\">&gt;()</span> <span class=\"nt\">const</span> <span class=\"cp\">[</span><span class=\"k\">with</span> <span class=\"n\">T</span><span class=\"o\"> =</span> <span class=\"nx\">gazebo</span><span class=\"nl\">::physics::Joint</span><span class=\"p\">;</span> <span class=\"nx\">typename</span> <span class=\"nx\">boost</span><span class=\"nl\">::detail::sp_member_access</span><span class=\"o\">&lt;</span><span class=\"nx\">T</span><span class=\"o\">&gt;</span><span class=\"nl\">::type</span> <span class=\"o\">=</span> <span class=\"nx\">gazebo</span><span class=\"nl\">::physics::Joint</span><span class=\"o\">*</span><span class=\"cp\">]</span><span class=\"o\">:</span> <span class=\"nt\">Assertion</span> <span class=\"err\">`</span><span class=\"nt\">px</span> <span class=\"o\">!=</span> <span class=\"nt\">0</span><span class=\"err\">&#39;</span> <span class=\"nt\">failed</span><span class=\"o\">.</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-08-18T00:41:41.119653+00:00", "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "updated_on": "2017-08-18T00:41:41.122031+00:00", "type": "pullrequest_comment", "id": 43062892}