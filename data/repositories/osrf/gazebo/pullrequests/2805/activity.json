{"pagelen": 50, "values": [{"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "293fd4e6b3dc", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/293fd4e6b3dc.json"}, "html": {"href": "#!/osrf/gazebo/commits/293fd4e6b3dc"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "fb7f1740d3db", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/fb7f1740d3db.json"}, "html": {"href": "#!/osrf/gazebo/commits/fb7f1740d3db"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "MERGED", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-12-21T03:49:08.217105+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52415126.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52415126"}}, "parent": {"id": 52390780, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52390780.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52390780"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "ok I'll keep these changes. Added a note in migration guide. fb7f174", "markup": "markdown", "html": "<p>ok I'll keep these changes. Added a note in migration guide. <a href=\"#!/osrf/gazebo/commits/fb7f174\" rel=\"nofollow\" class=\"ap-connect-link\">fb7f174</a></p>", "type": "rendered"}, "created_on": "2017-12-21T03:48:18.663133+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2017-12-21T03:48:18.666016+00:00", "type": "pullrequest_comment", "id": 52415126}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "293fd4e6b3dc", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/293fd4e6b3dc.json"}, "html": {"href": "#!/osrf/gazebo/commits/293fd4e6b3dc"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "fb7f1740d3db", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/fb7f1740d3db.json"}, "html": {"href": "#!/osrf/gazebo/commits/fb7f1740d3db"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-12-21T03:47:22.101781+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"approval": {"date": "2017-12-21T02:08:53.538460+00:00", "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52404568.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52404568"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "started new CI builds", "markup": "markdown", "html": "<p>started new CI builds</p>", "type": "rendered"}, "created_on": "2017-12-20T22:28:52.432531+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-12-20T22:28:52.435176+00:00", "type": "pullrequest_comment", "id": 52404568}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"approval": {"date": "2017-12-20T19:40:07.584767+00:00", "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52390780.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52390780"}}, "parent": {"id": 52309960, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309960.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309960"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Up to you. I don't have a strong opinion about this, since the possibility of breaking user code is mostly speculative.", "markup": "markdown", "html": "<p>Up to you. I don't have a strong opinion about this, since the possibility of breaking user code is mostly speculative.</p>", "type": "rendered"}, "created_on": "2017-12-20T19:05:03.865122+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2017-12-20T19:05:03.868353+00:00", "type": "pullrequest_comment", "id": 52390780}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309960.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309960"}}, "parent": {"id": 52202370, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52202370.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52202370"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "it was initially requested to set the shadow ambient factor to 0 (range [0-1]) down from 0.4. I took a compromise and set to 0.2. We can decide to keep 0.4 in this version and change to 0.2 later in `default` if we want to reduce the impact of the shadow changes on user code?", "markup": "markdown", "html": "<p>it was initially requested to set the shadow ambient factor to 0 (range [0-1]) down from 0.4. I took a compromise and set to 0.2. We can decide to keep 0.4 in this version and change to 0.2 later in <code>default</code> if we want to reduce the impact of the shadow changes on user code?</p>", "type": "rendered"}, "created_on": "2017-12-20T01:17:37.127798+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2017-12-20T01:17:37.131741+00:00", "type": "pullrequest_comment", "id": 52309960}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309841.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309841"}}, "parent": {"id": 52201964, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201964.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201964"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I don't expect to touch this class much in the future. Anyhow, I removed the `mLanguage` variable. 23c6227", "markup": "markdown", "html": "<p>I don't expect to touch this class much in the future. Anyhow, I removed the <code>mLanguage</code> variable. <a href=\"#!/osrf/gazebo/commits/23c6227\" rel=\"nofollow\" class=\"ap-connect-link\">23c6227</a></p>", "type": "rendered"}, "created_on": "2017-12-20T01:13:15.260449+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T01:13:15.262963+00:00", "type": "pullrequest_comment", "id": 52309841}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309715.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309715"}}, "parent": {"id": 52202275, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52202275.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52202275"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "added. 5aac216", "markup": "markdown", "html": "<p>added. <a href=\"#!/osrf/gazebo/commits/5aac216\" rel=\"nofollow\" class=\"ap-connect-link\">5aac216</a></p>", "type": "rendered"}, "created_on": "2017-12-20T01:09:47.862868+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T01:09:47.865610+00:00", "type": "pullrequest_comment", "id": 52309715}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "c39c5967372d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/c39c5967372d.json"}, "html": {"href": "#!/osrf/gazebo/commits/c39c5967372d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "23c6227e0ab7", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/23c6227e0ab7.json"}, "html": {"href": "#!/osrf/gazebo/commits/23c6227e0ab7"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-12-20T01:08:47.548263+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309400.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309400"}}, "parent": {"id": 52202082, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52202082.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52202082"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "done. 41206ba", "markup": "markdown", "html": "<p>done. <a href=\"#!/osrf/gazebo/commits/41206ba\" rel=\"nofollow\" class=\"ap-connect-link\">41206ba</a></p>", "type": "rendered"}, "created_on": "2017-12-20T00:59:10.868571+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T00:59:10.871732+00:00", "type": "pullrequest_comment", "id": 52309400}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309389.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309389"}}, "parent": {"id": 52201846, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201846.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201846"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "added a few `override`s. 41206ba", "markup": "markdown", "html": "<p>added a few <code>override</code>s. <a href=\"#!/osrf/gazebo/commits/41206ba\" rel=\"nofollow\" class=\"ap-connect-link\">41206ba</a></p>", "type": "rendered"}, "created_on": "2017-12-20T00:59:00.382914+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T00:59:00.385030+00:00", "type": "pullrequest_comment", "id": 52309389}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309387.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309387"}}, "parent": {"id": 52309333, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309333.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309333"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Got it, thanks", "markup": "markdown", "html": "<p>Got it, thanks</p>", "type": "rendered"}, "created_on": "2017-12-20T00:58:58.376846+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-20T00:58:58.378996+00:00", "type": "pullrequest_comment", "id": 52309387}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309375.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309375"}}, "parent": {"id": 52201607, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201607.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201607"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I removed most of them but left a few to highlight key changes compared to original OGRE files. 41206ba", "markup": "markdown", "html": "<p>I removed most of them but left a few to highlight key changes compared to original OGRE files. <a href=\"#!/osrf/gazebo/commits/41206ba\" rel=\"nofollow\" class=\"ap-connect-link\">41206ba</a></p>", "type": "rendered"}, "created_on": "2017-12-20T00:58:33.186168+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T00:58:48.812154+00:00", "type": "pullrequest_comment", "id": 52309375}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309333.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309333"}}, "parent": {"id": 52201564, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201564.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201564"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I don't think we support 1.6 anymore since min ogre version in trusty in 1.7. Also, RTShaderSystem is introduced in 1.7 and API changed in 1.8 so we only check 1.7 here.", "markup": "markdown", "html": "<p>I don't think we support 1.6 anymore since min ogre version in trusty in 1.7. Also, RTShaderSystem is introduced in 1.7 and API changed in 1.8 so we only check 1.7 here.</p>", "type": "rendered"}, "created_on": "2017-12-20T00:57:10.507070+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T00:57:10.510120+00:00", "type": "pullrequest_comment", "id": 52309333}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52309283.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52309283"}}, "parent": {"id": 52201464, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201464.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201464"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "we're catching the exceptions [here](#!/osrf/gazebo/src/dce3030d87304270475ddb742e9be402bc383b5c/gazebo/rendering/RTShaderSystem.cc?at=default&fileviewer=file-view-default#RTShaderSystem.cc-246)", "markup": "markdown", "html": "<p>we're catching the exceptions <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/dce3030d87304270475ddb742e9be402bc383b5c/gazebo/rendering/RTShaderSystem.cc?at=default&amp;fileviewer=file-view-default#RTShaderSystem.cc-246\" rel=\"nofollow\">here</a></p>", "type": "rendered"}, "created_on": "2017-12-20T00:55:42.819287+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {}, "updated_on": "2017-12-20T00:55:42.821772+00:00", "type": "pullrequest_comment", "id": 52309283}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "c39c5967372d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/c39c5967372d.json"}, "html": {"href": "#!/osrf/gazebo/commits/c39c5967372d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "41206ba506c8", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/41206ba506c8.json"}, "html": {"href": "#!/osrf/gazebo/commits/41206ba506c8"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-12-20T00:54:17.452520+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52202370.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52202370"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I know this is an improvement, but I'd just like to point out that the darker shadows might mess up user results.", "markup": "markdown", "html": "<p>I know this is an improvement, but I'd just like to point out that the darker shadows might mess up user results.</p>", "type": "rendered"}, "created_on": "2017-12-19T00:16:09.240515+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2017-12-19T00:16:09.243600+00:00", "type": "pullrequest_comment", "id": 52202370}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52202275.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52202275"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Maybe want to add an OSRF copyright notice now that we're editing it", "markup": "markdown", "html": "<p>Maybe want to add an OSRF copyright notice now that we're editing it</p>", "type": "rendered"}, "created_on": "2017-12-19T00:14:06.156543+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-19T00:14:06.160114+00:00", "type": "pullrequest_comment", "id": 52202275}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "a77aa5a958fb", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a77aa5a958fb.json"}, "html": {"href": "#!/osrf/gazebo/commits/a77aa5a958fb"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "b415ce2e225a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/b415ce2e225a.json"}, "html": {"href": "#!/osrf/gazebo/commits/b415ce2e225a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2017-12-19T00:12:19.010012+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "a77aa5a958fb", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a77aa5a958fb.json"}, "html": {"href": "#!/osrf/gazebo/commits/a77aa5a958fb"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "b415ce2e225a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/b415ce2e225a.json"}, "html": {"href": "#!/osrf/gazebo/commits/b415ce2e225a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2017-12-19T00:12:14.428625+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52202082.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52202082"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Move it below public functions?", "markup": "markdown", "html": "<p>Move it below public functions?</p>", "type": "rendered"}, "created_on": "2017-12-19T00:09:28.952284+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-19T00:09:28.955002+00:00", "type": "pullrequest_comment", "id": 52202082}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201964.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201964"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Do you envision this changing much in the future? Is it worth it to pimpl?", "markup": "markdown", "html": "<p>Do you envision this changing much in the future? Is it worth it to pimpl?</p>", "type": "rendered"}, "created_on": "2017-12-19T00:06:50.832299+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-19T00:06:50.834815+00:00", "type": "pullrequest_comment", "id": 52201964}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201846.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201846"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Use `override`?", "markup": "markdown", "html": "<p>Use <code>override</code>?</p>", "type": "rendered"}, "created_on": "2017-12-19T00:04:25.042099+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-19T00:04:25.044255+00:00", "type": "pullrequest_comment", "id": 52201846}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201607.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201607"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "Remove comment? There are quite a few others along the code, not sure if we want to keep them for future debugging", "markup": "markdown", "html": "<p>Remove comment? There are quite a few others along the code, not sure if we want to keep them for future debugging</p>", "type": "rendered"}, "created_on": "2017-12-18T23:59:09.248746+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-18T23:59:09.252464+00:00", "type": "pullrequest_comment", "id": 52201607}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201564.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201564"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I see some older code on this branch also refers to `OGRE_VERSION_MINOR == 6`. I'm wondering if this should be `<= 7`. What Ogre versions does Gazebo 7 support?", "markup": "markdown", "html": "<p>I see some older code on this branch also refers to <code>OGRE_VERSION_MINOR == 6</code>. I'm wondering if this should be <code>&lt;= 7</code>. What Ogre versions does Gazebo 7 support?</p>", "type": "rendered"}, "created_on": "2017-12-18T23:58:08.060289+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-18T23:58:08.062921+00:00", "type": "pullrequest_comment", "id": 52201564}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52201464.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52201464"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I assume Ogre is handling these exceptions?", "markup": "markdown", "html": "<p>I assume Ogre is handling these exceptions?</p>", "type": "rendered"}, "created_on": "2017-12-18T23:55:54.986007+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-18T23:55:54.988808+00:00", "type": "pullrequest_comment", "id": 52201464}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/52200878.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-52200878"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "These changes could also be ported to ign-common.", "markup": "markdown", "html": "<p>These changes could also be ported to ign-common.</p>", "type": "rendered"}, "created_on": "2017-12-18T23:41:39.385861+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-12-18T23:41:39.388298+00:00", "type": "pullrequest_comment", "id": 52200878}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "a77aa5a958fb", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a77aa5a958fb.json"}, "html": {"href": "#!/osrf/gazebo/commits/a77aa5a958fb"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "a2c6ff8e009a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a2c6ff8e009a.json"}, "html": {"href": "#!/osrf/gazebo/commits/a2c6ff8e009a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-12-16T11:51:01.491127+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "f72b73a33dee", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/f72b73a33dee.json"}, "html": {"href": "#!/osrf/gazebo/commits/f72b73a33dee"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "a8fba0b59d65", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/a8fba0b59d65.json"}, "html": {"href": "#!/osrf/gazebo/commits/a8fba0b59d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-12-08T04:43:16.211894+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49819571.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49819571"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "It looks good to me visually, but I haven't fully reviewed the code", "markup": "markdown", "html": "<p>It looks good to me visually, but I haven't fully reviewed the code</p>", "type": "rendered"}, "created_on": "2017-11-17T02:08:44.503417+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-11-17T02:08:44.506416+00:00", "type": "pullrequest_comment", "id": 49819571}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49819531.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49819531"}}, "parent": {"id": 49224540, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49224540.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49224540"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "this looks fixed to me now", "markup": "markdown", "html": "<p>this looks fixed to me now</p>", "type": "rendered"}, "created_on": "2017-11-17T02:06:57.007615+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-11-17T02:06:57.009901+00:00", "type": "pullrequest_comment", "id": 49819531}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49707648.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49707648"}}, "parent": {"id": 49592965, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49592965.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49592965"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "yeah, that looks great!", "markup": "markdown", "html": "<p>yeah, that looks great!</p>", "type": "rendered"}, "created_on": "2017-11-16T02:11:43.094978+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-11-16T02:11:43.097548+00:00", "type": "pullrequest_comment", "id": 49707648}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49592965.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49592965"}}, "parent": {"id": 49591633, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49591633.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49591633"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I think  9a5c297 should do it", "markup": "markdown", "html": "<p>I think  <a href=\"#!/osrf/gazebo/commits/9a5c297\" rel=\"nofollow\" class=\"ap-connect-link\">9a5c297</a> should do it</p>", "type": "rendered"}, "created_on": "2017-11-15T01:53:18.005506+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2017-11-15T01:53:18.009455+00:00", "type": "pullrequest_comment", "id": 49592965}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "d7411f63727d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d7411f63727d.json"}, "html": {"href": "#!/osrf/gazebo/commits/d7411f63727d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "9a5c297f6013", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/9a5c297f6013.json"}, "html": {"href": "#!/osrf/gazebo/commits/9a5c297f6013"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-15T01:52:38.398821+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "d7411f63727d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d7411f63727d.json"}, "html": {"href": "#!/osrf/gazebo/commits/d7411f63727d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "9a5c297f6013", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/9a5c297f6013.json"}, "html": {"href": "#!/osrf/gazebo/commits/9a5c297f6013"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-15T01:52:31.842004+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49591633.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49591633"}}, "parent": {"id": 49344188, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49344188.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49344188"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "thanks for fixing it. I'm running it in a loop to see if I can reproduce that failure in NameCollision\n\nin the meantime, I am seeing a seg-fault after the end of `UNIT_Console_TEST`\n\n~~~\n[       OK ] Console_TEST.ColorErr (0 ms)\n[----------] 13 tests from Console_TEST (4 ms total)\n\n[----------] Global test environment tear-down\n[==========] 13 tests from 1 test case ran. (4 ms total)\n[  PASSED  ] 13 tests.\n[Thread 0x7fffd7753700 (LWP 5141) exited]\n\nThread 1 \"UNIT_Console_TE\" received signal SIGSEGV, Segmentation fault.\nstd::basic_ofstream<char, std::char_traits<char> >::close (this=0x6a6ee0) at /usr/include/c++/5/fstream:803\n803\t\t  this->setstate(ios_base::failbit);\n(gdb) bt\n#0  std::basic_ofstream<char, std::char_traits<char> >::close (this=0x6a6ee0) at /usr/include/c++/5/fstream:803\n#1  gazebo::common::FileLogger::Buffer::~Buffer (this=0x6a3670, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/common/Console.cc:286\n#2  0x00007ffff7b3fe09 in gazebo::common::FileLogger::Buffer::~Buffer (this=0x6a3670, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/common/Console.cc:292\n#3  0x00007ffff7b3f95f in gazebo::common::FileLogger::~FileLogger (this=0x7ffff7dd5680 <gazebo::common::Console::log>, __in_chrg=<optimized out>, __vtt_parm=<optimized out>) at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/common/Console.cc:156\n#4  0x00007ffff6d8536a in __cxa_finalize (d=0x7ffff7dd4d38) at cxa_finalize.c:56\n#5  0x00007ffff7b0c393 in __do_global_dtors_aux () from /data_fast/scpeters/ws/gazebo7/build/gazebo/gazebo/common/libgazebo_common.so.7\n#6  0x00007fffffffdbf0 in ?? ()\n#7  0x00007ffff7de7de7 in _dl_fini () at dl-fini.c:235\nBacktrace stopped: frame did not save the PC\n~~~", "markup": "markdown", "html": "<p>thanks for fixing it. I'm running it in a loop to see if I can reproduce that failure in NameCollision</p>\n<p>in the meantime, I am seeing a seg-fault after the end of <code>UNIT_Console_TEST</code></p>\n<div class=\"codehilite\"><pre><span></span><span class=\"cp\">[</span>       <span class=\"nx\">OK</span> <span class=\"cp\">]</span> <span class=\"nt\">Console_TEST</span><span class=\"p\">.</span><span class=\"nc\">ColorErr</span> <span class=\"o\">(</span><span class=\"nt\">0</span> <span class=\"nt\">ms</span><span class=\"o\">)</span>\n<span class=\"cp\">[</span><span class=\"o\">----------</span><span class=\"cp\">]</span> <span class=\"nt\">13</span> <span class=\"nt\">tests</span> <span class=\"nt\">from</span> <span class=\"nt\">Console_TEST</span> <span class=\"o\">(</span><span class=\"nt\">4</span> <span class=\"nt\">ms</span> <span class=\"nt\">total</span><span class=\"o\">)</span>\n\n<span class=\"cp\">[</span><span class=\"o\">----------</span><span class=\"cp\">]</span> <span class=\"nt\">Global</span> <span class=\"nt\">test</span> <span class=\"nt\">environment</span> <span class=\"nt\">tear-down</span>\n<span class=\"cp\">[</span><span class=\"o\">==========</span><span class=\"cp\">]</span> <span class=\"nt\">13</span> <span class=\"nt\">tests</span> <span class=\"nt\">from</span> <span class=\"nt\">1</span> <span class=\"nt\">test</span> <span class=\"nt\">case</span> <span class=\"nt\">ran</span><span class=\"o\">.</span> <span class=\"o\">(</span><span class=\"nt\">4</span> <span class=\"nt\">ms</span> <span class=\"nt\">total</span><span class=\"o\">)</span>\n<span class=\"cp\">[</span>  <span class=\"nx\">PASSED</span>  <span class=\"cp\">]</span> <span class=\"nt\">13</span> <span class=\"nt\">tests</span><span class=\"o\">.</span>\n<span class=\"cp\">[</span><span class=\"k\">Thread</span> <span class=\"mh\">0x7fffd7753700</span> <span class=\"p\">(</span><span class=\"nx\">LWP</span> <span class=\"mi\">5141</span><span class=\"p\">)</span> <span class=\"nx\">exited</span><span class=\"cp\">]</span>\n\n<span class=\"nt\">Thread</span> <span class=\"nt\">1</span> <span class=\"s2\">&quot;UNIT_Console_TE&quot;</span> <span class=\"nt\">received</span> <span class=\"nt\">signal</span> <span class=\"nt\">SIGSEGV</span><span class=\"o\">,</span> <span class=\"nt\">Segmentation</span> <span class=\"nt\">fault</span><span class=\"o\">.</span>\n<span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">basic_ofstream</span><span class=\"o\">&lt;</span><span class=\"nt\">char</span><span class=\"o\">,</span> <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">char_traits</span><span class=\"o\">&lt;</span><span class=\"nt\">char</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"nd\">close</span> <span class=\"o\">(</span><span class=\"nt\">this</span><span class=\"o\">=</span><span class=\"nt\">0x6a6ee0</span><span class=\"o\">)</span> <span class=\"nt\">at</span> <span class=\"o\">/</span><span class=\"nt\">usr</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">c</span><span class=\"o\">++/</span><span class=\"nt\">5</span><span class=\"o\">/</span><span class=\"nt\">fstream</span><span class=\"p\">:</span><span class=\"nd\">803</span>\n<span class=\"nt\">803</span>       <span class=\"nt\">this-</span><span class=\"o\">&gt;</span><span class=\"nt\">setstate</span><span class=\"o\">(</span><span class=\"nt\">ios_base</span><span class=\"p\">::</span><span class=\"nd\">failbit</span><span class=\"o\">);</span>\n<span class=\"o\">(</span><span class=\"nt\">gdb</span><span class=\"o\">)</span> <span class=\"nt\">bt</span>\n<span class=\"p\">#</span><span class=\"nn\">0</span>  <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">basic_ofstream</span><span class=\"o\">&lt;</span><span class=\"nt\">char</span><span class=\"o\">,</span> <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">char_traits</span><span class=\"o\">&lt;</span><span class=\"nt\">char</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"nd\">close</span> <span class=\"o\">(</span><span class=\"nt\">this</span><span class=\"o\">=</span><span class=\"nt\">0x6a6ee0</span><span class=\"o\">)</span> <span class=\"nt\">at</span> <span class=\"o\">/</span><span class=\"nt\">usr</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">c</span><span class=\"o\">++/</span><span class=\"nt\">5</span><span class=\"o\">/</span><span class=\"nt\">fstream</span><span class=\"p\">:</span><span class=\"nd\">803</span>\n<span class=\"p\">#</span><span class=\"nn\">1</span>  <span class=\"nt\">gazebo</span><span class=\"p\">::</span><span class=\"nd\">common</span><span class=\"p\">::</span><span class=\"nd\">FileLogger</span><span class=\"p\">::</span><span class=\"nd\">Buffer</span><span class=\"o\">::~</span><span class=\"nt\">Buffer</span> <span class=\"o\">(</span><span class=\"nt\">this</span><span class=\"o\">=</span><span class=\"nt\">0x6a3670</span><span class=\"o\">,</span> <span class=\"nt\">__in_chrg</span><span class=\"o\">=&lt;</span><span class=\"nt\">optimized</span> <span class=\"nt\">out</span><span class=\"o\">&gt;)</span> <span class=\"nt\">at</span> <span class=\"o\">/</span><span class=\"nt\">data_fast</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws</span><span class=\"o\">/</span><span class=\"nt\">gazebo7</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">common</span><span class=\"o\">/</span><span class=\"nt\">Console</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">286</span>\n<span class=\"p\">#</span><span class=\"nn\">2</span>  <span class=\"nt\">0x00007ffff7b3fe09</span> <span class=\"nt\">in</span> <span class=\"nt\">gazebo</span><span class=\"p\">::</span><span class=\"nd\">common</span><span class=\"p\">::</span><span class=\"nd\">FileLogger</span><span class=\"p\">::</span><span class=\"nd\">Buffer</span><span class=\"o\">::~</span><span class=\"nt\">Buffer</span> <span class=\"o\">(</span><span class=\"nt\">this</span><span class=\"o\">=</span><span class=\"nt\">0x6a3670</span><span class=\"o\">,</span> <span class=\"nt\">__in_chrg</span><span class=\"o\">=&lt;</span><span class=\"nt\">optimized</span> <span class=\"nt\">out</span><span class=\"o\">&gt;)</span> <span class=\"nt\">at</span> <span class=\"o\">/</span><span class=\"nt\">data_fast</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws</span><span class=\"o\">/</span><span class=\"nt\">gazebo7</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">common</span><span class=\"o\">/</span><span class=\"nt\">Console</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">292</span>\n<span class=\"p\">#</span><span class=\"nn\">3</span>  <span class=\"nt\">0x00007ffff7b3f95f</span> <span class=\"nt\">in</span> <span class=\"nt\">gazebo</span><span class=\"p\">::</span><span class=\"nd\">common</span><span class=\"p\">::</span><span class=\"nd\">FileLogger</span><span class=\"o\">::~</span><span class=\"nt\">FileLogger</span> <span class=\"o\">(</span><span class=\"nt\">this</span><span class=\"o\">=</span><span class=\"nt\">0x7ffff7dd5680</span> <span class=\"o\">&lt;</span><span class=\"nt\">gazebo</span><span class=\"p\">::</span><span class=\"nd\">common</span><span class=\"p\">::</span><span class=\"nd\">Console</span><span class=\"p\">::</span><span class=\"nd\">log</span><span class=\"o\">&gt;,</span> <span class=\"nt\">__in_chrg</span><span class=\"o\">=&lt;</span><span class=\"nt\">optimized</span> <span class=\"nt\">out</span><span class=\"o\">&gt;,</span> <span class=\"nt\">__vtt_parm</span><span class=\"o\">=&lt;</span><span class=\"nt\">optimized</span> <span class=\"nt\">out</span><span class=\"o\">&gt;)</span> <span class=\"nt\">at</span> <span class=\"o\">/</span><span class=\"nt\">data_fast</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws</span><span class=\"o\">/</span><span class=\"nt\">gazebo7</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">common</span><span class=\"o\">/</span><span class=\"nt\">Console</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">156</span>\n<span class=\"p\">#</span><span class=\"nn\">4</span>  <span class=\"nt\">0x00007ffff6d8536a</span> <span class=\"nt\">in</span> <span class=\"nt\">__cxa_finalize</span> <span class=\"o\">(</span><span class=\"nt\">d</span><span class=\"o\">=</span><span class=\"nt\">0x7ffff7dd4d38</span><span class=\"o\">)</span> <span class=\"nt\">at</span> <span class=\"nt\">cxa_finalize</span><span class=\"p\">.</span><span class=\"nc\">c</span><span class=\"p\">:</span><span class=\"nd\">56</span>\n<span class=\"p\">#</span><span class=\"nn\">5</span>  <span class=\"nt\">0x00007ffff7b0c393</span> <span class=\"nt\">in</span> <span class=\"nt\">__do_global_dtors_aux</span> <span class=\"o\">()</span> <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">data_fast</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws</span><span class=\"o\">/</span><span class=\"nt\">gazebo7</span><span class=\"o\">/</span><span class=\"nt\">build</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">gazebo</span><span class=\"o\">/</span><span class=\"nt\">common</span><span class=\"o\">/</span><span class=\"nt\">libgazebo_common</span><span class=\"p\">.</span><span class=\"nc\">so</span><span class=\"p\">.</span><span class=\"nc\">7</span>\n<span class=\"p\">#</span><span class=\"nn\">6</span>  <span class=\"nt\">0x00007fffffffdbf0</span> <span class=\"nt\">in</span> <span class=\"o\">??</span> <span class=\"o\">()</span>\n<span class=\"p\">#</span><span class=\"nn\">7</span>  <span class=\"nt\">0x00007ffff7de7de7</span> <span class=\"nt\">in</span> <span class=\"nt\">_dl_fini</span> <span class=\"o\">()</span> <span class=\"nt\">at</span> <span class=\"nt\">dl-fini</span><span class=\"p\">.</span><span class=\"nc\">c</span><span class=\"p\">:</span><span class=\"nd\">235</span>\n<span class=\"nt\">Backtrace</span> <span class=\"nt\">stopped</span><span class=\"o\">:</span> <span class=\"nt\">frame</span> <span class=\"nt\">did</span> <span class=\"nt\">not</span> <span class=\"nt\">save</span> <span class=\"nt\">the</span> <span class=\"nt\">PC</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-11-15T01:15:29.201488+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-11-15T01:15:29.203588+00:00", "type": "pullrequest_comment", "id": 49591633}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "d7411f63727d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d7411f63727d.json"}, "html": {"href": "#!/osrf/gazebo/commits/d7411f63727d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "5fa7f4f2bd07", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/5fa7f4f2bd07.json"}, "html": {"href": "#!/osrf/gazebo/commits/5fa7f4f2bd07"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-15T00:31:33.394788+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "d7411f63727d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/d7411f63727d.json"}, "html": {"href": "#!/osrf/gazebo/commits/d7411f63727d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "89f146aece39", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/89f146aece39.json"}, "html": {"href": "#!/osrf/gazebo/commits/89f146aece39"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-14T23:13:20.355366+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49344188.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49344188"}}, "parent": {"id": 49225741, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49225741.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49225741"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I think it may be fixed by b09fd75. Started another [xenial-nvidia build](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/342/)", "markup": "markdown", "html": "<p>I think it may be fixed by <a href=\"#!/osrf/gazebo/commits/b09fd75\" rel=\"nofollow\" class=\"ap-connect-link\">b09fd75</a>. Started another <a data-is-external-link=\"true\" href=\"https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/342/\" rel=\"nofollow\">xenial-nvidia build</a></p>", "type": "rendered"}, "created_on": "2017-11-10T22:29:22.185882+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "updated_on": "2017-11-10T22:29:22.188807+00:00", "type": "pullrequest_comment", "id": 49344188}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "4ec26fcd8987", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4ec26fcd8987.json"}, "html": {"href": "#!/osrf/gazebo/commits/4ec26fcd8987"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "b09fd756b59c", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/b09fd756b59c.json"}, "html": {"href": "#!/osrf/gazebo/commits/b09fd756b59c"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-10T22:25:37.351859+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49225741.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49225741"}}, "parent": {"id": 49224540, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49224540.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49224540"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I checked the console log, and it looks like pull request #2806 has the same test failure\n\n* https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/338/testReport/junit/(root)/INTEGRATION_gpu_laser/test_ran/", "markup": "markdown", "html": "<p>I checked the console log, and it looks like <a href=\"#!/osrf/gazebo/pull-requests/2806/add-camera-lens-flare-effect\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2806</a> has the same test failure</p>\n<ul>\n<li><a href=\"https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/338/testReport/junit/(root)/INTEGRATION_gpu_laser/test_ran/\" rel=\"nofollow\" class=\"ap-connect-link\">https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/338/testReport/junit/(root)/INTEGRATION_gpu_laser/test_ran/</a></li>\n</ul>", "type": "rendered"}, "created_on": "2017-11-09T18:31:08.346333+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-11-09T18:31:08.349274+00:00", "type": "pullrequest_comment", "id": 49225741}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments/49224540.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805/_/diff#comment-49224540"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}, "content": {"raw": "I noticed that [INTEGRATION_gpu_laser failed on xenial-nvidia](https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/337/testReport/(root)/INTEGRATION_gpu_laser/test_ran/) with the following console output:\n\n~~~\n453: [ RUN      ] GPURaySensorTest.LaserUnitBox\n453: [Msg] Waiting for master.\n453: [Msg] Connected to gazebo master @ http://127.0.0.1:11345\n453: [Msg] Publicized address: 172.17.0.5\n453: [Dbg] [ServerFixture.cc:207] ServerFixture load in 0.9 seconds, timeout after 600 seconds\n453: [Wrn] [msgs.cc:1808] Conversion of sensor type[gpu_ray] not suppported.\n453: [Wrn] [msgs.cc:1808] Conversion of sensor type[gpu_ray] not suppported.\n453: [Dbg] [ServerFixture.cc:133] ServerFixture::Unload\n453: [       OK ] GPURaySensorTest.LaserUnitBox (2447 ms)\n453: [ RUN      ] GPURaySensorTest.NameCollision\n157/200 Test #453: INTEGRATION_gpu_laser .................................***Exception: SegFault  2.73 sec\n~~~\n\nI'm able to reproduce it maybe 50% of the time. The backtrace implicates the following line in [Console.cc](#!/osrf/gazebo/src/4ec26fcd89872290714029c0126dd837302ac9f6/gazebo/common/Console.cc?at=gazebo7&fileviewer=file-view-default#Console.cc-205) of all places:\n\n~~~\nbuf->stream = new std::ofstream(logPath.string().c_str(), std::ios::out);\n~~~\n\n~~~\nCore was generated by `test/integration/INTEGRATION_gpu_laser'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x00007f14ccd59545 in _int_malloc (av=av@entry=0x7f14cd09bb20 <main_arena>, bytes=bytes@entry=8192) at malloc.c:3727\n3727\tmalloc.c: No such file or directory.\n(gdb) bt\n#0  0x00007f14ccd59545 in _int_malloc (av=av@entry=0x7f14cd09bb20 <main_arena>, bytes=bytes@entry=8192) at malloc.c:3727\n#1  0x00007f14ccd5b184 in __GI___libc_malloc (bytes=8192) at malloc.c:2913\n#2  0x00007f14cd64de78 in operator new(unsigned long) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007f14cd64df19 in operator new[](unsigned long) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007f14cd6ac468 in std::basic_filebuf<char, std::char_traits<char> >::_M_allocate_internal_buffer() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007f14cd6b06b2 in std::basic_filebuf<char, std::char_traits<char> >::open(char const*, std::_Ios_Openmode) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00007f14ce81bb1e in std::basic_ofstream<char, std::char_traits<char> >::open (__mode=std::_S_out, __s=0x223c220 \"/home/scpeters/.gazebo/test-11345/test.log\", this=0x2236f60) at /usr/include/c++/5/fstream:802\n#7  std::basic_ofstream<char, std::char_traits<char> >::basic_ofstream (__mode=std::_S_out, __s=0x223c220 \"/home/scpeters/.gazebo/test-11345/test.log\", this=0x2236f60, __in_chrg=<optimized out>, __vtt_parm=<optimized out>) at /usr/include/c++/5/fstream:702\n#8  gazebo::common::FileLogger::Init (this=0x7f14ceaaf680 <gazebo::common::Console::log>, _prefix=\"test-\", _filename=\"test.log\") at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/common/Console.cc:205\n#9  0x0000000000445b2a in gazebo::ServerFixture::ServerFixture (this=0x2221b70) at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/test/ServerFixture.cc:91\n#10 0x000000000041955b in GPURaySensorTest::GPURaySensorTest (this=0x2221b70) at /data_fast/scpeters/ws/gazebo7/src/gazebo/test/integration/gpu_laser.cc:25\n#11 GPURaySensorTest_NameCollision_Test::GPURaySensorTest_NameCollision_Test (this=0x2221b70) at /data_fast/scpeters/ws/gazebo7/src/gazebo/test/integration/gpu_laser.cc:213\n...\n~~~\n\nIt's hard to see how it could be related, but I checked my collection of backtraces from overnight testing, and this looks new. I saw a [random stackoverflow post](https://stackoverflow.com/questions/40498613/logger-receiving-segmentation-fault-when-trying-to-open-ofstream) saying they had a similar issue with an ofstream, but who knows. Since this looks like a new flaky failure, I'd like to try to fix it before merging.", "markup": "markdown", "html": "<p>I noticed that <a data-is-external-link=\"true\" href=\"https://build.osrfoundation.org/job/gazebo-ci-pr_any-xenial-amd64-gpu-nvidia/337/testReport/(root)/INTEGRATION_gpu_laser/test_ran/\" rel=\"nofollow\">INTEGRATION_gpu_laser failed on xenial-nvidia</a> with the following console output:</p>\n<div class=\"codehilite\"><pre><span></span>453: [ RUN      ] GPURaySensorTest.LaserUnitBox\n453: [Msg] Waiting for master.\n453: [Msg] Connected to gazebo master @ http://127.0.0.1:11345\n453: [Msg] Publicized address: 172.17.0.5\n453: [Dbg] [ServerFixture.cc:207] ServerFixture load in 0.9 seconds, timeout after 600 seconds\n453: [Wrn] [msgs.cc:1808] Conversion of sensor type[gpu_ray] not suppported.\n453: [Wrn] [msgs.cc:1808] Conversion of sensor type[gpu_ray] not suppported.\n453: [Dbg] [ServerFixture.cc:133] ServerFixture::Unload\n453: [       OK ] GPURaySensorTest.LaserUnitBox (2447 ms)\n453: [ RUN      ] GPURaySensorTest.NameCollision\n157/200 Test #453: INTEGRATION_gpu_laser .................................***Exception: SegFault  2.73 sec\n</pre></div>\n\n\n<p>I'm able to reproduce it maybe 50% of the time. The backtrace implicates the following line in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/4ec26fcd89872290714029c0126dd837302ac9f6/gazebo/common/Console.cc?at=gazebo7&amp;fileviewer=file-view-default#Console.cc-205\" rel=\"nofollow\">Console.cc</a> of all places:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">buf-</span><span class=\"o\">&gt;</span><span class=\"nt\">stream</span> <span class=\"o\">=</span> <span class=\"nt\">new</span> <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">ofstream</span><span class=\"o\">(</span><span class=\"nt\">logPath</span><span class=\"p\">.</span><span class=\"nc\">string</span><span class=\"o\">()</span><span class=\"p\">.</span><span class=\"nc\">c_str</span><span class=\"o\">(),</span> <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">ios</span><span class=\"p\">::</span><span class=\"nd\">out</span><span class=\"o\">);</span>\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>Core was generated by `test/integration/INTEGRATION_gpu_laser&#39;.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x00007f14ccd59545 in _int_malloc (av=av@entry=0x7f14cd09bb20 &lt;main_arena&gt;, bytes=bytes@entry=8192) at malloc.c:3727\n3727    malloc.c: No such file or directory.\n(gdb) bt\n#0  0x00007f14ccd59545 in _int_malloc (av=av@entry=0x7f14cd09bb20 &lt;main_arena&gt;, bytes=bytes@entry=8192) at malloc.c:3727\n#1  0x00007f14ccd5b184 in __GI___libc_malloc (bytes=8192) at malloc.c:2913\n#2  0x00007f14cd64de78 in operator new(unsigned long) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007f14cd64df19 in operator new[](unsigned long) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007f14cd6ac468 in std::basic_filebuf&lt;char, std::char_traits&lt;char&gt; &gt;::_M_allocate_internal_buffer() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007f14cd6b06b2 in std::basic_filebuf&lt;char, std::char_traits&lt;char&gt; &gt;::open(char const*, std::_Ios_Openmode) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00007f14ce81bb1e in std::basic_ofstream&lt;char, std::char_traits&lt;char&gt; &gt;::open (__mode=std::_S_out, __s=0x223c220 &quot;/home/scpeters/.gazebo/test-11345/test.log&quot;, this=0x2236f60) at /usr/include/c++/5/fstream:802\n#7  std::basic_ofstream&lt;char, std::char_traits&lt;char&gt; &gt;::basic_ofstream (__mode=std::_S_out, __s=0x223c220 &quot;/home/scpeters/.gazebo/test-11345/test.log&quot;, this=0x2236f60, __in_chrg=&lt;optimized out&gt;, __vtt_parm=&lt;optimized out&gt;) at /usr/include/c++/5/fstream:702\n#8  gazebo::common::FileLogger::Init (this=0x7f14ceaaf680 &lt;gazebo::common::Console::log&gt;, _prefix=&quot;test-&quot;, _filename=&quot;test.log&quot;) at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/common/Console.cc:205\n#9  0x0000000000445b2a in gazebo::ServerFixture::ServerFixture (this=0x2221b70) at /data_fast/scpeters/ws/gazebo7/src/gazebo/gazebo/test/ServerFixture.cc:91\n#10 0x000000000041955b in GPURaySensorTest::GPURaySensorTest (this=0x2221b70) at /data_fast/scpeters/ws/gazebo7/src/gazebo/test/integration/gpu_laser.cc:25\n#11 GPURaySensorTest_NameCollision_Test::GPURaySensorTest_NameCollision_Test (this=0x2221b70) at /data_fast/scpeters/ws/gazebo7/src/gazebo/test/integration/gpu_laser.cc:213\n...\n</pre></div>\n\n\n<p>It's hard to see how it could be related, but I checked my collection of backtraces from overnight testing, and this looks new. I saw a <a data-is-external-link=\"true\" href=\"https://stackoverflow.com/questions/40498613/logger-receiving-segmentation-fault-when-trying-to-open-ofstream\" rel=\"nofollow\">random stackoverflow post</a> saying they had a similar issue with an ofstream, but who knows. Since this looks like a new flaky failure, I'd like to try to fix it before merging.</p>", "type": "rendered"}, "created_on": "2017-11-09T18:15:07.687298+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-11-09T18:15:07.690843+00:00", "type": "pullrequest_comment", "id": 49224540}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "4ec26fcd8987", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4ec26fcd8987.json"}, "html": {"href": "#!/osrf/gazebo/commits/4ec26fcd8987"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "4345f16c6cbc", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4345f16c6cbc.json"}, "html": {"href": "#!/osrf/gazebo/commits/4345f16c6cbc"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-08T22:44:00.579289+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is an known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "4ec26fcd8987", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4ec26fcd8987.json"}, "html": {"href": "#!/osrf/gazebo/commits/4ec26fcd8987"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "4345f16c6cbc", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4345f16c6cbc.json"}, "html": {"href": "#!/osrf/gazebo/commits/4345f16c6cbc"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-08T22:43:25.317273+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is an known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "4ec26fcd8987", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4ec26fcd8987.json"}, "html": {"href": "#!/osrf/gazebo/commits/4ec26fcd8987"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "12a3e62a25fe", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/12a3e62a25fe.json"}, "html": {"href": "#!/osrf/gazebo/commits/12a3e62a25fe"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-08T22:24:14.601912+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}, {"update": {"description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](https://bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](https://bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is an known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "title": "Shadow improvements", "destination": {"commit": {"hash": "4ec26fcd8987", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/4ec26fcd8987.json"}, "html": {"href": "#!/osrf/gazebo/commits/4ec26fcd8987"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "12a3e62a25fe", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/12a3e62a25fe.json"}, "html": {"href": "#!/osrf/gazebo/commits/12a3e62a25fe"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "state": "OPEN", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "date": "2017-11-08T22:24:14.566901+00:00"}, "pull_request": {"type": "pullrequest", "id": 2805, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}}, "title": "Shadow improvements"}}]}