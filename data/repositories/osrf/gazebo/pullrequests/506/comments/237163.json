{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/506/comments/237163.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/506/_/diff#comment-237163"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 506, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/506.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/506"}}, "title": "Fix gzlog stop command line"}, "content": {"raw": "Here's a simple script to stress-test it:\n\n~~~\n#!/bin/bash\n\ntask=qual_task_1\nnum_runs=50\nfor i in `seq 1 $num_runs`; do\n  roslaunch atlas_utils ${task}.launch &\n  sleep 20\n  gzlog stop\n  sleep 10\n  killall -INT roslaunch\n  sleep 15\n  num_end_tags=`grep '</gazebo_log>' /tmp/${task}/state.log | wc | awk {'print $1'}`\n  if [ $num_end_tags -ne 1 ]; then\n    echo \"[FAIL] Wrong number of end tags: $num_end_tags\"\n    exit 1\n  else\n    echo \"[PASS] Right number of end tags: $num_end_tags\"\n  fi\n  last_line=`tail -n 1 /tmp/${task}/state.log`\n  if [ $last_line != '</gazebo_log>' ]; then\n    echo \"[FAIL] Wrong last line: $last_line\"\n    exit 1\n  else\n    echo \"[PASS] Correct last line: $last_line\"\n  fi\ndone\n~~~", "markup": "markdown", "html": "<p>Here's a simple script to stress-test it:</p>\n<div class=\"codehilite language-bash\"><pre><span></span><span class=\"ch\">#!/bin/bash</span>\n\n<span class=\"nv\">task</span><span class=\"o\">=</span>qual_task_1\n<span class=\"nv\">num_runs</span><span class=\"o\">=</span><span class=\"m\">50</span>\n<span class=\"k\">for</span> i in <span class=\"sb\">`</span>seq <span class=\"m\">1</span> <span class=\"nv\">$num_runs</span><span class=\"sb\">`</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n  roslaunch atlas_utils <span class=\"si\">${</span><span class=\"nv\">task</span><span class=\"si\">}</span>.launch <span class=\"p\">&amp;</span>\n  sleep <span class=\"m\">20</span>\n  gzlog stop\n  sleep <span class=\"m\">10</span>\n  killall -INT roslaunch\n  sleep <span class=\"m\">15</span>\n  <span class=\"nv\">num_end_tags</span><span class=\"o\">=</span><span class=\"sb\">`</span>grep <span class=\"s1\">&#39;&lt;/gazebo_log&gt;&#39;</span> /tmp/<span class=\"si\">${</span><span class=\"nv\">task</span><span class=\"si\">}</span>/state.log <span class=\"p\">|</span> wc <span class=\"p\">|</span> awk <span class=\"o\">{</span><span class=\"s1\">&#39;print $1&#39;</span><span class=\"o\">}</span><span class=\"sb\">`</span>\n  <span class=\"k\">if</span> <span class=\"o\">[</span> <span class=\"nv\">$num_end_tags</span> -ne <span class=\"m\">1</span> <span class=\"o\">]</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n    <span class=\"nb\">echo</span> <span class=\"s2\">&quot;[FAIL] Wrong number of end tags: </span><span class=\"nv\">$num_end_tags</span><span class=\"s2\">&quot;</span>\n    <span class=\"nb\">exit</span> <span class=\"m\">1</span>\n  <span class=\"k\">else</span>\n    <span class=\"nb\">echo</span> <span class=\"s2\">&quot;[PASS] Right number of end tags: </span><span class=\"nv\">$num_end_tags</span><span class=\"s2\">&quot;</span>\n  <span class=\"k\">fi</span>\n  <span class=\"nv\">last_line</span><span class=\"o\">=</span><span class=\"sb\">`</span>tail -n <span class=\"m\">1</span> /tmp/<span class=\"si\">${</span><span class=\"nv\">task</span><span class=\"si\">}</span>/state.log<span class=\"sb\">`</span>\n  <span class=\"k\">if</span> <span class=\"o\">[</span> <span class=\"nv\">$last_line</span> !<span class=\"o\">=</span> <span class=\"s1\">&#39;&lt;/gazebo_log&gt;&#39;</span> <span class=\"o\">]</span><span class=\"p\">;</span> <span class=\"k\">then</span>\n    <span class=\"nb\">echo</span> <span class=\"s2\">&quot;[FAIL] Wrong last line: </span><span class=\"nv\">$last_line</span><span class=\"s2\">&quot;</span>\n    <span class=\"nb\">exit</span> <span class=\"m\">1</span>\n  <span class=\"k\">else</span>\n    <span class=\"nb\">echo</span> <span class=\"s2\">&quot;[PASS] Correct last line: </span><span class=\"nv\">$last_line</span><span class=\"s2\">&quot;</span>\n  <span class=\"k\">fi</span>\n<span class=\"k\">done</span>\n</pre></div>", "type": "rendered"}, "created_on": "2013-05-06T23:21:54.655598+00:00", "user": {"display_name": "Brian Gerkey", "uuid": "{3d8b5763-9dad-4be7-85c2-a7ab6cd49173}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D"}, "html": {"href": "https://bitbucket.org/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9/5fa9ec73-0fec-4860-a202-e34ae23b6a12/128"}}, "nickname": "Brian Gerkey", "type": "user", "account_id": "557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9"}, "updated_on": "2013-05-06T23:21:54.668001+00:00", "type": "pullrequest_comment", "id": 237163}