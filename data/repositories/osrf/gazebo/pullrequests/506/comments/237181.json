{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/506/comments/237181.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/506/_/diff#comment-237181"}}, "parent": {"id": 237163, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/506/comments/237163.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/506/_/diff#comment-237163"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 506, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/506.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/506"}}, "title": "Fix gzlog stop command line"}, "content": {"raw": "A slight modification that takes two arguments, where the first is the qual number and the second is the number of iterations.\n\n```\n#!c++\n\n#!/bin/bash\n\nif [ \"$#\" -eq \"0\" ]; then\n  task=\"qual_task_1\"\n  num_runs=50\nelse\n  task=\"qual_task_$1\"\n  num_runs=$2\nfi\n\nfor i in `seq 1 $num_runs`; do\n  roslaunch atlas_utils ${task}.launch &\n  sleep 20\n  gzlog stop\n  sleep 20\n  killall -INT roslaunch\n  sleep 15\n  num_end_tags=`grep '</gazebo_log>' /tmp/${task}/state.log | wc | awk {'print $1'}`\n  if [ $num_end_tags -ne 1 ]; then\n    echo \"[FAIL] Wrong number of end tags: $num_end_tags\"\n    exit 1\n  else\n    echo \"[PASS] Right number of end tags: $num_end_tags\"\n  fi\n  last_line=`tail -n 1 /tmp/${task}/state.log`\n  if [ $last_line != '</gazebo_log>' ]; then\n    echo \"[FAIL] Wrong last line: $last_line\"\n    exit 1\n  else\n    echo \"[PASS] Correct last line: $last_line\"\n  fi\ndone\n```\n", "markup": "markdown", "html": "<p>A slight modification that takes two arguments, where the first is the qual number and the second is the number of iterations.</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"cp\">#!/bin/bash</span>\n\n<span class=\"k\">if</span> <span class=\"p\">[</span> <span class=\"s\">&quot;$#&quot;</span> <span class=\"o\">-</span><span class=\"n\">eq</span> <span class=\"s\">&quot;0&quot;</span> <span class=\"p\">];</span> <span class=\"n\">then</span>\n  <span class=\"n\">task</span><span class=\"o\">=</span><span class=\"s\">&quot;qual_task_1&quot;</span>\n  <span class=\"n\">num_runs</span><span class=\"o\">=</span><span class=\"mi\">50</span>\n<span class=\"k\">else</span>\n  <span class=\"n\">task</span><span class=\"o\">=</span><span class=\"s\">&quot;qual_task_$1&quot;</span>\n  <span class=\"n\">num_runs</span><span class=\"o\">=</span><span class=\"err\">$</span><span class=\"mi\">2</span>\n<span class=\"n\">fi</span>\n\n<span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"n\">in</span> <span class=\"err\">`</span><span class=\"n\">seq</span> <span class=\"mi\">1</span> <span class=\"err\">$</span><span class=\"n\">num_runs</span><span class=\"err\">`</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n  <span class=\"n\">roslaunch</span> <span class=\"n\">atlas_utils</span> <span class=\"err\">$</span><span class=\"p\">{</span><span class=\"n\">task</span><span class=\"p\">}.</span><span class=\"n\">launch</span> <span class=\"o\">&amp;</span>\n  <span class=\"n\">sleep</span> <span class=\"mi\">20</span>\n  <span class=\"n\">gzlog</span> <span class=\"n\">stop</span>\n  <span class=\"n\">sleep</span> <span class=\"mi\">20</span>\n  <span class=\"n\">killall</span> <span class=\"o\">-</span><span class=\"n\">INT</span> <span class=\"n\">roslaunch</span>\n  <span class=\"n\">sleep</span> <span class=\"mi\">15</span>\n  <span class=\"n\">num_end_tags</span><span class=\"o\">=</span><span class=\"err\">`</span><span class=\"n\">grep</span> <span class=\"err\">&#39;</span><span class=\"o\">&lt;/</span><span class=\"n\">gazebo_log</span><span class=\"o\">&gt;</span><span class=\"err\">&#39;</span> <span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"err\">$</span><span class=\"p\">{</span><span class=\"n\">task</span><span class=\"p\">}</span><span class=\"o\">/</span><span class=\"n\">state</span><span class=\"p\">.</span><span class=\"n\">log</span> <span class=\"o\">|</span> <span class=\"n\">wc</span> <span class=\"o\">|</span> <span class=\"n\">awk</span> <span class=\"p\">{</span><span class=\"err\">&#39;</span><span class=\"n\">print</span> <span class=\"err\">$</span><span class=\"mi\">1</span><span class=\"err\">&#39;</span><span class=\"p\">}</span><span class=\"err\">`</span>\n  <span class=\"k\">if</span> <span class=\"p\">[</span> <span class=\"err\">$</span><span class=\"n\">num_end_tags</span> <span class=\"o\">-</span><span class=\"n\">ne</span> <span class=\"mi\">1</span> <span class=\"p\">];</span> <span class=\"n\">then</span>\n    <span class=\"n\">echo</span> <span class=\"s\">&quot;[FAIL] Wrong number of end tags: $num_end_tags&quot;</span>\n    <span class=\"n\">exit</span> <span class=\"mi\">1</span>\n  <span class=\"k\">else</span>\n    <span class=\"n\">echo</span> <span class=\"s\">&quot;[PASS] Right number of end tags: $num_end_tags&quot;</span>\n  <span class=\"n\">fi</span>\n  <span class=\"n\">last_line</span><span class=\"o\">=</span><span class=\"err\">`</span><span class=\"n\">tail</span> <span class=\"o\">-</span><span class=\"n\">n</span> <span class=\"mi\">1</span> <span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"err\">$</span><span class=\"p\">{</span><span class=\"n\">task</span><span class=\"p\">}</span><span class=\"o\">/</span><span class=\"n\">state</span><span class=\"p\">.</span><span class=\"n\">log</span><span class=\"err\">`</span>\n  <span class=\"k\">if</span> <span class=\"p\">[</span> <span class=\"err\">$</span><span class=\"n\">last_line</span> <span class=\"o\">!=</span> <span class=\"err\">&#39;</span><span class=\"o\">&lt;/</span><span class=\"n\">gazebo_log</span><span class=\"o\">&gt;</span><span class=\"err\">&#39;</span> <span class=\"p\">];</span> <span class=\"n\">then</span>\n    <span class=\"n\">echo</span> <span class=\"s\">&quot;[FAIL] Wrong last line: $last_line&quot;</span>\n    <span class=\"n\">exit</span> <span class=\"mi\">1</span>\n  <span class=\"k\">else</span>\n    <span class=\"n\">echo</span> <span class=\"s\">&quot;[PASS] Correct last line: $last_line&quot;</span>\n  <span class=\"n\">fi</span>\n<span class=\"n\">done</span>\n</pre></div>", "type": "rendered"}, "created_on": "2013-05-06T23:31:59.075221+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2013-05-07T11:24:58.685275+00:00", "type": "pullrequest_comment", "id": 237181}