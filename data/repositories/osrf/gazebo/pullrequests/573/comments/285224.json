{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/573/comments/285224.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/573/_/diff#comment-285224"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 573, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/573.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/573"}}, "title": "Fix for log segfault"}, "content": {"raw": "If I apply my log-crash patch (appended below) on top of gazebo_1.8.2, this command crashes pretty much immediately:\n\n     gzserver install/share/gazebo-1.8/worlds/pr2.world --record_encoding zlib --record_path /tmp/gztest -r\n\nIf I apply my patch on top of the proposed change in this pull request, the above command does not crash, at least not after several minutes of running.  That's good.\n\n~~~\n--- a/gazebo/physics/World.cc   Tue May 28 17:36:21 2013 -0700\n+++ b/gazebo/physics/World.cc   Sat Jun 01 15:04:13 2013 -0700\n@@ -1854,7 +1854,8 @@\n       this->prevStates[this->stateToggle];\n     this->logPrevIteration = this->iterations;\n\n-    if (!diffState.IsZero())\n+    //if (!diffState.IsZero())\n+    if (true)\n     {\n       this->stateToggle = currState;\n\n@@ -1870,7 +1871,7 @@\n     this->logContinueCondition.notify_all();\n\n     // Wait until there is work to be done.\n-    this->logCondition.wait(lock);\n+    //this->logCondition.wait(lock);\n   }\n\n   // Make sure nothing is blocked by this thread.\n\n~~~", "markup": "markdown", "html": "<p>If I apply my log-crash patch (appended below) on top of gazebo_1.8.2, this command crashes pretty much immediately:</p>\n<div class=\"codehilite\"><pre><span></span> gzserver install/share/gazebo-1.8/worlds/pr2.world --record_encoding zlib --record_path /tmp/gztest -r\n</pre></div>\n\n\n<p>If I apply my patch on top of the proposed change in this pull request, the above command does not crash, at least not after several minutes of running.  That's good.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gd\">--- a/gazebo/physics/World.cc   Tue May 28 17:36:21 2013 -0700</span>\n<span class=\"gi\">+++ b/gazebo/physics/World.cc   Sat Jun 01 15:04:13 2013 -0700</span>\n<span class=\"gu\">@@ -1854,7 +1854,8 @@</span>\n       this-&gt;prevStates[this-&gt;stateToggle];\n     this-&gt;logPrevIteration = this-&gt;iterations;\n\n<span class=\"gd\">-    if (!diffState.IsZero())</span>\n<span class=\"gi\">+    //if (!diffState.IsZero())</span>\n<span class=\"gi\">+    if (true)</span>\n     {\n       this-&gt;stateToggle = currState;\n\n<span class=\"gu\">@@ -1870,7 +1871,7 @@</span>\n     this-&gt;logContinueCondition.notify_all();\n\n     // Wait until there is work to be done.\n<span class=\"gd\">-    this-&gt;logCondition.wait(lock);</span>\n<span class=\"gi\">+    //this-&gt;logCondition.wait(lock);</span>\n   }\n\n   // Make sure nothing is blocked by this thread.\n</pre></div>", "type": "rendered"}, "created_on": "2013-06-01T22:32:49.460638+00:00", "user": {"display_name": "Brian Gerkey", "uuid": "{3d8b5763-9dad-4be7-85c2-a7ab6cd49173}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D"}, "html": {"href": "https://bitbucket.org/%7B3d8b5763-9dad-4be7-85c2-a7ab6cd49173%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9/5fa9ec73-0fec-4860-a202-e34ae23b6a12/128"}}, "nickname": "Brian Gerkey", "type": "user", "account_id": "557058:2e35028e-9ad8-4d6a-a3a5-275159a304a9"}, "updated_on": "2013-06-01T22:32:49.468457+00:00", "type": "pullrequest_comment", "id": 285224}