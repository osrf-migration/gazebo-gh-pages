{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/571/comments/285218.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/571/_/diff#comment-285218"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 571, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/571.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/571"}}, "title": "Logging and transport performance improvements "}, "content": {"raw": "Back to the basics, I ran the gazebo test suite with this new branch in SL K10 machine. Some tests are failing, starting by LogRecord. Maybe related (or not) to our latest failures, affecting log and transport:\n\nLine 87 in gazebo/util/LogRecord_TEST.cc -> gazebo::common::Time::MSleep(100) \n\n```\n#!gdb\n\n[Thread 0x7fffe9091700 (LWP 21110) exited]\nLogRecord_TEST: /usr/include/boost/smart_ptr/shared_ptr.hpp:418: T* boost::shared_ptr<T>::operator->() const [with T = gazebo::transport::Publisher]: Assertion `px != 0' failed.\n[Thread 0x7fffe8890700 (LWP 21111) exited]\n87\t    gazebo::common::Time::MSleep(100);\n(gdb) next\n\nProgram received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fffe9892700 (LWP 21109)]\n0x00007ffff6826425 in __GI_raise (sig=<optimized out>)\n    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n64\t../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) bt\n#0  0x00007ffff6826425 in __GI_raise (sig=<optimized out>)\n    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007ffff6829b8b in __GI_abort () at abort.c:91\n#2  0x00007ffff681f0ee in __assert_fail_base (fmt=<optimized out>, \n    assertion=0x7ffff75dbcc4 \"px != 0\", \n    file=0x7ffff75dbc98 \"/usr/include/boost/smart_ptr/shared_ptr.hpp\", line=<optimized out>, \n    function=<optimized out>) at assert.c:94\n#3  0x00007ffff681f192 in __GI___assert_fail (assertion=0x7ffff75dbcc4 \"px != 0\", \n    file=0x7ffff75dbc98 \"/usr/include/boost/smart_ptr/shared_ptr.hpp\", line=418, \n    function=0x7ffff75dcba0 \"T* boost::shared_ptr<T>::operator->() const [with T = gazebo::transport::Publisher]\") at assert.c:103\n#4  0x00007ffff75a2b63 in boost::shared_ptr<gazebo::transport::Publisher>::operator-> (\n    this=0x6869f8) at /usr/include/boost/smart_ptr/shared_ptr.hpp:418\n#5  0x00007ffff75c0567 in gazebo::util::LogRecord::PublishLogStatus (this=0x686720)\n    at /home/jrivero/code/gazebo/gazebo/util/LogRecord.cc:732\n#6  0x00007ffff75beeca in gazebo::util::LogRecord::Update (this=0x686720)\n    at /home/jrivero/code/gazebo/gazebo/util/LogRecord.cc:485\n#7  0x00007ffff75c0c26 in gazebo::util::LogRecord::Cleanup (this=0x686720)\n    at /home/jrivero/code/gazebo/gazebo/util/LogRecord.cc:820\n#8  0x00007ffff75da49e in boost::_mfi::mf0<void, gazebo::util::LogRecord>::operator() (\n    this=0x6a1908, p=0x686720) at /usr/include/boost/bind/mem_fn_template.hpp:49\n#9  0x00007ffff75d9996 in boost::_bi::list1<boost::_bi::value<gazebo::util::LogRecord*> >::operator()<boost::_mfi::mf0<void, gazebo::util::LogRecord>, boost::_bi::list0> (this=0x6a1918, \n    f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#10 0x00007ffff75d928f in boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::util::LogRecord>, boost::_bi::list1<boost::_bi::value<gazebo::util::LogRecord*> > >::operator() (\n    this=0x6a1908) at /usr/include/boost/bind/bind_template.hpp:20\n#11 0x00007ffff75d7de0 in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::util::LogRecord>, boost::_bi::list1<boost::_bi::value<gazebo::util::LogRecord*> > > >::run (this=0x6a1780) at /usr/include/boost/thread/detail/thread.hpp:61\n#12 0x00007ffff6388ce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#13 0x00007ffff781ae9a in start_thread (arg=0x7fffe9892700) at pthread_create.c:308\n#14 0x00007ffff68e3ccd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#15 0x0000000000000000 in ?? ()\n(gdb) \n```\n\n\n\n", "markup": "markdown", "html": "<p>Back to the basics, I ran the gazebo test suite with this new branch in SL K10 machine. Some tests are failing, starting by LogRecord. Maybe related (or not) to our latest failures, affecting log and transport:</p>\n<p>Line 87 in gazebo/util/LogRecord_TEST.cc -&gt; gazebo::common::Time::MSleep(100) </p>\n<div class=\"codehilite language-gdb\"><pre><span></span><span class=\"k\">[Thread 0x7fffe9091700 (LWP 21110) exited]</span>\n<span class=\"na\">LogRecord_TEST: /usr/include/boost/smart_ptr/shared_ptr.hpp:418: T* boost::shared_ptr&lt;T&gt;::operator-&gt;() const [with T</span> <span class=\"o\">=</span> <span class=\"s\">gazebo::transport::Publisher]: Assertion `px != 0&#39; failed.</span>\n<span class=\"k\">[Thread 0x7fffe8890700 (LWP 21111) exited]</span>\n<span class=\"na\">87      gazebo::common::Time::MSleep(100);</span>\n<span class=\"na\">(gdb) next</span>\n\n<span class=\"na\">Program received signal SIGABRT, Aborted.</span>\n<span class=\"k\">[Switching to Thread 0x7fffe9892700 (LWP 21109)]</span>\n<span class=\"na\">0x00007ffff6826425 in __GI_raise (sig</span><span class=\"o\">=</span><span class=\"s\">&lt;optimized out&gt;)</span>\n<span class=\"s\">    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64</span>\n<span class=\"na\">64  ../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.</span>\n<span class=\"na\">(gdb) bt</span>\n<span class=\"c1\">#0  0x00007ffff6826425 in __GI_raise (sig=&lt;optimized out&gt;)</span>\n    <span class=\"na\">at ../nptl/sysdeps/unix/sysv/linux/raise.c:64</span>\n<span class=\"c1\">#1  0x00007ffff6829b8b in __GI_abort () at abort.c:91</span>\n<span class=\"c1\">#2  0x00007ffff681f0ee in __assert_fail_base (fmt=&lt;optimized out&gt;, </span>\n    <span class=\"na\">assertion</span><span class=\"o\">=</span><span class=\"s\">0x7ffff75dbcc4 &quot;px != 0&quot;, </span>\n<span class=\"s\">    file=0x7ffff75dbc98 &quot;/usr/include/boost/smart_ptr/shared_ptr.hpp&quot;, line=&lt;optimized out&gt;, </span>\n<span class=\"s\">    function=&lt;optimized out&gt;) at assert.c:94</span>\n<span class=\"c1\">#3  0x00007ffff681f192 in __GI___assert_fail (assertion=0x7ffff75dbcc4 &quot;px != 0&quot;, </span>\n    <span class=\"na\">file</span><span class=\"o\">=</span><span class=\"s\">0x7ffff75dbc98 &quot;/usr/include/boost/smart_ptr/shared_ptr.hpp&quot;, line=418, </span>\n<span class=\"s\">    function=0x7ffff75dcba0 &quot;T* boost::shared_ptr&lt;T&gt;::operator-&gt;() const [with T = gazebo::transport::Publisher]&quot;) at assert.c:103</span>\n<span class=\"c1\">#4  0x00007ffff75a2b63 in boost::shared_ptr&lt;gazebo::transport::Publisher&gt;::operator-&gt; (</span>\n    <span class=\"na\">this</span><span class=\"o\">=</span><span class=\"s\">0x6869f8) at /usr/include/boost/smart_ptr/shared_ptr.hpp:418</span>\n<span class=\"c1\">#5  0x00007ffff75c0567 in gazebo::util::LogRecord::PublishLogStatus (this=0x686720)</span>\n    <span class=\"na\">at /home/jrivero/code/gazebo/gazebo/util/LogRecord.cc:732</span>\n<span class=\"c1\">#6  0x00007ffff75beeca in gazebo::util::LogRecord::Update (this=0x686720)</span>\n    <span class=\"na\">at /home/jrivero/code/gazebo/gazebo/util/LogRecord.cc:485</span>\n<span class=\"c1\">#7  0x00007ffff75c0c26 in gazebo::util::LogRecord::Cleanup (this=0x686720)</span>\n    <span class=\"na\">at /home/jrivero/code/gazebo/gazebo/util/LogRecord.cc:820</span>\n<span class=\"c1\">#8  0x00007ffff75da49e in boost::_mfi::mf0&lt;void, gazebo::util::LogRecord&gt;::operator() (</span>\n    <span class=\"na\">this</span><span class=\"o\">=</span><span class=\"s\">0x6a1908, p=0x686720) at /usr/include/boost/bind/mem_fn_template.hpp:49</span>\n<span class=\"c1\">#9  0x00007ffff75d9996 in boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::util::LogRecord*&gt; &gt;::operator()&lt;boost::_mfi::mf0&lt;void, gazebo::util::LogRecord&gt;, boost::_bi::list0&gt; (this=0x6a1918, </span>\n    <span class=\"na\">f</span><span class=\"o\">=</span><span class=\"s\">..., a=...) at /usr/include/boost/bind/bind.hpp:253</span>\n<span class=\"c1\">#10 0x00007ffff75d928f in boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::util::LogRecord&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::util::LogRecord*&gt; &gt; &gt;::operator() (</span>\n    <span class=\"na\">this</span><span class=\"o\">=</span><span class=\"s\">0x6a1908) at /usr/include/boost/bind/bind_template.hpp:20</span>\n<span class=\"c1\">#11 0x00007ffff75d7de0 in boost::detail::thread_data&lt;boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::util::LogRecord&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::util::LogRecord*&gt; &gt; &gt; &gt;::run (this=0x6a1780) at /usr/include/boost/thread/detail/thread.hpp:61</span>\n<span class=\"c1\">#12 0x00007ffff6388ce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1</span>\n<span class=\"c1\">#13 0x00007ffff781ae9a in start_thread (arg=0x7fffe9892700) at pthread_create.c:308</span>\n<span class=\"c1\">#14 0x00007ffff68e3ccd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112</span>\n<span class=\"c1\">#15 0x0000000000000000 in ?? ()</span>\n<span class=\"na\">(gdb) </span>\n</pre></div>", "type": "rendered"}, "created_on": "2013-06-01T21:50:39.249387+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": "2013-06-01T21:50:39.256082+00:00", "type": "pullrequest_comment", "id": 285218}