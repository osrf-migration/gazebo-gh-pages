{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2453/comments/24562734.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2453/_/diff#comment-24562734"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2453, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2453.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2453"}}, "title": "Load heightmap data locally in rendering"}, "content": {"raw": "I just did some testing with different combinations of client / server (this branch and the 7.3.1 debs0, and this is looking great. Here's a summary:\n\nIn separate terminal windows I run the following commands in order:\n\n~~~\ngzserver --verbose worlds/heightmap.world\ngz topic -e /gazebo/default/request\ngz topic -e /gazebo/default/response > response.txt\ngzclient --verbose\n~~~\n\n## Case 1: gzserver 7.3.1, any version of gzclient\n\nWhen either gzclient connected to the 7.3.1 version of gzserver, there were two `scene_info` requests, followed by a `heightmap_data` request:\n\n~~~\n$ gz topic -e /gazebo/default/request\nid: 1173\nrequest: \"scene_info\"\ndata: \"\"\n\nid: 3803\nrequest: \"scene_info\"\ndata: \"\"\n\nid: 1505\nrequest: \"heightmap_data\"\ndata: \"\"\n~~~\n\nThe size of these responses is about 2.2 MB.\n\n## Case 2: gzserver from this branch, gzclient 7.3.1\n\nWhen an old client connects to the gzserver from this branch, the same 3 requests are made, but the size of the responses is cut down to 780 kB, since the `scene_info` requests no longer contain serialized heights.\n\n## Case 3: gzserver and gzclient from this branch\n\nThis is the best case. There are still two `scene_info` requests, but the `heightmap_data` request is skipped, so the total response size is down to 44 kB!\n\n## Case 4: gzserver and gzclient from this branch, but gzclient can't find a file\n\nThis can happen if you run gzclient on a separate machine that doesn't have the heightmap data, or if the `GAZEBO_RESOURCE_PATH` is not set correctly. This case is equivalent to Case 2, with all 3 requests with responses totalling 780 kB. The only caveat to this case is that it doesn't give a console message saying that heightmaps will be serialized instead of loaded locally by gzclient and asking if they have set their `GAZEBO_RESOURCE_PATH` correctly. Instead it gives the following:\n\n~~~\n[Err] [SystemPaths.cc:410] File or path does not exist[\"\"]\n[Err] [SystemPaths.cc:410] File or path does not exist[\"\"]\n~~~\n\nIt would be nice to improve that message.", "markup": "markdown", "html": "<p>I just did some testing with different combinations of client / server (this branch and the 7.3.1 debs0, and this is looking great. Here's a summary:</p>\n<p>In separate terminal windows I run the following commands in order:</p>\n<div class=\"codehilite\"><pre><span></span>gzserver --verbose worlds/heightmap.world\ngz topic -e /gazebo/default/request\ngz topic -e /gazebo/default/response &gt; response.txt\ngzclient --verbose\n</pre></div>\n\n\n<h2 id=\"markdown-header-case-1-gzserver-731-any-version-of-gzclient\">Case 1: gzserver 7.3.1, any version of gzclient</h2>\n<p>When either gzclient connected to the 7.3.1 version of gzserver, there were two <code>scene_info</code> requests, followed by a <code>heightmap_data</code> request:</p>\n<div class=\"codehilite\"><pre><span></span>$ gz topic -e /gazebo/default/request\nid: <span class=\"m\">1173</span>\nrequest: <span class=\"s2\">&quot;scene_info&quot;</span>\ndata: <span class=\"s2\">&quot;&quot;</span>\n\nid: <span class=\"m\">3803</span>\nrequest: <span class=\"s2\">&quot;scene_info&quot;</span>\ndata: <span class=\"s2\">&quot;&quot;</span>\n\nid: <span class=\"m\">1505</span>\nrequest: <span class=\"s2\">&quot;heightmap_data&quot;</span>\ndata: <span class=\"s2\">&quot;&quot;</span>\n</pre></div>\n\n\n<p>The size of these responses is about 2.2 MB.</p>\n<h2 id=\"markdown-header-case-2-gzserver-from-this-branch-gzclient-731\">Case 2: gzserver from this branch, gzclient 7.3.1</h2>\n<p>When an old client connects to the gzserver from this branch, the same 3 requests are made, but the size of the responses is cut down to 780 kB, since the <code>scene_info</code> requests no longer contain serialized heights.</p>\n<h2 id=\"markdown-header-case-3-gzserver-and-gzclient-from-this-branch\">Case 3: gzserver and gzclient from this branch</h2>\n<p>This is the best case. There are still two <code>scene_info</code> requests, but the <code>heightmap_data</code> request is skipped, so the total response size is down to 44 kB!</p>\n<h2 id=\"markdown-header-case-4-gzserver-and-gzclient-from-this-branch-but-gzclient-cant-find-a-file\">Case 4: gzserver and gzclient from this branch, but gzclient can't find a file</h2>\n<p>This can happen if you run gzclient on a separate machine that doesn't have the heightmap data, or if the <code>GAZEBO_RESOURCE_PATH</code> is not set correctly. This case is equivalent to Case 2, with all 3 requests with responses totalling 780 kB. The only caveat to this case is that it doesn't give a console message saying that heightmaps will be serialized instead of loaded locally by gzclient and asking if they have set their <code>GAZEBO_RESOURCE_PATH</code> correctly. Instead it gives the following:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">[Err] [SystemPaths.cc:410] File or path does not exist[&quot;&quot;]</span>\n<span class=\"k\">[Err] [SystemPaths.cc:410] File or path does not exist[&quot;&quot;]</span>\n</pre></div>\n\n\n<p>It would be nice to improve that message.</p>", "type": "rendered"}, "created_on": "2016-09-30T20:18:09.399436+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-09-30T20:18:09.401338+00:00", "type": "pullrequest_comment", "id": 24562734}