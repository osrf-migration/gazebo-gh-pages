{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2515/comments/33252916.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2515/_/diff#comment-33252916"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2515, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2515.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2515"}}, "title": "Don't shut down gazebo when removing a world -> gazebo7"}, "content": {"raw": "I just found a deadlock ([full details here](https://gist.github.com/scpeters/987051653d41c33a56e6a3f1080c1238)):\n\nThe `WorldRemoveTest.RemoveBlankWorld/2` test deadlocked.\nThe test called `physics::remove_worlds` at\n[world_remove.cc:138](#!/osrf/gazebo/src/a364ad2dd38cf7cc35/test/integration/world_remove.cc?at=worldless_7#world_remove.cc-138)\nand that thread is waiting in `World::Fini` for the world run thread to join at\n[World.cc:928](#!/osrf/gazebo/src/a364ad2dd38cf7cc35/gazebo/physics/World.cc?at=worldless_7#world_remove.cc-928).\n\nThe world run thread is currently in `World::Step`\n[World.cc:642](#!/osrf/gazebo/src/a364ad2dd38cf7cc35/gazebo/physics/World.cc?at=worldless_7#world_remove.cc-642).\nand is blocked waiting to get a recursive lock on `worldUpdateMutex`, but that mutex has already been deleted.\n\nI'm not sure how it got into this state.", "markup": "markdown", "html": "<p>I just found a deadlock (<a data-is-external-link=\"true\" href=\"https://gist.github.com/scpeters/987051653d41c33a56e6a3f1080c1238\" rel=\"nofollow\">full details here</a>):</p>\n<p>The <code>WorldRemoveTest.RemoveBlankWorld/2</code> test deadlocked.\nThe test called <code>physics::remove_worlds</code> at\n<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/a364ad2dd38cf7cc35/test/integration/world_remove.cc?at=worldless_7#world_remove.cc-138\" rel=\"nofollow\">world_remove.cc:138</a>\nand that thread is waiting in <code>World::Fini</code> for the world run thread to join at\n<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/a364ad2dd38cf7cc35/gazebo/physics/World.cc?at=worldless_7#world_remove.cc-928\" rel=\"nofollow\">World.cc:928</a>.</p>\n<p>The world run thread is currently in <code>World::Step</code>\n<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/a364ad2dd38cf7cc35/gazebo/physics/World.cc?at=worldless_7#world_remove.cc-642\" rel=\"nofollow\">World.cc:642</a>.\nand is blocked waiting to get a recursive lock on <code>worldUpdateMutex</code>, but that mutex has already been deleted.</p>\n<p>I'm not sure how it got into this state.</p>", "type": "rendered"}, "created_on": "2017-03-16T00:34:12.506628+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-03-16T00:34:12.508995+00:00", "type": "pullrequest_comment", "id": 33252916}