{"rendered": {"description": {"raw": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "markup": "markdown", "html": "<p>This PR revives and extends <a href=\"#!/osrf/gazebo/pull-requests/2396/support-off-diagonal-inertia-terms-in\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2396</a>, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.</p>\n<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/f00c768\" rel=\"nofollow\">f00c768</a> diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly (<a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/aaa38dd\" rel=\"nofollow\">aaa38dd</a> corrects the relative pose calculations). <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/c527a76\" rel=\"nofollow\">c527a76</a> adjusts the joint axes accordingly.</p>\n<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/67f74c7\" rel=\"nofollow\">67f74c7</a> fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that <a data-is-external-link=\"true\" href=\"https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283\" rel=\"nofollow\">btPlaneSpace1</a> generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.</p>\n<p>Since the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to <code>BulletLink::UpdateMass</code> but decided to print an error message instead for now (<a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/7377dfe\" rel=\"nofollow\">7377dfe</a>). What do you think? The joint axis and anchor calculations in <code>Bullet*Joint::Init</code> currently rely on the links being in their <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&amp;fileviewer=file-view-default#BulletScrewJoint.cc-157\" rel=\"nofollow\">initial world poses</a>.</p>", "type": "rendered"}, "title": {"raw": "Support off-diagonal inertia terms in bullet", "markup": "markdown", "html": "<p>Support off-diagonal inertia terms in bullet</p>", "type": "rendered"}}, "type": "pullrequest", "description": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2757/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/diffstat/osrf/gazebo:da598aa8472c%0D0e536b1ea0b2?from_pullrequest_id=2757"}, "commits": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/commits.json"}, "self": {"href": "data/repositories/osrf/gazebo/pullrequests/2757.json"}, "comments": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2757/merge"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2757"}, "activity": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/diff/osrf/gazebo:da598aa8472c%0D0e536b1ea0b2?from_pullrequest_id=2757"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2757/approve"}, "statuses": {"href": "data/repositories/osrf/gazebo/pullrequests/2757/statuses_page=1.json"}}, "title": "Support off-diagonal inertia terms in bullet", "close_source_branch": false, "reviewers": [], "id": 2757, "destination": {"commit": {"hash": "0e536b1ea0b2", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0e536b1ea0b2.json"}, "html": {"href": "#!/osrf/gazebo/commits/0e536b1ea0b2"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "created_on": "2017-07-27T23:08:12.355338+00:00", "summary": {"raw": "This PR revives and extends pull request #2396, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.\r\n\r\n[f00c768](https://bitbucket.org/pchorak/gazebo/commits/f00c768) diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly ([aaa38dd](https://bitbucket.org/pchorak/gazebo/commits/aaa38dd) corrects the relative pose calculations). [c527a76](https://bitbucket.org/pchorak/gazebo/commits/c527a76) adjusts the joint axes accordingly.\r\n\r\n[67f74c7](https://bitbucket.org/pchorak/gazebo/commits/67f74c7) fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that [btPlaneSpace1](https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283) generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.\r\n\r\nSince the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to `BulletLink::UpdateMass` but decided to print an error message instead for now ([7377dfe](https://bitbucket.org/pchorak/gazebo/commits/7377dfe)). What do you think? The joint axis and anchor calculations in `Bullet*Joint::Init` currently rely on the links being in their [initial world poses](https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&fileviewer=file-view-default#BulletScrewJoint.cc-157).", "markup": "markdown", "html": "<p>This PR revives and extends <a href=\"#!/osrf/gazebo/pull-requests/2396/support-off-diagonal-inertia-terms-in\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2396</a>, which was declined. The main focus of the PR is to support inertia tensors with off-diagonal terms with Bullet. Bullet only accepts diagonal inertia terms so that a rigid body's frame coincides with it principal axes.</p>\n<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/f00c768\" rel=\"nofollow\">f00c768</a> diagonalizes the given inertia tensor, passes the principal moments to Bullet, and adjusts the relative poses of the collision shapes accordingly (<a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/aaa38dd\" rel=\"nofollow\">aaa38dd</a> corrects the relative pose calculations). <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/c527a76\" rel=\"nofollow\">c527a76</a> adjusts the joint axes accordingly.</p>\n<p><a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/67f74c7\" rel=\"nofollow\">67f74c7</a> fixes the computation of the child and parent coordinate frames for prismatic and screw joints, so that they are initially aligned. The problem was that <a data-is-external-link=\"true\" href=\"https://github.com/bulletphysics/bullet3/blob/master/src/LinearMath/btVector3.h#L1283\" rel=\"nofollow\">btPlaneSpace1</a> generates a coordinate system aligned with the given joint axis using rotations about different planes depending on the value of the z component of the axis. Thus, the generated parent and child frames sometimes differ by 90 degrees in their initial poses, which can cause flying behavior. Although the problem was identified in the context of off-diagonal inertia terms, it is a more general bug and can be illustrated with the world file in the comments below.</p>\n<p>Since the principal axes of the inertia tensor determine the Bullet rigid body frame, properly updating the inertia of a link would entail adjusting the relative poses of the collision shapes and joints. I began adding these changes to <code>BulletLink::UpdateMass</code> but decided to print an error message instead for now (<a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/commits/7377dfe\" rel=\"nofollow\">7377dfe</a>). What do you think? The joint axis and anchor calculations in <code>Bullet*Joint::Init</code> currently rely on the links being in their <a data-is-external-link=\"true\" href=\"https://bitbucket.org/pchorak/gazebo/src/c99abfb7522a97fa432981205ea8b2475f12c757/gazebo/physics/bullet/BulletScrewJoint.cc?at=bullet_off_diagonal_inertia2&amp;fileviewer=file-view-default#BulletScrewJoint.cc-157\" rel=\"nofollow\">initial world poses</a>.</p>", "type": "rendered"}, "source": {"commit": {"hash": "bf9987f6b601", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo/commit/bf9987f6b601"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo/commits/bf9987f6b601"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/pchorak/gazebo"}, "html": {"href": "https://bitbucket.org/pchorak/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{7130b41e-0983-4752-9e3b-9e2c12cf1268}ts=c_plus_plus"}}, "type": "repository", "name": "gazebo", "full_name": "pchorak/gazebo", "uuid": "{7130b41e-0983-4752-9e3b-9e2c12cf1268}"}, "branch": {"name": "bullet_off_diagonal_inertia2"}}, "comment_count": 19, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2017-09-08T16:23:57.748602+00:00", "type": "participant", "approved": false, "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}}, {"role": "PARTICIPANT", "participated_on": "2017-08-02T21:03:18.569276+00:00", "type": "participant", "approved": true, "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}, {"role": "PARTICIPANT", "participated_on": "2017-09-08T01:22:10.087042+00:00", "type": "participant", "approved": true, "user": {"display_name": "Ying Lu", "uuid": "{11ec131e-4af6-4228-beaf-167b1c8d1c2c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D"}, "html": {"href": "https://bitbucket.org/%7B11ec131e-4af6-4228-beaf-167b1c8d1c2c%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:659bfe31-d941-44f5-aa6d-00058b070ea8/c88d5925-8a09-40c7-8684-c02aeafe0f59/128"}}, "nickname": "rosebudflyaway", "type": "user", "account_id": "557058:659bfe31-d941-44f5-aa6d-00058b070ea8"}}], "reason": "", "updated_on": "2017-10-26T19:00:34.699132+00:00", "author": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}, "merge_commit": {"hash": "da598aa8472c", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/da598aa8472c.json"}, "html": {"href": "#!/osrf/gazebo/commits/da598aa8472c"}}}, "closed_by": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}