{"pagelen": 50, "values": [{"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50511175.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50511175"}}, "parent": {"id": 50510348, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50510348.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50510348"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Okay, thanks ;)", "markup": "markdown", "html": "<p>Okay, thanks ;)</p>", "type": "rendered"}, "created_on": "2017-11-27T16:15:34.223353+00:00", "user": {"display_name": "Martin Pecka", "uuid": "{41691c43-4ae0-49ba-ba45-3c36439f5af2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D"}, "html": {"href": "https://bitbucket.org/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d1ad32a09564f856909994613fdbc37cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMP-1.png"}}, "nickname": "peci1", "type": "user", "account_id": "557058:434ecab2-e510-4ede-8f9a-1c2a5a4032e1"}, "updated_on": "2017-11-27T16:15:34.268078+00:00", "type": "pullrequest_comment", "id": 50511175}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50510348.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50510348"}}, "parent": {"id": 50508317, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50508317.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50508317"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Yeah that can be misleading, we've been trying to duplicate the entries on the changelog when porting forward to make it clear when that happened, but we're not being very consistent about it yet (we should though).\n\nAs @sloretz said, the changes are already on 8 and default, but haven't been released yet:\n\n#!/osrf/gazebo/branches/compare/gazebo8%0Dgazebo8_8.1.1#pull-requests", "markup": "markdown", "html": "<p>Yeah that can be misleading, we've been trying to duplicate the entries on the changelog when porting forward to make it clear when that happened, but we're not being very consistent about it yet (we should though).</p>\n<p>As @sloretz said, the changes are already on 8 and default, but haven't been released yet:</p>\n<p><a href=\"#!/osrf/gazebo/branches/compare/gazebo8%0Dgazebo8_8.1.1#pull-requests\" rel=\"nofollow\" class=\"ap-connect-link\">#!/osrf/gazebo/branches/compare/gazebo8%0Dgazebo8_8.1.1#pull-requests</a></p>", "type": "rendered"}, "created_on": "2017-11-27T16:09:32.413437+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2017-11-27T16:09:32.426361+00:00", "type": "pullrequest_comment", "id": 50510348}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50508317.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50508317"}}, "parent": {"id": 50507763, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50507763.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50507763"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Hmm, but in the changelogs the news about this were placed in the 7.x.x parts. That's why I didn't notice it. Isn't that wrong? Or don't I just understand the semantics of the changelogs?", "markup": "markdown", "html": "<p>Hmm, but in the changelogs the news about this were placed in the 7.x.x parts. That's why I didn't notice it. Isn't that wrong? Or don't I just understand the semantics of the changelogs?</p>", "type": "rendered"}, "created_on": "2017-11-27T15:53:53.571117+00:00", "user": {"display_name": "Martin Pecka", "uuid": "{41691c43-4ae0-49ba-ba45-3c36439f5af2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D"}, "html": {"href": "https://bitbucket.org/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d1ad32a09564f856909994613fdbc37cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMP-1.png"}}, "nickname": "peci1", "type": "user", "account_id": "557058:434ecab2-e510-4ede-8f9a-1c2a5a4032e1"}, "updated_on": "2017-11-27T15:53:53.637402+00:00", "type": "pullrequest_comment", "id": 50508317}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50507763.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50507763"}}, "parent": {"id": 50473660, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50473660.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50473660"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Looks like it was merged to gazebo8 in pull request #2734 and default in pull request #2736.", "markup": "markdown", "html": "<p>Looks like it was merged to gazebo8 in <a href=\"#!/osrf/gazebo/pull-requests/2734/merge-7-8\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2734</a> and default in <a href=\"#!/osrf/gazebo/pull-requests/2736/merge-gazebo8-default\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2736</a>.</p>", "type": "rendered"}, "created_on": "2017-11-27T15:50:04.462103+00:00", "user": {"display_name": "Shane Loretz", "uuid": "{656e3311-aad9-45a1-aaf7-b0ee0e84b287}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D"}, "html": {"href": "https://bitbucket.org/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:684383ab-ac95-4859-a350-4a6f41a94a22/c7a1ebf5-cade-4115-9f26-9d3facb776db/128"}}, "nickname": "Shane Loretz", "type": "user", "account_id": "557058:684383ab-ac95-4859-a350-4a6f41a94a22"}, "updated_on": "2017-11-27T15:50:04.465547+00:00", "type": "pullrequest_comment", "id": 50507763}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/50473660.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-50473660"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Would it be possible to also merge this fix to gazebo8 and default?", "markup": "markdown", "html": "<p>Would it be possible to also merge this fix to gazebo8 and default?</p>", "type": "rendered"}, "created_on": "2017-11-27T10:58:46.439855+00:00", "user": {"display_name": "Martin Pecka", "uuid": "{41691c43-4ae0-49ba-ba45-3c36439f5af2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D"}, "html": {"href": "https://bitbucket.org/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d1ad32a09564f856909994613fdbc37cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMP-1.png"}}, "nickname": "peci1", "type": "user", "account_id": "557058:434ecab2-e510-4ede-8f9a-1c2a5a4032e1"}, "updated_on": "2017-11-27T10:58:46.486176+00:00", "type": "pullrequest_comment", "id": 50473660}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "0d4129391f78", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0d4129391f78.json"}, "html": {"href": "#!/osrf/gazebo/commits/0d4129391f78"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "86b57532d9f1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/86b57532d9f1.json"}, "html": {"href": "#!/osrf/gazebo/commits/86b57532d9f1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "MERGED", "author": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "date": "2017-06-28T16:49:08.771513+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"approval": {"date": "2017-06-28T16:49:02.755395+00:00", "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39748590.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39748590"}}, "parent": {"id": 39392985, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39392985.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39392985"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "It's as clean as it can be", "markup": "markdown", "html": "<p>It's as clean as it can be</p>", "type": "rendered"}, "created_on": "2017-06-28T16:49:00.192891+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2017-06-28T16:49:00.196320+00:00", "type": "pullrequest_comment", "id": 39748590}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "0d4129391f78", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/0d4129391f78.json"}, "html": {"href": "#!/osrf/gazebo/commits/0d4129391f78"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "86b57532d9f1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/86b57532d9f1.json"}, "html": {"href": "#!/osrf/gazebo/commits/86b57532d9f1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-06-27T18:39:25.437492+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39663968.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39663968"}}, "parent": {"id": 39472160, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39472160.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39472160"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "I reverted the change and added documentation of the change in 86b57532d9f1", "markup": "markdown", "html": "<p>I reverted the change and added documentation of the change in <a href=\"#!/osrf/gazebo/commits/86b57532d9f1\" rel=\"nofollow\" class=\"ap-connect-link\">86b57532d9f1</a></p>", "type": "rendered"}, "created_on": "2017-06-27T18:39:21.300936+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-06-27T18:39:21.303314+00:00", "type": "pullrequest_comment", "id": 39663968}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"approval": {"date": "2017-06-23T18:49:31.640645+00:00", "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "user": {"display_name": "Shane Loretz", "uuid": "{656e3311-aad9-45a1-aaf7-b0ee0e84b287}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D"}, "html": {"href": "https://bitbucket.org/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:684383ab-ac95-4859-a350-4a6f41a94a22/c7a1ebf5-cade-4115-9f26-9d3facb776db/128"}}, "nickname": "Shane Loretz", "type": "user", "account_id": "557058:684383ab-ac95-4859-a350-4a6f41a94a22"}}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39472160.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39472160"}}, "parent": {"id": 39325172, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39325172.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39325172"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Oh, I would be ok with reverting this change then if we add that explanation as a comment. does anyone else have any thoughts about this?", "markup": "markdown", "html": "<p>Oh, I would be ok with reverting this change then if we add that explanation as a comment. does anyone else have any thoughts about this?</p>", "type": "rendered"}, "created_on": "2017-06-23T16:52:29.922979+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-06-23T16:52:29.926768+00:00", "type": "pullrequest_comment", "id": 39472160}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39392985.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39392985"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Looks good to me. Queued a new build just to take the latest commits into account:\n\nhttps://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/gazebo-ci-pr_any-homebrew-amd64/", "markup": "markdown", "html": "<p>Looks good to me. Queued a new build just to take the latest commits into account:</p>\n<p><a href=\"https://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/gazebo-ci-pr_any-homebrew-amd64/\" rel=\"nofollow\" class=\"ap-connect-link\">https://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/gazebo-ci-pr_any-homebrew-amd64/</a></p>", "type": "rendered"}, "created_on": "2017-06-22T17:21:27.470691+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": "2017-06-22T17:21:27.474039+00:00", "type": "pullrequest_comment", "id": 39392985}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/39325172.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-39325172"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "I guess the idea here was that the local pose of the canonical link does not change, so there is no need to keep telling everyone about it. The canonical link will automatically move as the model moves.\n\nBut I'm ok with publishing it, feels more complete this way.", "markup": "markdown", "html": "<p>I guess the idea here was that the local pose of the canonical link does not change, so there is no need to keep telling everyone about it. The canonical link will automatically move as the model moves.</p>\n<p>But I'm ok with publishing it, feels more complete this way.</p>", "type": "rendered"}, "created_on": "2017-06-22T00:29:27.139938+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {}, "updated_on": "2017-06-22T00:29:27.142291+00:00", "type": "pullrequest_comment", "id": 39325172}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "9ec730773365", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/9ec730773365.json"}, "html": {"href": "#!/osrf/gazebo/commits/9ec730773365"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "67445eda32c9", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/67445eda32c9.json"}, "html": {"href": "#!/osrf/gazebo/commits/67445eda32c9"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-06-19T21:32:34.313298+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"approval": {"date": "2017-06-09T21:23:26.242866+00:00", "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "user": {"display_name": "Peter Horak", "uuid": "{c72abe74-c12a-4128-a6fc-94f3844ac8ef}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D"}, "html": {"href": "https://bitbucket.org/%7Bc72abe74-c12a-4128-a6fc-94f3844ac8ef%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a/87d803b7-3e50-40c1-8159-a5c20abd84ea/128"}}, "nickname": "pchorak", "type": "user", "account_id": "557058:451ed60b-3cfa-4a97-b4d3-a3fc34c2b21a"}}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "9210f981b0b1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/9210f981b0b1.json"}, "html": {"href": "#!/osrf/gazebo/commits/9210f981b0b1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "cd9190ed4b20", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/cd9190ed4b20.json"}, "html": {"href": "#!/osrf/gazebo/commits/cd9190ed4b20"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-06-05T17:40:38.469680+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "9210f981b0b1", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/9210f981b0b1.json"}, "html": {"href": "#!/osrf/gazebo/commits/9210f981b0b1"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "38308e9da58e", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/38308e9da58e.json"}, "html": {"href": "#!/osrf/gazebo/commits/38308e9da58e"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-06-05T17:38:17.415128+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/38206338.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-38206338"}}, "parent": {"id": 38172107, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/38172107.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-38172107"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "It took a while to figure out the root of the problem. Thanks for your help identifying it!", "markup": "markdown", "html": "<p>It took a while to figure out the root of the problem. Thanks for your help identifying it!</p>", "type": "rendered"}, "created_on": "2017-06-05T17:37:46.606902+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-06-05T17:37:46.610233+00:00", "type": "pullrequest_comment", "id": 38206338}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/38172107.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-38172107"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "Hey there! @scpeters thanks for the fix!", "markup": "markdown", "html": "<p>Hey there! @scpeters thanks for the fix!</p>", "type": "rendered"}, "created_on": "2017-06-05T09:37:06.284754+00:00", "user": {"display_name": "Andrea Ruzzenenti", "uuid": "{e1b5ee2b-de45-4d4a-a5e6-a8ac3fbf68e7}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be1b5ee2b-de45-4d4a-a5e6-a8ac3fbf68e7%7D"}, "html": {"href": "https://bitbucket.org/%7Be1b5ee2b-de45-4d4a-a5e6-a8ac3fbf68e7%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/23c771650185f3cd68d95b67cb829a12d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsAR-5.png"}}, "nickname": "aerydna", "type": "user", "account_id": "557058:4cda65f8-5ec6-402e-9da4-1c7f61e1a152"}, "updated_on": "2017-06-05T09:37:06.338366+00:00", "type": "pullrequest_comment", "id": 38172107}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/37993090.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-37993090"}}, "parent": {"id": 37977909, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/37977909.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-37977909"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "b903d4b", "markup": "markdown", "html": "<p><a href=\"#!/osrf/gazebo/commits/b903d4b\" rel=\"nofollow\" class=\"ap-connect-link\">b903d4b</a></p>", "type": "rendered"}, "created_on": "2017-06-01T09:39:59.096394+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-06-01T09:39:59.099976+00:00", "type": "pullrequest_comment", "id": 37993090}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "cddf2613ce88", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/cddf2613ce88.json"}, "html": {"href": "#!/osrf/gazebo/commits/cddf2613ce88"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "b903d4b72239", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/b903d4b72239.json"}, "html": {"href": "#!/osrf/gazebo/commits/b903d4b72239"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-06-01T08:07:25.726191+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/37977909.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-37977909"}}, "parent": {"id": 37951106, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/37951106.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-37951106"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "that's reasonable. I had just done a copy/paste of the old code, but I can clean it up a bit too", "markup": "markdown", "html": "<p>that's reasonable. I had just done a copy/paste of the old code, but I can clean it up a bit too</p>", "type": "rendered"}, "created_on": "2017-06-01T06:31:01.305437+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2017-06-01T06:31:01.307731+00:00", "type": "pullrequest_comment", "id": 37977909}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/37951106.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-37951106"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "How about removing the iterators?\n```\n#!c++\n\nfor (auto &childPtr : this->children)\n{\n  if (childPtr->HasType(COLLISION))\n  {\n    CollisionPtr entityC = boost::static_pointer_cast<Collision>(childPtr);\n    entityC->SetWorldPoseDirty();\n  }\n}\n```", "markup": "markdown", "html": "<p>How about removing the iterators?</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"k\">auto</span> <span class=\"o\">&amp;</span><span class=\"nl\">childPtr</span> <span class=\"p\">:</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">children</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">childPtr</span><span class=\"o\">-&gt;</span><span class=\"n\">HasType</span><span class=\"p\">(</span><span class=\"n\">COLLISION</span><span class=\"p\">))</span>\n  <span class=\"p\">{</span>\n    <span class=\"n\">CollisionPtr</span> <span class=\"n\">entityC</span> <span class=\"o\">=</span> <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">static_pointer_cast</span><span class=\"o\">&lt;</span><span class=\"n\">Collision</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">childPtr</span><span class=\"p\">);</span>\n    <span class=\"n\">entityC</span><span class=\"o\">-&gt;</span><span class=\"n\">SetWorldPoseDirty</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-05-31T18:51:11.305167+00:00", "user": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}, "inline": {}, "updated_on": "2017-05-31T18:51:11.307373+00:00", "type": "pullrequest_comment", "id": 37951106}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "cddf2613ce88", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/cddf2613ce88.json"}, "html": {"href": "#!/osrf/gazebo/commits/cddf2613ce88"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "572379cb8f6a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/572379cb8f6a.json"}, "html": {"href": "#!/osrf/gazebo/commits/572379cb8f6a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-05-18T23:25:50.205352+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "ce35d9414147", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/ce35d9414147.json"}, "html": {"href": "#!/osrf/gazebo/commits/ce35d9414147"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "55774da193ac", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/55774da193ac.json"}, "html": {"href": "#!/osrf/gazebo/commits/55774da193ac"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-05-04T23:33:22.263413+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/36126832.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-36126832"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "I just found  a little more explanation of the changes to Entity.cc in my email drafts folder:\n\nWith each simulation timestep, the physics engine calls `SetWorldPose` on each link that moves, and [Entity::SetWorldPose](#!/osrf/gazebo/src/d50d5cffcb75595913e14ef6ff1290137d9f3284/gazebo/physics/Entity.cc?fileviewer=file-view-default#Entity.cc-473) redirects using a function pointer to different `SetWorldPose` variants, like `SetWorldPoseModel`, `SetWorldPoseCanonicalLink`, and `SetWorldPoseDefault`. `Collision::GetWorldPose` was working for collisions attached to the canonical link of a model because `SetWorldPoseCanonicalLink` was iterating over child collisions and calling `Collision::SetWorldPoseDirty`. To give this functionality to non-canonical links, I moved that loop to `SetWorldPoseDefault` and added a call to `SetWorldPoseDefault` from the start of `SetWorldPoseCanonicalLink` (57c8d6f).", "markup": "markdown", "html": "<p>I just found  a little more explanation of the changes to Entity.cc in my email drafts folder:</p>\n<p>With each simulation timestep, the physics engine calls <code>SetWorldPose</code> on each link that moves, and <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/d50d5cffcb75595913e14ef6ff1290137d9f3284/gazebo/physics/Entity.cc?fileviewer=file-view-default#Entity.cc-473\" rel=\"nofollow\">Entity::SetWorldPose</a> redirects using a function pointer to different <code>SetWorldPose</code> variants, like <code>SetWorldPoseModel</code>, <code>SetWorldPoseCanonicalLink</code>, and <code>SetWorldPoseDefault</code>. <code>Collision::GetWorldPose</code> was working for collisions attached to the canonical link of a model because <code>SetWorldPoseCanonicalLink</code> was iterating over child collisions and calling <code>Collision::SetWorldPoseDirty</code>. To give this functionality to non-canonical links, I moved that loop to <code>SetWorldPoseDefault</code> and added a call to <code>SetWorldPoseDefault</code> from the start of <code>SetWorldPoseCanonicalLink</code> (<a href=\"#!/osrf/gazebo/commits/57c8d6f\" rel=\"nofollow\" class=\"ap-connect-link\">57c8d6f</a>).</p>", "type": "rendered"}, "created_on": "2017-05-03T07:52:30.869304+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-05-03T07:52:30.871917+00:00", "type": "pullrequest_comment", "id": 36126832}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/36124148.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-36124148"}}, "parent": {"id": 36123867, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/36123867.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-36123867"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "here it is with the fix:\n\n![fixed.gif](data/bitbucket.org/repo/jgXqbo/images/1412578886-fixed.gif)\n\nboth spheres roll as they should", "markup": "markdown", "html": "<p>here it is with the fix:</p>\n<p><img alt=\"fixed.gif\" src=\"data/bitbucket.org/repo/jgXqbo/images/1412578886-fixed.gif\" /></p>\n<p>both spheres roll as they should</p>", "type": "rendered"}, "created_on": "2017-05-03T07:11:48.713306+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-05-03T07:11:48.715717+00:00", "type": "pullrequest_comment", "id": 36124148}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702/comments/36123867.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702/_/diff#comment-36123867"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}, "content": {"raw": "here's a close up of the spheres rotating without the fix:\n\n![broken.gif](data/bitbucket.org/repo/jgXqbo/images/3125630411-broken.gif)\n\nthe canonical link starts to roll as it should, while the non-canonical link continues spinning vertically", "markup": "markdown", "html": "<p>here's a close up of the spheres rotating without the fix:</p>\n<p><img alt=\"broken.gif\" src=\"data/bitbucket.org/repo/jgXqbo/images/3125630411-broken.gif\" /></p>\n<p>the canonical link starts to roll as it should, while the non-canonical link continues spinning vertically</p>", "type": "rendered"}, "created_on": "2017-05-03T07:06:51.600263+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-05-03T07:06:51.602775+00:00", "type": "pullrequest_comment", "id": 36123867}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "8a11f7f5192d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/8a11f7f5192d.json"}, "html": {"href": "#!/osrf/gazebo/commits/8a11f7f5192d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "46d28e5ac0ee", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/46d28e5ac0ee.json"}, "html": {"href": "#!/osrf/gazebo/commits/46d28e5ac0ee"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-05-03T01:16:05.000994+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}, {"update": {"description": "It was reported that setting a body-fixed friction direction is not working (issue #2068). This was confusing to me, since we have an extensive test of friction direction parameters in `physics_friction.cc`:\r\n\r\n![friction direction test](https://bitbucket.org/repo/jgXqbo/images/2692916182-friction_dir_test_small.gif)\r\n\r\nIt turns out that friction direction parameters are indeed broken in certain cases, and it is related to the `Collision::GetWorldPose` function that is called in [ODEPhysics::Collide](#!/osrf/gazebo/src/gazebo7/gazebo/physics/ode/ODEPhysics.cc#ODEPhysics.cc-1124). Many thanks to  @aerydna for pointing this out and my apologies for not understanding it sooner.\r\n\r\nI believe the problem is that `Collision::GetWorldPose` is only working properly for the collisions that are attached to canonical links in a model, which is the case with the boxes in the test shown above. To show the test failure, I added a non-canonical link to the `collision_pose_offset` test world and a failing expectation to `INTEGRATION_physics_collision`. I also added a pair of spheres to the `friction_dir_test` world with asymmetric friction and a body-fixed friction direction. The spheres have no friction in the initial direction that they are sliding and will slide straight ahead, but by applying an angular velocity about the vertical axis, the friction directions should change the the spheres should start rolling. I will attach additional animations showing the failure case and the fixed case.\r\n\r\nThe fix is in 57c8d6f, which is to mark collisions of all links as dirty when parent link gets updated, instead of just for canonical links.\r\n\r\nWhile nosing around in Entity.cc, I also saw that poses were not published for canonical links, which seemed weird to me, so I fixed the logic in 14473f4.", "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)", "destination": {"commit": {"hash": "8a11f7f5192d", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/8a11f7f5192d.json"}, "html": {"href": "#!/osrf/gazebo/commits/8a11f7f5192d"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "reason": "", "source": {"commit": {"hash": "46d28e5ac0ee", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/46d28e5ac0ee.json"}, "html": {"href": "#!/osrf/gazebo/commits/46d28e5ac0ee"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "collision_pose_noncanonical"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2017-05-03T01:16:04.967331+00:00"}, "pull_request": {"type": "pullrequest", "id": 2702, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2702.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2702"}}, "title": "Fix Collision::GetWorldPose for non-canonical links (and friction directions, #2068)"}}]}