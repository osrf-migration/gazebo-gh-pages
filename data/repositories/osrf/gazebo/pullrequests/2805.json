{"rendered": {"description": {"raw": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](data/bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](data/bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "markup": "markdown", "html": "<p>Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this <a data-is-external-link=\"true\" href=\"http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c\" rel=\"nofollow\">ogre function description</a> that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new <code>CustomPSSMShadowCameraSetup</code> was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.</p>\n<p>To smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.</p>\n<p>Color of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. </p>\n<p>Also bumped default shadow texture resolution to 2048 from 1024.</p>\n<p>before:</p>\n<p><img alt=\"shadows_before.jpg\" src=\"data/bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg\" /></p>\n<p>after:</p>\n<p><img alt=\"shadows_after.jpg\" src=\"data/bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg\" /></p>\n<p>jenkins:</p>\n<p><a data-is-external-link=\"true\" href=\"https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/\" rel=\"nofollow\">homebrew</a> - ok (<code>VisualProperty.CastShadows</code> test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)</p>", "type": "rendered"}, "title": {"raw": "Shadow improvements", "markup": "markdown", "html": "<p>Shadow improvements</p>", "type": "rendered"}}, "type": "pullrequest", "description": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](data/bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](data/bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2805/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/diffstat/osrf/gazebo:b9f803e44162%0D293fd4e6b3dc?from_pullrequest_id=2805"}, "commits": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/commits.json"}, "self": {"href": "data/repositories/osrf/gazebo/pullrequests/2805.json"}, "comments": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2805/merge"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2805"}, "activity": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/diff/osrf/gazebo:b9f803e44162%0D293fd4e6b3dc?from_pullrequest_id=2805"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/pullrequests/2805/approve"}, "statuses": {"href": "data/repositories/osrf/gazebo/pullrequests/2805/statuses_page=1.json"}}, "title": "Shadow improvements", "close_source_branch": true, "reviewers": [], "id": 2805, "destination": {"commit": {"hash": "293fd4e6b3dc", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/293fd4e6b3dc.json"}, "html": {"href": "#!/osrf/gazebo/commits/293fd4e6b3dc"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "gazebo7"}}, "created_on": "2017-11-08T22:24:14.550895+00:00", "summary": {"raw": "Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this [ogre function description](http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c) that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new `CustomPSSMShadowCameraSetup` was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.\r\n\r\nTo smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.\r\n\r\nColor of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. \r\n\r\nAlso bumped default shadow texture resolution to 2048 from 1024.\r\n\r\nbefore:\r\n\r\n![shadows_before.jpg](data/bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg)\r\n\r\nafter:\r\n\r\n![shadows_after.jpg](data/bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg)\r\n\r\njenkins:\r\n\r\n[homebrew](https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/) - ok (`VisualProperty.CastShadows` test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)", "markup": "markdown", "html": "<p>Our shadows are subject to light space perspective warping which is not ideal when the camera view vector is coincident with the light direction vector. See this <a data-is-external-link=\"true\" href=\"http://www.ogre3d.org/docs/api/1.8/class_ogre_1_1_li_s_p_s_m_shadow_camera_setup.html#a2a6fb5e0335458e5c626740bfcbfc56c\" rel=\"nofollow\">ogre function description</a> that tries to reduce the effect. However it was not sufficient for cases when the sun is at low angles. So  a new <code>CustomPSSMShadowCameraSetup</code> was added to bypass the perspective warping.  Most of the code in that class is taken from OGRE hence their licence header is kept in the source files.</p>\n<p>To smooth out jagged edges in the shadows, hardware Percentage Closer Filtering (PCF) and Poisson disk sampling were added - though sometimes they are still obvious at certain angles.</p>\n<p>Color of the shadows is now slightly darker than before to reduce the effect of built-in \"ambient\" light so that they are physically more accurate. </p>\n<p>Also bumped default shadow texture resolution to 2048 from 1024.</p>\n<p>before:</p>\n<p><img alt=\"shadows_before.jpg\" src=\"data/bitbucket.org/repo/jgXqbo/images/3401938950-shadows_before.jpg\" /></p>\n<p>after:</p>\n<p><img alt=\"shadows_after.jpg\" src=\"data/bitbucket.org/repo/jgXqbo/images/2226025022-shadows_after.jpg\" /></p>\n<p>jenkins:</p>\n<p><a data-is-external-link=\"true\" href=\"https://build.osrfoundation.org/view/main/view/gazebo/job/gazebo-ci-pr_any-homebrew-amd64/1252/\" rel=\"nofollow\">homebrew</a> - ok (<code>VisualProperty.CastShadows</code> test failure is a known problem after upgrading our homebrew gazebo7 jobs to ogre 1.9)</p>", "type": "rendered"}, "source": {"commit": {"hash": "fb7f1740d3db", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/fb7f1740d3db.json"}, "html": {"href": "#!/osrf/gazebo/commits/fb7f1740d3db"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "branch": {"name": "shadow_improvements_7_ian"}}, "comment_count": 29, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2017-12-21T02:08:53.538460+00:00", "type": "participant", "approved": true, "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}}, {"role": "PARTICIPANT", "participated_on": "2017-12-20T19:40:07.584767+00:00", "type": "participant", "approved": true, "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}, {"role": "PARTICIPANT", "participated_on": "2017-12-21T03:48:18.666016+00:00", "type": "participant", "approved": false, "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}}], "reason": "", "updated_on": "2017-12-21T03:49:08.204609+00:00", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "merge_commit": {"hash": "b9f803e44162", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/gazebo/commit/b9f803e44162.json"}, "html": {"href": "#!/osrf/gazebo/commits/b9f803e44162"}}}, "closed_by": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}}