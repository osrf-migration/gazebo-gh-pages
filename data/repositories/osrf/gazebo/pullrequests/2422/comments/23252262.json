{"links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2422/comments/23252262.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2422/_/diff#comment-23252262"}}, "parent": {"id": 23186161, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2422/comments/23186161.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2422/_/diff#comment-23186161"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 2422, "links": {"self": {"href": "data/repositories/osrf/gazebo/pullrequests/2422.json"}, "html": {"href": "#!/osrf/gazebo/pull-requests/2422"}}, "title": "Joint_position_initialization"}, "content": {"raw": "I think the following might work, but I haven't had a chance to test it yet\n\n~~~\ndiff -r f72d725c02ac gazebo/physics/Joint.cc\n--- a/gazebo/physics/Joint.cc\tFri Sep 02 21:30:48 2016 -0700\n+++ b/gazebo/physics/Joint.cc\tFri Sep 02 21:38:19 2016 -0700\n@@ -520,6 +520,12 @@\n   for (unsigned int i = 0; i < this->GetAngleCount(); ++i)\n   {\n     this->SetVelocity(i, 0.0);\n+    // clamp initial position between joint limits\n+    ignition::math::Angle position = ignition::math::clamp(\n+      this->InitialPosition(i),\n+      this->GetLowerLimit(i).Ign(),\n+      this->GetUpperLimit(i).Ign());\n+    this->SetPosition(i, position.Radian());\n   }\n   this->staticAngle.SetFromRadian(0);\n }\n~~~", "markup": "markdown", "html": "<p>I think the following might work, but I haven't had a chance to test it yet</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r f72d725c02ac gazebo/physics/Joint.cc</span>\n<span class=\"gd\">--- a/gazebo/physics/Joint.cc   Fri Sep 02 21:30:48 2016 -0700</span>\n<span class=\"gi\">+++ b/gazebo/physics/Joint.cc   Fri Sep 02 21:38:19 2016 -0700</span>\n<span class=\"gu\">@@ -520,6 +520,12 @@</span>\n   for (unsigned int i = 0; i &lt; this-&gt;GetAngleCount(); ++i)\n   {\n     this-&gt;SetVelocity(i, 0.0);\n<span class=\"gi\">+    // clamp initial position between joint limits</span>\n<span class=\"gi\">+    ignition::math::Angle position = ignition::math::clamp(</span>\n<span class=\"gi\">+      this-&gt;InitialPosition(i),</span>\n<span class=\"gi\">+      this-&gt;GetLowerLimit(i).Ign(),</span>\n<span class=\"gi\">+      this-&gt;GetUpperLimit(i).Ign());</span>\n<span class=\"gi\">+    this-&gt;SetPosition(i, position.Radian());</span>\n   }\n   this-&gt;staticAngle.SetFromRadian(0);\n }\n</pre></div>", "type": "rendered"}, "created_on": "2016-09-03T04:38:50.031121+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-09-03T04:38:50.035078+00:00", "type": "pullrequest_comment", "id": 23252262}