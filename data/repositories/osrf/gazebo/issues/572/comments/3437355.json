{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/572/comments/3437355.json"}, "html": {"href": "#!/osrf/gazebo/issues/572#comment-3437355"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/572.json"}}, "type": "issue", "id": 572, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "VRC heightmap problems"}, "content": {"raw": "@nkoenig @hsu \n\nIn an attempt of getting a usable terrain for testing perception and avoiding the lidar performance issue I wanted to test the performance of a triangle mesh as a replacement for heightmap. In order to test an extreme case I used a trimesh [1] with a size of 13*13 meters and a resolution of 250.000 triangles and put 6 of them into the scene in front of Atlas [2] - so that's 1.5 million triangles in front of atlas placed up to a distance of approximately 30 meters, so pretty much all the triangles are within the reach of LIDAR and cameras.\n\nEven though the triangle mesh has a much higher resolution than the heightmap used in vrc world 2, the triangle mesh performs much better than heightmap, especially when using the LIDAR.\n\nHere are some results, both worlds using the same physics settings (the vrc world2 defaults with unbounded update rate):\n\n    heightmap (vrc world2 heightmap + atlas, no other objects): \n            atlas standing: 1.45 - 1.5\n            both cameras: 1.3   \n            lidar: 0.03, 0.02, or maybe lower just not displayed  | lidar hz stays at 40\n            atlas levitating: 1.8\n            atlas levitating+cameras: 1.6\n            atlas levitating+lidar: 0.18\n            atlas levitating+lidar+cameras: 0.18 | camera at ~28, lidar at ~36\n\n    6*250k trimesh:\n            atlas levitating: 1.5\n            atlas levitating+cameras: 1.40 | cameras at 14Hz (50% of desired)\n            atlas levitating+lidar: 1.2 | lidar at 38Hz\n            atlas levitating+lidar+cameras: 1.15-1.20 | cameras at 17Hz, lidar 38Hz\n            atlas \"standing\" (feet are in contact with ground but robot held upright using 'pinned_with_gravity'): 1.15\n            atlas \"standing\" + all sensors: 0.85-0.9 | lidar 35Hz, cameras 21Hz\n\n\nAs you can clearly see, even with unnecessarily high resolution the triangle mesh clearly outperforms the (fairly low resolution) heightmap used in vrc world 2. Besides performance the triangle mesh also has the advantage of not suffering under the distance/texture distortion problem that Gazebo heightmaps have (actually I've also noticed the same texture distortion problem at some parts of terrain while testing cryengine 3 - so this might partially be a problem of the underlying technology used).\n\nThe only case where heightmap performs \"better\" than the trimesh in the above \"benchmark\" is the cameras' update rate, but this is due to the extremely high triangle count which was chosen as stresstest for LIDAR. Using a more sane, but still high resolution, triangle count of 50k per mesh bumps the camera rate back up to the desired 30Hz.\n\nI haven't had time to test other performance criteria but e.g. dropping atlas onto the 250k triangle mesh still keeps the RTF above 0.9 upon impact. \n\n[1] http://i.imgur.com/JzxjxAE.jpg (exported from an Unreal Development Kit example scene, triangle count reduced to 250k using Meshlab)\n\n[2] http://i.imgur.com/phi42KS.jpg", "markup": "markdown", "html": "<p>@nkoenig @hsu </p>\n<p>In an attempt of getting a usable terrain for testing perception and avoiding the lidar performance issue I wanted to test the performance of a triangle mesh as a replacement for heightmap. In order to test an extreme case I used a trimesh [1] with a size of 13*13 meters and a resolution of 250.000 triangles and put 6 of them into the scene in front of Atlas [2] - so that's 1.5 million triangles in front of atlas placed up to a distance of approximately 30 meters, so pretty much all the triangles are within the reach of LIDAR and cameras.</p>\n<p>Even though the triangle mesh has a much higher resolution than the heightmap used in vrc world 2, the triangle mesh performs much better than heightmap, especially when using the LIDAR.</p>\n<p>Here are some results, both worlds using the same physics settings (the vrc world2 defaults with unbounded update rate):</p>\n<div class=\"codehilite\"><pre><span></span>heightmap (vrc world2 heightmap + atlas, no other objects): \n        atlas standing: 1.45 - 1.5\n        both cameras: 1.3   \n        lidar: 0.03, 0.02, or maybe lower just not displayed  | lidar hz stays at 40\n        atlas levitating: 1.8\n        atlas levitating+cameras: 1.6\n        atlas levitating+lidar: 0.18\n        atlas levitating+lidar+cameras: 0.18 | camera at ~28, lidar at ~36\n\n6*250k trimesh:\n        atlas levitating: 1.5\n        atlas levitating+cameras: 1.40 | cameras at 14Hz (50% of desired)\n        atlas levitating+lidar: 1.2 | lidar at 38Hz\n        atlas levitating+lidar+cameras: 1.15-1.20 | cameras at 17Hz, lidar 38Hz\n        atlas &quot;standing&quot; (feet are in contact with ground but robot held upright using &#39;pinned_with_gravity&#39;): 1.15\n        atlas &quot;standing&quot; + all sensors: 0.85-0.9 | lidar 35Hz, cameras 21Hz\n</pre></div>\n\n\n<p>As you can clearly see, even with unnecessarily high resolution the triangle mesh clearly outperforms the (fairly low resolution) heightmap used in vrc world 2. Besides performance the triangle mesh also has the advantage of not suffering under the distance/texture distortion problem that Gazebo heightmaps have (actually I've also noticed the same texture distortion problem at some parts of terrain while testing cryengine 3 - so this might partially be a problem of the underlying technology used).</p>\n<p>The only case where heightmap performs \"better\" than the trimesh in the above \"benchmark\" is the cameras' update rate, but this is due to the extremely high triangle count which was chosen as stresstest for LIDAR. Using a more sane, but still high resolution, triangle count of 50k per mesh bumps the camera rate back up to the desired 30Hz.</p>\n<p>I haven't had time to test other performance criteria but e.g. dropping atlas onto the 250k triangle mesh still keeps the RTF above 0.9 upon impact. </p>\n<p>[1] <a href=\"http://i.imgur.com/JzxjxAE.jpg\" rel=\"nofollow\" class=\"ap-connect-link\">http://i.imgur.com/JzxjxAE.jpg</a> (exported from an Unreal Development Kit example scene, triangle count reduced to 250k using Meshlab)</p>\n<p>[2] <a href=\"http://i.imgur.com/phi42KS.jpg\" rel=\"nofollow\" class=\"ap-connect-link\">http://i.imgur.com/phi42KS.jpg</a></p>", "type": "rendered"}, "created_on": "2013-03-17T22:39:47.922238+00:00", "user": {"display_name": "Thomas Koletschka", "uuid": "{b33092ac-6376-48d1-9803-d9e6de445d1a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bb33092ac-6376-48d1-9803-d9e6de445d1a%7D"}, "html": {"href": "https://bitbucket.org/%7Bb33092ac-6376-48d1-9803-d9e6de445d1a%7D/"}, "avatar": {"href": "https://bitbucket.org/account/thomasko/avatar/"}}, "nickname": "thomasko", "type": "user", "account_id": null}, "updated_on": null, "type": "issue_comment", "id": 3437355}