{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1480/comments/16050221.json"}, "html": {"href": "#!/osrf/gazebo/issues/1480#comment-16050221"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1480.json"}}, "type": "issue", "id": 1480, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "UNIT_Exception_TEST failure on OS X"}, "content": {"raw": "The threading message seems to be a red herring.\n\nI made sure to kill the ModelDatabase thread:\n~~~\ndiff -r 008ba7669a75 gazebo/common/Exception_TEST.cc\n--- a/gazebo/common/Exception_TEST.cc\tMon Mar 02 17:28:08 2015 -0800\n+++ b/gazebo/common/Exception_TEST.cc\tTue Mar 03 00:21:05 2015 -0800\n@@ -19,6 +19,7 @@\n \n #include \"gazebo/common/Assert.hh\"\n #include \"gazebo/common/Exception.hh\"\n+#include \"gazebo/common/ModelDatabase.hh\"\n #include \"test/util.hh\"\n \n using namespace gazebo;\n@@ -76,8 +77,10 @@\n #else\n TEST_F(Exception, GZASSERT_Enabled_ThrowAssertion)\n {\n-    ASSERT_DEATH(\n-      GZ_ASSERT(true == false, \"Assert thrown\"),\n+  common::ModelDatabase::Instance()->Fini();\n+  common::Time::MSleep(100);\n+  ASSERT_DEATH(\n+    GZ_ASSERT(true == false, \"Assert thrown\"),\n       \".*Internal Program Error - assertion.*\");\n }\n #endif\n~~~\nbut it still fails:\n~~~\n[ RUN      ] Exception.GZASSERT_Enabled_ThrowAssertion\n/Users/scpeters/ws/gazebo/src/gazebo/gazebo/common/Exception_TEST.cc:84: Failure\nDeath test: (__builtin_expect(!((true == false)&&(\"Assert thrown\")), 0) ? __assert_rtn(__func__, \"/Users/scpeters/ws/gazebo/src/gazebo/gazebo/common/Exception_TEST.cc\", 83, \"(true == false)&&(\\\"Assert thrown\\\")\") : (void)0)\n    Result: died but not with expected error.\n  Expected: .*Internal Program Error - assertion.*\nActual msg:\n[  DEATH   ] Assertion failed: ((true == false)&&(\"Assert thrown\")), function TestBody, file /Users/scpeters/ws/gazebo/src/gazebo/gazebo/common/Exception_TEST.cc, line 83.\n[  DEATH   ] \n[  FAILED  ] Exception.GZASSERT_Enabled_ThrowAssertion (7649 ms)\n~~~", "markup": "markdown", "html": "<p>The threading message seems to be a red herring.</p>\n<p>I made sure to kill the ModelDatabase thread:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 008ba7669a75 gazebo/common/Exception_TEST.cc</span>\n<span class=\"gd\">--- a/gazebo/common/Exception_TEST.cc   Mon Mar 02 17:28:08 2015 -0800</span>\n<span class=\"gi\">+++ b/gazebo/common/Exception_TEST.cc   Tue Mar 03 00:21:05 2015 -0800</span>\n<span class=\"gu\">@@ -19,6 +19,7 @@</span>\n\n #include &quot;gazebo/common/Assert.hh&quot;\n #include &quot;gazebo/common/Exception.hh&quot;\n<span class=\"gi\">+#include &quot;gazebo/common/ModelDatabase.hh&quot;</span>\n #include &quot;test/util.hh&quot;\n\n using namespace gazebo;\n<span class=\"gu\">@@ -76,8 +77,10 @@</span>\n #else\n TEST_F(Exception, GZASSERT_Enabled_ThrowAssertion)\n {\n<span class=\"gd\">-    ASSERT_DEATH(</span>\n<span class=\"gd\">-      GZ_ASSERT(true == false, &quot;Assert thrown&quot;),</span>\n<span class=\"gi\">+  common::ModelDatabase::Instance()-&gt;Fini();</span>\n<span class=\"gi\">+  common::Time::MSleep(100);</span>\n<span class=\"gi\">+  ASSERT_DEATH(</span>\n<span class=\"gi\">+    GZ_ASSERT(true == false, &quot;Assert thrown&quot;),</span>\n       &quot;.*Internal Program Error - assertion.*&quot;);\n }\n #endif\n</pre></div>\n\n\n<p>but it still fails:</p>\n<div class=\"codehilite\"><pre><span></span>[ RUN      ] Exception.GZASSERT_Enabled_ThrowAssertion\n/Users/scpeters/ws/gazebo/src/gazebo/gazebo/common/Exception_TEST.cc:84: Failure\nDeath test: (__builtin_expect(!((true == false)&amp;&amp;(&quot;Assert thrown&quot;)), 0) ? __assert_rtn(__func__, &quot;/Users/scpeters/ws/gazebo/src/gazebo/gazebo/common/Exception_TEST.cc&quot;, 83, &quot;(true == false)&amp;&amp;(\\&quot;Assert thrown\\&quot;)&quot;) : (void)0)\n    Result: died but not with expected error.\n  Expected: .*Internal Program Error - assertion.*\nActual msg:\n[  DEATH   ] Assertion failed: ((true == false)&amp;&amp;(&quot;Assert thrown&quot;)), function TestBody, file /Users/scpeters/ws/gazebo/src/gazebo/gazebo/common/Exception_TEST.cc, line 83.\n[  DEATH   ] \n[  FAILED  ] Exception.GZASSERT_Enabled_ThrowAssertion (7649 ms)\n</pre></div>", "type": "rendered"}, "created_on": "2015-03-03T08:22:02.239199+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 16050221}