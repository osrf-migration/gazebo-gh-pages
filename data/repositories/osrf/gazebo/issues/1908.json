{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/1908/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/1908.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1908/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/1908/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/1908/flaky-seg-fault-in-connection-onreadheader"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1908/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "Flaky seg-fault in Connection::OnReadHeader during teardown", "component": {"name": "transport", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122882.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "I've observed seg-faults from different tests with identical backtraces (details for \r\n[UNIT_Visual_TEST](https://gist.github.com/scpeters/b9c3c090d9603f165e66) and \r\n[UNIT_MagnetometerSensor_TEST](https://gist.github.com/scpeters/005c17e02b96955faa59)).\r\nThe seg-fault occurs during a `boost::asio::async_read` in `Connection::OnReadHeader`\r\n([Connection.hh:259](#!/osrf/gazebo/src/81cc629155b9c/gazebo/transport/Connection.hh#Connection.hh-259)).\r\n\r\nIn the main thread, the test has completed and `ServerFixture::Unload` has been called during Teardown and is waiting for the server thread to join\r\n([ServerFixture.cc:137](#!/osrf/gazebo/src/81cc629155b/gazebo/test/ServerFixture.cc#ServerFixture.cc-137)).\r\n\r\nIn the Server thread, `gazebo::shutdown` has been called at the end of `Server::Run`, which has called `ConnectionManager::Stop` and the thread is waiting in a loop for `ConnectionManager::stopped` to be true ([ConnectionManager.cc:250](#!/osrf/gazebo/src/81cc629155b9c6/gazebo/transport/ConnectionManager.cc#ConnectionManager.cc-249)).\r\n\r\ncc @caguero ", "markup": "markdown", "html": "<p>I've observed seg-faults from different tests with identical backtraces (details for \n<a data-is-external-link=\"true\" href=\"https://gist.github.com/scpeters/b9c3c090d9603f165e66\" rel=\"nofollow\">UNIT_Visual_TEST</a> and \n<a data-is-external-link=\"true\" href=\"https://gist.github.com/scpeters/005c17e02b96955faa59\" rel=\"nofollow\">UNIT_MagnetometerSensor_TEST</a>).\nThe seg-fault occurs during a <code>boost::asio::async_read</code> in <code>Connection::OnReadHeader</code>\n(<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/81cc629155b9c/gazebo/transport/Connection.hh#Connection.hh-259\" rel=\"nofollow\">Connection.hh:259</a>).</p>\n<p>In the main thread, the test has completed and <code>ServerFixture::Unload</code> has been called during Teardown and is waiting for the server thread to join\n(<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/81cc629155b/gazebo/test/ServerFixture.cc#ServerFixture.cc-137\" rel=\"nofollow\">ServerFixture.cc:137</a>).</p>\n<p>In the Server thread, <code>gazebo::shutdown</code> has been called at the end of <code>Server::Run</code>, which has called <code>ConnectionManager::Stop</code> and the thread is waiting in a loop for <code>ConnectionManager::stopped</code> to be true (<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/81cc629155b9c6/gazebo/transport/ConnectionManager.cc#ConnectionManager.cc-249\" rel=\"nofollow\">ConnectionManager.cc:250</a>).</p>\n<p>cc @caguero </p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2016-03-29T08:42:16.348308+00:00", "milestone": null, "updated_on": "2016-09-14T19:20:12.439564+00:00", "type": "issue", "id": 1908}