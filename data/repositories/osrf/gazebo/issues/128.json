{"priority": "critical", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/128/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/128.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/128/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/128/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/128/model-delete-left-over-plugin-event-from"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/128/vote"}}, "reporter": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "title": "model delete:  left over plugin event from deleted model causes segfault on gzserver", "component": null, "votes": 0, "watches": 2, "content": {"raw": "Model tear down is incomplete, to reproduce, insert pioneer2dx model, delete pioneer2dx model, insert anything else.  gzserver will fail trying to call event left over by the pioneer2dx model when inserting the second model with following backtrace:\n\n~~~\n\n#0  0x00007f9f2aaeb445 in __GI_raise (sig=<optimized out>) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007f9f2aaeebab in __GI_abort () at abort.c:91\n#2  0x00007f9f2aae410e in __assert_fail_base (fmt=<optimized out>, assertion=0x7f9f2c98e824 \"px != 0\", \n    file=0x7f9f2c98e7f8 \"/usr/include/boost/smart_ptr/shared_ptr.hpp\", line=<optimized out>, function=<optimized out>) at assert.c:94\n#3  0x00007f9f2aae41b2 in __GI___assert_fail (assertion=0x7f9f2c98e824 \"px != 0\", file=0x7f9f2c98e7f8 \"/usr/include/boost/smart_ptr/shared_ptr.hpp\", \n    line=418, function=0x7f9f2c98e9a0 \"T* boost::shared_ptr<T>::operator->() const [with T = gazebo::physics::Joint]\") at assert.c:103\n#4  0x00007f9f2c908245 in boost::shared_ptr<gazebo::physics::Joint>::operator-> (this=0x7f9ef43df7c0) at /usr/include/boost/smart_ptr/shared_ptr.hpp:418\n#5  0x00007f9f1015af8c in gazebo::DiffDrivePlugin::OnUpdate (this=0x7f9ef43df770) at /home/hsu/projects/gazebo_patches/plugins/DiffDrivePlugin.cc:131\n#6  0x00007f9f10164b4a in boost::_mfi::mf0<void, gazebo::DiffDrivePlugin>::operator() (this=0x7f9ef42f5388, p=0x7f9ef43df770)\n    at /usr/include/boost/bind/mem_fn_template.hpp:49\n#7  0x00007f9f101645ac in boost::_bi::list1<boost::_bi::value<gazebo::DiffDrivePlugin*> >::operator()<boost::_mfi::mf0<void, gazebo::DiffDrivePlugin>, boost::_bi::list0> (this=0x7f9ef42f5398, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#8  0x00007f9f10163fbd in boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::DiffDrivePlugin>, boost::_bi::list1<boost::_bi::value<gazebo::DiffDrivePlugin*> > >::operator() (this=0x7f9ef42f5388) at /usr/include/boost/bind/bind_template.hpp:20\n#9  0x00007f9f1016395a in boost::detail::function::void_function_obj_invoker0<boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::DiffDrivePlugin>, boost::_bi::list1<boost::_bi::value<gazebo::DiffDrivePlugin*> > >, void>::invoke (function_obj_ptr=...)\n    at /usr/include/boost/function/function_template.hpp:153\n#10 0x00007f9f2ccdb854 in boost::function0<void>::operator() (this=0x7f9ef42f5380) at /usr/include/boost/function/function_template.hpp:1013\n#11 0x00007f9f2ccdf6b7 in gazebo::event::EventT<void ()>::Signal() (this=0x7f9f2d5d3320) at /home/hsu/projects/gazebo_patches/gazebo/common/Event.hh:120\n#12 0x00007f9f2ccdceee in gazebo::event::EventT<void ()>::operator()() (this=0x7f9f2d5d3320)\n    at /home/hsu/projects/gazebo_patches/gazebo/common/Event.hh:113\n#13 0x00007f9f2c96af10 in gazebo::physics::World::Update (this=0x1cb2020) at /home/hsu/projects/gazebo_patches/gazebo/physics/World.cc:380\n#14 0x00007f9f2c96ab1c in gazebo::physics::World::Step (this=0x1cb2020) at /home/hsu/projects/gazebo_patches/gazebo/physics/World.cc:320\n#15 0x00007f9f2c96a774 in gazebo::physics::World::RunLoop (this=0x1cb2020) at /home/hsu/projects/gazebo_patches/gazebo/physics/World.cc:289\n#16 0x00007f9f2c98339a in boost::_mfi::mf0<void, gazebo::physics::World>::operator() (this=0x1d75838, p=0x1cb2020)\n    at /usr/include/boost/bind/mem_fn_template.hpp:49\n#17 0x00007f9f2c98294c in boost::_bi::list1<boost::_bi::value<gazebo::physics::World*> >::operator()<boost::_mfi::mf0<void, gazebo::physics::World>, boost::_bi::list0> (this=0x1d75848, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#18 0x00007f9f2c981f37 in boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::physics::World>, boost::_bi::list1<boost::_bi::value<gazebo::physics::World*> > >::operator() (this=0x1d75838) at /usr/include/boost/bind/bind_template.hpp:20\n#19 0x00007f9f2c9847b6 in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::physics::World>, boost::_bi::list1<boost::_bi::value<gazebo::physics::World*> > > >::run (this=0x1d756b0) at /usr/include/boost/thread/detail/thread.hpp:61\n#20 0x00007f9f2b7ffce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#21 0x00007f9f2bf06e9a in start_thread (arg=0x7f9f067fc700) at pthread_create.c:308\n#22 0x00007f9f2aba8dbd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#23 0x0000000000000000 in ?? ()\n(gdb) \n~~~\n\nFurther testing shows plugin's destructor is not called when removing the model.", "markup": "markdown", "html": "<p>Model tear down is incomplete, to reproduce, insert pioneer2dx model, delete pioneer2dx model, insert anything else.  gzserver will fail trying to call event left over by the pioneer2dx model when inserting the second model with following backtrace:</p>\n<div class=\"codehilite\"><pre><span></span>#0  0x00007f9f2aaeb445 in __GI_raise (sig=&lt;optimized out&gt;) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007f9f2aaeebab in __GI_abort () at abort.c:91\n#2  0x00007f9f2aae410e in __assert_fail_base (fmt=&lt;optimized out&gt;, assertion=0x7f9f2c98e824 &quot;px != 0&quot;, \n    file=0x7f9f2c98e7f8 &quot;/usr/include/boost/smart_ptr/shared_ptr.hpp&quot;, line=&lt;optimized out&gt;, function=&lt;optimized out&gt;) at assert.c:94\n#3  0x00007f9f2aae41b2 in __GI___assert_fail (assertion=0x7f9f2c98e824 &quot;px != 0&quot;, file=0x7f9f2c98e7f8 &quot;/usr/include/boost/smart_ptr/shared_ptr.hpp&quot;, \n    line=418, function=0x7f9f2c98e9a0 &quot;T* boost::shared_ptr&lt;T&gt;::operator-&gt;() const [with T = gazebo::physics::Joint]&quot;) at assert.c:103\n#4  0x00007f9f2c908245 in boost::shared_ptr&lt;gazebo::physics::Joint&gt;::operator-&gt; (this=0x7f9ef43df7c0) at /usr/include/boost/smart_ptr/shared_ptr.hpp:418\n#5  0x00007f9f1015af8c in gazebo::DiffDrivePlugin::OnUpdate (this=0x7f9ef43df770) at /home/hsu/projects/gazebo_patches/plugins/DiffDrivePlugin.cc:131\n#6  0x00007f9f10164b4a in boost::_mfi::mf0&lt;void, gazebo::DiffDrivePlugin&gt;::operator() (this=0x7f9ef42f5388, p=0x7f9ef43df770)\n    at /usr/include/boost/bind/mem_fn_template.hpp:49\n#7  0x00007f9f101645ac in boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::DiffDrivePlugin*&gt; &gt;::operator()&lt;boost::_mfi::mf0&lt;void, gazebo::DiffDrivePlugin&gt;, boost::_bi::list0&gt; (this=0x7f9ef42f5398, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#8  0x00007f9f10163fbd in boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::DiffDrivePlugin&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::DiffDrivePlugin*&gt; &gt; &gt;::operator() (this=0x7f9ef42f5388) at /usr/include/boost/bind/bind_template.hpp:20\n#9  0x00007f9f1016395a in boost::detail::function::void_function_obj_invoker0&lt;boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::DiffDrivePlugin&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::DiffDrivePlugin*&gt; &gt; &gt;, void&gt;::invoke (function_obj_ptr=...)\n    at /usr/include/boost/function/function_template.hpp:153\n#10 0x00007f9f2ccdb854 in boost::function0&lt;void&gt;::operator() (this=0x7f9ef42f5380) at /usr/include/boost/function/function_template.hpp:1013\n#11 0x00007f9f2ccdf6b7 in gazebo::event::EventT&lt;void ()&gt;::Signal() (this=0x7f9f2d5d3320) at /home/hsu/projects/gazebo_patches/gazebo/common/Event.hh:120\n#12 0x00007f9f2ccdceee in gazebo::event::EventT&lt;void ()&gt;::operator()() (this=0x7f9f2d5d3320)\n    at /home/hsu/projects/gazebo_patches/gazebo/common/Event.hh:113\n#13 0x00007f9f2c96af10 in gazebo::physics::World::Update (this=0x1cb2020) at /home/hsu/projects/gazebo_patches/gazebo/physics/World.cc:380\n#14 0x00007f9f2c96ab1c in gazebo::physics::World::Step (this=0x1cb2020) at /home/hsu/projects/gazebo_patches/gazebo/physics/World.cc:320\n#15 0x00007f9f2c96a774 in gazebo::physics::World::RunLoop (this=0x1cb2020) at /home/hsu/projects/gazebo_patches/gazebo/physics/World.cc:289\n#16 0x00007f9f2c98339a in boost::_mfi::mf0&lt;void, gazebo::physics::World&gt;::operator() (this=0x1d75838, p=0x1cb2020)\n    at /usr/include/boost/bind/mem_fn_template.hpp:49\n#17 0x00007f9f2c98294c in boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::physics::World*&gt; &gt;::operator()&lt;boost::_mfi::mf0&lt;void, gazebo::physics::World&gt;, boost::_bi::list0&gt; (this=0x1d75848, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#18 0x00007f9f2c981f37 in boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::physics::World&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::physics::World*&gt; &gt; &gt;::operator() (this=0x1d75838) at /usr/include/boost/bind/bind_template.hpp:20\n#19 0x00007f9f2c9847b6 in boost::detail::thread_data&lt;boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::physics::World&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::physics::World*&gt; &gt; &gt; &gt;::run (this=0x1d756b0) at /usr/include/boost/thread/detail/thread.hpp:61\n#20 0x00007f9f2b7ffce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#21 0x00007f9f2bf06e9a in start_thread (arg=0x7f9f067fc700) at pthread_create.c:308\n#22 0x00007f9f2aba8dbd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#23 0x0000000000000000 in ?? ()\n(gdb) \n</pre></div>\n\n\n<p>Further testing shows plugin's destructor is not called when removing the model.</p>", "type": "rendered"}, "assignee": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "state": "closed", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2012-10-21T00:17:02.908595+00:00", "milestone": null, "updated_on": "2016-09-14T19:45:27.838080+00:00", "type": "issue", "id": 128}