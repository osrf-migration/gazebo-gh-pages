{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2570/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2570.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2570/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2570/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2570/menu-actions-already-tracked"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2570/vote"}}, "reporter": null, "title": "Menu actions Already Tracked", "component": {"name": "gui", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122878.json"}}}, "votes": 1, "watches": null, "content": {"raw": "When starting gazebo, there seems to be an issue where the menus are being added/tracked more than once. (see below)\r\n\r\nReplication: \r\nRunning `gazebo --verbose` give the following messages.\r\n```\r\n#!bash\r\n\r\n[Wrn] [GuiIface.cc:120] void DBusMenuExporterPrivate::addAction(QAction*, int): Already tracking action \"&File\" under id 48\r\n[Wrn] [GuiIface.cc:120] void DBusMenuExporterPrivate::addAction(QAction*, int): Already tracking action \"&Edit\" under id 51\r\n[Wrn] [GuiIface.cc:120] void DBusMenuExporterPrivate::addAction(QAction*, int): Already tracking action \"&View\" under id 53\r\n[Wrn] [GuiIface.cc:120] void DBusMenuExporterPrivate::addAction(QAction*, int): Already tracking action \"&Window\" under id 56\r\n[Wrn] [GuiIface.cc:120] void DBusMenuExporterPrivate::addAction(QAction*, int): Already tracking action \"&Help\" under id 60\r\n```\r\nI saw this in *MainWindow.cc*: \r\n\r\n```\r\n#!c++\r\n\r\nvoid MainWindow::AddMenu(QMenu *_menu)\r\n{\r\n  if (!_menu)\r\n    return;\r\n\r\n  // Get the main window's menubar\r\n  // Note: for some reason we can not call menuBar() again,\r\n  // so manually retrieving the menubar from the mainwindow.\r\n  QList<QMenuBar *> menuBars  = this->findChildren<QMenuBar *>();\r\n  if (!menuBars.empty())\r\n  {\r\n    // Note: addMenu(QMenu *) works the first time but when\r\n    // ShowMenuBar() is called more than once which results in menus being\r\n    // re-added, (e.g. when switching between model editor and simulation modes)\r\n    // _menu does not show up in the menu bar.\r\n    // So workaround is to use addMenu(QString)\r\n    QMenu *newMenu = menuBars[0]->addMenu(_menu->title());\r\n\r\n    for (auto &menuAct : _menu->actions())\r\n      newMenu->addAction(menuAct);\r\n  }\r\n}\r\n```", "markup": "markdown", "html": "<p>When starting gazebo, there seems to be an issue where the menus are being added/tracked more than once. (see below)</p>\n<p>Replication: \nRunning <code>gazebo --verbose</code> give the following messages.</p>\n<div class=\"codehilite language-bash\"><pre><span></span><span class=\"o\">[</span>Wrn<span class=\"o\">]</span> <span class=\"o\">[</span>GuiIface.cc:120<span class=\"o\">]</span> void DBusMenuExporterPrivate::addAction<span class=\"o\">(</span>QAction*, int<span class=\"o\">)</span>: Already tracking action <span class=\"s2\">&quot;&amp;File&quot;</span> under id <span class=\"m\">48</span>\n<span class=\"o\">[</span>Wrn<span class=\"o\">]</span> <span class=\"o\">[</span>GuiIface.cc:120<span class=\"o\">]</span> void DBusMenuExporterPrivate::addAction<span class=\"o\">(</span>QAction*, int<span class=\"o\">)</span>: Already tracking action <span class=\"s2\">&quot;&amp;Edit&quot;</span> under id <span class=\"m\">51</span>\n<span class=\"o\">[</span>Wrn<span class=\"o\">]</span> <span class=\"o\">[</span>GuiIface.cc:120<span class=\"o\">]</span> void DBusMenuExporterPrivate::addAction<span class=\"o\">(</span>QAction*, int<span class=\"o\">)</span>: Already tracking action <span class=\"s2\">&quot;&amp;View&quot;</span> under id <span class=\"m\">53</span>\n<span class=\"o\">[</span>Wrn<span class=\"o\">]</span> <span class=\"o\">[</span>GuiIface.cc:120<span class=\"o\">]</span> void DBusMenuExporterPrivate::addAction<span class=\"o\">(</span>QAction*, int<span class=\"o\">)</span>: Already tracking action <span class=\"s2\">&quot;&amp;Window&quot;</span> under id <span class=\"m\">56</span>\n<span class=\"o\">[</span>Wrn<span class=\"o\">]</span> <span class=\"o\">[</span>GuiIface.cc:120<span class=\"o\">]</span> void DBusMenuExporterPrivate::addAction<span class=\"o\">(</span>QAction*, int<span class=\"o\">)</span>: Already tracking action <span class=\"s2\">&quot;&amp;Help&quot;</span> under id <span class=\"m\">60</span>\n</pre></div>\n\n\n<p>I saw this in <em>MainWindow.cc</em>: </p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"kt\">void</span> <span class=\"n\">MainWindow</span><span class=\"o\">::</span><span class=\"n\">AddMenu</span><span class=\"p\">(</span><span class=\"n\">QMenu</span> <span class=\"o\">*</span><span class=\"n\">_menu</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">_menu</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span><span class=\"p\">;</span>\n\n  <span class=\"c1\">// Get the main window&#39;s menubar</span>\n  <span class=\"c1\">// Note: for some reason we can not call menuBar() again,</span>\n  <span class=\"c1\">// so manually retrieving the menubar from the mainwindow.</span>\n  <span class=\"n\">QList</span><span class=\"o\">&lt;</span><span class=\"n\">QMenuBar</span> <span class=\"o\">*&gt;</span> <span class=\"n\">menuBars</span>  <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">findChildren</span><span class=\"o\">&lt;</span><span class=\"n\">QMenuBar</span> <span class=\"o\">*&gt;</span><span class=\"p\">();</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">menuBars</span><span class=\"p\">.</span><span class=\"n\">empty</span><span class=\"p\">())</span>\n  <span class=\"p\">{</span>\n    <span class=\"c1\">// Note: addMenu(QMenu *) works the first time but when</span>\n    <span class=\"c1\">// ShowMenuBar() is called more than once which results in menus being</span>\n    <span class=\"c1\">// re-added, (e.g. when switching between model editor and simulation modes)</span>\n    <span class=\"c1\">// _menu does not show up in the menu bar.</span>\n    <span class=\"c1\">// So workaround is to use addMenu(QString)</span>\n    <span class=\"n\">QMenu</span> <span class=\"o\">*</span><span class=\"n\">newMenu</span> <span class=\"o\">=</span> <span class=\"n\">menuBars</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">-&gt;</span><span class=\"n\">addMenu</span><span class=\"p\">(</span><span class=\"n\">_menu</span><span class=\"o\">-&gt;</span><span class=\"n\">title</span><span class=\"p\">());</span>\n\n    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"k\">auto</span> <span class=\"o\">&amp;</span><span class=\"nl\">menuAct</span> <span class=\"p\">:</span> <span class=\"n\">_menu</span><span class=\"o\">-&gt;</span><span class=\"n\">actions</span><span class=\"p\">())</span>\n      <span class=\"n\">newMenu</span><span class=\"o\">-&gt;</span><span class=\"n\">addAction</span><span class=\"p\">(</span><span class=\"n\">menuAct</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "9.0", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/242746.json"}}}, "edited_on": null, "created_on": "2018-12-04T18:44:39.106421+00:00", "milestone": null, "updated_on": "2018-12-04T19:04:14.627484+00:00", "type": "issue", "id": 2570}