{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/762/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/762.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/762/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/762/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/762/mismatched-free-of-buffers"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/762/vote"}}, "reporter": {"display_name": "daniel_pinyol_laserna", "uuid": "{1d0de129-ce25-492b-bfd0-8c586d99e578}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1d0de129-ce25-492b-bfd0-8c586d99e578%7D"}, "html": {"href": "https://bitbucket.org/%7B1d0de129-ce25-492b-bfd0-8c586d99e578%7D/"}, "avatar": {"href": "https://bitbucket.org/account/daniel_pinyol_laserna/avatar/"}}, "nickname": "daniel_pinyol_laserna", "type": "user", "account_id": null}, "title": "mismatched free of buffers", "component": null, "votes": 0, "watches": 2, "content": {"raw": "Hi,\r\nIn both Connection and VideVisual, there are arrays which should be freed with delete[] instead of delete.\r\n\r\nthanks\r\n\r\n\r\n```\r\n#!c++\r\n\r\nConnection::~Connection()\r\n{\r\n  delete this->headerBuffer;\r\n\r\nVideoVisual::~VideoVisual()\r\n{\r\n  delete this->video;\r\n  delete this->imageBuffer;\r\n}\r\n```\r\n\r\n\r\n\r\n```\r\n#!\r\n\r\n==12355== Mismatched free() / delete / delete []\r\n==12355==    at 0x402A92A: operator delete(void*) (vg_replace_malloc.c:480)\r\n==12355==    by 0x44C9555: gazebo::transport::Connection::~Connection() (Connection.cc:98)\r\n==12355==    by 0x44C9882: gazebo::transport::Connection::~Connection() (Connection.cc:113)\r\n==12355==    by 0x44EF593: gazebo::transport::ConnectionManager::Fini() (ConnectionManager.cc:226)\r\n==12355==    by 0x451C000: gazebo::transport::fini() (Transport.cc:152)\r\n==12355==    by 0x80CFD55: gazebo::fini() (gazebo.cc:108)\r\n==12355==    by 0x80AE707: gazebo::Server::Fini() (Server.cc:418)\r\n==12355==    by 0x80A97D8: main (server_main.cc:44)\r\n==12355==  Address 0xda2a1a0 is 0 bytes inside a block of size 8 alloc'd\r\n==12355==    at 0x402B22A: operator new[](unsigned int) (vg_replace_malloc.c:357)\r\n==12355==    by 0x44C8DE0: gazebo::transport::Connection::Connection() (Connection.cc:63)\r\n==12355==    by 0x44EE35C: gazebo::transport::ConnectionManager::Init(std::string const&, unsigned int) (ConnectionManager.cc:89)\r\n==12355==    by 0x451BCAA: gazebo::transport::init(std::string const&, unsigned int) (Transport.cc:91)\r\n==12355==    by 0x80CFC10: gazebo::load(int, char**) (gazebo.cc:73)\r\n==12355==    by 0x80AD9E8: gazebo::Server::LoadImpl(boost::shared_ptr<sdf::Element>, std::string const&) (Server.cc:326)\r\n==12355==    by 0x80AD447: gazebo::Server::LoadFile(std::string const&, std::string const&) (Server.cc:288)\r\n==12355==    by 0x80AC6FB: gazebo::Server::ParseArgs(int, char**) (Server.cc:245)\r\n==12355==    by 0x80A97B2: main (server_main.cc:40)\r\n```", "markup": "markdown", "html": "<p>Hi,\nIn both Connection and VideVisual, there are arrays which should be freed with delete[] instead of delete.</p>\n<p>thanks</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"n\">Connection</span><span class=\"o\">::~</span><span class=\"n\">Connection</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"k\">delete</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">headerBuffer</span><span class=\"p\">;</span>\n\n<span class=\"n\">VideoVisual</span><span class=\"o\">::~</span><span class=\"n\">VideoVisual</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"k\">delete</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">video</span><span class=\"p\">;</span>\n  <span class=\"k\">delete</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">imageBuffer</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>==12355== Mismatched free() / delete / delete []\n==12355==    at 0x402A92A: operator delete(void*) (vg_replace_malloc.c:480)\n==12355==    by 0x44C9555: gazebo::transport::Connection::~Connection() (Connection.cc:98)\n==12355==    by 0x44C9882: gazebo::transport::Connection::~Connection() (Connection.cc:113)\n==12355==    by 0x44EF593: gazebo::transport::ConnectionManager::Fini() (ConnectionManager.cc:226)\n==12355==    by 0x451C000: gazebo::transport::fini() (Transport.cc:152)\n==12355==    by 0x80CFD55: gazebo::fini() (gazebo.cc:108)\n==12355==    by 0x80AE707: gazebo::Server::Fini() (Server.cc:418)\n==12355==    by 0x80A97D8: main (server_main.cc:44)\n==12355==  Address 0xda2a1a0 is 0 bytes inside a block of size 8 alloc&#39;d\n==12355==    at 0x402B22A: operator new[](unsigned int) (vg_replace_malloc.c:357)\n==12355==    by 0x44C8DE0: gazebo::transport::Connection::Connection() (Connection.cc:63)\n==12355==    by 0x44EE35C: gazebo::transport::ConnectionManager::Init(std::string const&amp;, unsigned int) (ConnectionManager.cc:89)\n==12355==    by 0x451BCAA: gazebo::transport::init(std::string const&amp;, unsigned int) (Transport.cc:91)\n==12355==    by 0x80CFC10: gazebo::load(int, char**) (gazebo.cc:73)\n==12355==    by 0x80AD9E8: gazebo::Server::LoadImpl(boost::shared_ptr&lt;sdf::Element&gt;, std::string const&amp;) (Server.cc:326)\n==12355==    by 0x80AD447: gazebo::Server::LoadFile(std::string const&amp;, std::string const&amp;) (Server.cc:288)\n==12355==    by 0x80AC6FB: gazebo::Server::ParseArgs(int, char**) (Server.cc:245)\n==12355==    by 0x80A97B2: main (server_main.cc:40)\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "closed", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2013-07-03T08:47:12.898445+00:00", "milestone": null, "updated_on": "2016-09-14T19:45:27.074271+00:00", "type": "issue", "id": 762}