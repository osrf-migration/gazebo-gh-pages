{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2650/comments/54309421.json"}, "html": {"href": "#!/osrf/gazebo/issues/2650#comment-54309421"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2650.json"}}, "type": "issue", "id": 2650, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "catkin build - cannot find `tinyxml2::tinyxml2` target"}, "content": {"raw": "Got it! It\u2019s ignition-cmake0 in combination with DART who\u2019s making mess\u2026 Here\u2019s what\u2019s going on:\n\n1. First CMake run: DART calls `find_path(TINYXML2_INCLUDE_DIRS ...)` from its own Findtinyxml2.cmake . This puts the variable TINYXML2\\_INCLUDE\\_DIRS into CMake cache.\n2. First CMake run: Ignition CMake calls `pkg_check_modules(TINYXML2 tinyxml2)` \\(it gets called by ign-common and ign-fuel-tools\\). This \\(even if it finds the package\\) sets `TINYXML2_INCLUDE_DIRS` to an empty string. This was \u201cfixed\u201d in [https://bitbucket.org/ignitionrobotics/ign-cmake/commits/e8913dfc6e0ae0c8e510f51d571335a90755e0c0](https://bitbucket.org/ignitionrobotics/ign-cmake/commits/e8913dfc6e0ae0c8e510f51d571335a90755e0c0) , however this commit did not make it \\(yet\\) into ignition-common0.\n3. Second CMake run: `find_path(TINYXML2_INCLUDE_DIRS ...)` in DART doesn\u2019t look up the path again, because it\u2019s in cache. However, the cache contains an empty string. \n4. Second CMake run: FindPackageHandleStandardArgs at the end of Findtinxyxml2.cmake from DART considers the tinyxml2 package as not found because of the empty path.\n5. From now on, the CMake phase is broken.\n\nSo the solution is to unset `TINYXML2_INCLUDE_DIRS` from cache on specific places. Or, an even better solution would be if [the fix from newer versions of ignition-common would be backported to ignition-common0](https://bitbucket.org/ignitionrobotics/ign-cmake/issues/67/ignition-cmake0-unset-blank-cache).\n\nThere\u2019s not even need for renaming all the Gazebo usages of tinyxml2 to gztinyxml2 \\(though it would be a good idea anyways\\).\n\nSo the fastest fix is:\n\n```diff\ndiff -r fc44c9cb4072 cmake/SearchForStuff.cmake\n--- a/cmake/SearchForStuff.cmake        Thu Oct 10 11:23:15 2019 +0200\n+++ b/cmake/SearchForStuff.cmake        Fri Oct 11 17:28:25 2019 +0200\n@@ -161,6 +161,7 @@\n \n   #################################################\n   # Find DART\n+  unset(TINYXML2_INCLUDE_DIRS CACHE)\n   set(DART_MIN_REQUIRED_VERSION 6)\n   find_package(DART ${DART_MIN_REQUIRED_VERSION} CONFIG OPTIONAL_COMPONENTS utils-urdf)\n   if (DART_FOUND)\n@@ -174,6 +175,7 @@\n     BUILD_WARNING (\"DART ${DART_MIN_REQUIRED_VERSION} not found, for dart physics engine option, please install libdart${DART_MIN_REQUIRED_VERSION}-dev.\")\n     set (HAVE_DART FALSE)\n   endif()\n+  unset(TINYXML2_INCLUDE_DIRS CACHE)\n \n   #################################################\n   # Find tinyxml. Only debian distributions package tinyxml with a pkg-config\n@@ -738,6 +740,7 @@\n \n ################################################################################\n # Find the Ignition Fuel Tools library\n+unset(TINYXML2_INCLUDE_DIRS CACHE)\n find_package(ignition-fuel_tools1 1.2 QUIET)\n if (NOT ignition-fuel_tools1_FOUND)\n   message (STATUS \"Looking for libignition-fuel_tools1 - not found\")\n@@ -764,6 +767,7 @@\n     link_directories(${ignition-common1_LIBRARY_DIRS})\n   endif()\n endif()\n+unset(TINYXML2_INCLUDE_DIRS CACHE)\n```\n\nShould I post a PR with these changes or would you like to find a better fix for this issue \\(or wait for the ignition-common backport\\)?\n\n\u200c", "markup": "markdown", "html": "<p>Got it! It\u2019s ignition-cmake0 in combination with DART who\u2019s making mess\u2026 Here\u2019s what\u2019s going on:</p>\n<ol>\n<li>First CMake run: DART calls <code>find_path(TINYXML2_INCLUDE_DIRS ...)</code> from its own Findtinyxml2.cmake . This puts the variable TINYXML2_INCLUDE_DIRS into CMake cache.</li>\n<li>First CMake run: Ignition CMake calls <code>pkg_check_modules(TINYXML2 tinyxml2)</code> (it gets called by ign-common and ign-fuel-tools). This (even if it finds the package) sets <code>TINYXML2_INCLUDE_DIRS</code> to an empty string. This was \u201cfixed\u201d in <a data-is-external-link=\"true\" href=\"https://bitbucket.org/ignitionrobotics/ign-cmake/commits/e8913dfc6e0ae0c8e510f51d571335a90755e0c0\" rel=\"nofollow\">https://bitbucket.org/ignitionrobotics/ign-cmake/commits/e8913dfc6e0ae0c8e510f51d571335a90755e0c0</a> , however this commit did not make it (yet) into ignition-common0.</li>\n<li>Second CMake run: <code>find_path(TINYXML2_INCLUDE_DIRS ...)</code> in DART doesn\u2019t look up the path again, because it\u2019s in cache. However, the cache contains an empty string. </li>\n<li>Second CMake run: FindPackageHandleStandardArgs at the end of Findtinxyxml2.cmake from DART considers the tinyxml2 package as not found because of the empty path.</li>\n<li>From now on, the CMake phase is broken.</li>\n</ol>\n<p>So the solution is to unset <code>TINYXML2_INCLUDE_DIRS</code> from cache on specific places. Or, an even better solution would be if <a data-is-external-link=\"true\" href=\"https://bitbucket.org/ignitionrobotics/ign-cmake/issues/67/ignition-cmake0-unset-blank-cache\" rel=\"nofollow\">the fix from newer versions of ignition-common would be backported to ignition-common0</a>.</p>\n<p>There\u2019s not even need for renaming all the Gazebo usages of tinyxml2 to gztinyxml2 (though it would be a good idea anyways).</p>\n<p>So the fastest fix is:</p>\n<div class=\"codehilite language-diff\"><pre><span></span><span class=\"gh\">diff -r fc44c9cb4072 cmake/SearchForStuff.cmake</span>\n<span class=\"gd\">--- a/cmake/SearchForStuff.cmake        Thu Oct 10 11:23:15 2019 +0200</span>\n<span class=\"gi\">+++ b/cmake/SearchForStuff.cmake        Fri Oct 11 17:28:25 2019 +0200</span>\n<span class=\"gu\">@@ -161,6 +161,7 @@</span>\n\n   #################################################\n   # Find DART\n<span class=\"gi\">+  unset(TINYXML2_INCLUDE_DIRS CACHE)</span>\n   set(DART_MIN_REQUIRED_VERSION 6)\n   find_package(DART ${DART_MIN_REQUIRED_VERSION} CONFIG OPTIONAL_COMPONENTS utils-urdf)\n   if (DART_FOUND)\n<span class=\"gu\">@@ -174,6 +175,7 @@</span>\n     BUILD_WARNING (&quot;DART ${DART_MIN_REQUIRED_VERSION} not found, for dart physics engine option, please install libdart${DART_MIN_REQUIRED_VERSION}-dev.&quot;)\n     set (HAVE_DART FALSE)\n   endif()\n<span class=\"gi\">+  unset(TINYXML2_INCLUDE_DIRS CACHE)</span>\n\n   #################################################\n   # Find tinyxml. Only debian distributions package tinyxml with a pkg-config\n<span class=\"gu\">@@ -738,6 +740,7 @@</span>\n\n ################################################################################\n # Find the Ignition Fuel Tools library\n<span class=\"gi\">+unset(TINYXML2_INCLUDE_DIRS CACHE)</span>\n find_package(ignition-fuel_tools1 1.2 QUIET)\n if (NOT ignition-fuel_tools1_FOUND)\n   message (STATUS &quot;Looking for libignition-fuel_tools1 - not found&quot;)\n<span class=\"gu\">@@ -764,6 +767,7 @@</span>\n     link_directories(${ignition-common1_LIBRARY_DIRS})\n   endif()\n endif()\n<span class=\"gi\">+unset(TINYXML2_INCLUDE_DIRS CACHE)</span>\n</pre></div>\n\n\n<p>Should I post a PR with these changes or would you like to find a better fix for this issue (or wait for the ignition-common backport)?</p>\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2019-10-11T15:32:10.788570+00:00", "user": {"display_name": "Martin Pecka", "uuid": "{41691c43-4ae0-49ba-ba45-3c36439f5af2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D"}, "html": {"href": "https://bitbucket.org/%7B41691c43-4ae0-49ba-ba45-3c36439f5af2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d1ad32a09564f856909994613fdbc37cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMP-1.png"}}, "nickname": "peci1", "type": "user", "account_id": "557058:434ecab2-e510-4ede-8f9a-1c2a5a4032e1"}, "updated_on": null, "type": "issue_comment", "id": 54309421}