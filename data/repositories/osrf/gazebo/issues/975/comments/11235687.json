{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/975/comments/11235687.json"}, "html": {"href": "#!/osrf/gazebo/issues/975#comment-11235687"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/975.json"}}, "type": "issue", "id": 975, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "DART joint springs are partially working."}, "content": {"raw": "Somehow the SpringDamperTest is broken again with dart 4.1. The energy checks at [joint_test.cc:352](#!/osrf/gazebo/src/4f4e5ffdf79ba3f813de773ee596fa1e26a8134a/test/integration/joint_test.cc?at=default#cl-352) are failing and eventually nan's are generated, which causes the test to proceed very slowly. The following patch prevents the nan's but doesn't fix the energy problem:\n~~~\ndiff -r 7f4841ef8279 test/worlds/spring_damper_test.world\n--- a/test/worlds/spring_damper_test.world\tMon Jul 14 16:20:34 2014 -0700\n+++ b/test/worlds/spring_damper_test.world\tMon Jul 14 16:58:52 2014 -0700\n@@ -625,7 +625,7 @@\n         <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>\n         <axis>\n           <limit>\n-            <lower>-1.0</lower>\n+            <lower>-0.1</lower>\n             <upper>1.0</upper>\n           </limit>\n           <xyz>0.0 0.0 1.0</xyz>\n~~~\nIt was tricky to notice this because INTEGRATION_joint_test requires the latest sdformat version (try building on trusty with `libsdformat2-dev-prerelease` installed). Then run the test as follows:\n~~~\n$ test/integration/INTEGRATION_joint_test --gtest_filter=\"*/3\"\n~~~\nIf there's not an easy fix for this, I'll have to disable the test again.\n\nUPDATE:\n\nBy further disabling the energy check, I see that the only other test failure is on line 384:\n~~~\ndiff -r 7f4841ef8279 test/integration/joint_test.cc\n--- a/test/integration/joint_test.cc\tMon Jul 14 16:20:34 2014 -0700\n+++ b/test/integration/joint_test.cc\tMon Jul 14 17:02:50 2014 -0700\n@@ -349,7 +349,7 @@\n               << \", see #975\"\n               << std::endl;\n       }\n-      EXPECT_NEAR(energy / energyPluginImplicit0, 1.0, 2e-2);\n+      //EXPECT_NEAR(energy / energyPluginImplicit0, 1.0, 2e-2);\n     }\n     else\n     {\n~~~\n~~~\n[ RUN      ] PhysicsEngines/JointTest.SpringDamperTest/3\n[Dbg] [joint_test.hh:59] Params: (0x473c00 pointing to \"dart\", 0x4766e1 pointing to \"\")\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 192.168.1.182\n[Wrn] [Publisher.cc:131] Queue limit reached for topic /gazebo/default/pose/local/info, deleting message. This warning is printed only once.\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.8 seconds, timeout after 600 seconds\n[Err] [joint_test.cc:347] dart has reduced accuracy for spring energy conservation, see #975\n[Err] [joint_test.cc:373] dart doesn't support joint limit stiffness, see #975\ngazebo/test/integration/joint_test.cc:384: Failure\nValue of: 17\nExpected: cyclesPluginImplicit\nWhich is: 1\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\n[  FAILED  ] PhysicsEngines/JointTest.SpringDamperTest/3, where GetParam() = (0x473c00 pointing to \"dart\", 0x4766e1 pointing to \"\") (6317 ms)\n~~~", "markup": "markdown", "html": "<p>Somehow the SpringDamperTest is broken again with dart 4.1. The energy checks at <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/4f4e5ffdf79ba3f813de773ee596fa1e26a8134a/test/integration/joint_test.cc?at=default#cl-352\" rel=\"nofollow\">joint_test.cc:352</a> are failing and eventually nan's are generated, which causes the test to proceed very slowly. The following patch prevents the nan's but doesn't fix the energy problem:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 7f4841ef8279 test/worlds/spring_damper_test.world</span>\n<span class=\"gd\">--- a/test/worlds/spring_damper_test.world  Mon Jul 14 16:20:34 2014 -0700</span>\n<span class=\"gi\">+++ b/test/worlds/spring_damper_test.world  Mon Jul 14 16:58:52 2014 -0700</span>\n<span class=\"gu\">@@ -625,7 +625,7 @@</span>\n         &lt;pose&gt;0.0 0.0 0.0 0.0 0.0 0.0&lt;/pose&gt;\n         &lt;axis&gt;\n           &lt;limit&gt;\n<span class=\"gd\">-            &lt;lower&gt;-1.0&lt;/lower&gt;</span>\n<span class=\"gi\">+            &lt;lower&gt;-0.1&lt;/lower&gt;</span>\n             &lt;upper&gt;1.0&lt;/upper&gt;\n           &lt;/limit&gt;\n           &lt;xyz&gt;0.0 0.0 1.0&lt;/xyz&gt;\n</pre></div>\n\n\n<p>It was tricky to notice this because INTEGRATION_joint_test requires the latest sdformat version (try building on trusty with <code>libsdformat2-dev-prerelease</code> installed). Then run the test as follows:</p>\n<div class=\"codehilite\"><pre><span></span>$ test/integration/INTEGRATION_joint_test --gtest_filter<span class=\"o\">=</span><span class=\"s2\">&quot;*/3&quot;</span>\n</pre></div>\n\n\n<p>If there's not an easy fix for this, I'll have to disable the test again.</p>\n<p>UPDATE:</p>\n<p>By further disabling the energy check, I see that the only other test failure is on line 384:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 7f4841ef8279 test/integration/joint_test.cc</span>\n<span class=\"gd\">--- a/test/integration/joint_test.cc    Mon Jul 14 16:20:34 2014 -0700</span>\n<span class=\"gi\">+++ b/test/integration/joint_test.cc    Mon Jul 14 17:02:50 2014 -0700</span>\n<span class=\"gu\">@@ -349,7 +349,7 @@</span>\n               &lt;&lt; &quot;, see #975&quot;\n               &lt;&lt; std::endl;\n       }\n<span class=\"gd\">-      EXPECT_NEAR(energy / energyPluginImplicit0, 1.0, 2e-2);</span>\n<span class=\"gi\">+      //EXPECT_NEAR(energy / energyPluginImplicit0, 1.0, 2e-2);</span>\n     }\n     else\n     {\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>[ RUN      ] PhysicsEngines/JointTest.SpringDamperTest/3\n[Dbg] [joint_test.hh:59] Params: (0x473c00 pointing to &quot;dart&quot;, 0x4766e1 pointing to &quot;&quot;)\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 192.168.1.182\n[Wrn] [Publisher.cc:131] Queue limit reached for topic /gazebo/default/pose/local/info, deleting message. This warning is printed only once.\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.8 seconds, timeout after 600 seconds\n[Err] [joint_test.cc:347] dart has reduced accuracy for spring energy conservation, see #975\n[Err] [joint_test.cc:373] dart doesn&#39;t support joint limit stiffness, see #975\ngazebo/test/integration/joint_test.cc:384: Failure\nValue of: 17\nExpected: cyclesPluginImplicit\nWhich is: 1\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\n[  FAILED  ] PhysicsEngines/JointTest.SpringDamperTest/3, where GetParam() = (0x473c00 pointing to &quot;dart&quot;, 0x4766e1 pointing to &quot;&quot;) (6317 ms)\n</pre></div>", "type": "rendered"}, "created_on": "2014-07-15T00:00:48.511726+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-07-15T00:04:19.648496+00:00", "type": "issue_comment", "id": 11235687}