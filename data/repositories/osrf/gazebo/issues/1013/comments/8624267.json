{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1013/comments/8624267.json"}, "html": {"href": "#!/osrf/gazebo/issues/1013#comment-8624267"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1013.json"}}, "type": "issue", "id": 1013, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Gripper test sometimes fails (transport/msgs related)"}, "content": {"raw": "valgrind says look at [Gripper::HandleAttach, lines 176-177](#!/osrf/gazebo/src/445b62a58c30e18999fa0bc24792fc5cea95fd2f/gazebo/physics/Gripper.cc?at=default#cl-176), the OnUpdate function is continuing to access `this->contacts`, while that data structure is being destroyed.\n~~~\n==3941== 1 errors in context 3 of 20:\n==3941== Thread 26:\n==3941== Invalid read of size 8\n==3941==    at 0x7C4C838: std::basic_string<char, std::char_traits<char>, std::allocator<char> >::basic_string(std::string const&) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17)\n==3941==    by 0x5410466: gazebo::physics::Gripper::HandleAttach() (Gripper.cc:177)\n==3941==    by 0x5412A97: gazebo::physics::Gripper::OnUpdate() (Gripper.cc:153)\n==3941==    by 0x498D16: gazebo::event::EventT<void ()()>::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n==3941==  Address 0x285e6620 is 0 bytes inside a block of size 8 free'd\n==3941==    at 0x4C2A44B: operator delete(void*) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==3941==    by 0x5EB3477: gazebo::msgs::Contact::SharedDtor() (contact.pb.cc:159)\n==3941==    by 0x5EB503B: gazebo::msgs::Contact::~Contact() (contact.pb.cc:151)\n==3941==    by 0x5412A1E: gazebo::physics::Gripper::OnUpdate() (stl_construct.h:95)\n==3941==    by 0x498D16: gazebo::event::EventT<void ()()>::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n==3941== \n==3941== \n==3941== 1 errors in context 4 of 20:\n==3941== Invalid read of size 8\n==3941==    at 0x7C4C838: std::basic_string<char, std::char_traits<char>, std::allocator<char> >::basic_string(std::string const&) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17)\n==3941==    by 0x5410450: gazebo::physics::Gripper::HandleAttach() (Gripper.cc:176)\n==3941==    by 0x5412A97: gazebo::physics::Gripper::OnUpdate() (Gripper.cc:153)\n==3941==    by 0x498D16: gazebo::event::EventT<void ()()>::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n==3941==  Address 0x2605a9d0 is 0 bytes inside a block of size 8 free'd\n==3941==    at 0x4C2A44B: operator delete(void*) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==3941==    by 0x5EB344C: gazebo::msgs::Contact::SharedDtor() (contact.pb.cc:156)\n==3941==    by 0x5EB503B: gazebo::msgs::Contact::~Contact() (contact.pb.cc:151)\n==3941==    by 0x5412A1E: gazebo::physics::Gripper::OnUpdate() (stl_construct.h:95)\n==3941==    by 0x498D16: gazebo::event::EventT<void ()()>::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n~~~", "markup": "markdown", "html": "<p>valgrind says look at <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/445b62a58c30e18999fa0bc24792fc5cea95fd2f/gazebo/physics/Gripper.cc?at=default#cl-176\" rel=\"nofollow\">Gripper::HandleAttach, lines 176-177</a>, the OnUpdate function is continuing to access <code>this-&gt;contacts</code>, while that data structure is being destroyed.</p>\n<div class=\"codehilite\"><pre><span></span>==3941== 1 errors in context 3 of 20:\n==3941== Thread 26:\n==3941== Invalid read of size 8\n==3941==    at 0x7C4C838: std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;::basic_string(std::string const&amp;) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17)\n==3941==    by 0x5410466: gazebo::physics::Gripper::HandleAttach() (Gripper.cc:177)\n==3941==    by 0x5412A97: gazebo::physics::Gripper::OnUpdate() (Gripper.cc:153)\n==3941==    by 0x498D16: gazebo::event::EventT&lt;void ()()&gt;::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n==3941==  Address 0x285e6620 is 0 bytes inside a block of size 8 free&#39;d\n==3941==    at 0x4C2A44B: operator delete(void*) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==3941==    by 0x5EB3477: gazebo::msgs::Contact::SharedDtor() (contact.pb.cc:159)\n==3941==    by 0x5EB503B: gazebo::msgs::Contact::~Contact() (contact.pb.cc:151)\n==3941==    by 0x5412A1E: gazebo::physics::Gripper::OnUpdate() (stl_construct.h:95)\n==3941==    by 0x498D16: gazebo::event::EventT&lt;void ()()&gt;::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n==3941== \n==3941== \n==3941== 1 errors in context 4 of 20:\n==3941== Invalid read of size 8\n==3941==    at 0x7C4C838: std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;::basic_string(std::string const&amp;) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17)\n==3941==    by 0x5410450: gazebo::physics::Gripper::HandleAttach() (Gripper.cc:176)\n==3941==    by 0x5412A97: gazebo::physics::Gripper::OnUpdate() (Gripper.cc:153)\n==3941==    by 0x498D16: gazebo::event::EventT&lt;void ()()&gt;::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n==3941==  Address 0x2605a9d0 is 0 bytes inside a block of size 8 free&#39;d\n==3941==    at 0x4C2A44B: operator delete(void*) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==3941==    by 0x5EB344C: gazebo::msgs::Contact::SharedDtor() (contact.pb.cc:156)\n==3941==    by 0x5EB503B: gazebo::msgs::Contact::~Contact() (contact.pb.cc:151)\n==3941==    by 0x5412A1E: gazebo::physics::Gripper::OnUpdate() (stl_construct.h:95)\n==3941==    by 0x498D16: gazebo::event::EventT&lt;void ()()&gt;::Signal() (function_template.hpp:760)\n==3941==    by 0x54799BA: gazebo::physics::World::Update() (Event.hh:187)\n==3941==    by 0x5481D13: gazebo::physics::World::Step() (World.cc:561)\n==3941==    by 0x5483064: gazebo::physics::World::RunLoop() (World.cc:410)\n==3941==    by 0x70D06C8: ??? (in /usr/lib/libboost_thread.so.1.49.0)\n==3941==    by 0x644EE99: start_thread (pthread_create.c:308)\n==3941==    by 0x84983FC: clone (clone.S:112)\n</pre></div>", "type": "rendered"}, "created_on": "2014-02-26T00:14:29.478035+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 8624267}