{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2013/comments/29335478.json"}, "html": {"href": "#!/osrf/gazebo/issues/2013#comment-29335478"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2013.json"}}, "type": "issue", "id": 2013, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "gzclient creates and destroys a lot of threads after startup"}, "content": {"raw": "I interrupted gzclient during the thread frenzy, and it looks like the threads are generated by `libcurl`:\n\n~~~\n[New Thread 0x7fff8ffff700 (LWP 28660)]\n^C\nProgram received signal SIGINT, Interrupt.\n0x00007fffebba50e0 in XPending () from /usr/lib/x86_64-linux-gnu/libX11.so.6\n(gdb) thread apply all bt\n~~~\n\nthread 28660\n~~~\nThread 41 (Thread 0x7fff8ffff700 (LWP 28660)):\n#0  0x00007ffff6642fdd in poll () at ../sysdeps/unix/syscall-template.S:81\n#1  0x00007fffd7dd0214 in send_dg (ansp2_malloced=0x7fff8fffe430, resplen2=0x7fff8fffe420, anssizp2=0x7fff8fffe410, ansp2=0x7fff8fffe460, anscp=0x7fff8fffe450, gotsomewhere=<synthetic pointer>, v_circuit=<synthetic pointer>, ns=0, terrno=0x7fff8fffce60, anssizp=0x7fff8fffcfa0, ansp=0x7fff8fffce58, buflen2=31, buf2=0x7fff8fffcff0 \"b\\243\\001\", buflen=31, buf=0x7fff8fffcfd0 \"\\200\", statp=0x7fff8ffffdb8) at res_send.c:1206\n#2  __libc_res_nsend (statp=statp@entry=0x7fff8ffffdb8, buf=buf@entry=0x7fff8fffcfd0 \"\\200\", buflen=31, buf2=buf2@entry=0x7fff8fffcff0 \"b\\243\\001\", buflen2=buflen2@entry=31, ans=ans@entry=0x7fff8fffdbe0 \"b\\243\\201\\200\", anssiz=anssiz@entry=2048, ansp=ansp@entry=0x7fff8fffe450, ansp2=ansp2@entry=0x7fff8fffe460, nansp2=nansp2@entry=0x7fff8fffe410, resplen2=resplen2@entry=0x7fff8fffe420, ansp2_malloced=ansp2_malloced@entry=0x7fff8fffe430) at res_send.c:576\n#3  0x00007fffd7dcde2c in __GI___libc_res_nquery (statp=statp@entry=0x7fff8ffffdb8, name=0x7fff5802d650 \"gazebosim.org\", class=class@entry=1, type=type@entry=62321, answer=answer@entry=0x7fff8fffdbe0 \"b\\243\\201\\200\", anslen=anslen@entry=2048, answerp=answerp@entry=0x7fff8fffe450, answerp2=answerp2@entry=0x7fff8fffe460, nanswerp2=nanswerp2@entry=0x7fff8fffe410, resplen2=resplen2@entry=0x7fff8fffe420, answerp2_malloced=answerp2_malloced@entry=0x7fff8fffe430) at res_query.c:227\n#4  0x00007fffd7dce863 in __libc_res_nquerydomain (domain=0x0, answerp2_malloced=0x7fff8fffe430, resplen2=0x7fff8fffe420, nanswerp2=0x7fff8fffe410, answerp2=0x7fff8fffe460, answerp=0x7fff8fffe450, anslen=2048, answer=0x7fff8fffdbe0 \"b\\243\\201\\200\", type=62321, class=1, name=0x7fff5802d650 \"gazebosim.org\", statp=0x7fff8ffffdb8) at res_query.c:591\n#5  __GI___libc_res_nsearch (statp=0x7fff8ffffdb8, name=name@entry=0x7fff5802d650 \"gazebosim.org\", class=class@entry=1, type=type@entry=62321, answer=answer@entry=0x7fff8fffdbe0 \"b\\243\\201\\200\", anslen=anslen@entry=2048, answerp=answerp@entry=0x7fff8fffe450, answerp2=answerp2@entry=0x7fff8fffe460, nanswerp2=nanswerp2@entry=0x7fff8fffe410, resplen2=resplen2@entry=0x7fff8fffe420, answerp2_malloced=answerp2_malloced@entry=0x7fff8fffe430) at res_query.c:381\n#6  0x00007fff8495ec73 in _nss_dns_gethostbyname4_r (name=name@entry=0x7fff5802d650 \"gazebosim.org\", pat=pat@entry=0x7fff8fffeaa0, buffer=buffer@entry=0x7fff8fffe500 \"\\377\\002\", buflen=buflen@entry=1064, errnop=errnop@entry=0x7fff8fffea70, herrnop=herrnop@entry=0x7fff8fffeac0, ttlp=ttlp@entry=0x0) at nss_dns/dns-host.c:315\n#7  0x00007ffff6622607 in gaih_inet (name=<optimized out>, name@entry=0x7fff5802d650 \"gazebosim.org\", service=<optimized out>, req=req@entry=0x7fff5802db60, pai=pai@entry=0x7fff8fffebd0, naddrs=naddrs@entry=0x7fff8fffebc0) at ../sysdeps/posix/getaddrinfo.c:850\n#8  0x00007ffff6625cbd in __GI_getaddrinfo (name=0x7fff5802d650 \"gazebosim.org\", service=0x7fff8fffed80 \"80\", hints=0x7fff5802db60, pai=0x7fff8fffed38) at ../sysdeps/posix/getaddrinfo.c:2406\n#9  0x00007fffedfb4244 in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#10 0x00007fffedfc10f4 in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#11 0x00007fffedfbe99b in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#12 0x00007ffff1cbd184 in start_thread (arg=0x7fff8ffff700) at pthread_create.c:312\n#13 0x00007ffff665037d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n~~~\n\nlibcurl was invoked by [ModelDatabase.cc](#!/osrf/gazebo/src/ca2a71952a3823494afe2aafe9b6996c40e31539/gazebo/common/ModelDatabase.cc?fileviewer=file-view-default#ModelDatabase.cc-197)\n~~~\nThread 2 (Thread 0x7fffd25d0700 (LWP 28620)):\n#0  0x00007ffff6642fdd in poll () at ../sysdeps/unix/syscall-template.S:81\n#1  0x00007fffedfb0bca in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#2  0x00007fffedfa4930 in curl_easy_perform () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#3  0x00007ffff60e601b in gazebo::common::ModelDatabase::GetManifestImpl (this=this@entry=0x7ffff7dd5e80 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>, _uri=\"http://gazebosim.org/models/cart_soft_suspension/model.config\") at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:209\n#4  0x00007ffff60e63d7 in gazebo::common::ModelDatabase::GetModelConfig (this=this@entry=0x7ffff7dd5e80 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>, _uri=\"http://gazebosim.org/models/cart_soft_suspension\") at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:191\n#5  0x00007ffff60e650d in gazebo::common::ModelDatabase::GetModelName (this=this@entry=0x7ffff7dd5e80 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>, _uri=\"http://gazebosim.org/models/cart_soft_suspension\") at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:368\n#6  0x00007ffff60e7703 in gazebo::common::ModelDatabase::UpdateModelCacheImpl (this=this@entry=0x7ffff7dd5e80 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:265\n#7  0x00007ffff60e7c66 in gazebo::common::ModelDatabase::UpdateModelCache (this=0x7ffff7dd5e80 <SingletonT<gazebo::common::ModelDatabase>::GetInstance()::t>, _fetchImmediately=false) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:293\n#8  0x00007ffff1aaaa4a in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.54.0\n#9  0x00007ffff1cbd184 in start_thread (arg=0x7fffd25d0700) at pthread_create.c:312\n#10 0x00007ffff665037d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n~~~", "markup": "markdown", "html": "<p>I interrupted gzclient during the thread frenzy, and it looks like the threads are generated by <code>libcurl</code>:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">[New Thread 0x7fff8ffff700 (LWP 28660)]</span>\n<span class=\"na\">^C</span>\n<span class=\"na\">Program received signal SIGINT, Interrupt.</span>\n<span class=\"na\">0x00007fffebba50e0 in XPending () from /usr/lib/x86_64-linux-gnu/libX11.so.6</span>\n<span class=\"na\">(gdb) thread apply all bt</span>\n</pre></div>\n\n\n<p>thread 28660</p>\n<div class=\"codehilite\"><pre><span></span>Thread 41 (Thread 0x7fff8ffff700 (LWP 28660)):\n#0  0x00007ffff6642fdd in poll () at ../sysdeps/unix/syscall-template.S:81\n#1  0x00007fffd7dd0214 in send_dg (ansp2_malloced=0x7fff8fffe430, resplen2=0x7fff8fffe420, anssizp2=0x7fff8fffe410, ansp2=0x7fff8fffe460, anscp=0x7fff8fffe450, gotsomewhere=&lt;synthetic pointer&gt;, v_circuit=&lt;synthetic pointer&gt;, ns=0, terrno=0x7fff8fffce60, anssizp=0x7fff8fffcfa0, ansp=0x7fff8fffce58, buflen2=31, buf2=0x7fff8fffcff0 &quot;b\\243\\001&quot;, buflen=31, buf=0x7fff8fffcfd0 &quot;\\200&quot;, statp=0x7fff8ffffdb8) at res_send.c:1206\n#2  __libc_res_nsend (statp=statp@entry=0x7fff8ffffdb8, buf=buf@entry=0x7fff8fffcfd0 &quot;\\200&quot;, buflen=31, buf2=buf2@entry=0x7fff8fffcff0 &quot;b\\243\\001&quot;, buflen2=buflen2@entry=31, ans=ans@entry=0x7fff8fffdbe0 &quot;b\\243\\201\\200&quot;, anssiz=anssiz@entry=2048, ansp=ansp@entry=0x7fff8fffe450, ansp2=ansp2@entry=0x7fff8fffe460, nansp2=nansp2@entry=0x7fff8fffe410, resplen2=resplen2@entry=0x7fff8fffe420, ansp2_malloced=ansp2_malloced@entry=0x7fff8fffe430) at res_send.c:576\n#3  0x00007fffd7dcde2c in __GI___libc_res_nquery (statp=statp@entry=0x7fff8ffffdb8, name=0x7fff5802d650 &quot;gazebosim.org&quot;, class=class@entry=1, type=type@entry=62321, answer=answer@entry=0x7fff8fffdbe0 &quot;b\\243\\201\\200&quot;, anslen=anslen@entry=2048, answerp=answerp@entry=0x7fff8fffe450, answerp2=answerp2@entry=0x7fff8fffe460, nanswerp2=nanswerp2@entry=0x7fff8fffe410, resplen2=resplen2@entry=0x7fff8fffe420, answerp2_malloced=answerp2_malloced@entry=0x7fff8fffe430) at res_query.c:227\n#4  0x00007fffd7dce863 in __libc_res_nquerydomain (domain=0x0, answerp2_malloced=0x7fff8fffe430, resplen2=0x7fff8fffe420, nanswerp2=0x7fff8fffe410, answerp2=0x7fff8fffe460, answerp=0x7fff8fffe450, anslen=2048, answer=0x7fff8fffdbe0 &quot;b\\243\\201\\200&quot;, type=62321, class=1, name=0x7fff5802d650 &quot;gazebosim.org&quot;, statp=0x7fff8ffffdb8) at res_query.c:591\n#5  __GI___libc_res_nsearch (statp=0x7fff8ffffdb8, name=name@entry=0x7fff5802d650 &quot;gazebosim.org&quot;, class=class@entry=1, type=type@entry=62321, answer=answer@entry=0x7fff8fffdbe0 &quot;b\\243\\201\\200&quot;, anslen=anslen@entry=2048, answerp=answerp@entry=0x7fff8fffe450, answerp2=answerp2@entry=0x7fff8fffe460, nanswerp2=nanswerp2@entry=0x7fff8fffe410, resplen2=resplen2@entry=0x7fff8fffe420, answerp2_malloced=answerp2_malloced@entry=0x7fff8fffe430) at res_query.c:381\n#6  0x00007fff8495ec73 in _nss_dns_gethostbyname4_r (name=name@entry=0x7fff5802d650 &quot;gazebosim.org&quot;, pat=pat@entry=0x7fff8fffeaa0, buffer=buffer@entry=0x7fff8fffe500 &quot;\\377\\002&quot;, buflen=buflen@entry=1064, errnop=errnop@entry=0x7fff8fffea70, herrnop=herrnop@entry=0x7fff8fffeac0, ttlp=ttlp@entry=0x0) at nss_dns/dns-host.c:315\n#7  0x00007ffff6622607 in gaih_inet (name=&lt;optimized out&gt;, name@entry=0x7fff5802d650 &quot;gazebosim.org&quot;, service=&lt;optimized out&gt;, req=req@entry=0x7fff5802db60, pai=pai@entry=0x7fff8fffebd0, naddrs=naddrs@entry=0x7fff8fffebc0) at ../sysdeps/posix/getaddrinfo.c:850\n#8  0x00007ffff6625cbd in __GI_getaddrinfo (name=0x7fff5802d650 &quot;gazebosim.org&quot;, service=0x7fff8fffed80 &quot;80&quot;, hints=0x7fff5802db60, pai=0x7fff8fffed38) at ../sysdeps/posix/getaddrinfo.c:2406\n#9  0x00007fffedfb4244 in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#10 0x00007fffedfc10f4 in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#11 0x00007fffedfbe99b in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#12 0x00007ffff1cbd184 in start_thread (arg=0x7fff8ffff700) at pthread_create.c:312\n#13 0x00007ffff665037d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n</pre></div>\n\n\n<p>libcurl was invoked by <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/ca2a71952a3823494afe2aafe9b6996c40e31539/gazebo/common/ModelDatabase.cc?fileviewer=file-view-default#ModelDatabase.cc-197\" rel=\"nofollow\">ModelDatabase.cc</a></p>\n<div class=\"codehilite\"><pre><span></span>Thread 2 (Thread 0x7fffd25d0700 (LWP 28620)):\n#0  0x00007ffff6642fdd in poll () at ../sysdeps/unix/syscall-template.S:81\n#1  0x00007fffedfb0bca in ?? () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#2  0x00007fffedfa4930 in curl_easy_perform () from /usr/lib/x86_64-linux-gnu/libcurl.so.4\n#3  0x00007ffff60e601b in gazebo::common::ModelDatabase::GetManifestImpl (this=this@entry=0x7ffff7dd5e80 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;, _uri=&quot;http://gazebosim.org/models/cart_soft_suspension/model.config&quot;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:209\n#4  0x00007ffff60e63d7 in gazebo::common::ModelDatabase::GetModelConfig (this=this@entry=0x7ffff7dd5e80 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;, _uri=&quot;http://gazebosim.org/models/cart_soft_suspension&quot;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:191\n#5  0x00007ffff60e650d in gazebo::common::ModelDatabase::GetModelName (this=this@entry=0x7ffff7dd5e80 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;, _uri=&quot;http://gazebosim.org/models/cart_soft_suspension&quot;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:368\n#6  0x00007ffff60e7703 in gazebo::common::ModelDatabase::UpdateModelCacheImpl (this=this@entry=0x7ffff7dd5e80 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:265\n#7  0x00007ffff60e7c66 in gazebo::common::ModelDatabase::UpdateModelCache (this=0x7ffff7dd5e80 &lt;SingletonT&lt;gazebo::common::ModelDatabase&gt;::GetInstance()::t&gt;, _fetchImmediately=false) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/ModelDatabase.cc:293\n#8  0x00007ffff1aaaa4a in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.54.0\n#9  0x00007ffff1cbd184 in start_thread (arg=0x7fffd25d0700) at pthread_create.c:312\n#10 0x00007ffff665037d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n</pre></div>", "type": "rendered"}, "created_on": "2016-07-20T23:07:33.576725+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 29335478}