{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2505/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2505.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2505/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2505/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2505/setaxis-implementation-incorrect-for-dart"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2505/vote"}}, "reporter": {"display_name": "Michael Grey", "uuid": "{c1cdfe52-2887-474c-ae99-72fdc53a59c9}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D"}, "html": {"href": "https://bitbucket.org/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:67759e29-d1df-465f-868d-047738e36fc9/d42d74cf-c1bd-4431-8288-07f543bbe325/128"}}, "nickname": "mxgrey", "type": "user", "account_id": "557058:67759e29-d1df-465f-868d-047738e36fc9"}, "title": "SetAxis implementation incorrect for DART", "component": null, "votes": 0, "watches": 2, "content": {"raw": "While trying to get a better understanding of the reference frame for joint axes in SDF, I noticed that the implementation of `SetAxis()` for `DARTHingeJoint` has a bug. Specifically, [this line](#!/osrf/gazebo/src/1561a52d5a7ca26980b3555800fe72c9038743c5/gazebo/physics/dart/DARTHingeJoint.cc#lines-120) shouldn't be in there. That transforms the joint axis into the parent link frame, but we just want it to be expressed in the frame that it's already in.\r\n\r\nIt seems this has gone unnoticed because that transform from the parent link frame is set to an identity matrix at the point in time that this function is called by the SDF loading routine, so it has no effect. However, if a user calls this function later, after the whole SDF has been loaded, then the axis will be set incorrectly if there's any relative rotation between the parent link and joint poses.\r\n\r\nI already have a fix and regression test written for this. I'm opening this issue so that I can tag the regression test with an issue number.", "markup": "markdown", "html": "<p>While trying to get a better understanding of the reference frame for joint axes in SDF, I noticed that the implementation of <code>SetAxis()</code> for <code>DARTHingeJoint</code> has a bug. Specifically, <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/1561a52d5a7ca26980b3555800fe72c9038743c5/gazebo/physics/dart/DARTHingeJoint.cc#lines-120\" rel=\"nofollow\">this line</a> shouldn't be in there. That transforms the joint axis into the parent link frame, but we just want it to be expressed in the frame that it's already in.</p>\n<p>It seems this has gone unnoticed because that transform from the parent link frame is set to an identity matrix at the point in time that this function is called by the SDF loading routine, so it has no effect. However, if a user calls this function later, after the whole SDF has been loaded, then the axis will be set incorrectly if there's any relative rotation between the parent link and joint poses.</p>\n<p>I already have a fix and regression test written for this. I'm opening this issue so that I can tag the regression test with an issue number.</p>", "type": "rendered"}, "assignee": {"display_name": "Michael Grey", "uuid": "{c1cdfe52-2887-474c-ae99-72fdc53a59c9}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D"}, "html": {"href": "https://bitbucket.org/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:67759e29-d1df-465f-868d-047738e36fc9/d42d74cf-c1bd-4431-8288-07f543bbe325/128"}}, "nickname": "mxgrey", "type": "user", "account_id": "557058:67759e29-d1df-465f-868d-047738e36fc9"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-08-07T10:02:08.152637+00:00", "milestone": null, "updated_on": "2018-12-10T18:54:37.061781+00:00", "type": "issue", "id": 2505}