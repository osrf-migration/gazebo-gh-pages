{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/821/comments/7533672.json"}, "html": {"href": "#!/osrf/gazebo/issues/821#comment-7533672"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/821.json"}}, "type": "issue", "id": 821, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Apparent transport race condition on startup"}, "content": {"raw": "I've added some console output to my overnight testing that indicates when message parsing fails:\n~~~\ndiff -r 56ef8eb1faaa gazebo/Master.cc\n--- a/gazebo/Master.cc\tTue Dec 17 19:02:34 2013 +0000\n+++ b/gazebo/Master.cc\tFri Dec 20 13:47:13 2013 -0800\n@@ -166,7 +166,13 @@\n   {\n     boost::recursive_mutex::scoped_lock lock(this->connectionMutex);\n     msgs::Publish pub;\n-    pub.ParseFromString(packet.serialized_data());\n+    if (!pub.ParseFromString(packet.serialized_data()))\n+    {\n+      gzerr << \"ParseFromString failed:\"\n+            << \" packet.type() \" << packet.type()\n+            << \" packet.serialized_data() \" << packet.serialized_data()\n+            << std::endl;\n+    }\n \n     Connection_M::iterator iter2;\n     for (iter2 = this->connections.begin();\n~~~\nOver the past few nights, I've noticed that there are many types of messages that can fail this way, which makes me think it's not related to a specific topic or message:\n\nFailing topics:\n~~~\n/gazebo/default/factory\n/gazebo/default/log/control\n/gazebo/default/pr2/head_tilt_link\n/gazebo/default/simple_gripper/joint_cmd\n/gazebo/default/world_control\n~~~\n\nThe list of failing message types is slightly attenuated because many of the messages are truncated:\n~~~\ngazebo.msgs.Factory\ngazebo.msgs.Joi\ngazebo.msgs.LogControl\ngazebo.msgs.WorldControl\n~~~\n\nSo I think these messages are getting truncated somewhere.", "markup": "markdown", "html": "<p>I've added some console output to my overnight testing that indicates when message parsing fails:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 56ef8eb1faaa gazebo/Master.cc</span>\n<span class=\"gd\">--- a/gazebo/Master.cc  Tue Dec 17 19:02:34 2013 +0000</span>\n<span class=\"gi\">+++ b/gazebo/Master.cc  Fri Dec 20 13:47:13 2013 -0800</span>\n<span class=\"gu\">@@ -166,7 +166,13 @@</span>\n   {\n     boost::recursive_mutex::scoped_lock lock(this-&gt;connectionMutex);\n     msgs::Publish pub;\n<span class=\"gd\">-    pub.ParseFromString(packet.serialized_data());</span>\n<span class=\"gi\">+    if (!pub.ParseFromString(packet.serialized_data()))</span>\n<span class=\"gi\">+    {</span>\n<span class=\"gi\">+      gzerr &lt;&lt; &quot;ParseFromString failed:&quot;</span>\n<span class=\"gi\">+            &lt;&lt; &quot; packet.type() &quot; &lt;&lt; packet.type()</span>\n<span class=\"gi\">+            &lt;&lt; &quot; packet.serialized_data() &quot; &lt;&lt; packet.serialized_data()</span>\n<span class=\"gi\">+            &lt;&lt; std::endl;</span>\n<span class=\"gi\">+    }</span>\n\n     Connection_M::iterator iter2;\n     for (iter2 = this-&gt;connections.begin();\n</pre></div>\n\n\n<p>Over the past few nights, I've noticed that there are many types of messages that can fail this way, which makes me think it's not related to a specific topic or message:</p>\n<p>Failing topics:</p>\n<div class=\"codehilite\"><pre><span></span>/gazebo/default/factory\n/gazebo/default/log/control\n/gazebo/default/pr2/head_tilt_link\n/gazebo/default/simple_gripper/joint_cmd\n/gazebo/default/world_control\n</pre></div>\n\n\n<p>The list of failing message types is slightly attenuated because many of the messages are truncated:</p>\n<div class=\"codehilite\"><pre><span></span>gazebo.msgs.Factory\ngazebo.msgs.Joi\ngazebo.msgs.LogControl\ngazebo.msgs.WorldControl\n</pre></div>\n\n\n<p>So I think these messages are getting truncated somewhere.</p>", "type": "rendered"}, "created_on": "2013-12-30T19:37:12.551867+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 7533672}