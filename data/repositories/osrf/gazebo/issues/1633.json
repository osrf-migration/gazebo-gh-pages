{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/1633/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/1633.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1633/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/1633/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/1633/seg-fault-in-teardown-of"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1633/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "seg-fault in teardown of UNIT_RenderWidget_TEST", "component": {"name": "gui", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122878.json"}}}, "votes": 0, "watches": 2, "content": {"raw": "I'm seeing a seg-fault in `UNIT_RenderWidget_TEST` when I run it on my desktop. The seg-fault emits from the destructor of `OriginVisual` added in pull request #1700. Note that the tests pass, it's just that it seg-faults during teardown.\r\n\r\n~~~\r\nPASS   : RenderWidget_TEST::InsertWidget()\r\nPASS   : RenderWidget_TEST::cleanupTestCase()\r\nTotals: 3 passed, 0 failed, 0 skipped\r\n********* Finished testing of RenderWidget_TEST *********\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x00007ffff1142a49 in Ogre::VertexData::~VertexData() ()\r\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.8.1\r\n~~~\r\n~~~\r\n(gdb) bt\r\n#0  0x00007ffff1142a49 in Ogre::VertexData::~VertexData() ()\r\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.8.1\r\n#1  0x00007ffff52e4c83 in gazebo::rendering::DynamicRenderable::~DynamicRenderable (\r\n    this=0x7fff7ffde1e0, __in_chrg=<optimized out>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/DynamicRenderable.cc:33\r\n#2  0x00007ffff52e39c9 in gazebo::rendering::DynamicLines::~DynamicLines (this=0x7fff7ffde1e0, \r\n    __in_chrg=<optimized out>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/DynamicLines.cc:47\r\n#3  0x00007ffff535d62c in gazebo::rendering::Visual::DeleteDynamicLine (this=<optimized out>, \r\n    _line=<optimized out>) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Visual.cc:1808\r\n#4  0x00007ffff5312137 in gazebo::rendering::OriginVisual::~OriginVisual (this=0x7fff8ca54e40, \r\n    __in_chrg=<optimized out>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/OriginVisual.cc:39\r\n~~~\r\n~~~\r\n#5  0x00007ffff5312179 in gazebo::rendering::OriginVisual::~OriginVisual (this=0x7fff8ca54e40, \r\n    __in_chrg=<optimized out>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/OriginVisual.cc:42\r\n#6  0x00007ffff52b47be in boost::detail::sp_counted_base::release (this=0x7fff8e7318a0)\r\n    at /usr/include/boost/smart_ptr/detail/sp_counted_base_gcc_x86.hpp:146\r\n#7  0x00007ffff534a7b8 in ~shared_count (this=0x7fff8c99f910, __in_chrg=<optimized out>)\r\n    at /usr/include/boost/smart_ptr/detail/shared_count.hpp:371\r\n#8  ~shared_ptr (this=0x7fff8c99f908, __in_chrg=<optimized out>)\r\n    at /usr/include/boost/smart_ptr/shared_ptr.hpp:328\r\n~~~\r\n~~~\r\n#9  gazebo::rendering::ScenePrivate::~ScenePrivate (this=0x7fff8c99f620, __in_chrg=<optimized out>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/ScenePrivate.hh:116\r\n#10 0x00007ffff53314b1 in gazebo::rendering::Scene::~Scene (this=0x7fff8caf3f70, \r\n    __in_chrg=<optimized out>) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:266\r\n#11 0x00007ffff5331529 in gazebo::rendering::Scene::~Scene (this=0x7fff8caf3f70, \r\n    __in_chrg=<optimized out>) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:268\r\n#12 0x00007ffff6eb8b7e in boost::detail::sp_counted_base::release (this=0x7fff8cb077d0)\r\n    at /usr/include/boost/smart_ptr/detail/sp_counted_base_gcc_x86.hpp:146\r\n~~~\r\n~~~\r\n#13 0x00007ffff6f211fc in ~shared_count (this=<optimized out>, __in_chrg=<optimized out>)\r\n    at /usr/include/boost/smart_ptr/detail/shared_count.hpp:371\r\n#14 ~shared_ptr (this=<optimized out>, __in_chrg=<optimized out>)\r\n    at /usr/include/boost/smart_ptr/shared_ptr.hpp:328\r\n#15 reset (this=<optimized out>) at /usr/include/boost/smart_ptr/shared_ptr.hpp:619\r\n#16 gazebo::gui::ModelManipulator::Clear (\r\n    this=this@entry=0x7ffff7548070 <SingletonT<gazebo::gui::ModelManipulator>::GetInstance()::t>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/gui/ModelManipulator.cc:69\r\n~~~\r\n~~~\r\n#17 0x00007ffff6f22c60 in gazebo::gui::ModelManipulator::~ModelManipulator (\r\n    this=0x7ffff7548070 <SingletonT<gazebo::gui::ModelManipulator>::GetInstance()::t>, \r\n    __in_chrg=<optimized out>)\r\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/gui/ModelManipulator.cc:57\r\n#18 0x00007ffff42c5259 in __run_exit_handlers (status=0, listp=0x7ffff46476c8 <__exit_funcs>, \r\n    run_list_atexit=run_list_atexit@entry=true) at exit.c:82\r\n#19 0x00007ffff42c52a5 in __GI_exit (status=<optimized out>) at exit.c:104\r\n#20 0x00007ffff42aaecc in __libc_start_main (main=0x407370 <main(int, char**)>, argc=1, \r\n    argv=0x7fffffffdc68, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, \r\n    stack_end=0x7fffffffdc58) at libc-start.c:321\r\n#21 0x0000000000407d6f in _start ()\r\n(gdb)\r\n~~~", "markup": "markdown", "html": "<p>I'm seeing a seg-fault in <code>UNIT_RenderWidget_TEST</code> when I run it on my desktop. The seg-fault emits from the destructor of <code>OriginVisual</code> added in <a href=\"#!/osrf/gazebo/pull-requests/1700/add-world-origin-indicator\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #1700</a>. Note that the tests pass, it's just that it seg-faults during teardown.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">PASS</span>   <span class=\"o\">:</span> <span class=\"n\">RenderWidget_TEST</span><span class=\"o\">::</span><span class=\"n\">InsertWidget</span><span class=\"o\">()</span>\n<span class=\"n\">PASS</span>   <span class=\"o\">:</span> <span class=\"n\">RenderWidget_TEST</span><span class=\"o\">::</span><span class=\"n\">cleanupTestCase</span><span class=\"o\">()</span>\n<span class=\"n\">Totals</span><span class=\"o\">:</span> <span class=\"mi\">3</span> <span class=\"n\">passed</span><span class=\"o\">,</span> <span class=\"mi\">0</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"mi\">0</span> <span class=\"n\">skipped</span>\n<span class=\"o\">*********</span> <span class=\"n\">Finished</span> <span class=\"n\">testing</span> <span class=\"n\">of</span> <span class=\"n\">RenderWidget_TEST</span> <span class=\"o\">*********</span>\n\n<span class=\"n\">Program</span> <span class=\"n\">received</span> <span class=\"n\">signal</span> <span class=\"n\">SIGSEGV</span><span class=\"o\">,</span> <span class=\"n\">Segmentation</span> <span class=\"n\">fault</span><span class=\"o\">.</span>\n<span class=\"mh\">0x00007ffff1142a49</span> <span class=\"k\">in</span> <span class=\"n\">Ogre</span><span class=\"o\">::</span><span class=\"n\">VertexData</span><span class=\"o\">::~</span><span class=\"n\">VertexData</span><span class=\"o\">()</span> <span class=\"o\">()</span>\n   <span class=\"n\">from</span> <span class=\"sr\">/usr/lib/x86_64-linux-gnu/</span><span class=\"n\">libOgreMain</span><span class=\"o\">.</span><span class=\"na\">so</span><span class=\"o\">.</span><span class=\"mf\">1.8</span><span class=\"o\">.</span><span class=\"mi\">1</span>\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>(gdb) bt\n#0  0x00007ffff1142a49 in Ogre::VertexData::~VertexData() ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.8.1\n#1  0x00007ffff52e4c83 in gazebo::rendering::DynamicRenderable::~DynamicRenderable (\n    this=0x7fff7ffde1e0, __in_chrg=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/DynamicRenderable.cc:33\n#2  0x00007ffff52e39c9 in gazebo::rendering::DynamicLines::~DynamicLines (this=0x7fff7ffde1e0, \n    __in_chrg=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/DynamicLines.cc:47\n#3  0x00007ffff535d62c in gazebo::rendering::Visual::DeleteDynamicLine (this=&lt;optimized out&gt;, \n    _line=&lt;optimized out&gt;) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Visual.cc:1808\n#4  0x00007ffff5312137 in gazebo::rendering::OriginVisual::~OriginVisual (this=0x7fff8ca54e40, \n    __in_chrg=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/OriginVisual.cc:39\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>#5  0x00007ffff5312179 in gazebo::rendering::OriginVisual::~OriginVisual (this=0x7fff8ca54e40, \n    __in_chrg=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/OriginVisual.cc:42\n#6  0x00007ffff52b47be in boost::detail::sp_counted_base::release (this=0x7fff8e7318a0)\n    at /usr/include/boost/smart_ptr/detail/sp_counted_base_gcc_x86.hpp:146\n#7  0x00007ffff534a7b8 in ~shared_count (this=0x7fff8c99f910, __in_chrg=&lt;optimized out&gt;)\n    at /usr/include/boost/smart_ptr/detail/shared_count.hpp:371\n#8  ~shared_ptr (this=0x7fff8c99f908, __in_chrg=&lt;optimized out&gt;)\n    at /usr/include/boost/smart_ptr/shared_ptr.hpp:328\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>#9  gazebo::rendering::ScenePrivate::~ScenePrivate (this=0x7fff8c99f620, __in_chrg=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/ScenePrivate.hh:116\n#10 0x00007ffff53314b1 in gazebo::rendering::Scene::~Scene (this=0x7fff8caf3f70, \n    __in_chrg=&lt;optimized out&gt;) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:266\n#11 0x00007ffff5331529 in gazebo::rendering::Scene::~Scene (this=0x7fff8caf3f70, \n    __in_chrg=&lt;optimized out&gt;) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:268\n#12 0x00007ffff6eb8b7e in boost::detail::sp_counted_base::release (this=0x7fff8cb077d0)\n    at /usr/include/boost/smart_ptr/detail/sp_counted_base_gcc_x86.hpp:146\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>#13 0x00007ffff6f211fc in ~shared_count (this=&lt;optimized out&gt;, __in_chrg=&lt;optimized out&gt;)\n    at /usr/include/boost/smart_ptr/detail/shared_count.hpp:371\n#14 ~shared_ptr (this=&lt;optimized out&gt;, __in_chrg=&lt;optimized out&gt;)\n    at /usr/include/boost/smart_ptr/shared_ptr.hpp:328\n#15 reset (this=&lt;optimized out&gt;) at /usr/include/boost/smart_ptr/shared_ptr.hpp:619\n#16 gazebo::gui::ModelManipulator::Clear (\n    this=this@entry=0x7ffff7548070 &lt;SingletonT&lt;gazebo::gui::ModelManipulator&gt;::GetInstance()::t&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/gui/ModelManipulator.cc:69\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>#17 0x00007ffff6f22c60 in gazebo::gui::ModelManipulator::~ModelManipulator (\n    this=0x7ffff7548070 &lt;SingletonT&lt;gazebo::gui::ModelManipulator&gt;::GetInstance()::t&gt;, \n    __in_chrg=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/gui/ModelManipulator.cc:57\n#18 0x00007ffff42c5259 in __run_exit_handlers (status=0, listp=0x7ffff46476c8 &lt;__exit_funcs&gt;, \n    run_list_atexit=run_list_atexit@entry=true) at exit.c:82\n#19 0x00007ffff42c52a5 in __GI_exit (status=&lt;optimized out&gt;) at exit.c:104\n#20 0x00007ffff42aaecc in __libc_start_main (main=0x407370 &lt;main(int, char**)&gt;, argc=1, \n    argv=0x7fffffffdc68, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;, \n    stack_end=0x7fffffffdc58) at libc-start.c:321\n#21 0x0000000000407d6f in _start ()\n(gdb)\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "closed", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2015-06-10T23:05:20.369406+00:00", "milestone": null, "updated_on": "2016-09-14T19:44:14.425641+00:00", "type": "issue", "id": 1633}