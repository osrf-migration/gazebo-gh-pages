{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2401/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2401.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2401/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2401/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2401/not-working-correctly-in-combination-with"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2401/vote"}}, "reporter": {"display_name": "Andreas Bihlmaier", "uuid": "{5937f01e-6c0d-4cfd-b8d2-6276f312c74c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5937f01e-6c0d-4cfd-b8d2-6276f312c74c%7D"}, "html": {"href": "https://bitbucket.org/%7B5937f01e-6c0d-4cfd-b8d2-6276f312c74c%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/0a70ca141ff43b3d9385a1823f4c265ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsAB-3.png"}}, "nickname": "andreasBihlmaier", "type": "user", "account_id": "557058:32bae45c-b312-4f18-8f77-d15bd9d6f68b"}, "title": "<joint> <axis> not working correctly in combination with <include> inside <model> (nested model) in sdf >= 1.5 unless old behaviour (sdf <= 1.4) is restored via <use_parent_model_frame>", "component": null, "votes": 3, "watches": 4, "content": {"raw": "Hi everyone,\r\n\r\nI found an issue regarding the \"new\" (SDF >= 1.5) behavior of <joint><axis> in combination with <include>:\r\nThe axis of all models that are <include>d with a <pose> are wrong. To be more precise, it appears that they do not take the <include><pose> into account and thus turn up wrong with respect to all other coordinate systems in the <include>d model.\r\nThe issue is easily reproducible in Gazebo 7 and 8. A minimal example follows (and is attached) together with three screenshots that show the issue using the \"Demo Joint Types\" model from the online repository. \r\nAs there is simply a coordinate transform missing *somewhere*, I'd estimate someone more familiar with this part of the Gazebo code base, will be able to quickly fix it. I would highly appreciate it.\r\n\r\n```\r\n#!xml\r\n\r\n<?xml version=\"1.0\" ?>\r\n<sdf version=\"1.6\">\r\n  <model name=\"broken_joint_axis_include_demo\">\r\n\r\n    <include>\r\n      <uri>model://demo_joint_types</uri>\r\n      <name>model1</name>\r\n    </include>\r\n\r\n    <include>\r\n      <uri>model://demo_joint_types</uri>\r\n      <name>model2</name>\r\n      <pose>\r\n        2 0 0\r\n        0 0 1.57079 \r\n      </pose>\r\n    </include>\r\n\r\n    <joint name=\"rd_drive_torque_to_beer_joint\" type=\"fixed\">\r\n      <parent>model1::heavy_base</parent>\r\n      <child>model2::heavy_base</child>\r\n    </joint>\r\n    \r\n  </model>\r\n</sdf>\r\n```\r\n\r\nThe combined model:\r\n![gazebo_joint_axis_include_bug01.png](data/bitbucket.org/repo/jgXqbo/images/1879317020-gazebo_joint_axis_include_bug01.png)\r\n\r\nCorrect <joint><axis>:\r\n![gazebo_joint_axis_include_bug03.png](data/bitbucket.org/repo/jgXqbo/images/642108975-gazebo_joint_axis_include_bug03.png)\r\n\r\nWrong <joint><axis> in <include>d model:\r\n![gazebo_joint_axis_include_bug02.png](data/bitbucket.org/repo/jgXqbo/images/1071516660-gazebo_joint_axis_include_bug02.png)\r\n\r\nNote: Everything works if all joints in the <include>d model use <use_parent_model_frame>1</use_parent_model_frame>, but then we are back at the non-intuitive way <axis> is defined (to model instead of child frame).", "markup": "markdown", "html": "<p>Hi everyone,</p>\n<p>I found an issue regarding the \"new\" (SDF &gt;= 1.5) behavior of &lt;joint&gt;&lt;axis&gt; in combination with &lt;include&gt;:\nThe axis of all models that are &lt;include&gt;d with a &lt;pose&gt; are wrong. To be more precise, it appears that they do not take the &lt;include&gt;&lt;pose&gt; into account and thus turn up wrong with respect to all other coordinate systems in the &lt;include&gt;d model.\nThe issue is easily reproducible in Gazebo 7 and 8. A minimal example follows (and is attached) together with three screenshots that show the issue using the \"Demo Joint Types\" model from the online repository. \nAs there is simply a coordinate transform missing <em>somewhere</em>, I'd estimate someone more familiar with this part of the Gazebo code base, will be able to quickly fix it. I would highly appreciate it.</p>\n<div class=\"codehilite language-xml\"><pre><span></span><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>\n<span class=\"nt\">&lt;sdf</span> <span class=\"na\">version=</span><span class=\"s\">&quot;1.6&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;model</span> <span class=\"na\">name=</span><span class=\"s\">&quot;broken_joint_axis_include_demo&quot;</span><span class=\"nt\">&gt;</span>\n\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://demo_joint_types<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;name&gt;</span>model1<span class=\"nt\">&lt;/name&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://demo_joint_types<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;name&gt;</span>model2<span class=\"nt\">&lt;/name&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>\n        2 0 0\n        0 0 1.57079 \n      <span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n\n    <span class=\"nt\">&lt;joint</span> <span class=\"na\">name=</span><span class=\"s\">&quot;rd_drive_torque_to_beer_joint&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;fixed&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;parent&gt;</span>model1::heavy_base<span class=\"nt\">&lt;/parent&gt;</span>\n      <span class=\"nt\">&lt;child&gt;</span>model2::heavy_base<span class=\"nt\">&lt;/child&gt;</span>\n    <span class=\"nt\">&lt;/joint&gt;</span>\n\n  <span class=\"nt\">&lt;/model&gt;</span>\n<span class=\"nt\">&lt;/sdf&gt;</span>\n</pre></div>\n\n\n<p>The combined model:\n<img alt=\"gazebo_joint_axis_include_bug01.png\" src=\"data/bitbucket.org/repo/jgXqbo/images/1879317020-gazebo_joint_axis_include_bug01.png\" /></p>\n<p>Correct &lt;joint&gt;&lt;axis&gt;:\n<img alt=\"gazebo_joint_axis_include_bug03.png\" src=\"data/bitbucket.org/repo/jgXqbo/images/642108975-gazebo_joint_axis_include_bug03.png\" /></p>\n<p>Wrong &lt;joint&gt;&lt;axis&gt; in &lt;include&gt;d model:\n<img alt=\"gazebo_joint_axis_include_bug02.png\" src=\"data/bitbucket.org/repo/jgXqbo/images/1071516660-gazebo_joint_axis_include_bug02.png\" /></p>\n<p>Note: Everything works if all joints in the &lt;include&gt;d model use &lt;use_parent_model_frame&gt;1&lt;/use_parent_model_frame&gt;, but then we are back at the non-intuitive way &lt;axis&gt; is defined (to model instead of child frame).</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2018-01-16T14:31:43.702174+00:00", "milestone": null, "updated_on": "2018-09-24T16:24:50.679803+00:00", "type": "issue", "id": 2401}