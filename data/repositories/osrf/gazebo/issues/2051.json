{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2051/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2051.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2051/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2051/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2051/visual-messages-with-transparency-cause"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2051/vote"}}, "reporter": {"display_name": "Frederik Zwilling", "uuid": "{02119825-8bf1-496d-a327-a8a7668aea92}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B02119825-8bf1-496d-a327-a8a7668aea92%7D"}, "html": {"href": "https://bitbucket.org/%7B02119825-8bf1-496d-a327-a8a7668aea92%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2dcaec112e85b3bdb5f95ed22e70c5d8d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsFZ-5.png"}}, "nickname": "fzwilling", "type": "user", "account_id": "557058:ec43b86d-6bae-41bd-adb1-f32f2c710be5"}, "title": "Visual messages with transparency cause huge FPS drop after upgrade to Gazebo 7", "component": {"name": "rendering", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122881.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "Hi, we recently upgraded from Gazebo  5.1 to 7.3 and had major problems with the FPS in gzclient dropping to 2 FPS while using the same models and plugins which worked fine in 5.1.\r\n\r\nBy creating a minimal  breaking example, I found that  the problem is caused by Visual messages with a set transparency value in a populated world.\r\n\r\nIn the attachment and below you can find my minimal breaking example. It consists of a world of similar complexity to my application in the [RoboCup Logistics League](https://youtu.be/cccDF0nhsE8) and a plugin creating a blinking light with Visual messages.\r\n\r\nWith Gazebo 7 this runs at 8 FPS.\r\nBy commenting the line that sets the transparency of the visual msg or downgrading to Gazebo 5.1, this runs above 26 FPS.\r\n\r\nI already created a workaround for our application by omitting using transparency, but I think this is a bug you want to fix.\r\n\r\n(I am using an Intel Core i7-3770 CPU @ 3.40GHz \u00d7 8 and an Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor Graphics Controller with Fedora 23.\r\n)\r\n\r\nWorld file:\r\n\r\n```\r\n#!sdf\r\n\r\n<?xml version=\"1.0\" ?>\r\n<sdf version=\"1.4\">\r\n  <world name=\"RCLL\">\r\n    <gui>\r\n      <camera name=\"user camera\">\r\n\t<pose>1 -2 9.5 0 1.1 1.56</pose>\r\n      </camera>\r\n    </gui>\r\n    <physics type=\"ode\">\r\n      <max_step_size>0.004</max_step_size>\r\n      <real_time_factor>1</real_time_factor>\r\n      <real_time_update_rate>300</real_time_update_rate>\r\n    </physics>\r\n    <scene>\r\n      <shadows>0</shadows>\r\n    </scene>\r\n    <include>\r\n      <uri>model://ground_plane</uri>\r\n    </include>\r\n    <include>\r\n      <uri>model://sun</uri>\r\n    </include>\r\n\r\n    <!-- Added some models to reach a similar complexity -->\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>0 1 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>0 2 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>1 1 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>1 2 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>2 1 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>2 2 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>3 1 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>3 2 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>4 1 0.2 0 0 0</pose>\r\n    </include>\r\n    <include>\r\n      <uri>model://youbot</uri>\r\n      <pose>4 2 0.2 0 0 0</pose>\r\n    </include>\r\n\r\n    <!-- this plugin causes the FPS drop -->\r\n    <plugin name=\"breaking_plugin\" filename=\"libbreaking_plugin.so\" />\r\n  </world>\r\n</sdf>\r\n\r\n```\r\n\r\nPlugin:\r\n\r\n```\r\n#!c++\r\n\r\n#include <gazebo/gazebo.hh>\r\n#include <gazebo/physics/physics.hh>\r\n#include <gazebo/common/common.hh>\r\n#include <gazebo/transport/transport.hh>\r\n\r\nusing namespace gazebo;\r\n\r\nclass LightControl : public WorldPlugin\r\n{\r\npublic:\r\n  LightControl(){};\r\n  ~LightControl(){};\r\n\r\n  virtual void Load(physics::WorldPtr _world, sdf::ElementPtr _sdf)\r\n  {\r\n    world_ = _world;\r\n    update_connection_ = event::Events::ConnectWorldUpdateBegin(boost::bind(&LightControl::OnUpdate, this, _1));\r\n    node_ = transport::NodePtr(new transport::Node());\r\n    node_->Init(world_->GetName());\r\n    visPub_ = this->node_->Advertise<msgs::Visual>(\"~/visual\", /*max number of lights*/ 3*12);\r\n    last_sent_time_ = world_->GetSimTime().Double();\r\n  }\r\n  \r\n  virtual void OnUpdate(const common::UpdateInfo &)\r\n  {\r\n    double time = world_->GetSimTime().Double();    \r\n    if(time - last_sent_time_ < 0.1)\r\n      return;\r\n    last_sent_time_ = time;\r\n\r\n    state_on = !state_on;\r\n\r\n    msgs::Visual msg;\r\n    \r\n    //////////// this line costs ~20 FPS in Gazbeo 7\r\n    msg.set_transparency(0.0);\r\n    ///////////\r\n    \r\n    msgs::Geometry *geomMsg = msg.mutable_geometry();\r\n    geomMsg->set_type(msgs::Geometry::CYLINDER);\r\n    geomMsg->mutable_cylinder()->set_radius(0.05);\r\n    geomMsg->mutable_cylinder()->set_length(0.1);\r\n    msg.set_cast_shadows(false);\r\n    msg.set_parent_name(\"light::link\");\r\n    msg.set_name(\"light::link::redon\");\r\n#if GAZEBO_MAJOR_VERSION > 5\r\n    msgs::Set(msg.mutable_pose(), ignition::math::Pose3d(1, 0, 0.085, 0, 0, 0));\r\n#else\r\n    msgs::Set(msg.mutable_pose(), math::Pose(1, 0, 0.085, 0, 0, 0));\r\n#endif\r\n    msgs::Set(msg.mutable_material()->mutable_diffuse(), common::Color(0.8, 0, 0, 0.8));\r\n    msgs::Set(msg.mutable_material()->mutable_emissive(), common::Color(1.0, 0.3, 0.3, 1.0));\r\n    if(state_on)\r\n      msg.set_visible(true);\r\n    else\r\n      msg.set_visible(false);\r\n    visPub_->Publish(msg);\r\n  }\r\n\r\nprivate:\r\n  physics::WorldPtr world_;\r\n  event::ConnectionPtr update_connection_;\r\n  transport::NodePtr node_;\r\n  transport::PublisherPtr visPub_;\r\n  double last_sent_time_;\r\n  bool state_on = true;\r\n};\r\n\r\nGZ_REGISTER_WORLD_PLUGIN(LightControl)\r\n\r\n```\r\n\r\n", "markup": "markdown", "html": "<p>Hi, we recently upgraded from Gazebo  5.1 to 7.3 and had major problems with the FPS in gzclient dropping to 2 FPS while using the same models and plugins which worked fine in 5.1.</p>\n<p>By creating a minimal  breaking example, I found that  the problem is caused by Visual messages with a set transparency value in a populated world.</p>\n<p>In the attachment and below you can find my minimal breaking example. It consists of a world of similar complexity to my application in the <a data-is-external-link=\"true\" href=\"https://youtu.be/cccDF0nhsE8\" rel=\"nofollow\">RoboCup Logistics League</a> and a plugin creating a blinking light with Visual messages.</p>\n<p>With Gazebo 7 this runs at 8 FPS.\nBy commenting the line that sets the transparency of the visual msg or downgrading to Gazebo 5.1, this runs above 26 FPS.</p>\n<p>I already created a workaround for our application by omitting using transparency, but I think this is a bug you want to fix.</p>\n<p>(I am using an Intel Core i7-3770 CPU @ 3.40GHz \u00d7 8 and an Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor Graphics Controller with Fedora 23.\n)</p>\n<p>World file:</p>\n<div class=\"codehilite language-sdf\"><pre><span></span><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>\n<span class=\"nt\">&lt;sdf</span> <span class=\"na\">version=</span><span class=\"s\">&quot;1.4&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;world</span> <span class=\"na\">name=</span><span class=\"s\">&quot;RCLL&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;gui&gt;</span>\n      <span class=\"nt\">&lt;camera</span> <span class=\"na\">name=</span><span class=\"s\">&quot;user camera&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;pose&gt;</span>1 -2 9.5 0 1.1 1.56<span class=\"nt\">&lt;/pose&gt;</span>\n      <span class=\"nt\">&lt;/camera&gt;</span>\n    <span class=\"nt\">&lt;/gui&gt;</span>\n    <span class=\"nt\">&lt;physics</span> <span class=\"na\">type=</span><span class=\"s\">&quot;ode&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;max_step_size&gt;</span>0.004<span class=\"nt\">&lt;/max_step_size&gt;</span>\n      <span class=\"nt\">&lt;real_time_factor&gt;</span>1<span class=\"nt\">&lt;/real_time_factor&gt;</span>\n      <span class=\"nt\">&lt;real_time_update_rate&gt;</span>300<span class=\"nt\">&lt;/real_time_update_rate&gt;</span>\n    <span class=\"nt\">&lt;/physics&gt;</span>\n    <span class=\"nt\">&lt;scene&gt;</span>\n      <span class=\"nt\">&lt;shadows&gt;</span>0<span class=\"nt\">&lt;/shadows&gt;</span>\n    <span class=\"nt\">&lt;/scene&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://ground_plane<span class=\"nt\">&lt;/uri&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://sun<span class=\"nt\">&lt;/uri&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n\n    <span class=\"c\">&lt;!-- Added some models to reach a similar complexity --&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>0 1 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>0 2 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>1 1 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>1 2 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>2 1 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>2 2 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>3 1 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>3 2 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>4 1 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n    <span class=\"nt\">&lt;include&gt;</span>\n      <span class=\"nt\">&lt;uri&gt;</span>model://youbot<span class=\"nt\">&lt;/uri&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span>4 2 0.2 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;/include&gt;</span>\n\n    <span class=\"c\">&lt;!-- this plugin causes the FPS drop --&gt;</span>\n    <span class=\"nt\">&lt;plugin</span> <span class=\"na\">name=</span><span class=\"s\">&quot;breaking_plugin&quot;</span> <span class=\"na\">filename=</span><span class=\"s\">&quot;libbreaking_plugin.so&quot;</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/world&gt;</span>\n<span class=\"nt\">&lt;/sdf&gt;</span>\n</pre></div>\n\n\n<p>Plugin:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/gazebo.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/physics/physics.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/common/common.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/transport/transport.hh&gt;</span><span class=\"cp\"></span>\n\n<span class=\"k\">using</span> <span class=\"k\">namespace</span> <span class=\"n\">gazebo</span><span class=\"p\">;</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">LightControl</span> <span class=\"o\">:</span> <span class=\"k\">public</span> <span class=\"n\">WorldPlugin</span>\n<span class=\"p\">{</span>\n<span class=\"k\">public</span><span class=\"o\">:</span>\n  <span class=\"n\">LightControl</span><span class=\"p\">(){};</span>\n  <span class=\"o\">~</span><span class=\"n\">LightControl</span><span class=\"p\">(){};</span>\n\n  <span class=\"k\">virtual</span> <span class=\"kt\">void</span> <span class=\"nf\">Load</span><span class=\"p\">(</span><span class=\"n\">physics</span><span class=\"o\">::</span><span class=\"n\">WorldPtr</span> <span class=\"n\">_world</span><span class=\"p\">,</span> <span class=\"n\">sdf</span><span class=\"o\">::</span><span class=\"n\">ElementPtr</span> <span class=\"n\">_sdf</span><span class=\"p\">)</span>\n  <span class=\"p\">{</span>\n    <span class=\"n\">world_</span> <span class=\"o\">=</span> <span class=\"n\">_world</span><span class=\"p\">;</span>\n    <span class=\"n\">update_connection_</span> <span class=\"o\">=</span> <span class=\"n\">event</span><span class=\"o\">::</span><span class=\"n\">Events</span><span class=\"o\">::</span><span class=\"n\">ConnectWorldUpdateBegin</span><span class=\"p\">(</span><span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">bind</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">LightControl</span><span class=\"o\">::</span><span class=\"n\">OnUpdate</span><span class=\"p\">,</span> <span class=\"k\">this</span><span class=\"p\">,</span> <span class=\"n\">_1</span><span class=\"p\">));</span>\n    <span class=\"n\">node_</span> <span class=\"o\">=</span> <span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">NodePtr</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">Node</span><span class=\"p\">());</span>\n    <span class=\"n\">node_</span><span class=\"o\">-&gt;</span><span class=\"n\">Init</span><span class=\"p\">(</span><span class=\"n\">world_</span><span class=\"o\">-&gt;</span><span class=\"n\">GetName</span><span class=\"p\">());</span>\n    <span class=\"n\">visPub_</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">node_</span><span class=\"o\">-&gt;</span><span class=\"n\">Advertise</span><span class=\"o\">&lt;</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Visual</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;~/visual&quot;</span><span class=\"p\">,</span> <span class=\"cm\">/*max number of lights*/</span> <span class=\"mi\">3</span><span class=\"o\">*</span><span class=\"mi\">12</span><span class=\"p\">);</span>\n    <span class=\"n\">last_sent_time_</span> <span class=\"o\">=</span> <span class=\"n\">world_</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSimTime</span><span class=\"p\">().</span><span class=\"n\">Double</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">virtual</span> <span class=\"kt\">void</span> <span class=\"nf\">OnUpdate</span><span class=\"p\">(</span><span class=\"k\">const</span> <span class=\"n\">common</span><span class=\"o\">::</span><span class=\"n\">UpdateInfo</span> <span class=\"o\">&amp;</span><span class=\"p\">)</span>\n  <span class=\"p\">{</span>\n    <span class=\"kt\">double</span> <span class=\"n\">time</span> <span class=\"o\">=</span> <span class=\"n\">world_</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSimTime</span><span class=\"p\">().</span><span class=\"n\">Double</span><span class=\"p\">();</span>    \n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">time</span> <span class=\"o\">-</span> <span class=\"n\">last_sent_time_</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.1</span><span class=\"p\">)</span>\n      <span class=\"k\">return</span><span class=\"p\">;</span>\n    <span class=\"n\">last_sent_time_</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"p\">;</span>\n\n    <span class=\"n\">state_on</span> <span class=\"o\">=</span> <span class=\"o\">!</span><span class=\"n\">state_on</span><span class=\"p\">;</span>\n\n    <span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Visual</span> <span class=\"n\">msg</span><span class=\"p\">;</span>\n\n    <span class=\"c1\">//////////// this line costs ~20 FPS in Gazbeo 7</span>\n    <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">set_transparency</span><span class=\"p\">(</span><span class=\"mf\">0.0</span><span class=\"p\">);</span>\n    <span class=\"c1\">///////////</span>\n\n    <span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Geometry</span> <span class=\"o\">*</span><span class=\"n\">geomMsg</span> <span class=\"o\">=</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">mutable_geometry</span><span class=\"p\">();</span>\n    <span class=\"n\">geomMsg</span><span class=\"o\">-&gt;</span><span class=\"n\">set_type</span><span class=\"p\">(</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Geometry</span><span class=\"o\">::</span><span class=\"n\">CYLINDER</span><span class=\"p\">);</span>\n    <span class=\"n\">geomMsg</span><span class=\"o\">-&gt;</span><span class=\"n\">mutable_cylinder</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">set_radius</span><span class=\"p\">(</span><span class=\"mf\">0.05</span><span class=\"p\">);</span>\n    <span class=\"n\">geomMsg</span><span class=\"o\">-&gt;</span><span class=\"n\">mutable_cylinder</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">set_length</span><span class=\"p\">(</span><span class=\"mf\">0.1</span><span class=\"p\">);</span>\n    <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">set_cast_shadows</span><span class=\"p\">(</span><span class=\"nb\">false</span><span class=\"p\">);</span>\n    <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">set_parent_name</span><span class=\"p\">(</span><span class=\"s\">&quot;light::link&quot;</span><span class=\"p\">);</span>\n    <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">set_name</span><span class=\"p\">(</span><span class=\"s\">&quot;light::link::redon&quot;</span><span class=\"p\">);</span>\n<span class=\"cp\">#if GAZEBO_MAJOR_VERSION &gt; 5</span>\n    <span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Set</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">mutable_pose</span><span class=\"p\">(),</span> <span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">math</span><span class=\"o\">::</span><span class=\"n\">Pose3d</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mf\">0.085</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">));</span>\n<span class=\"cp\">#else</span>\n    <span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Set</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">mutable_pose</span><span class=\"p\">(),</span> <span class=\"n\">math</span><span class=\"o\">::</span><span class=\"n\">Pose</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mf\">0.085</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">));</span>\n<span class=\"cp\">#endif</span>\n    <span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Set</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">mutable_material</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">mutable_diffuse</span><span class=\"p\">(),</span> <span class=\"n\">common</span><span class=\"o\">::</span><span class=\"n\">Color</span><span class=\"p\">(</span><span class=\"mf\">0.8</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mf\">0.8</span><span class=\"p\">));</span>\n    <span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Set</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">mutable_material</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"n\">mutable_emissive</span><span class=\"p\">(),</span> <span class=\"n\">common</span><span class=\"o\">::</span><span class=\"n\">Color</span><span class=\"p\">(</span><span class=\"mf\">1.0</span><span class=\"p\">,</span> <span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">1.0</span><span class=\"p\">));</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"n\">state_on</span><span class=\"p\">)</span>\n      <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">set_visible</span><span class=\"p\">(</span><span class=\"nb\">true</span><span class=\"p\">);</span>\n    <span class=\"k\">else</span>\n      <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"n\">set_visible</span><span class=\"p\">(</span><span class=\"nb\">false</span><span class=\"p\">);</span>\n    <span class=\"n\">visPub_</span><span class=\"o\">-&gt;</span><span class=\"n\">Publish</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n<span class=\"k\">private</span><span class=\"o\">:</span>\n  <span class=\"n\">physics</span><span class=\"o\">::</span><span class=\"n\">WorldPtr</span> <span class=\"n\">world_</span><span class=\"p\">;</span>\n  <span class=\"n\">event</span><span class=\"o\">::</span><span class=\"n\">ConnectionPtr</span> <span class=\"n\">update_connection_</span><span class=\"p\">;</span>\n  <span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">NodePtr</span> <span class=\"n\">node_</span><span class=\"p\">;</span>\n  <span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">PublisherPtr</span> <span class=\"n\">visPub_</span><span class=\"p\">;</span>\n  <span class=\"kt\">double</span> <span class=\"n\">last_sent_time_</span><span class=\"p\">;</span>\n  <span class=\"kt\">bool</span> <span class=\"n\">state_on</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>\n<span class=\"p\">};</span>\n\n<span class=\"n\">GZ_REGISTER_WORLD_PLUGIN</span><span class=\"p\">(</span><span class=\"n\">LightControl</span><span class=\"p\">)</span>\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "6.0", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/170782.json"}}}, "edited_on": null, "created_on": "2016-09-22T15:29:48.606775+00:00", "milestone": null, "updated_on": "2016-09-22T15:34:49.002769+00:00", "type": "issue", "id": 2051}