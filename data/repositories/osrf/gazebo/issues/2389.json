{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2389/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2389.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2389/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2389/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2389/linkstate-stores-angular-velocities-as"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2389/vote"}}, "reporter": {"display_name": "Guillaume Matheron", "uuid": "{9f1a587b-5c72-4b03-8500-98e10add803c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9f1a587b-5c72-4b03-8500-98e10add803c%7D"}, "html": {"href": "https://bitbucket.org/%7B9f1a587b-5c72-4b03-8500-98e10add803c%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/8679bdeb68cdd7bae460e81a1ca902c1d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsGM-5.png"}}, "nickname": "gmatheron", "type": "user", "account_id": "557058:eda51b76-248d-479e-a278-05fe26e7876b"}, "title": "LinkState stores angular velocities as Quaternions, so they overflow when higher than pi rad/s", "component": {"name": "physics", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122876.json"}}}, "votes": 2, "watches": 4, "content": {"raw": "In gazebo/physics/LinkState.cc, this code stores angular velocities in a Quaternion. If the velocity is more than pi rad/s, it overflows back to -pi rad/s.\r\n\r\n\r\n```\r\n#!undefined\r\n\r\nthis->velocity = math::Pose(_link->GetWorldLinearVel(),\r\n                   math::Quaternion(_link->GetWorldAngularVel()));\r\n```\r\n\r\nA minimal example is attached.\r\n\r\nTo use it, build the module using cmake, then run the attached sdf file with gazebo. Each second, the world is saved and immediately restored.\r\n\r\nIn gazebo, apply a torque to the object, until its angular velocity reaches pi rad/s. The object will change rotation direction as the angular velocity is mapped back to -pi rad/s in WorldState.\r\n\r\nThis was tested using gazebo7\r\n\r\n\r\nFrom the module output :\r\nState restored to <state world_name='default'>...<model name='minimal'>...<link name='link'><pose>...</pose><velocity>0 0 0 3.017 -0 0 </velocity></link></model></state>\r\nState restored to <state world_name='default'>...<model name='minimal'>...<link name='link'><pose>...</pose><velocity>0 0 0 -2.966 -0 0 </velocity></link></model></state>", "markup": "markdown", "html": "<p>In gazebo/physics/LinkState.cc, this code stores angular velocities in a Quaternion. If the velocity is more than pi rad/s, it overflows back to -pi rad/s.</p>\n<div class=\"codehilite language-undefined\"><pre><span></span><span class=\"nt\">this-</span><span class=\"o\">&gt;</span><span class=\"nt\">velocity</span> <span class=\"o\">=</span> <span class=\"nt\">math</span><span class=\"p\">::</span><span class=\"nd\">Pose</span><span class=\"o\">(</span><span class=\"nt\">_link-</span><span class=\"o\">&gt;</span><span class=\"nt\">GetWorldLinearVel</span><span class=\"o\">(),</span>\n                   <span class=\"nt\">math</span><span class=\"p\">::</span><span class=\"nd\">Quaternion</span><span class=\"o\">(</span><span class=\"nt\">_link-</span><span class=\"o\">&gt;</span><span class=\"nt\">GetWorldAngularVel</span><span class=\"o\">()));</span>\n</pre></div>\n\n\n<p>A minimal example is attached.</p>\n<p>To use it, build the module using cmake, then run the attached sdf file with gazebo. Each second, the world is saved and immediately restored.</p>\n<p>In gazebo, apply a torque to the object, until its angular velocity reaches pi rad/s. The object will change rotation direction as the angular velocity is mapped back to -pi rad/s in WorldState.</p>\n<p>This was tested using gazebo7</p>\n<p>From the module output :\nState restored to &lt;state world_name='default'&gt;...&lt;model name='minimal'&gt;...&lt;link name='link'&gt;&lt;pose&gt;...&lt;/pose&gt;&lt;velocity&gt;0 0 0 3.017 -0 0 &lt;/velocity&gt;&lt;/link&gt;&lt;/model&gt;&lt;/state&gt;\nState restored to &lt;state world_name='default'&gt;...&lt;model name='minimal'&gt;...&lt;link name='link'&gt;&lt;pose&gt;...&lt;/pose&gt;&lt;velocity&gt;0 0 0 -2.966 -0 0 &lt;/velocity&gt;&lt;/link&gt;&lt;/model&gt;&lt;/state&gt;</p>", "type": "rendered"}, "assignee": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "state": "new", "version": {"name": "7.0", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/242744.json"}}}, "edited_on": null, "created_on": "2017-12-14T15:48:43.161521+00:00", "milestone": null, "updated_on": "2018-03-12T02:34:50.597646+00:00", "type": "issue", "id": 2389}