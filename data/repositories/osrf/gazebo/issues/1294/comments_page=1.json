{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12878000.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12878000"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "That sounds good to me. If you know the magnetic field orientation at your test site, you can just specify it in the tag that you propose.\n\nA more complicated alternative would be to try to compute the magnetic field based on the [spherical_coordinates](https://bitbucket.org/osrf/sdformat/src/b1ef111a9e01a187051604b4b08fd1867785ee8b/sdf/1.5/spherical_coordinates.sdf?at=default) values. This would require a planetary magnetic field model.\n\nOr we could make a flag so you could choose between a model-based magnetic field and a manual override.\n~~~\n<physics>\n   <magnetic_field type=\"manual\">0.10 0.7 0.1</magnetic_field>\n</physics>\n~~~\n~~~\n<physics>\n   <magnetic_field type=\"model\">0 0 0</magnetic_field>\n</physics>\n~~~", "markup": "markdown", "html": "<p>That sounds good to me. If you know the magnetic field orientation at your test site, you can just specify it in the tag that you propose.</p>\n<p>A more complicated alternative would be to try to compute the magnetic field based on the <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/sdformat/src/b1ef111a9e01a187051604b4b08fd1867785ee8b/sdf/1.5/spherical_coordinates.sdf?at=default\" rel=\"nofollow\">spherical_coordinates</a> values. This would require a planetary magnetic field model.</p>\n<p>Or we could make a flag so you could choose between a model-based magnetic field and a manual override.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;physics&gt;</span>\n   <span class=\"nt\">&lt;magnetic_field</span> <span class=\"na\">type=</span><span class=\"s\">&quot;manual&quot;</span><span class=\"nt\">&gt;</span>0.10 0.7 0.1<span class=\"nt\">&lt;/magnetic_field&gt;</span>\n<span class=\"nt\">&lt;/physics&gt;</span>\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;physics&gt;</span>\n   <span class=\"nt\">&lt;magnetic_field</span> <span class=\"na\">type=</span><span class=\"s\">&quot;model&quot;</span><span class=\"nt\">&gt;</span>0 0 0<span class=\"nt\">&lt;/magnetic_field&gt;</span>\n<span class=\"nt\">&lt;/physics&gt;</span>\n</pre></div>", "type": "rendered"}, "created_on": "2014-10-09T17:25:56.146313+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 12878000}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12878047.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12878047"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Cool idea. Is there a source for magnetic field data?\n\nWe should place the `<magnetic>` tag as a child of `<world>`, similar to `<spherical_coordinates>`.", "markup": "markdown", "html": "<p>Cool idea. Is there a source for magnetic field data?</p>\n<p>We should place the <code>&lt;magnetic&gt;</code> tag as a child of <code>&lt;world&gt;</code>, similar to <code>&lt;spherical_coordinates&gt;</code>.</p>", "type": "rendered"}, "created_on": "2014-10-09T17:28:58.314454+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": null, "type": "issue_comment", "id": 12878047}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12878183.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12878183"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Google led me to the following:\n\n* [Summary of several models from NOAA](http://www.ngdc.noaa.gov/geomag/models.shtml)\n* [International Geomagnetic Reference Field](http://www.ngdc.noaa.gov/IAGA/vmod/igrf.html), also here's a [scientific paper documenting the model](http://digitalcommons.unl.edu/cgi/viewcontent.cgi?article=1260&context=usdeptcommercepub)", "markup": "markdown", "html": "<p>Google led me to the following:</p>\n<ul>\n<li><a data-is-external-link=\"true\" href=\"http://www.ngdc.noaa.gov/geomag/models.shtml\" rel=\"nofollow\">Summary of several models from NOAA</a></li>\n<li><a data-is-external-link=\"true\" href=\"http://www.ngdc.noaa.gov/IAGA/vmod/igrf.html\" rel=\"nofollow\">International Geomagnetic Reference Field</a>, also here's a <a data-is-external-link=\"true\" href=\"http://digitalcommons.unl.edu/cgi/viewcontent.cgi?article=1260&amp;context=usdeptcommercepub\" rel=\"nofollow\">scientific paper documenting the model</a></li>\n</ul>", "type": "rendered"}, "created_on": "2014-10-09T17:39:13.275522+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2014-10-09T17:42:35.919493+00:00", "type": "issue_comment", "id": 12878183}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12878971.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12878971"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "For CRATES I  have been using the world Magnetic and Geographical models from GeographicLib:\nhttps://bitbucket.org/asymingt/crates/src/ae976a3786cdf5a16cd30c663a7ac3d40b21b841/src/sim/src/plugins/world/Environment.cpp?at=master\n\nMy (clunky) solution was to attach a plugin to the world, siphon off the origin spherical coordinates / simulation time and broadcast realistic gravitational and magnetic vectors on the gazbeo transport. There's probably a neater way to do this, though. \n\nI am reluctant to suggest that we go for this degree of realism as the default Gazebo behaviour, because it would also introduce more dependencies and large geoid / parameter files. I think we should rather keep its behaviour along the same lines as gravity, and the more complex stuff can be added as a sensor plugin. \n\nI've forked gazebo master, and I'm coding up what I think is a nice way of doing things. I'll send through a pull request in the next couple of days. ", "markup": "markdown", "html": "<p>For CRATES I  have been using the world Magnetic and Geographical models from GeographicLib:\n<a href=\"https://bitbucket.org/asymingt/crates/src/ae976a3786cdf5a16cd30c663a7ac3d40b21b841/src/sim/src/plugins/world/Environment.cpp?at=master\" rel=\"nofollow\" class=\"ap-connect-link\">https://bitbucket.org/asymingt/crates/src/ae976a3786cdf5a16cd30c663a7ac3d40b21b841/src/sim/src/plugins/world/Environment.cpp?at=master</a></p>\n<p>My (clunky) solution was to attach a plugin to the world, siphon off the origin spherical coordinates / simulation time and broadcast realistic gravitational and magnetic vectors on the gazbeo transport. There's probably a neater way to do this, though. </p>\n<p>I am reluctant to suggest that we go for this degree of realism as the default Gazebo behaviour, because it would also introduce more dependencies and large geoid / parameter files. I think we should rather keep its behaviour along the same lines as gravity, and the more complex stuff can be added as a sensor plugin. </p>\n<p>I've forked gazebo master, and I'm coding up what I think is a nice way of doing things. I'll send through a pull request in the next couple of days. </p>", "type": "rendered"}, "created_on": "2014-10-09T18:23:06.101122+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": "2014-10-09T18:23:38.463056+00:00", "type": "issue_comment", "id": 12878971}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12879081.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12879081"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Also, as a side note, the World Magnetic Model (WMM) seems to be the go-to model for UAV flight control systems:\nhttp://www.ngdc.noaa.gov/geomag/WMM/calculators.shtml\n\nAlthough gravity changes a bit (mostly by latitude because of the shape of the earth) its variation can be easily accounted for by simple calibration procedures when the multicopter is stationary on the ground. As far as I know, the same cannot be done for the magnetic field.", "markup": "markdown", "html": "<p>Also, as a side note, the World Magnetic Model (WMM) seems to be the go-to model for UAV flight control systems:\n<a href=\"http://www.ngdc.noaa.gov/geomag/WMM/calculators.shtml\" rel=\"nofollow\" class=\"ap-connect-link\">http://www.ngdc.noaa.gov/geomag/WMM/calculators.shtml</a></p>\n<p>Although gravity changes a bit (mostly by latitude because of the shape of the earth) its variation can be easily accounted for by simple calibration procedures when the multicopter is stationary on the ground. As far as I know, the same cannot be done for the magnetic field.</p>", "type": "rendered"}, "created_on": "2014-10-09T18:30:18.521305+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": null, "type": "issue_comment", "id": 12879081}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12881226.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12881226"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "That's a good point about dependencies and complexity. I think we could make `<magnetic_field>` a child of `<world>` and use a plugin from a separate package to provide the WMM model. Thanks!", "markup": "markdown", "html": "<p>That's a good point about dependencies and complexity. I think we could make <code>&lt;magnetic_field&gt;</code> a child of <code>&lt;world&gt;</code> and use a plugin from a separate package to provide the WMM model. Thanks!</p>", "type": "rendered"}, "created_on": "2014-10-09T20:48:05.187367+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 12881226}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12883165.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12883165"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Yes, my initial idea was to treat the magnetic field in a similar way to gravity; although, I expect you want to create the sdf element relative to the world tag, rather than the physics tag. Here's my work in progress (!), which seeks to provide basic magnetometer and altimeter support. The code compiles but is untested. \nhttps://bitbucket.org/asymingt/gazebo/commits/3c7f6fb82194727c3f6597e5cb6623128ee583af\n\nAs you can probably tell, much of the code was lifted from the ImuSensor.cc code.", "markup": "markdown", "html": "<p>Yes, my initial idea was to treat the magnetic field in a similar way to gravity; although, I expect you want to create the sdf element relative to the world tag, rather than the physics tag. Here's my work in progress (!), which seeks to provide basic magnetometer and altimeter support. The code compiles but is untested. \n<a href=\"https://bitbucket.org/asymingt/gazebo/commits/3c7f6fb82194727c3f6597e5cb6623128ee583af\" rel=\"nofollow\" class=\"ap-connect-link\">https://bitbucket.org/asymingt/gazebo/commits/3c7f6fb82194727c3f6597e5cb6623128ee583af</a></p>\n<p>As you can probably tell, much of the code was lifted from the ImuSensor.cc code.</p>", "type": "rendered"}, "created_on": "2014-10-09T23:54:01.676196+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": "2014-10-09T23:55:24.074552+00:00", "type": "issue_comment", "id": 12883165}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12888275.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12888275"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Probably slightly unrelated, but as a user that simulates an IMU that provides in a single sensors a 3-axis accelerometer, a 3-axis gyroscope and a 3-axis magnetometer I would love the option of having the magnetometer reading available from the existing ImuSensor (just an option, because not all the IMUs are equipped with magnetometers).\n\nOn the other hand, it would also be useful to have separate accelerometers and gyroscope sensors (similarly to the proposed magnetometer sensor), as not all the available sensors of this kind are packed into an IMU. [1] This is a bit of a design rebus, for which I currently don't have a solution. \n\n\n[1] Some examples of standalone accelerometer on real robots :\n\n * PR2 gripper accelerometer https://github.com/PR2/pr2_simulator/issues/85\n\n * CellulARskin taxel with embedded accelerometer http://www.cellularskin.eu/specifications.html\n\n", "markup": "markdown", "html": "<p>Probably slightly unrelated, but as a user that simulates an IMU that provides in a single sensors a 3-axis accelerometer, a 3-axis gyroscope and a 3-axis magnetometer I would love the option of having the magnetometer reading available from the existing ImuSensor (just an option, because not all the IMUs are equipped with magnetometers).</p>\n<p>On the other hand, it would also be useful to have separate accelerometers and gyroscope sensors (similarly to the proposed magnetometer sensor), as not all the available sensors of this kind are packed into an IMU. [1] This is a bit of a design rebus, for which I currently don't have a solution. </p>\n<p>[1] Some examples of standalone accelerometer on real robots :</p>\n<ul>\n<li>\n<p>PR2 gripper accelerometer <a href=\"https://github.com/PR2/pr2_simulator/issues/85\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/PR2/pr2_simulator/issues/85</a></p>\n</li>\n<li>\n<p>CellulARskin taxel with embedded accelerometer <a href=\"http://www.cellularskin.eu/specifications.html\" rel=\"nofollow\" class=\"ap-connect-link\">http://www.cellularskin.eu/specifications.html</a></p>\n</li>\n</ul>", "type": "rendered"}, "created_on": "2014-10-10T08:20:02.214102+00:00", "user": {"display_name": "Silvio Traversaro", "uuid": "{34f404cb-5642-4f27-a032-e04c7143d776}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B34f404cb-5642-4f27-a032-e04c7143d776%7D"}, "html": {"href": "https://bitbucket.org/%7B34f404cb-5642-4f27-a032-e04c7143d776%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:e1c3e6a0-9a64-4e5f-a668-feebc191c5b6/578caaa1-056c-45a2-8bf9-bee94c3bebef/128"}}, "nickname": "traversaro", "type": "user", "account_id": "557058:e1c3e6a0-9a64-4e5f-a668-feebc191c5b6"}, "updated_on": null, "type": "issue_comment", "id": 12888275}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12930937.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12930937"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "I agree with Silvio. However, strictly speaking, a magnetometer shouldn't fall under the category 'inertial', as it measures only extrinsic forces, whereas IMUs measure intrinsic forces. Collectively, I believe a magnetometer and IMU are bundled into a motion processing unit (MPU), which provides derived values like orientation.\n\nAs Silvio mentioned, there are often cases -- particularly when energy is  constrained -- where a standalone accelerometer is used. I guess what I am saying, is that IMUs and MPUs are metasensor packages, with magnetometers, gyroscopes and accelerometers being the actual sensors.\n\nAgain, maybe a bit pedantic. But, it may be useful to make design decisions that give rise to a logical division between a base sensor and sensor bundles.", "markup": "markdown", "html": "<p>I agree with Silvio. However, strictly speaking, a magnetometer shouldn't fall under the category 'inertial', as it measures only extrinsic forces, whereas IMUs measure intrinsic forces. Collectively, I believe a magnetometer and IMU are bundled into a motion processing unit (MPU), which provides derived values like orientation.</p>\n<p>As Silvio mentioned, there are often cases -- particularly when energy is  constrained -- where a standalone accelerometer is used. I guess what I am saying, is that IMUs and MPUs are metasensor packages, with magnetometers, gyroscopes and accelerometers being the actual sensors.</p>\n<p>Again, maybe a bit pedantic. But, it may be useful to make design decisions that give rise to a logical division between a base sensor and sensor bundles.</p>", "type": "rendered"}, "created_on": "2014-10-13T10:17:17.354361+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": "2014-10-13T10:18:04.370058+00:00", "type": "issue_comment", "id": 12930937}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12933905.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12933905"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "+1 for finding a proper terminology for distinguish between IMU and IMU + magnetometer. \n\nIn XSens documentation [1][2] I found they use the Attitude Heading Reference System (AHRS) term for IMU + magnetometer. Unfortunately I found it used in other contexts also for referring to simple IMUs, or even referring to units with an integrated GPS. Perhaps there is a relevant standard for this definitions? \n\n\n[1] : http://www.xsens.com/tags/imu/\n\n[2] : http://www.xsens.com/tags/ahrs/", "markup": "markdown", "html": "<p>+1 for finding a proper terminology for distinguish between IMU and IMU + magnetometer. </p>\n<p>In XSens documentation [1][2] I found they use the Attitude Heading Reference System (AHRS) term for IMU + magnetometer. Unfortunately I found it used in other contexts also for referring to simple IMUs, or even referring to units with an integrated GPS. Perhaps there is a relevant standard for this definitions? </p>\n<p>[1] : <a href=\"http://www.xsens.com/tags/imu/\" rel=\"nofollow\" class=\"ap-connect-link\">http://www.xsens.com/tags/imu/</a></p>\n<p>[2] : <a href=\"http://www.xsens.com/tags/ahrs/\" rel=\"nofollow\" class=\"ap-connect-link\">http://www.xsens.com/tags/ahrs/</a></p>", "type": "rendered"}, "created_on": "2014-10-13T12:42:46.374552+00:00", "user": {"display_name": "Silvio Traversaro", "uuid": "{34f404cb-5642-4f27-a032-e04c7143d776}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B34f404cb-5642-4f27-a032-e04c7143d776%7D"}, "html": {"href": "https://bitbucket.org/%7B34f404cb-5642-4f27-a032-e04c7143d776%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:e1c3e6a0-9a64-4e5f-a668-feebc191c5b6/578caaa1-056c-45a2-8bf9-bee94c3bebef/128"}}, "nickname": "traversaro", "type": "user", "account_id": "557058:e1c3e6a0-9a64-4e5f-a668-feebc191c5b6"}, "updated_on": "2014-10-13T12:43:13.216929+00:00", "type": "issue_comment", "id": 12933905}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/12935833.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-12935833"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "An AHRS is a system (sensors + motion processing algorithm) for calculating orientation, normally in the context of flight. I would be reluctant to call the IMU + magnetometer combination an AHRS, because that's only one of the many potential uses of an IMU+MAG combination. For example, a 6DoF kinematic tracking filter goes one more step and integrates specific force (linear acceleration - gravity) through orientation to obtain displacement. Other uses of a IMU+MARG include pedometry, activity detection, vibration monitoring, etc. \n\nDespite the fact that MARG is more frequently used in the literature, I'd be more in favour of MPU, because -- like IMU -- the \"unit\" suffix suggests that the device is an aggregation of sensors. \n\nOne last thing to think about is whether we even need to aggregate sensors into these units. In addition to perhaps being slightly simpler to add, the only distinct advantage that I can see with bundling sensors into these units is the ability to write a SensorPlugin that synthetically generates correlated error perturbations. \n\nThis invites an even larger discussion about how spatiotemporal (integral to GNSS performance), temperature (sometimes integral to IMU) and pressure (integral to altimeters) correlated errors should be dealt with in Gazebo. Although, this should probably all go into a different issue on the tracker.", "markup": "markdown", "html": "<p>An AHRS is a system (sensors + motion processing algorithm) for calculating orientation, normally in the context of flight. I would be reluctant to call the IMU + magnetometer combination an AHRS, because that's only one of the many potential uses of an IMU+MAG combination. For example, a 6DoF kinematic tracking filter goes one more step and integrates specific force (linear acceleration - gravity) through orientation to obtain displacement. Other uses of a IMU+MARG include pedometry, activity detection, vibration monitoring, etc. </p>\n<p>Despite the fact that MARG is more frequently used in the literature, I'd be more in favour of MPU, because -- like IMU -- the \"unit\" suffix suggests that the device is an aggregation of sensors. </p>\n<p>One last thing to think about is whether we even need to aggregate sensors into these units. In addition to perhaps being slightly simpler to add, the only distinct advantage that I can see with bundling sensors into these units is the ability to write a SensorPlugin that synthetically generates correlated error perturbations. </p>\n<p>This invites an even larger discussion about how spatiotemporal (integral to GNSS performance), temperature (sometimes integral to IMU) and pressure (integral to altimeters) correlated errors should be dealt with in Gazebo. Although, this should probably all go into a different issue on the tracker.</p>", "type": "rendered"}, "created_on": "2014-10-13T14:07:28.705994+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": "2014-10-13T14:08:23.512037+00:00", "type": "issue_comment", "id": 12935833}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13024135.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13024135"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Another thought I had with this concerns ROS integration. There is a widely-used ```sensor_msgs``` package in ROS, which provides common sensor message structures. This package defines separate IMU and MagneticField messages, and it would be in Gazebo's interest to keep the same mapping. It's a bit of a hack, but one could use negative covariance matrix diagonals to indicate the absence of data, zeros when the data is error-free/deterministic, and positive when the statistic is available. The equivalent IMU message on Gazebo's protobuffer transport doesn't yet include covariances, although Gaussian noise perturbations are offered.", "markup": "markdown", "html": "<p>Another thought I had with this concerns ROS integration. There is a widely-used <code>sensor_msgs</code> package in ROS, which provides common sensor message structures. This package defines separate IMU and MagneticField messages, and it would be in Gazebo's interest to keep the same mapping. It's a bit of a hack, but one could use negative covariance matrix diagonals to indicate the absence of data, zeros when the data is error-free/deterministic, and positive when the statistic is available. The equivalent IMU message on Gazebo's protobuffer transport doesn't yet include covariances, although Gaussian noise perturbations are offered.</p>", "type": "rendered"}, "created_on": "2014-10-16T14:06:59.183363+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": null, "type": "issue_comment", "id": 13024135}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13024449.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13024449"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "@scpeters, jumping back to the original magnetometer idea...\n\nI think we should keep things simple from the outset. In a similar way to how gravity is dealt with, lets assume that the robots will all experience the same magnetic field, because they are operating over short baselines. This will avoid us needing a world magnetic model, and yet another third party library. I therefore don't think there's the need to declare a manual attribute just quite yet.\n\nSo, we'd have this markup in the world:\n\n```xml\n<physics>\n   <magnetic_field>0.10 0.7 0.1</magnetic_field>\n</physics>\n```\n\n... and this markup in the model...\n\n```xml\n<sensor name=\"HMC5843\" type=\"magnetometer\">\n  <pose>0.01 0 0.03 0 -0 0</pose>\n  <magnetometer>\n    <noise>\n      <type>gaussian</type>\n      <mean>0.0</mean>\n      <stddev>0.01</stddev>\n    </noise>\n  </magnetometer>\n</sensor>\n```\n\nThe sensor would work in much the same way as how gravity influences an IMU accelerometer. The global magnetic vector should be rotated into the body frame, using the orientation of the sensor.\n\nAre you cool with this? If so, are you able to action it, or should I?", "markup": "markdown", "html": "<p>@scpeters, jumping back to the original magnetometer idea...</p>\n<p>I think we should keep things simple from the outset. In a similar way to how gravity is dealt with, lets assume that the robots will all experience the same magnetic field, because they are operating over short baselines. This will avoid us needing a world magnetic model, and yet another third party library. I therefore don't think there's the need to declare a manual attribute just quite yet.</p>\n<p>So, we'd have this markup in the world:</p>\n<div class=\"codehilite language-xml\"><pre><span></span><span class=\"nt\">&lt;physics&gt;</span>\n   <span class=\"nt\">&lt;magnetic_field&gt;</span>0.10 0.7 0.1<span class=\"nt\">&lt;/magnetic_field&gt;</span>\n<span class=\"nt\">&lt;/physics&gt;</span>\n</pre></div>\n\n\n<p>... and this markup in the model...</p>\n<div class=\"codehilite language-xml\"><pre><span></span><span class=\"nt\">&lt;sensor</span> <span class=\"na\">name=</span><span class=\"s\">&quot;HMC5843&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;magnetometer&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;pose&gt;</span>0.01 0 0.03 0 -0 0<span class=\"nt\">&lt;/pose&gt;</span>\n  <span class=\"nt\">&lt;magnetometer&gt;</span>\n    <span class=\"nt\">&lt;noise&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>gaussian<span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;mean&gt;</span>0.0<span class=\"nt\">&lt;/mean&gt;</span>\n      <span class=\"nt\">&lt;stddev&gt;</span>0.01<span class=\"nt\">&lt;/stddev&gt;</span>\n    <span class=\"nt\">&lt;/noise&gt;</span>\n  <span class=\"nt\">&lt;/magnetometer&gt;</span>\n<span class=\"nt\">&lt;/sensor&gt;</span>\n</pre></div>\n\n\n<p>The sensor would work in much the same way as how gravity influences an IMU accelerometer. The global magnetic vector should be rotated into the body frame, using the orientation of the sensor.</p>\n<p>Are you cool with this? If so, are you able to action it, or should I?</p>", "type": "rendered"}, "created_on": "2014-10-16T14:18:24.965005+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": "2014-10-16T14:19:11.448391+00:00", "type": "issue_comment", "id": 13024449}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13028988.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13028988"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "That looks fine to me. I'm a little swamped right now, so I would be much more able to review a pull request than to submit one of my own. :)\n\nOne thing to think about is what the default value of the `magnetic_field` should be. I assume it shouldn't be `0 0 0`.", "markup": "markdown", "html": "<p>That looks fine to me. I'm a little swamped right now, so I would be much more able to review a pull request than to submit one of my own. :)</p>\n<p>One thing to think about is what the default value of the <code>magnetic_field</code> should be. I assume it shouldn't be <code>0 0 0</code>.</p>", "type": "rendered"}, "created_on": "2014-10-16T17:01:32.548727+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 13028988}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13049582.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13049582"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "For simplicity, I think the unit vector should be ```0 1 0``` (adopting the RHS coordinate system ENU). This makes the bold assumption that true and magnetic north are aligned, which is actually not the case. One exception to this general rule is that if a nonzero heading R is specified in ```<spherical_coordinates>```, then the magnetic field vector should be rotated by -R about the Z axis. I believe the SI unit for magnetism is the Tesla, but because of the unit magnitude, microTeslas may be more useful.\n\nGiven that the earth's magnetic field is approximately 50 microtesla (http://hypertextbook.com/facts/1999/DanielleCaruso.shtml) one of the following two initial values are probably OK.\n\nFor microtesla: ```0 50 0```\n\nFor Tesla: ```0 0.00005 0```", "markup": "markdown", "html": "<p>For simplicity, I think the unit vector should be <code>0 1 0</code> (adopting the RHS coordinate system ENU). This makes the bold assumption that true and magnetic north are aligned, which is actually not the case. One exception to this general rule is that if a nonzero heading R is specified in <code>&lt;spherical_coordinates&gt;</code>, then the magnetic field vector should be rotated by -R about the Z axis. I believe the SI unit for magnetism is the Tesla, but because of the unit magnitude, microTeslas may be more useful.</p>\n<p>Given that the earth's magnetic field is approximately 50 microtesla (<a href=\"http://hypertextbook.com/facts/1999/DanielleCaruso.shtml\" rel=\"nofollow\" class=\"ap-connect-link\">http://hypertextbook.com/facts/1999/DanielleCaruso.shtml</a>) one of the following two initial values are probably OK.</p>\n<p>For microtesla: <code>0 50 0</code></p>\n<p>For Tesla: <code>0 0.00005 0</code></p>", "type": "rendered"}, "created_on": "2014-10-17T13:17:57.657966+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": null, "type": "issue_comment", "id": 13049582}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13068692.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13068692"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Just for the record: [hector_gazebo_plugins](http://wiki.ros.org/hector_gazebo_plugins#GazeboRosMagnetic) provides a 3D magnetic field sensor simulation as a ROS plugin since 2012. We use it successfully for our quadrotor simulation based on Gazebo: [hector_quadrotor](http://wiki.ros.org/hector_quadrotor).\n\nIt should be noted that the magnetic field is not at all parallel to the earth surface except near the equator. The [magnetic inclination](http://en.wikipedia.org/wiki/Magnetic_dip) is about 60 degrees in Europe and in the US and grows to 90 degrees when coming closer to the poles. So the vertical component is even larger than the horizontal one. The angle between true and magnetic north is called [declination](http://en.wikipedia.org/wiki/Magnetic_declination).\n\n`GazeboRosMagnetic` in hector_gazebo_plugins has the declination, inclination and magnitude as plugin parameters and uses them to calculate the earth fixed magnetic field vector. I would propose to make these three parameters properties of the world instead of the vector itself as they are easier to lookup in the web or at least it is easier to assign reasonable default values. I usually use the [NOAA magnetic field calculator](http://www.ngdc.noaa.gov/geomag-web/) based on their World Magnetic Model (WMM2010).\n\nWith respect to terminology the term IMU is often misused for what should be an AHRS in the robotics community. Originally (in the navigation community) an \"**IMU**\" (Inertial *Measurement* Unit) is nothing more than a  sensor unit consisting of a (3-axis) gyroscope and a (3-axis) accelerometer and measures angular rates and accelerations (including gravity) in the body frame. With high-grade gyroscopes the angular rate signals can be integrated to a relative orientation, but the MEMS sensors that are affordable and commonly used in robotics applications have too much noise and drift and pure integration would be useless. If combined with an estimator that fuses angular rates and accelerations such a device is called an \"**ARS**\" (Attitude Reference System) or \"**IRS**\" (Inertial Reference System) that outputs the roll and pitch angle. Only with an additional magnetic field sensor the absolute yaw angle is also observable, making the ARS an \"**AHRS**\" (Attitude and Heading Reference System). The acronym \"**MARG**\" (Magnetic, Angular Rate, and Gravity) is used for the sensor array within an AHRS. Last but not least, if the system also integrates the measured accelerations and outputs velocities or even position it is usually called an \"**INS**\" (Inertial Navigation System). Again, with MEMS sensors pure integration without external aiding (e.g. by GNSS) would be useless as the error would grow too fast. These definitions can be found in many text books about the topic and also at the [Xsens web page](https://www.xsens.com/tags/ahrs/).\n\nTo come back to the original topic of this issue: A magnetic field sensor is an independent sensor and should not be integrated in the IMU sensor plugin.", "markup": "markdown", "html": "<p>Just for the record: <a data-is-external-link=\"true\" href=\"http://wiki.ros.org/hector_gazebo_plugins#GazeboRosMagnetic\" rel=\"nofollow\">hector_gazebo_plugins</a> provides a 3D magnetic field sensor simulation as a ROS plugin since 2012. We use it successfully for our quadrotor simulation based on Gazebo: <a data-is-external-link=\"true\" href=\"http://wiki.ros.org/hector_quadrotor\" rel=\"nofollow\">hector_quadrotor</a>.</p>\n<p>It should be noted that the magnetic field is not at all parallel to the earth surface except near the equator. The <a data-is-external-link=\"true\" href=\"http://en.wikipedia.org/wiki/Magnetic_dip\" rel=\"nofollow\">magnetic inclination</a> is about 60 degrees in Europe and in the US and grows to 90 degrees when coming closer to the poles. So the vertical component is even larger than the horizontal one. The angle between true and magnetic north is called <a data-is-external-link=\"true\" href=\"http://en.wikipedia.org/wiki/Magnetic_declination\" rel=\"nofollow\">declination</a>.</p>\n<p><code>GazeboRosMagnetic</code> in hector_gazebo_plugins has the declination, inclination and magnitude as plugin parameters and uses them to calculate the earth fixed magnetic field vector. I would propose to make these three parameters properties of the world instead of the vector itself as they are easier to lookup in the web or at least it is easier to assign reasonable default values. I usually use the <a data-is-external-link=\"true\" href=\"http://www.ngdc.noaa.gov/geomag-web/\" rel=\"nofollow\">NOAA magnetic field calculator</a> based on their World Magnetic Model (WMM2010).</p>\n<p>With respect to terminology the term IMU is often misused for what should be an AHRS in the robotics community. Originally (in the navigation community) an \"<strong>IMU</strong>\" (Inertial <em>Measurement</em> Unit) is nothing more than a  sensor unit consisting of a (3-axis) gyroscope and a (3-axis) accelerometer and measures angular rates and accelerations (including gravity) in the body frame. With high-grade gyroscopes the angular rate signals can be integrated to a relative orientation, but the MEMS sensors that are affordable and commonly used in robotics applications have too much noise and drift and pure integration would be useless. If combined with an estimator that fuses angular rates and accelerations such a device is called an \"<strong>ARS</strong>\" (Attitude Reference System) or \"<strong>IRS</strong>\" (Inertial Reference System) that outputs the roll and pitch angle. Only with an additional magnetic field sensor the absolute yaw angle is also observable, making the ARS an \"<strong>AHRS</strong>\" (Attitude and Heading Reference System). The acronym \"<strong>MARG</strong>\" (Magnetic, Angular Rate, and Gravity) is used for the sensor array within an AHRS. Last but not least, if the system also integrates the measured accelerations and outputs velocities or even position it is usually called an \"<strong>INS</strong>\" (Inertial Navigation System). Again, with MEMS sensors pure integration without external aiding (e.g. by GNSS) would be useless as the error would grow too fast. These definitions can be found in many text books about the topic and also at the <a data-is-external-link=\"true\" href=\"https://www.xsens.com/tags/ahrs/\" rel=\"nofollow\">Xsens web page</a>.</p>\n<p>To come back to the original topic of this issue: A magnetic field sensor is an independent sensor and should not be integrated in the IMU sensor plugin.</p>", "type": "rendered"}, "created_on": "2014-10-18T21:04:59.587779+00:00", "user": {"display_name": "Johannes Meyer", "uuid": "{58d19163-cefc-479b-b80a-d78fb811b533}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B58d19163-cefc-479b-b80a-d78fb811b533%7D"}, "html": {"href": "https://bitbucket.org/%7B58d19163-cefc-479b-b80a-d78fb811b533%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1363fb056a859ce072c21fdb8da3a710d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJM-6.png"}}, "nickname": "johmeyer", "type": "user", "account_id": "557058:7237c8c3-e637-4ea0-ab9c-d45f303d8fb9"}, "updated_on": null, "type": "issue_comment", "id": 13068692}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13073883.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13073883"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "I agree with @johmeyer about keeping the distinction between IMU and MAG sensors. We should give a decent default value (inclination and declination) for the magnetic field. Perhaps we can use the WMM2010-derived field strength at the OSRF office -- ```[5.5645 22.8758 -42.3884] microTesla``` -- for the time the sensor was added, and use that as a default value? This could easily be changed by a user in the world file. We could even write a short tutorial for the Gazebo wiki.\n\nFrom what I can tell, [hector_quadrotor](http://wiki.ros.org/hector_quadrotor) implements all quadrotor-specific sensors (GPS, IMU, barometric pressure, magnetometer) as ```ModelPlugin``` types. I can understand why this is the case for barometric pressure and magnetometer (these sensor types don't yet exist in Gazebo), but not for the GPS and IMU sensors, where a ```SensorPlugin``` type exist. Was there a reason for this design choice? Branching off from my comments in Issue #1285, would it not be a good overall design goal to integrate more sensor base types into SDF / Gazebo, with varying levels of complexity encoded as SensorPlugins.", "markup": "markdown", "html": "<p>I agree with @johmeyer about keeping the distinction between IMU and MAG sensors. We should give a decent default value (inclination and declination) for the magnetic field. Perhaps we can use the WMM2010-derived field strength at the OSRF office -- <code>[5.5645 22.8758 -42.3884] microTesla</code> -- for the time the sensor was added, and use that as a default value? This could easily be changed by a user in the world file. We could even write a short tutorial for the Gazebo wiki.</p>\n<p>From what I can tell, <a data-is-external-link=\"true\" href=\"http://wiki.ros.org/hector_quadrotor\" rel=\"nofollow\">hector_quadrotor</a> implements all quadrotor-specific sensors (GPS, IMU, barometric pressure, magnetometer) as <code>ModelPlugin</code> types. I can understand why this is the case for barometric pressure and magnetometer (these sensor types don't yet exist in Gazebo), but not for the GPS and IMU sensors, where a <code>SensorPlugin</code> type exist. Was there a reason for this design choice? Branching off from my comments in Issue <a href=\"#!/osrf/gazebo/issues/1285/improve-sensor-noise-modeling\" rel=\"nofollow\" title=\"Improve sensor noise modeling\" class=\"ap-connect-link\">#1285</a>, would it not be a good overall design goal to integrate more sensor base types into SDF / Gazebo, with varying levels of complexity encoded as SensorPlugins.</p>", "type": "rendered"}, "created_on": "2014-10-19T12:56:00.963484+00:00", "user": {"display_name": "Andrew Symington", "uuid": "{db1311fc-02e6-442e-84a1-4bb85dfee5ba}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D"}, "html": {"href": "https://bitbucket.org/%7Bdb1311fc-02e6-442e-84a1-4bb85dfee5ba%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:cab3b56e-7c24-487c-b07f-05e0600adf54/8a009f21-29b8-4d43-98ed-2677428e17ff/128"}}, "nickname": "asymingt", "type": "user", "account_id": "557058:cab3b56e-7c24-487c-b07f-05e0600adf54"}, "updated_on": "2014-10-19T13:30:47.666693+00:00", "type": "issue_comment", "id": 13073883}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13074998.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13074998"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "The reason why the plugins in hector_gazebo_plugins are implemented as `ModelPlugin`s and not `SensorPlugin`s is easy: We wanted to use these sensors only in a ROS environment with the precompiled Gazebo libraries, so we did not consider to patch Gazebo/SDF or send a pull request when development has started. The IMU plugin started as a fork of the `gazebo_ros_imu` plugin in the [gazebo_plugins](http://wiki.ros.org/gazebo_plugins) package, which is also implemented as a `ModelPlugin` and does not use Gazebo's `IMUSensor`. The fork was necessary as this plugin does not simulate an IMU, but an AHRS (e.g. the acceleration output is without gravity). Barometric pressure, magnetometer and GPS plugins were not yet available in 2012.", "markup": "markdown", "html": "<p>The reason why the plugins in hector_gazebo_plugins are implemented as <code>ModelPlugin</code>s and not <code>SensorPlugin</code>s is easy: We wanted to use these sensors only in a ROS environment with the precompiled Gazebo libraries, so we did not consider to patch Gazebo/SDF or send a pull request when development has started. The IMU plugin started as a fork of the <code>gazebo_ros_imu</code> plugin in the <a data-is-external-link=\"true\" href=\"http://wiki.ros.org/gazebo_plugins\" rel=\"nofollow\">gazebo_plugins</a> package, which is also implemented as a <code>ModelPlugin</code> and does not use Gazebo's <code>IMUSensor</code>. The fork was necessary as this plugin does not simulate an IMU, but an AHRS (e.g. the acceleration output is without gravity). Barometric pressure, magnetometer and GPS plugins were not yet available in 2012.</p>", "type": "rendered"}, "created_on": "2014-10-19T15:02:15.530985+00:00", "user": {"display_name": "Johannes Meyer", "uuid": "{58d19163-cefc-479b-b80a-d78fb811b533}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B58d19163-cefc-479b-b80a-d78fb811b533%7D"}, "html": {"href": "https://bitbucket.org/%7B58d19163-cefc-479b-b80a-d78fb811b533%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1363fb056a859ce072c21fdb8da3a710d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJM-6.png"}}, "nickname": "johmeyer", "type": "user", "account_id": "557058:7237c8c3-e637-4ea0-ab9c-d45f303d8fb9"}, "updated_on": null, "type": "issue_comment", "id": 13074998}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/13097774.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-13097774"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "@johmeyer Thanks for chiming in. It's true that the `hector_quadrotor` plugins predates the `GPSSensor` implementation in Gazebo. For ROS users, hopefully we can agree on common functionality for the upstream sensor implementations in Gazebo.\n\nRegarding the definition of the parameters as a `Vector3` or a sequence of magnitude and angles, I think Gazebo eventually wants the magnetic field as a `Vector3`. For the sdf parameter, it sounds like the preferred format will depend on the format used by available tools for computing the magnetic field.\n\nIt looks like NOAA has a tool that will generate both sets of parameters based on IGRF 11 or WMM 2010:\n\nhttp://www.ngdc.noaa.gov/geomag-web/#igrfwmm\n\nFrom my perspective as a Gazebo developer, if that NOAA tool is sufficient, I would prefer the SDF parameter to use a Vector3 format to simplify the Gazebo code. Other opinions welcome.", "markup": "markdown", "html": "<p>@johmeyer Thanks for chiming in. It's true that the <code>hector_quadrotor</code> plugins predates the <code>GPSSensor</code> implementation in Gazebo. For ROS users, hopefully we can agree on common functionality for the upstream sensor implementations in Gazebo.</p>\n<p>Regarding the definition of the parameters as a <code>Vector3</code> or a sequence of magnitude and angles, I think Gazebo eventually wants the magnetic field as a <code>Vector3</code>. For the sdf parameter, it sounds like the preferred format will depend on the format used by available tools for computing the magnetic field.</p>\n<p>It looks like NOAA has a tool that will generate both sets of parameters based on IGRF 11 or WMM 2010:</p>\n<p><a href=\"http://www.ngdc.noaa.gov/geomag-web/#igrfwmm\" rel=\"nofollow\" class=\"ap-connect-link\">http://www.ngdc.noaa.gov/geomag-web/#igrfwmm</a></p>\n<p>From my perspective as a Gazebo developer, if that NOAA tool is sufficient, I would prefer the SDF parameter to use a Vector3 format to simplify the Gazebo code. Other opinions welcome.</p>", "type": "rendered"}, "created_on": "2014-10-20T16:52:32.317410+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 13097774}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294/comments/28348502.json"}, "html": {"href": "#!/osrf/gazebo/issues/1294#comment-28348502"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1294.json"}}, "type": "issue", "id": 1294, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Inclusion of magnetic field strength sensor"}, "content": {"raw": "Has this been solved by pull request #1788?", "markup": "markdown", "html": "<p>Has this been solved by <a href=\"#!/osrf/gazebo/pull-requests/1788/add-magnetometer-sensor-redo-of-andrews\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #1788</a>?</p>", "type": "rendered"}, "created_on": "2016-06-08T01:02:12.445458+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": null, "type": "issue_comment", "id": 28348502}], "page": 1, "size": 20}