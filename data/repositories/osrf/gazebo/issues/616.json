{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/616/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/616.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/616/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/616/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/616/instability-on-startup-in-gazebo-branch"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/616/vote"}}, "reporter": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "title": "instability on startup in gazebo branch for groovy", "component": null, "votes": 0, "watches": 3, "content": {"raw": "In [catkin_groovy branch](#!/osrf/gazebo/src/9defae5902012b8cec2096cf87ba07bb69ec76d9/?at=catkin_groovy)(effectively `gazebo_1.5` branch + gpu sensor and minor parser fixes) compiled with `O2` or `O3` optimization, when starting PR2 simulation\r\n~~~\r\nroslaunch pr2_gazebo pr2_empty_world.launch\r\n~~~\r\n\r\noccasionally leads to segfault:\r\n~~~\r\n(gdb) bt\r\n#0  0x00007fffed5321e3 in Ogre::TexturePtr::operator=(Ogre::TexturePtr const&) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#1  0x00007fffed75e3e5 in Ogre::TextureUnitState::ensurePrepared(unsigned long) const () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#2  0x00007fffed75e5d3 in Ogre::TextureUnitState::_prepare() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#3  0x00007fffed63c66c in Ogre::Pass::_prepare() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#4  0x00007fffed75099c in Ogre::Technique::_prepare() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#5  0x00007fffed5bcef4 in Ogre::Material::prepareImpl() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#6  0x00007fffed6815da in Ogre::Resource::load(bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#7  0x00007fffed54fb25 in Ogre::Entity::reevaluateVertexProcessing() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#8  0x00007fffed5534bd in Ogre::Entity::_initialise(bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#9  0x00007fffed554121 in Ogre::Entity::Entity(std::string const&, Ogre::MeshPtr const&) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#10 0x00007fffed55467d in Ogre::EntityFactory::createInstanceImpl(std::string const&, std::map<std::string, std::string, std::less<std::string>, Ogre::STLAllocator<std::pair<std::string const, std::string>, Ogre::CategorisedAllocPolicy<(Ogre::MemoryCategory)0> > > const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#11 0x00007fffed610ba1 in Ogre::MovableObjectFactory::createInstance(std::string const&, Ogre::SceneManager*, std::map<std::string, std::string, std::less<std::string>, Ogre::STLAllocator<std::pair<std::string const, std::string>, Ogre::CategorisedAllocPolicy<(Ogre::MemoryCategory)0> > > const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#12 0x00007fffed6c718d in Ogre::SceneManager::createMovableObject(std::string const&, std::string const&, std::map<std::string, std::string, std::less<std::string>, Ogre::STLAllocator<std::pair<std::string const, std::string>, Ogre::CategorisedAllocPolicy<(Ogre::MemoryCategory)0> > > const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#13 0x00007fffed6c3c18 in Ogre::SceneManager::createEntity(std::string const&, std::string const&, std::string const&) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\r\n#14 0x00007ffff283c57c in gazebo::rendering::Light::CreateVisual (this=0x38cfb40) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Light.cc:284\r\n#15 0x00007ffff283f603 in gazebo::rendering::Light::Load (this=0x38cfb40) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Light.cc:102\r\n#16 0x00007ffff283f861 in gazebo::rendering::Light::LoadFromMsg (this=0x38cfb40, _msg=...) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Light.cc:229\r\n#17 0x00007ffff286f71f in gazebo::rendering::Scene::ProcessLightMsg (this=0x1ac3960, _msg=...)\r\n    at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Scene.cc:2092\r\n#18 0x00007ffff286fc02 in gazebo::rendering::Scene::PreRender (this=0x1ac3960) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Scene.cc:1506\r\n#19 0x00007ffff705056e in operator() (this=<optimized out>) at /usr/include/boost/function/function_template.hpp:1013\r\n#20 Signal (this=<optimized out>) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/common/Event.hh:126\r\n#21 operator() (this=<optimized out>) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/common/Event.hh:119\r\n#22 gazebo::sensors::SensorManager::ImageSensorContainer::Update (this=0x1ac3cf0, _force=false)\r\n    at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/sensors/SensorManager.cc:608\r\n#23 0x00007ffff7051d26 in gazebo::sensors::SensorManager::Update (this=0x7ffff75b8f60, _force=false)\r\n    at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/sensors/SensorManager.cc:127\r\n#24 0x00000000004243cf in gazebo::Server::Run (this=0x68d400) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/Server.cc:416\r\n#25 0x0000000000420dd3 in main (argc=9, argv=0x7fffffffda58) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/server_main.cc:43\r\n(gdb) \r\n~~~\r\n\r\nFailure occurs at\r\n\r\n~~~\r\n    // Create the selection object.\r\n    Ogre::MovableObject *obj = static_cast<Ogre::MovableObject*>\r\n      (visSceneNode->getCreator()->createEntity(this->GetName() +\r\n                                                \"_selection_sphere\",\r\n                                                \"unit_sphere\"));\r\n~~~\r\n\r\nSuspect due to pr2 actually using a [Projector](#!/osrf/gazebo/src/9defae5902012b8cec2096cf87ba07bb69ec76d9/gazebo/rendering/Projector.hh?at=catkin_groovy) with a [projector plugin](https://bitbucket.org/osrf/simulator_gazebo/src/db987b945c0984985a47e0e6cb092f96423e6eb9/gazebo_plugins/src/gazebo_ros_projector.cpp?at=default).\r\n", "markup": "markdown", "html": "<p>In <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/9defae5902012b8cec2096cf87ba07bb69ec76d9/?at=catkin_groovy\" rel=\"nofollow\">catkin_groovy branch</a>(effectively <code>gazebo_1.5</code> branch + gpu sensor and minor parser fixes) compiled with <code>O2</code> or <code>O3</code> optimization, when starting PR2 simulation</p>\n<div class=\"codehilite\"><pre><span></span>roslaunch pr2_gazebo pr2_empty_world.launch\n</pre></div>\n\n\n<p>occasionally leads to segfault:</p>\n<div class=\"codehilite\"><pre><span></span>(gdb) bt\n#0  0x00007fffed5321e3 in Ogre::TexturePtr::operator=(Ogre::TexturePtr const&amp;) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#1  0x00007fffed75e3e5 in Ogre::TextureUnitState::ensurePrepared(unsigned long) const () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#2  0x00007fffed75e5d3 in Ogre::TextureUnitState::_prepare() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#3  0x00007fffed63c66c in Ogre::Pass::_prepare() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#4  0x00007fffed75099c in Ogre::Technique::_prepare() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#5  0x00007fffed5bcef4 in Ogre::Material::prepareImpl() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#6  0x00007fffed6815da in Ogre::Resource::load(bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#7  0x00007fffed54fb25 in Ogre::Entity::reevaluateVertexProcessing() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#8  0x00007fffed5534bd in Ogre::Entity::_initialise(bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#9  0x00007fffed554121 in Ogre::Entity::Entity(std::string const&amp;, Ogre::MeshPtr const&amp;) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#10 0x00007fffed55467d in Ogre::EntityFactory::createInstanceImpl(std::string const&amp;, std::map&lt;std::string, std::string, std::less&lt;std::string&gt;, Ogre::STLAllocator&lt;std::pair&lt;std::string const, std::string&gt;, Ogre::CategorisedAllocPolicy&lt;(Ogre::MemoryCategory)0&gt; &gt; &gt; const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#11 0x00007fffed610ba1 in Ogre::MovableObjectFactory::createInstance(std::string const&amp;, Ogre::SceneManager*, std::map&lt;std::string, std::string, std::less&lt;std::string&gt;, Ogre::STLAllocator&lt;std::pair&lt;std::string const, std::string&gt;, Ogre::CategorisedAllocPolicy&lt;(Ogre::MemoryCategory)0&gt; &gt; &gt; const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#12 0x00007fffed6c718d in Ogre::SceneManager::createMovableObject(std::string const&amp;, std::string const&amp;, std::map&lt;std::string, std::string, std::less&lt;std::string&gt;, Ogre::STLAllocator&lt;std::pair&lt;std::string const, std::string&gt;, Ogre::CategorisedAllocPolicy&lt;(Ogre::MemoryCategory)0&gt; &gt; &gt; const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#13 0x00007fffed6c3c18 in Ogre::SceneManager::createEntity(std::string const&amp;, std::string const&amp;, std::string const&amp;) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.1.7.4\n#14 0x00007ffff283c57c in gazebo::rendering::Light::CreateVisual (this=0x38cfb40) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Light.cc:284\n#15 0x00007ffff283f603 in gazebo::rendering::Light::Load (this=0x38cfb40) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Light.cc:102\n#16 0x00007ffff283f861 in gazebo::rendering::Light::LoadFromMsg (this=0x38cfb40, _msg=...) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Light.cc:229\n#17 0x00007ffff286f71f in gazebo::rendering::Scene::ProcessLightMsg (this=0x1ac3960, _msg=...)\n    at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Scene.cc:2092\n#18 0x00007ffff286fc02 in gazebo::rendering::Scene::PreRender (this=0x1ac3960) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/rendering/Scene.cc:1506\n#19 0x00007ffff705056e in operator() (this=&lt;optimized out&gt;) at /usr/include/boost/function/function_template.hpp:1013\n#20 Signal (this=&lt;optimized out&gt;) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/common/Event.hh:126\n#21 operator() (this=&lt;optimized out&gt;) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/common/Event.hh:119\n#22 gazebo::sensors::SensorManager::ImageSensorContainer::Update (this=0x1ac3cf0, _force=false)\n    at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/sensors/SensorManager.cc:608\n#23 0x00007ffff7051d26 in gazebo::sensors::SensorManager::Update (this=0x7ffff75b8f60, _force=false)\n    at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/sensors/SensorManager.cc:127\n#24 0x00000000004243cf in gazebo::Server::Run (this=0x68d400) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/Server.cc:416\n#25 0x0000000000420dd3 in main (argc=9, argv=0x7fffffffda58) at /home/hsu/projects/groovy/simulator_gazebo/gazebo/build/gazebo-hg/gazebo/server_main.cc:43\n(gdb) \n</pre></div>\n\n\n<p>Failure occurs at</p>\n<div class=\"codehilite\"><pre><span></span>    // Create the selection object.\n    Ogre::MovableObject *obj = static_cast&lt;Ogre::MovableObject*&gt;\n      (visSceneNode-&gt;getCreator()-&gt;createEntity(this-&gt;GetName() +\n                                                &quot;_selection_sphere&quot;,\n                                                &quot;unit_sphere&quot;));\n</pre></div>\n\n\n<p>Suspect due to pr2 actually using a <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/9defae5902012b8cec2096cf87ba07bb69ec76d9/gazebo/rendering/Projector.hh?at=catkin_groovy\" rel=\"nofollow\">Projector</a> with a <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/simulator_gazebo/src/db987b945c0984985a47e0e6cb092f96423e6eb9/gazebo_plugins/src/gazebo_ros_projector.cpp?at=default\" rel=\"nofollow\">projector plugin</a>.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2013-03-29T22:43:56.838930+00:00", "milestone": null, "updated_on": "2016-09-14T19:41:38.654067+00:00", "type": "issue", "id": 616}