{"priority": "major", "kind": "enhancement", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/1529/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/1529.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1529/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/1529/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/1529/alternative-approach-to-including-ign-math"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1529/vote"}}, "reporter": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "title": "Alternative approach to including ign-math (formerly pull request #1535)", "component": null, "votes": 0, "watches": 2, "content": {"raw": "pull request #1534 presents one approach to integrating the [ignition-math](https://bitbucket.org/ignitionrobotics/ign-math) library into gazebo as an eventual replacement for the `gazebo::math` classes. This pull request presents another approach.\r\n\r\nSwitching to `ignition-math` will require changes to both gazebo code and downstream gazebo plugin code. It's my understanding that the philosophy of pull request #1534 is to encourage everyone to stop using `gazebo/math/*.hh` header files, `gazebo::math::` classes and helper functions, and start using `ignition-math` instead. This will also require adapting to some API differences between `ignition-math` and `gazebo::math`.\r\n\r\nThis will be a lot of work/pain. It would be one thing if it was only pain for us, but it will also affect our downstream users who write gazebo plugins using math classes, which is likely almost 100% since math is our lowest-level library. It would actually be even worse for our users, who would need to use `#ifdef`'s if they want their plugin to support multiple versions of gazebo. I have an alternative in this pull request that could reduce the pain of transition for ourselves and our users.\r\n\r\nCaveat: I haven't fully implemented it; so it might not work, but I think it's worth discussing. I'm willing to support the approach in pull request #1534, but I'd like this approach to at least be considered.\r\n\r\nApproach, focusing only on the `math::Angle` class as an example (see Step 4 for the key idea):\r\n\r\n1. Add `ignition-math` as an optional dependency (6df6b70); it will later be required\r\n\r\n2. Deprecate `gazebo::math::Angle` functions that don't match the `ignition::math::Angle` API and add replacement functions that do match (9d1c07f)\r\n\r\n3. Fix `gazebo::math::Angle` deprecation warnings in gazebo (0558a69)\r\n\r\n4. If `ignition-math` is found, typedef `ignition::math::Angle` as `gazebo::math::Angle` and don't compile Angle.cc; this is the key part that could reduce the pain of transition. Users would still be able to include `gazebo/math/Angle.hh` and use `gazebo::math::Angle`, but it would all simply point to `ignition/math/Angle.hh` and `ignition::math::Angle`.\r\n\r\n5. Eventually make `ignition-math` required and delete all the `.cc` files in `gazebo/math`.\r\n\r\nOther caveats:\r\n\r\n1. I had to remove `class Angle` from `gazebo/math/MathTypes.hh` (a6c6ada) because it was causing problems. I'm not sure if this is a big deal or not or if it will be for other math classes.\r\n\r\n2. I saw a conflict between something in `gazebo/math/Helpers.hh` and `ignition/math/Helpers.hh`, though I can't remember where I saw it. Hopefully jenkins shows it.", "markup": "markdown", "html": "<p><a href=\"#!/osrf/gazebo/pull-requests/1534/first-step-in-transition-to-ign-math\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #1534</a> presents one approach to integrating the <a data-is-external-link=\"true\" href=\"https://bitbucket.org/ignitionrobotics/ign-math\" rel=\"nofollow\">ignition-math</a> library into gazebo as an eventual replacement for the <code>gazebo::math</code> classes. This pull request presents another approach.</p>\n<p>Switching to <code>ignition-math</code> will require changes to both gazebo code and downstream gazebo plugin code. It's my understanding that the philosophy of <a href=\"#!/osrf/gazebo/pull-requests/1534/first-step-in-transition-to-ign-math\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #1534</a> is to encourage everyone to stop using <code>gazebo/math/*.hh</code> header files, <code>gazebo::math::</code> classes and helper functions, and start using <code>ignition-math</code> instead. This will also require adapting to some API differences between <code>ignition-math</code> and <code>gazebo::math</code>.</p>\n<p>This will be a lot of work/pain. It would be one thing if it was only pain for us, but it will also affect our downstream users who write gazebo plugins using math classes, which is likely almost 100% since math is our lowest-level library. It would actually be even worse for our users, who would need to use <code>#ifdef</code>'s if they want their plugin to support multiple versions of gazebo. I have an alternative in this pull request that could reduce the pain of transition for ourselves and our users.</p>\n<p>Caveat: I haven't fully implemented it; so it might not work, but I think it's worth discussing. I'm willing to support the approach in <a href=\"#!/osrf/gazebo/pull-requests/1534/first-step-in-transition-to-ign-math\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #1534</a>, but I'd like this approach to at least be considered.</p>\n<p>Approach, focusing only on the <code>math::Angle</code> class as an example (see Step 4 for the key idea):</p>\n<ol>\n<li>\n<p>Add <code>ignition-math</code> as an optional dependency (<a href=\"#!/osrf/gazebo/commits/6df6b70\" rel=\"nofollow\" class=\"ap-connect-link\">6df6b70</a>); it will later be required</p>\n</li>\n<li>\n<p>Deprecate <code>gazebo::math::Angle</code> functions that don't match the <code>ignition::math::Angle</code> API and add replacement functions that do match (<a href=\"#!/osrf/gazebo/commits/9d1c07f\" rel=\"nofollow\" class=\"ap-connect-link\">9d1c07f</a>)</p>\n</li>\n<li>\n<p>Fix <code>gazebo::math::Angle</code> deprecation warnings in gazebo (<a href=\"#!/osrf/gazebo/commits/0558a69\" rel=\"nofollow\" class=\"ap-connect-link\">0558a69</a>)</p>\n</li>\n<li>\n<p>If <code>ignition-math</code> is found, typedef <code>ignition::math::Angle</code> as <code>gazebo::math::Angle</code> and don't compile Angle.cc; this is the key part that could reduce the pain of transition. Users would still be able to include <code>gazebo/math/Angle.hh</code> and use <code>gazebo::math::Angle</code>, but it would all simply point to <code>ignition/math/Angle.hh</code> and <code>ignition::math::Angle</code>.</p>\n</li>\n<li>\n<p>Eventually make <code>ignition-math</code> required and delete all the <code>.cc</code> files in <code>gazebo/math</code>.</p>\n</li>\n</ol>\n<p>Other caveats:</p>\n<ol>\n<li>\n<p>I had to remove <code>class Angle</code> from <code>gazebo/math/MathTypes.hh</code> (<a href=\"#!/osrf/gazebo/commits/a6c6ada\" rel=\"nofollow\" class=\"ap-connect-link\">a6c6ada</a>) because it was causing problems. I'm not sure if this is a big deal or not or if it will be for other math classes.</p>\n</li>\n<li>\n<p>I saw a conflict between something in <code>gazebo/math/Helpers.hh</code> and <code>ignition/math/Helpers.hh</code>, though I can't remember where I saw it. Hopefully jenkins shows it.</p>\n</li>\n</ol>", "type": "rendered"}, "assignee": null, "state": "closed", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2015-03-20T18:24:35.509776+00:00", "milestone": null, "updated_on": "2016-09-14T19:23:17.770391+00:00", "type": "issue", "id": 1529}