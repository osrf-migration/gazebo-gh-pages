{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/1066/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1066/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/1066/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066/tests-segfaults-when-calling-dlclose-on"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1066/vote"}}, "reporter": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden", "component": null, "votes": 0, "watches": 1, "content": {"raw": "In the ```hidden_symbols``` branch, some [tests are segfaulting](http://build.osrfoundation.org/job/gazebo-any-devel-quantal-amd64-gpu-nvidia/306/testReport/?). This happens after the call to ServerFixture::Unload().\r\n\r\nAs a side note, the failure is pretty similar to the one described in issue #1026.\r\n\r\n```\r\n[ RUN      ] Sensor_TEST.UpdateAfterReset\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 192.168.0.203\r\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 2.1 seconds, timeout after 600 seconds\r\n[Dbg] [Sensor_TEST.cc:64] default::hokuyo::link::laser loaded with update rate of 30 Hz\r\n[Dbg] [Sensor_TEST.cc:85] counted 20 messages in 0.752 seconds\r\n[Dbg] [Sensor_TEST.cc:99] counted 64 messages in 2.25 seconds\r\n[Dbg] [Sensor_TEST.cc:115] sent reset world message\r\n[Dbg] [Sensor_TEST.cc:118] world time is now 0.099\r\n[Dbg] [Sensor_TEST.cc:129] counted 59 messages in 1.997 seconds. Expected[29.955]\r\n[Dbg] [Sensor_TEST.cc:146] counted 59 messages in 2.096 seconds\r\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\r\nSegmentation fault (core dumped)\r\n```\r\n\r\n```\r\n(gdb) bt\r\n#0  0x00007fffc09d0ad3 in ?? ()\r\n#1  0x00007fffd0a33790 in ?? ()\r\n#2  0x00007fffd09cf470 in ?? ()\r\n#3  0x00007fffd30b51c0 in ?? ()\r\n#4  0x00007fffa0c76d80 in ?? ()\r\n#5  0x00007fffa0c83a40 in ?? ()\r\n#6  0x00000000ffffffff in ?? ()\r\n#7  0x00007fffa0c80bc0 in ?? ()\r\n#8  0x00007fffc09d0d19 in ?? ()\r\n#9  0x00007fffd30b5390 in ?? ()\r\n#10 0x00007ffff730f739 in release (this=0x7fffa0c83a40)\r\n    at /usr/include/boost/smart_ptr/detail/sp_counted_base_gcc_x86.hpp:145\r\n#11 boost::detail::shared_count::~shared_count (this=<optimized out>, \r\n    __in_chrg=<optimized out>) at /usr/include/boost/smart_ptr/detail/shared_count.hpp:217\r\n#12 0x00007ffff7344f15 in ~shared_ptr (this=0x7fffa0c80bb0, __in_chrg=<optimized out>)\r\n    at /usr/include/boost/smart_ptr/shared_ptr.hpp:168\r\n#13 _Destroy<boost::shared_ptr<gazebo::SensorPlugin> > (__pointer=0x7fffa0c80bb0)\r\n    at /usr/include/c++/4.6/bits/stl_construct.h:94\r\n#14 __destroy<boost::shared_ptr<gazebo::SensorPlugin>*> (__last=<optimized out>, \r\n    __first=<optimized out>) at /usr/include/c++/4.6/bits/stl_construct.h:104\r\n#15 _Destroy<boost::shared_ptr<gazebo::SensorPlugin>*> (__last=<optimized out>, \r\n    __first=<optimized out>) at /usr/include/c++/4.6/bits/stl_construct.h:127\r\n#16 _Destroy<boost::shared_ptr<gazebo::SensorPlugin>*, boost::shared_ptr<gazebo::SensorPlugin> > (__last=0x7ffff7b88480, __first=0x7fffa0c80bb0)\r\n    at /usr/include/c++/4.6/bits/stl_construct.h:153\r\n#17 _M_erase_at_end (__pos=0x7fffa0c80bb0, this=<optimized out>)\r\n    at /usr/include/c++/4.6/bits/stl_vector.h:1255\r\n#18 clear (this=0x7fffd0974370) at /usr/include/c++/4.6/bits/stl_vector.h:1040\r\n#19 gazebo::sensors::Sensor::Fini (this=0x7fffd09742b0)\r\n    at /home/jrivero/code/gazebo/gazebo/sensors/Sensor.cc:241\r\n#20 0x00007ffff733eedb in gazebo::sensors::RaySensor::Fini (this=0x7fffd09742b0)\r\n    at /home/jrivero/code/gazebo/gazebo/sensors/RaySensor.cc:128\r\n#21 0x00007ffff734cd16 in gazebo::sensors::SensorManager::SensorContainer::Fini (\r\n    this=0x7fffd0731980) at /home/jrivero/code/gazebo/gazebo/sensors/SensorManager.cc:412\r\n#22 0x00007ffff734ce05 in gazebo::sensors::SensorManager::Fini (this=0x69a240)\r\n    at /home/jrivero/code/gazebo/gazebo/sensors/SensorManager.cc:208\r\n#23 0x00007ffff734450b in gazebo::sensors::fini ()\r\n    at /home/jrivero/code/gazebo/gazebo/sensors/SensorsIface.cc:70\r\n#24 0x0000000000465d56 in gazebo::shutdown ()\r\n    at /home/jrivero/code/gazebo/gazebo/gazebo.cc:247\r\n#25 0x00000000004593ac in gazebo::Server::Run (this=0x7fffd00008e0)\r\n    at /home/jrivero/code/gazebo/gazebo/Server.cc:479\r\n#26 0x0000000000440fb3 in ServerFixture::RunServer (this=0x767d50, _worldFilename=..., \r\n    _paused=false, _physics=...) at /home/jrivero/code/gazebo/test/ServerFixture.cc:233\r\n#27 0x00007ffff5b00ce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\r\n#28 0x00007ffff672ce9a in start_thread (arg=0x7fffdc963700) at pthread_create.c:308\r\n#29 0x00007ffff47623fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\r\n#30 0x0000000000000000 in ?? ()\r\n```", "markup": "markdown", "html": "<p>In the <code>hidden_symbols</code> branch, some <a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/job/gazebo-any-devel-quantal-amd64-gpu-nvidia/306/testReport/\" rel=\"nofollow\">tests are segfaulting</a>. This happens after the call to ServerFixture::Unload().</p>\n<p>As a side note, the failure is pretty similar to the one described in issue <a href=\"#!/osrf/gazebo/issues/1026/osx-seg-faults-during-plugin-teardown\" rel=\"nofollow\" title=\"OSX seg-faults during plugin teardown\" class=\"ap-connect-link\">#1026</a>.</p>\n<div class=\"codehilite\"><pre><span></span>[ RUN      ] Sensor_TEST.UpdateAfterReset\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 192.168.0.203\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 2.1 seconds, timeout after 600 seconds\n[Dbg] [Sensor_TEST.cc:64] default::hokuyo::link::laser loaded with update rate of 30 Hz\n[Dbg] [Sensor_TEST.cc:85] counted 20 messages in 0.752 seconds\n[Dbg] [Sensor_TEST.cc:99] counted 64 messages in 2.25 seconds\n[Dbg] [Sensor_TEST.cc:115] sent reset world message\n[Dbg] [Sensor_TEST.cc:118] world time is now 0.099\n[Dbg] [Sensor_TEST.cc:129] counted 59 messages in 1.997 seconds. Expected[29.955]\n[Dbg] [Sensor_TEST.cc:146] counted 59 messages in 2.096 seconds\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\nSegmentation fault (core dumped)\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>(gdb) bt\n#0  0x00007fffc09d0ad3 in ?? ()\n#1  0x00007fffd0a33790 in ?? ()\n#2  0x00007fffd09cf470 in ?? ()\n#3  0x00007fffd30b51c0 in ?? ()\n#4  0x00007fffa0c76d80 in ?? ()\n#5  0x00007fffa0c83a40 in ?? ()\n#6  0x00000000ffffffff in ?? ()\n#7  0x00007fffa0c80bc0 in ?? ()\n#8  0x00007fffc09d0d19 in ?? ()\n#9  0x00007fffd30b5390 in ?? ()\n#10 0x00007ffff730f739 in release (this=0x7fffa0c83a40)\n    at /usr/include/boost/smart_ptr/detail/sp_counted_base_gcc_x86.hpp:145\n#11 boost::detail::shared_count::~shared_count (this=&lt;optimized out&gt;, \n    __in_chrg=&lt;optimized out&gt;) at /usr/include/boost/smart_ptr/detail/shared_count.hpp:217\n#12 0x00007ffff7344f15 in ~shared_ptr (this=0x7fffa0c80bb0, __in_chrg=&lt;optimized out&gt;)\n    at /usr/include/boost/smart_ptr/shared_ptr.hpp:168\n#13 _Destroy&lt;boost::shared_ptr&lt;gazebo::SensorPlugin&gt; &gt; (__pointer=0x7fffa0c80bb0)\n    at /usr/include/c++/4.6/bits/stl_construct.h:94\n#14 __destroy&lt;boost::shared_ptr&lt;gazebo::SensorPlugin&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=&lt;optimized out&gt;) at /usr/include/c++/4.6/bits/stl_construct.h:104\n#15 _Destroy&lt;boost::shared_ptr&lt;gazebo::SensorPlugin&gt;*&gt; (__last=&lt;optimized out&gt;, \n    __first=&lt;optimized out&gt;) at /usr/include/c++/4.6/bits/stl_construct.h:127\n#16 _Destroy&lt;boost::shared_ptr&lt;gazebo::SensorPlugin&gt;*, boost::shared_ptr&lt;gazebo::SensorPlugin&gt; &gt; (__last=0x7ffff7b88480, __first=0x7fffa0c80bb0)\n    at /usr/include/c++/4.6/bits/stl_construct.h:153\n#17 _M_erase_at_end (__pos=0x7fffa0c80bb0, this=&lt;optimized out&gt;)\n    at /usr/include/c++/4.6/bits/stl_vector.h:1255\n#18 clear (this=0x7fffd0974370) at /usr/include/c++/4.6/bits/stl_vector.h:1040\n#19 gazebo::sensors::Sensor::Fini (this=0x7fffd09742b0)\n    at /home/jrivero/code/gazebo/gazebo/sensors/Sensor.cc:241\n#20 0x00007ffff733eedb in gazebo::sensors::RaySensor::Fini (this=0x7fffd09742b0)\n    at /home/jrivero/code/gazebo/gazebo/sensors/RaySensor.cc:128\n#21 0x00007ffff734cd16 in gazebo::sensors::SensorManager::SensorContainer::Fini (\n    this=0x7fffd0731980) at /home/jrivero/code/gazebo/gazebo/sensors/SensorManager.cc:412\n#22 0x00007ffff734ce05 in gazebo::sensors::SensorManager::Fini (this=0x69a240)\n    at /home/jrivero/code/gazebo/gazebo/sensors/SensorManager.cc:208\n#23 0x00007ffff734450b in gazebo::sensors::fini ()\n    at /home/jrivero/code/gazebo/gazebo/sensors/SensorsIface.cc:70\n#24 0x0000000000465d56 in gazebo::shutdown ()\n    at /home/jrivero/code/gazebo/gazebo/gazebo.cc:247\n#25 0x00000000004593ac in gazebo::Server::Run (this=0x7fffd00008e0)\n    at /home/jrivero/code/gazebo/gazebo/Server.cc:479\n#26 0x0000000000440fb3 in ServerFixture::RunServer (this=0x767d50, _worldFilename=..., \n    _paused=false, _physics=...) at /home/jrivero/code/gazebo/test/ServerFixture.cc:233\n#27 0x00007ffff5b00ce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#28 0x00007ffff672ce9a in start_thread (arg=0x7fffdc963700) at pthread_create.c:308\n#29 0x00007ffff47623fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#30 0x0000000000000000 in ?? ()\n</pre></div>", "type": "rendered"}, "assignee": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "state": "invalid", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2014-02-26T15:43:53.301361+00:00", "milestone": null, "updated_on": "2018-03-19T21:47:15.799907+00:00", "type": "issue", "id": 1066}