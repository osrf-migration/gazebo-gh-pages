{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2587/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2587.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2587/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2587/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2587/wrong-reference-point-for-optical-centre"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2587/vote"}}, "reporter": {"display_name": "Christian Rauch", "uuid": "{408871b1-9dca-4a44-88df-e8f0dbdba533}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B408871b1-9dca-4a44-88df-e8f0dbdba533%7D"}, "html": {"href": "https://bitbucket.org/%7B408871b1-9dca-4a44-88df-e8f0dbdba533%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/a54c27438e4b2d461db222760c23af17d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCR-2.png"}}, "nickname": "christian-rauch", "type": "user", "account_id": "557058:3551aa15-5c14-4b8f-b364-4546b8f30250"}, "title": "Wrong reference point for optical centre (cx, cy)", "component": {"name": "rendering", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122881.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "It seems, that the optical centre (principal point) of the intrinsic parameters (since Gazebo10) has to be given with respect to the bottom left corner of the image (x=0, y=hight). Usually, the optical centre is given with respect to the image origin (x=0, y=0), that is the top left of an image.\r\n\r\n\r\n# Setup #\r\nI created a camera sensor (640 x 480) with intrinsic parameters:\r\n```\r\n#!XML\r\n          <lens>\r\n            <intrinsics>\r\n              <fx>536.473145060694</fx>\r\n              <fy>536.8639285109052</fy>\r\n              <cx>314.0086519801989</cx>\r\n              <cy>246.7391576005324</cy>\r\n              <s>0</s>\r\n            </intrinsics>\r\n          </lens>\r\n```\r\nand a box centred inside the optical frame with 0.5m distance for demonstration purpose:\r\n```\r\n#!XML\r\n      <visual name=\"visual\">\r\n        <pose>0.5 0 0 0 0 0</pose>\r\n        <geometry>\r\n          <box>\r\n            <size>0.1 0.1 0.1</size>\r\n          </box>\r\n        </geometry>\r\n        <material>\r\n          <ambient>0.1 0.1 0.1 1</ambient>\r\n          <diffuse>0.1 0.1 0.2 1</diffuse>\r\n          <specular>0 0 0 0</specular>\r\n          <emissive>0 0 0 1</emissive>\r\n        </material>\r\n      </visual>\r\n```\r\n\r\n# Result #\r\nThe rendered image\r\n![image.png](data/bitbucket.org/repo/jgXqbo/images/3744898896-image.png)\r\nshows a rectangular shape with approx. 120x120pxl dimension. The upper left coordinate of the rectangle is (x=254, y=173) and the lower right is (x=373, y=293).\r\n\r\nIf you compute the centre of the rectangle in the image plane, you get cx=254+60=314, which matches with the given cx=314, and cy=173+60=233, which does not match with the given cy=246.\r\n\r\nI turns out, that the optical centre (cx,cy) is expected relative to the bottom left. I.e. if I change cy=480\u2212246.734=233.26 the rectangular shape is correctly centred at the optical centre (314, 246).", "markup": "markdown", "html": "<p>It seems, that the optical centre (principal point) of the intrinsic parameters (since Gazebo10) has to be given with respect to the bottom left corner of the image (x=0, y=hight). Usually, the optical centre is given with respect to the image origin (x=0, y=0), that is the top left of an image.</p>\n<h1 id=\"markdown-header-setup\">Setup</h1>\n<p>I created a camera sensor (640 x 480) with intrinsic parameters:</p>\n<div class=\"codehilite language-xml\"><pre><span></span>          <span class=\"nt\">&lt;lens&gt;</span>\n            <span class=\"nt\">&lt;intrinsics&gt;</span>\n              <span class=\"nt\">&lt;fx&gt;</span>536.473145060694<span class=\"nt\">&lt;/fx&gt;</span>\n              <span class=\"nt\">&lt;fy&gt;</span>536.8639285109052<span class=\"nt\">&lt;/fy&gt;</span>\n              <span class=\"nt\">&lt;cx&gt;</span>314.0086519801989<span class=\"nt\">&lt;/cx&gt;</span>\n              <span class=\"nt\">&lt;cy&gt;</span>246.7391576005324<span class=\"nt\">&lt;/cy&gt;</span>\n              <span class=\"nt\">&lt;s&gt;</span>0<span class=\"nt\">&lt;/s&gt;</span>\n            <span class=\"nt\">&lt;/intrinsics&gt;</span>\n          <span class=\"nt\">&lt;/lens&gt;</span>\n</pre></div>\n\n\n<p>and a box centred inside the optical frame with 0.5m distance for demonstration purpose:</p>\n<div class=\"codehilite language-xml\"><pre><span></span>      <span class=\"nt\">&lt;visual</span> <span class=\"na\">name=</span><span class=\"s\">&quot;visual&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;pose&gt;</span>0.5 0 0 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n        <span class=\"nt\">&lt;geometry&gt;</span>\n          <span class=\"nt\">&lt;box&gt;</span>\n            <span class=\"nt\">&lt;size&gt;</span>0.1 0.1 0.1<span class=\"nt\">&lt;/size&gt;</span>\n          <span class=\"nt\">&lt;/box&gt;</span>\n        <span class=\"nt\">&lt;/geometry&gt;</span>\n        <span class=\"nt\">&lt;material&gt;</span>\n          <span class=\"nt\">&lt;ambient&gt;</span>0.1 0.1 0.1 1<span class=\"nt\">&lt;/ambient&gt;</span>\n          <span class=\"nt\">&lt;diffuse&gt;</span>0.1 0.1 0.2 1<span class=\"nt\">&lt;/diffuse&gt;</span>\n          <span class=\"nt\">&lt;specular&gt;</span>0 0 0 0<span class=\"nt\">&lt;/specular&gt;</span>\n          <span class=\"nt\">&lt;emissive&gt;</span>0 0 0 1<span class=\"nt\">&lt;/emissive&gt;</span>\n        <span class=\"nt\">&lt;/material&gt;</span>\n      <span class=\"nt\">&lt;/visual&gt;</span>\n</pre></div>\n\n\n<h1 id=\"markdown-header-result\">Result</h1>\n<p>The rendered image\n<img alt=\"image.png\" src=\"data/bitbucket.org/repo/jgXqbo/images/3744898896-image.png\" />\nshows a rectangular shape with approx. 120x120pxl dimension. The upper left coordinate of the rectangle is (x=254, y=173) and the lower right is (x=373, y=293).</p>\n<p>If you compute the centre of the rectangle in the image plane, you get cx=254+60=314, which matches with the given cx=314, and cy=173+60=233, which does not match with the given cy=246.</p>\n<p>I turns out, that the optical centre (cx,cy) is expected relative to the bottom left. I.e. if I change cy=480\u2212246.734=233.26 the rectangular shape is correctly centred at the optical centre (314, 246).</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "9.0", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/242746.json"}}}, "edited_on": null, "created_on": "2019-01-21T21:19:00.596454+00:00", "milestone": null, "updated_on": "2019-01-21T21:19:00.596454+00:00", "type": "issue", "id": 2587}