{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/1350/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/1350.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1350/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/1350/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/1350/integration_plugin-test-failures-in"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1350/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "INTEGRATION_plugin test failures in gazebo3 - default", "component": {"name": "testing", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/128164.json"}}}, "votes": 0, "watches": 2, "content": {"raw": "The `INTEGRATION_plugin` test was added to gazebo_1.9 and recently merged forward to the other release branches (pull request #1289). The test status is as follows:\r\n\r\n* [passing in gazebo_1.9](http://build.osrfoundation.org/view/gazebo/job/gazebo-any-devel-precise-amd64-gpu-ati/95/testReport/%28root%29/PluginTest/)\r\n* [passing in gazebo_2.2](http://build.osrfoundation.org/view/gazebo/job/gazebo-any-devel-precise-amd64-gpu-ati/96/testReport/%28root%29/PluginTest/)\r\n* failing in gazebo_3.1 (verified on my machine)\r\n* gazebo_4.1 untested (I assume it's also failing)\r\n* [failing in default](http://build.osrfoundation.org/view/gazebo/job/gazebo-default-devel-trusty-amd64-gpu-nvidia/147/testReport/junit/%28root%29/INTEGRATION_plugin/test_ran/)\r\n\r\nOn my machine with the `gazebo_3.1` branch, the test fails when trying to find a specific error message in the `~/.gazebo/test.log` file:\r\n~~~\r\n[==========] Running 3 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 3 tests from PluginTest\r\n[ RUN      ] PluginTest.ModelExceptionConstructor\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 172.23.2.90\r\n[Err] [Model.cc:749] Exception occured in the constructor of plugin with name[exception] and filename[libExceptionModelPluginConstructor.so]. This plugin will not run.\r\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.9 seconds, timeout after 600 seconds\r\ntest/integration/plugin.cc:58: Failure\r\nValue of: loggedString.find( \"Exception occured in the constructor of plugin with name\") != std::string::npos\r\n  Actual: false\r\nExpected: true\r\n[Dbg] [plugin.cc:59] Gazebo multi-robot simulator, version 3.2.0Copyright (C) 2012-2014 Open Source Robotics Foundation.Released under the Apache 2 License.http://gazebosim.org\r\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\r\n[  FAILED  ] PluginTest.ModelExceptionConstructor (1140 ms)\r\n[ RUN      ] PluginTest.ModelExceptionInit\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 172.23.2.90\r\n[Err] [Model.cc:798] Exception occured in the Init function of plugin with name[exception] and filename[libExceptionModelPluginInit.so]. This plugin will not run\r\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.7 seconds, timeout after 600 seconds\r\ntest/integration/plugin.cc:94: Failure\r\nValue of: loggedString.find( \"Exception occured in the Init function of plugin with name\") != std::string::npos\r\n  Actual: false\r\nExpected: true\r\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\r\n[  FAILED  ] PluginTest.ModelExceptionInit (937 ms)\r\n[ RUN      ] PluginTest.ModelExceptionLoad\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 172.23.2.90\r\n[Err] [Model.cc:780] Exception occured in the Load function of plugin with name[exception] and filename[libExceptionModelPluginLoad.so]. This plugin will not run.\r\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.9 seconds, timeout after 600 seconds\r\ntest/integration/plugin.cc:129: Failure\r\nValue of: loggedString.find( \"Exception occured in the Load function of plugin with name\") != std::string::npos\r\n  Actual: false\r\nExpected: true\r\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\r\n[  FAILED  ] PluginTest.ModelExceptionLoad (1139 ms)\r\n[----------] 3 tests from PluginTest (3216 ms total)\r\n\r\n[----------] Global test environment tear-down\r\n[==========] 3 tests from 1 test case ran. (3216 ms total)\r\n[  PASSED  ] 0 tests.\r\n[  FAILED  ] 3 tests, listed below:\r\n[  FAILED  ] PluginTest.ModelExceptionConstructor\r\n[  FAILED  ] PluginTest.ModelExceptionInit\r\n[  FAILED  ] PluginTest.ModelExceptionLoad\r\n\r\n 3 FAILED TESTS\r\n~~~\r\n\r\nThere are two problems:\r\n\r\n1. The location of the test log files changed with gazebo_3.1, and has also changed on the default branch. So the test should be updated with the proper location, or perhaps an accessor for the name of the current log file.\r\n\r\n2. The `gzerr` statements are being logged to the file for unit tests derived from `AutoLogFixture`, but there are problems with the integration tests derived from `ServerFixture`. All I see in the log files from these tests is the preamble:\r\n~~~\r\nGazebo multi-robot simulator, version 4.1.0\r\nCopyright (C) 2012-2014 Open Source Robotics Foundation.\r\nReleased under the Apache 2 License.\r\nhttp://gazebosim.org\r\n\r\n\r\n~~~\r\nPerhaps the FileLogger buffer needs to be flushed at the end of the test?", "markup": "markdown", "html": "<p>The <code>INTEGRATION_plugin</code> test was added to gazebo_1.9 and recently merged forward to the other release branches (<a href=\"#!/osrf/gazebo/pull-requests/1289/merged-gazebo-19-into-gazebo-22\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #1289</a>). The test status is as follows:</p>\n<ul>\n<li><a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/view/gazebo/job/gazebo-any-devel-precise-amd64-gpu-ati/95/testReport/%28root%29/PluginTest/\" rel=\"nofollow\">passing in gazebo_1.9</a></li>\n<li><a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/view/gazebo/job/gazebo-any-devel-precise-amd64-gpu-ati/96/testReport/%28root%29/PluginTest/\" rel=\"nofollow\">passing in gazebo_2.2</a></li>\n<li>failing in gazebo_3.1 (verified on my machine)</li>\n<li>gazebo_4.1 untested (I assume it's also failing)</li>\n<li><a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/view/gazebo/job/gazebo-default-devel-trusty-amd64-gpu-nvidia/147/testReport/junit/%28root%29/INTEGRATION_plugin/test_ran/\" rel=\"nofollow\">failing in default</a></li>\n</ul>\n<p>On my machine with the <code>gazebo_3.1</code> branch, the test fails when trying to find a specific error message in the <code>~/.gazebo/test.log</code> file:</p>\n<div class=\"codehilite\"><pre><span></span>[==========] Running 3 tests from 1 test case.\n[----------] Global test environment set-up.\n[----------] 3 tests from PluginTest\n[ RUN      ] PluginTest.ModelExceptionConstructor\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 172.23.2.90\n[Err] [Model.cc:749] Exception occured in the constructor of plugin with name[exception] and filename[libExceptionModelPluginConstructor.so]. This plugin will not run.\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.9 seconds, timeout after 600 seconds\ntest/integration/plugin.cc:58: Failure\nValue of: loggedString.find( &quot;Exception occured in the constructor of plugin with name&quot;) != std::string::npos\n  Actual: false\nExpected: true\n[Dbg] [plugin.cc:59] Gazebo multi-robot simulator, version 3.2.0Copyright (C) 2012-2014 Open Source Robotics Foundation.Released under the Apache 2 License.http://gazebosim.org\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\n[  FAILED  ] PluginTest.ModelExceptionConstructor (1140 ms)\n[ RUN      ] PluginTest.ModelExceptionInit\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 172.23.2.90\n[Err] [Model.cc:798] Exception occured in the Init function of plugin with name[exception] and filename[libExceptionModelPluginInit.so]. This plugin will not run\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.7 seconds, timeout after 600 seconds\ntest/integration/plugin.cc:94: Failure\nValue of: loggedString.find( &quot;Exception occured in the Init function of plugin with name&quot;) != std::string::npos\n  Actual: false\nExpected: true\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\n[  FAILED  ] PluginTest.ModelExceptionInit (937 ms)\n[ RUN      ] PluginTest.ModelExceptionLoad\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 172.23.2.90\n[Err] [Model.cc:780] Exception occured in the Load function of plugin with name[exception] and filename[libExceptionModelPluginLoad.so]. This plugin will not run.\n[Dbg] [ServerFixture.cc:144] ServerFixture load in 0.9 seconds, timeout after 600 seconds\ntest/integration/plugin.cc:129: Failure\nValue of: loggedString.find( &quot;Exception occured in the Load function of plugin with name&quot;) != std::string::npos\n  Actual: false\nExpected: true\n[Dbg] [ServerFixture.cc:95] ServerFixture::Unload\n[  FAILED  ] PluginTest.ModelExceptionLoad (1139 ms)\n[----------] 3 tests from PluginTest (3216 ms total)\n\n[----------] Global test environment tear-down\n[==========] 3 tests from 1 test case ran. (3216 ms total)\n[  PASSED  ] 0 tests.\n[  FAILED  ] 3 tests, listed below:\n[  FAILED  ] PluginTest.ModelExceptionConstructor\n[  FAILED  ] PluginTest.ModelExceptionInit\n[  FAILED  ] PluginTest.ModelExceptionLoad\n\n 3 FAILED TESTS\n</pre></div>\n\n\n<p>There are two problems:</p>\n<ol>\n<li>\n<p>The location of the test log files changed with gazebo_3.1, and has also changed on the default branch. So the test should be updated with the proper location, or perhaps an accessor for the name of the current log file.</p>\n</li>\n<li>\n<p>The <code>gzerr</code> statements are being logged to the file for unit tests derived from <code>AutoLogFixture</code>, but there are problems with the integration tests derived from <code>ServerFixture</code>. All I see in the log files from these tests is the preamble:</p>\n</li>\n</ol>\n<div class=\"codehilite\"><pre><span></span>Gazebo multi-robot simulator, version 4.1.0\nCopyright (C) 2012-2014 Open Source Robotics Foundation.\nReleased under the Apache 2 License.\nhttp://gazebosim.org\n</pre></div>\n\n\n<p>Perhaps the FileLogger buffer needs to be flushed at the end of the test?</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2014-12-02T00:36:35.300960+00:00", "milestone": null, "updated_on": "2016-09-14T19:22:13.347487+00:00", "type": "issue", "id": 1350}