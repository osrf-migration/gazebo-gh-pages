{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1448/comments/15611533.json"}, "html": {"href": "#!/osrf/gazebo/issues/1448#comment-15611533"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1448.json"}}, "type": "issue", "id": 1448, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Crash after deleting simple gripper in paused state"}, "content": {"raw": "I think the following will fix it:\n~~~\ndiff -r 6b2841a1895e gazebo/physics/ode/ODEPhysics.cc\n--- a/gazebo/physics/ode/ODEPhysics.cc\tMon Feb 09 21:41:10 2015 -0800\n+++ b/gazebo/physics/ode/ODEPhysics.cc\tTue Feb 10 17:28:50 2015 -0800\n@@ -810,15 +810,30 @@\n void ODEPhysics::Collide(ODECollision *_collision1, ODECollision *_collision2,\n                          dContactGeom *_contactCollisions)\n {\n+  if (!_collision1 || !_collision2)\n+  {\n+    // Invalid Collision pointers.\n+    return;\n+  }\n+\n+  ODESurfaceParamsPtr surf1 = _collision1->GetODESurface();\n+  ODESurfaceParamsPtr surf2 = _collision2->GetODESurface();\n+\n+  if (!surf1 || !surf2)\n+  {\n+    // Invalid SurfaceParams pointers.\n+    return;\n+  }\n+\n   // Filter collisions based on contact bitmask if collide_without_contact is\n   // on.The bitmask is set mainly for speed improvements otherwise a collision\n   // with collide_without_contact may potentially generate a large number of\n   // contacts.\n-  if (_collision1->GetSurface()->collideWithoutContact ||\n-      _collision2->GetSurface()->collideWithoutContact)\n+  if (surf1->collideWithoutContact ||\n+      surf2->collideWithoutContact)\n   {\n-    if ((_collision1->GetSurface()->collideWithoutContactBitmask &\n-         _collision2->GetSurface()->collideWithoutContactBitmask) == 0)\n+    if ((surf1->collideWithoutContactBitmask &\n+         surf2->collideWithoutContactBitmask) == 0)\n     {\n       return;\n     }\n@@ -888,9 +903,6 @@\n                          dContactSlip1 |\n                          dContactSlip2;\n \n-  ODESurfaceParamsPtr surf1 = _collision1->GetODESurface();\n-  ODESurfaceParamsPtr surf2 = _collision2->GetODESurface();\n-\n   // Compute the CFM and ERP by assuming the two bodies form a\n   // spring-damper system.\n   double kp = 1.0 / (1.0 / surf1->kp + 1.0 / surf2->kp);\n~~~", "markup": "markdown", "html": "<p>I think the following will fix it:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 6b2841a1895e gazebo/physics/ode/ODEPhysics.cc</span>\n<span class=\"gd\">--- a/gazebo/physics/ode/ODEPhysics.cc  Mon Feb 09 21:41:10 2015 -0800</span>\n<span class=\"gi\">+++ b/gazebo/physics/ode/ODEPhysics.cc  Tue Feb 10 17:28:50 2015 -0800</span>\n<span class=\"gu\">@@ -810,15 +810,30 @@</span>\n void ODEPhysics::Collide(ODECollision *_collision1, ODECollision *_collision2,\n                          dContactGeom *_contactCollisions)\n {\n<span class=\"gi\">+  if (!_collision1 || !_collision2)</span>\n<span class=\"gi\">+  {</span>\n<span class=\"gi\">+    // Invalid Collision pointers.</span>\n<span class=\"gi\">+    return;</span>\n<span class=\"gi\">+  }</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+  ODESurfaceParamsPtr surf1 = _collision1-&gt;GetODESurface();</span>\n<span class=\"gi\">+  ODESurfaceParamsPtr surf2 = _collision2-&gt;GetODESurface();</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+  if (!surf1 || !surf2)</span>\n<span class=\"gi\">+  {</span>\n<span class=\"gi\">+    // Invalid SurfaceParams pointers.</span>\n<span class=\"gi\">+    return;</span>\n<span class=\"gi\">+  }</span>\n<span class=\"gi\">+</span>\n   // Filter collisions based on contact bitmask if collide_without_contact is\n   // on.The bitmask is set mainly for speed improvements otherwise a collision\n   // with collide_without_contact may potentially generate a large number of\n   // contacts.\n<span class=\"gd\">-  if (_collision1-&gt;GetSurface()-&gt;collideWithoutContact ||</span>\n<span class=\"gd\">-      _collision2-&gt;GetSurface()-&gt;collideWithoutContact)</span>\n<span class=\"gi\">+  if (surf1-&gt;collideWithoutContact ||</span>\n<span class=\"gi\">+      surf2-&gt;collideWithoutContact)</span>\n   {\n<span class=\"gd\">-    if ((_collision1-&gt;GetSurface()-&gt;collideWithoutContactBitmask &amp;</span>\n<span class=\"gd\">-         _collision2-&gt;GetSurface()-&gt;collideWithoutContactBitmask) == 0)</span>\n<span class=\"gi\">+    if ((surf1-&gt;collideWithoutContactBitmask &amp;</span>\n<span class=\"gi\">+         surf2-&gt;collideWithoutContactBitmask) == 0)</span>\n     {\n       return;\n     }\n<span class=\"gu\">@@ -888,9 +903,6 @@</span>\n                          dContactSlip1 |\n                          dContactSlip2;\n\n<span class=\"gd\">-  ODESurfaceParamsPtr surf1 = _collision1-&gt;GetODESurface();</span>\n<span class=\"gd\">-  ODESurfaceParamsPtr surf2 = _collision2-&gt;GetODESurface();</span>\n<span class=\"gd\">-</span>\n   // Compute the CFM and ERP by assuming the two bodies form a\n   // spring-damper system.\n   double kp = 1.0 / (1.0 / surf1-&gt;kp + 1.0 / surf2-&gt;kp);\n</pre></div>", "type": "rendered"}, "created_on": "2015-02-11T01:29:06.754333+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 15611533}