{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2429/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2429.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2429/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2429/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2429/client-hangs-if-loading-complex-world"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2429/vote"}}, "reporter": {"display_name": "Deanna Hood", "uuid": "{40d490b4-7de9-4c89-ac1c-2219a22057eb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B40d490b4-7de9-4c89-ac1c-2219a22057eb%7D"}, "html": {"href": "https://bitbucket.org/%7B40d490b4-7de9-4c89-ac1c-2219a22057eb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:ec666897-79d8-48b4-ae27-4f0e9e56f5b5/f7b56737-eb1f-481f-beb1-50c179565cf4/128"}}, "nickname": "d_hood", "type": "user", "account_id": "557058:ec666897-79d8-48b4-ae27-4f0e9e56f5b5"}, "title": "Client hangs if loading complex world resulting in permanent black gzclient", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Seems that a race condition has been exaggerated in the latest gazebo version that makes the following more likely to occur:\r\n\r\nStart `gazebo` with a complex world file. The gzclient shows a black world with the orange \"loading world\" popup, forever. The gzserver is running fine, however, and if you start another gzclient, it will work fine too. It's just the first gzclient that seems to start before something is ready.\r\n\r\nThe reason I suspect it's a race condition is because we first noticed it on an older laptop, and I can reproduce it on my newer desktop by running `stress` at the same time. Also, the fact that additional gzclients started later on work fine.\r\n\r\nThe trigger seems to be having many models in the world. For simple worlds, I can't trigger this, but with complex worlds, the issue appears.\r\n\r\nI have attached a world file with a lot of models, and no plugins. The model is from https://bitbucket.org/osrf/ariac/src/772ae339342000114e20a1fe9819f085a36bcb66/osrf_gear/models/part3_ariac/?at=master, and doesn't refer to meshes/materials in other models.\r\n\r\nIf I run the world with all models, it will give the black screen even on gazebo 8.2, but if I run the world with only half the models, it'll be fine in 8.2, unless I add CPU stress. On 8.3, the world with only half the models will always give black screen on my machine. That's what makes me think that this is not a new bug, but just a race condition that is now more likely to occur.\r\n\r\n```\r\n$ stress --cpu 7 --timeout 60\r\n$ gazebo ~/ariac_ws/many_gear_parts.world --verbose\r\nGazebo multi-robot simulator, version 8.3.0\r\nCopyright (C) 2012 Open Source Robotics Foundation.\r\nReleased under the Apache 2 License.\r\nhttp://gazebosim.org\r\n\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 172.23.1.167\r\nGazebo multi-robot simulator, version 8.3.0\r\nCopyright (C) 2012 Open Source Robotics Foundation.\r\nReleased under the Apache 2 License.\r\nhttp://gazebosim.org\r\n\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 172.23.1.167\r\n[Err] [Node.cc:105] No namespace found\r\n[Err] [Node.cc:105] No namespace found\r\n<client hangs with black screen>\r\n```\r\n\r\nAnecdotally, it seems that if \"No namespace found\" is printed zero or once things are fine, but if it's printed twice or more, the client will give the black screen. I'm not sure what causes that to be output though, so don't have any other insight.\r\n\r\n@_jrivero_ noticed this with 8.3 but we've had ARIAC users run into this on 7.11, so it must have come from a PR that targeted both versions.", "markup": "markdown", "html": "<p>Seems that a race condition has been exaggerated in the latest gazebo version that makes the following more likely to occur:</p>\n<p>Start <code>gazebo</code> with a complex world file. The gzclient shows a black world with the orange \"loading world\" popup, forever. The gzserver is running fine, however, and if you start another gzclient, it will work fine too. It's just the first gzclient that seems to start before something is ready.</p>\n<p>The reason I suspect it's a race condition is because we first noticed it on an older laptop, and I can reproduce it on my newer desktop by running <code>stress</code> at the same time. Also, the fact that additional gzclients started later on work fine.</p>\n<p>The trigger seems to be having many models in the world. For simple worlds, I can't trigger this, but with complex worlds, the issue appears.</p>\n<p>I have attached a world file with a lot of models, and no plugins. The model is from <a href=\"https://bitbucket.org/osrf/ariac/src/772ae339342000114e20a1fe9819f085a36bcb66/osrf_gear/models/part3_ariac/?at=master\" rel=\"nofollow\" class=\"ap-connect-link\">https://bitbucket.org/osrf/ariac/src/772ae339342000114e20a1fe9819f085a36bcb66/osrf_gear/models/part3_ariac/?at=master</a>, and doesn't refer to meshes/materials in other models.</p>\n<p>If I run the world with all models, it will give the black screen even on gazebo 8.2, but if I run the world with only half the models, it'll be fine in 8.2, unless I add CPU stress. On 8.3, the world with only half the models will always give black screen on my machine. That's what makes me think that this is not a new bug, but just a race condition that is now more likely to occur.</p>\n<div class=\"codehilite\"><pre><span></span>$ stress --cpu <span class=\"m\">7</span> --timeout <span class=\"m\">60</span>\n$ gazebo ~/ariac_ws/many_gear_parts.world --verbose\nGazebo multi-robot simulator, version <span class=\"m\">8</span>.3.0\nCopyright <span class=\"o\">(</span>C<span class=\"o\">)</span> <span class=\"m\">2012</span> Open Source Robotics Foundation.\nReleased under the Apache <span class=\"m\">2</span> License.\nhttp://gazebosim.org\n\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Waiting <span class=\"k\">for</span> master.\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Connected to gazebo master @ http://127.0.0.1:11345\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Publicized address: <span class=\"m\">172</span>.23.1.167\nGazebo multi-robot simulator, version <span class=\"m\">8</span>.3.0\nCopyright <span class=\"o\">(</span>C<span class=\"o\">)</span> <span class=\"m\">2012</span> Open Source Robotics Foundation.\nReleased under the Apache <span class=\"m\">2</span> License.\nhttp://gazebosim.org\n\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Waiting <span class=\"k\">for</span> master.\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Connected to gazebo master @ http://127.0.0.1:11345\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Publicized address: <span class=\"m\">172</span>.23.1.167\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>Node.cc:105<span class=\"o\">]</span> No namespace found\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>Node.cc:105<span class=\"o\">]</span> No namespace found\n&lt;client hangs with black screen&gt;\n</pre></div>\n\n\n<p>Anecdotally, it seems that if \"No namespace found\" is printed zero or once things are fine, but if it's printed twice or more, the client will give the black screen. I'm not sure what causes that to be output though, so don't have any other insight.</p>\n<p>@<em>jrivero</em> noticed this with 8.3 but we've had ARIAC users run into this on 7.11, so it must have come from a PR that targeted both versions.</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-02-16T22:03:28.601589+00:00", "milestone": null, "updated_on": "2018-02-17T02:58:01.163710+00:00", "type": "issue", "id": 2429}