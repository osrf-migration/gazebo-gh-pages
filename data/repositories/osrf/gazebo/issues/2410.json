{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2410/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2410/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2410/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410/wrong-gazebo-physics-model-worldpose-for"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2410/vote"}}, "reporter": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models", "component": {"name": "physics", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122876.json"}}}, "votes": 0, "watches": 2, "content": {"raw": "I'm trying to write a Gazebo Model plugin that simply gets the absolute pose of a model __nested within another__.\r\n\r\nThe sdf looks like this\r\n```\r\n<sdf version=\"1.5\">\r\n\r\n  <model name=\"root_model\">\r\n    <pose> 1 1 0 0 0 0 </pose>\r\n    <link name=\"root_model_root_link\">\r\n      <!-- standard sdf content here -->\r\n    </link>\r\n \r\n    <!-- nested model -->\r\n    <model name=\"nested_model\">\r\n      <!-- pose relative to the parent model -->\r\n      <pose> 0 0 1 0 0 0</pose>\r\n      <link name=\"nested_model_root_link\">\r\n        <!-- standard sdf content here -->\r\n      </link>\r\n      \r\n      <!-- plugin inserted inside the nested model -->\r\n      <plugin name='plugin' filename='plugin_name.so'></plugin>\r\n    </model>\r\n\r\n  </model>\r\n\r\n</sdf>\r\n\r\n```\r\n\r\nLet's say I have a little box (the nested model) on top of another box  (the root model) and I want to know the __absolute__ position of the little box.\r\n\r\nWith this code I'm getting the pointer to the model\r\n\r\n```\r\nvoid PluginClass::Load(gazebo::physics::ModelPtr _parent, sdf::ElementPtr _sdf)                                                       \r\n{        \r\n   // m_model is a member of the class                                                                                                                                                                                                                                                                 \r\n    m_model = _parent;  \r\n}\r\n```\r\n\r\nand then I try to read the absolute pose with respect to the Gazebo world frame in a method\r\nthat was binded to the World update event using ```gazebo::event::Events::ConnectWorldUpdateBegin```\r\n\r\n```\r\n...\r\nignition::math::Pose3d currentPose;\r\ncurrentPose = m_model->WorldPose();\r\n...\r\n```\r\n\r\nWhen I start Gazebo and load the sdf I obtain for the positional part of the nested model\r\n```\r\nx = 1\r\ny = 1\r\nz = 1\r\n``` \r\nand that is correct. However if I try to interact with the root model and with the nested model strange things happen. For example if I move the big box upward using the Translation Mode and then I release it the box falls due to gravity, together with the little box. The new position obtained is like (it depends on how much the box was moved upward)\r\n```\r\nx = 1\r\ny = 1\r\nz = 1.92\r\n```\r\nwhich is clearly wrong since the two objects, after the transient, are again in the initial position.\r\nIf I repeat the experiment the `z` coordinates increases further.\r\n\r\nAlso if I try to move the little box relative to the big box, e.g. a robot pushes the little box on a plane parallel to the `x`-`y` plane of the inertial reference frame, the position is not updated at all.\r\n\r\nIs this behavior normal?", "markup": "markdown", "html": "<p>I'm trying to write a Gazebo Model plugin that simply gets the absolute pose of a model <strong>nested within another</strong>.</p>\n<p>The sdf looks like this</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;sdf</span> <span class=\"na\">version=</span><span class=\"s\">&quot;1.5&quot;</span><span class=\"nt\">&gt;</span>\n\n  <span class=\"nt\">&lt;model</span> <span class=\"na\">name=</span><span class=\"s\">&quot;root_model&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;pose&gt;</span> 1 1 0 0 0 0 <span class=\"nt\">&lt;/pose&gt;</span>\n    <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;root_model_root_link&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"c\">&lt;!-- standard sdf content here --&gt;</span>\n    <span class=\"nt\">&lt;/link&gt;</span>\n\n    <span class=\"c\">&lt;!-- nested model --&gt;</span>\n    <span class=\"nt\">&lt;model</span> <span class=\"na\">name=</span><span class=\"s\">&quot;nested_model&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"c\">&lt;!-- pose relative to the parent model --&gt;</span>\n      <span class=\"nt\">&lt;pose&gt;</span> 0 0 1 0 0 0<span class=\"nt\">&lt;/pose&gt;</span>\n      <span class=\"nt\">&lt;link</span> <span class=\"na\">name=</span><span class=\"s\">&quot;nested_model_root_link&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"c\">&lt;!-- standard sdf content here --&gt;</span>\n      <span class=\"nt\">&lt;/link&gt;</span>\n\n      <span class=\"c\">&lt;!-- plugin inserted inside the nested model --&gt;</span>\n      <span class=\"nt\">&lt;plugin</span> <span class=\"na\">name=</span><span class=\"s\">&#39;plugin&#39;</span> <span class=\"na\">filename=</span><span class=\"s\">&#39;plugin_name.so&#39;</span><span class=\"nt\">&gt;&lt;/plugin&gt;</span>\n    <span class=\"nt\">&lt;/model&gt;</span>\n\n  <span class=\"nt\">&lt;/model&gt;</span>\n\n<span class=\"nt\">&lt;/sdf&gt;</span>\n</pre></div>\n\n\n<p>Let's say I have a little box (the nested model) on top of another box  (the root model) and I want to know the <strong>absolute</strong> position of the little box.</p>\n<p>With this code I'm getting the pointer to the model</p>\n<div class=\"codehilite\"><pre><span></span>void PluginClass::Load(gazebo::physics::ModelPtr _parent, sdf::ElementPtr _sdf)                                                       \n{        \n   // m_model is a member of the class                                                                                                                                                                                                                                                                 \n    m_model = _parent;  \n}\n</pre></div>\n\n\n<p>and then I try to read the absolute pose with respect to the Gazebo world frame in a method\nthat was binded to the World update event using <code>gazebo::event::Events::ConnectWorldUpdateBegin</code></p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">...</span>\n<span class=\"nt\">ignition</span><span class=\"p\">::</span><span class=\"nd\">math</span><span class=\"p\">::</span><span class=\"nd\">Pose3d</span> <span class=\"nt\">currentPose</span><span class=\"o\">;</span>\n<span class=\"nt\">currentPose</span> <span class=\"o\">=</span> <span class=\"nt\">m_model-</span><span class=\"o\">&gt;</span><span class=\"nt\">WorldPose</span><span class=\"o\">();</span>\n<span class=\"o\">...</span>\n</pre></div>\n\n\n<p>When I start Gazebo and load the sdf I obtain for the positional part of the nested model</p>\n<div class=\"codehilite\"><pre><span></span>x = 1\ny = 1\nz = 1\n</pre></div>\n\n\n<p>and that is correct. However if I try to interact with the root model and with the nested model strange things happen. For example if I move the big box upward using the Translation Mode and then I release it the box falls due to gravity, together with the little box. The new position obtained is like (it depends on how much the box was moved upward)</p>\n<div class=\"codehilite\"><pre><span></span>x = 1\ny = 1\nz = 1.92\n</pre></div>\n\n\n<p>which is clearly wrong since the two objects, after the transient, are again in the initial position.\nIf I repeat the experiment the <code>z</code> coordinates increases further.</p>\n<p>Also if I try to move the little box relative to the big box, e.g. a robot pushes the little box on a plane parallel to the <code>x</code>-<code>y</code> plane of the inertial reference frame, the position is not updated at all.</p>\n<p>Is this behavior normal?</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "7.0", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/242744.json"}}}, "edited_on": null, "created_on": "2018-01-25T14:37:25.034103+00:00", "milestone": null, "updated_on": "2018-01-27T16:53:38.892253+00:00", "type": "issue", "id": 2410}