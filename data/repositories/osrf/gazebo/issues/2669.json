{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2669/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2669.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2669/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2669/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2669/sonarsensor_testcreatesonar-failures-with"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2669/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "SonarSensor_TEST.CreateSonar failures with dart", "component": {"name": "physics::DARTPhysics", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/139387.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "The `SonarSensor_TEST.CreateSonar` test cases in `UNIT_SonarSensor_TEST` occasionally fail for dart during teardown. I've uploaded a backtrace to the following gist:\r\n\r\n* https://gist.github.com/scpeters/09b10d03952af8adbffe47bd2632abea\r\n\r\nHere is the console output:\r\n\r\n~~~\r\n[ RUN      ] SonarTests/SonarSensor_TEST.CreateSonar/7\r\n[Dbg] [SonarSensor_TEST.cc:195] Physics dart paused 1\r\n[Msg] Waiting for master.\r\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n[Msg] Publicized address: 172.23.2.90\r\n[Dbg] [DARTModel.cc:72] Initializing DART model ground_plane\r\n[Dbg] [DARTModel.cc:128] Building DART BodyNode for link 'link' with a free joint.\r\nWarning [BodyNode.cpp:498] [BodyNode] A negative or zero mass [0] is set to BodyNode [link], which can cause invalid physical behavior or segfault. Consider setting positive value instead.\r\n[Dbg] [ServerFixture.cc:209] ServerFixture load in 0.7 seconds, timeout after 600 seconds\r\nWarning [parser.cc:540] Converting a deprecated SDF source[data-string].\r\n[Err] [Publisher.cc:101] Publishing an uninitialized message on topic[/gazebo/default/ground_plane/link/sonar/sonar]. Required field [sonar.geometry] missing.\r\n[Err] [Publisher.cc:101] Publishing an uninitialized message on topic[/gazebo/default/ground_plane/link/sonar/sonar]. Required field [sonar.geometry] missing.\r\n[Dbg] [ServerFixture.cc:135] ServerFixture::Unload\r\nWarning [World.cpp:355] [World::removeSkeleton] Skeleton [ground_plane] is not in the world.\r\n~~~\r\n\r\nHere is an excerpt of the backtrace showing a dart failure in the `~SonarSensor` destructor.\r\n\r\n~~~\r\n#0  0x00007f7c06594574 in  () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#1  0x00007f7c06594bca in dart::dynamics::JacobianNode::~JacobianNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#2  0x00007f7c06505ee7 in dart::dynamics::FixedJacobianNode::~FixedJacobianNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#3  0x00007f7c06601b64 in dart::dynamics::CompositeNode<dart::common::CompositeJoiner<dart::dynamics::FixedJacobianNode, dart::dynamics::ShapeFrame> >::~CompositeNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#4  0x00007f7c066024d3 in dart::dynamics::ShapeNode::~ShapeNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#5  0x00007f7c066026c1 in dart::dynamics::ShapeNode::~ShapeNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#6  0x00007f7c065c4bc2 in dart::dynamics::NodeDestructor::~NodeDestructor() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#7  0x00007f7c064e961a in std::_Sp_counted_ptr<dart::dynamics::NodeDestructor*, (__gnu_cxx::_Lock_policy)2>::_M_dispose() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\r\n#8  0x00007f7c0e1ade0c in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (this=0x558e21ebdc60) at /usr/include/c++/8/bits/shared_ptr_base.h:148\r\n#9  0x00007f7c0e1ade0c in std::_Sp_counted_base<(__gnu_cxx::_Lock_policy)2>::_M_release() (this=0x558e21ebdc60) at /usr/include/c++/8/bits/shared_ptr_base.h:148\r\n#10 0x00007f7c0e1ade0c in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() (this=0x558e21bf29a0, __in_chrg=<optimized out>) at /usr/include/c++/8/bits/shared_ptr_base.h:728\r\n#11 0x00007f7c0e1ade0c in std::__shared_ptr<dart::dynamics::NodeDestructor, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() (this=0x558e21bf2998, __in_chrg=<optimized out>) at /usr/include/c++/8/bits/shared_ptr_base.h:1167\r\n#12 0x00007f7c0e1ade0c in std::shared_ptr<dart::dynamics::NodeDestructor>::~shared_ptr() (this=0x558e21bf2998, __in_chrg=<optimized out>) at /usr/include/c++/8/bits/shared_ptr.h:103\r\n#13 0x00007f7c0e1ade0c in dart::dynamics::TemplateNodePtr<dart::dynamics::ShapeNode, dart::dynamics::BodyNode>::~TemplateNodePtr() (this=0x558e21bf2990, __in_chrg=<optimized out>) at /usr/include/dart/dynamics/detail/NodePtr.hpp:49\r\n#14 0x00007f7c0e1ade0c in gazebo::physics::DARTCollisionPrivate::~DARTCollisionPrivate() (this=0x558e21bf2990, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTCollisionPrivate.hh:40\r\n#15 0x00007f7c0e1ade0c in gazebo::physics::DARTCollision::~DARTCollision() (this=0x558e21d17030, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTCollision.cc:47\r\n#16 0x00007f7c0e1ade99 in gazebo::physics::DARTCollision::~DARTCollision() (this=0x558e21d17030, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTCollision.cc:45\r\n#17 0x00007f7c0e2b187a in boost::detail::sp_counted_base::release() (this=0x558e21bf2b10) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:110\r\n#18 0x00007f7c0e2b187a in boost::detail::sp_counted_base::release() (this=0x558e21bf2b10) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:106\r\n#19 0x00007f7c0e2b187a in boost::detail::shared_count::~shared_count() (this=0x558e21bf2c28, __in_chrg=<optimized out>) at /usr/include/boost/smart_ptr/detail/shared_count.hpp:426\r\n#20 0x00007f7c0e2b187a in boost::shared_ptr<gazebo::physics::Collision>::~shared_ptr() (this=0x558e21bf2c20, __in_chrg=<optimized out>) at /usr/include/boost/smart_ptr/shared_ptr.hpp:341\r\n#21 0x00007f7c0e2b187a in gazebo::physics::Shape::~Shape() (this=0x558e21bf2b30, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/Shape.cc:43\r\n#22 0x00007f7c0e1cc179 in gazebo::physics::DARTMeshShape::~DARTMeshShape() (this=0x558e21bf2b30, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTMeshShape.cc:41\r\n#23 0x00007f7c0eafb5da in boost::detail::sp_counted_base::release() (this=0x558e21bf4230) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:110\r\n#24 0x00007f7c0eafb5da in boost::detail::sp_counted_base::release() (this=0x558e21bf4230) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:106\r\n#25 0x00007f7c0eb417cd in boost::detail::shared_count::~shared_count() (this=<optimized out>, __in_chrg=<optimized out>) at /usr/include/boost/smart_ptr/detail/shared_count.hpp:426\r\n#26 0x00007f7c0eb417cd in boost::shared_ptr<gazebo::physics::MeshShape>::~shared_ptr() (this=<optimized out>, __in_chrg=<optimized out>) at /usr/include/boost/smart_ptr/shared_ptr.hpp:341\r\n#27 0x00007f7c0eb417cd in boost::shared_ptr<gazebo::physics::MeshShape>::reset() (this=0x558e21c33710) at /usr/include/boost/smart_ptr/shared_ptr.hpp:693\r\n#28 0x00007f7c0eb417cd in gazebo::sensors::SonarSensor::~SonarSensor() (this=0x558e21ca6160, __in_chrg=<optimized out>) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/sensors/SonarSensor.cc:63\r\n...\r\n~~~", "markup": "markdown", "html": "<p>The <code>SonarSensor_TEST.CreateSonar</code> test cases in <code>UNIT_SonarSensor_TEST</code> occasionally fail for dart during teardown. I've uploaded a backtrace to the following gist:</p>\n<ul>\n<li><a href=\"https://gist.github.com/scpeters/09b10d03952af8adbffe47bd2632abea\" rel=\"nofollow\" class=\"ap-connect-link\">https://gist.github.com/scpeters/09b10d03952af8adbffe47bd2632abea</a></li>\n</ul>\n<p>Here is the console output:</p>\n<div class=\"codehilite\"><pre><span></span>[ RUN      ] SonarTests/SonarSensor_TEST.CreateSonar/7\n[Dbg] [SonarSensor_TEST.cc:195] Physics dart paused 1\n[Msg] Waiting for master.\n[Msg] Connected to gazebo master @ http://127.0.0.1:11345\n[Msg] Publicized address: 172.23.2.90\n[Dbg] [DARTModel.cc:72] Initializing DART model ground_plane\n[Dbg] [DARTModel.cc:128] Building DART BodyNode for link &#39;link&#39; with a free joint.\nWarning [BodyNode.cpp:498] [BodyNode] A negative or zero mass [0] is set to BodyNode [link], which can cause invalid physical behavior or segfault. Consider setting positive value instead.\n[Dbg] [ServerFixture.cc:209] ServerFixture load in 0.7 seconds, timeout after 600 seconds\nWarning [parser.cc:540] Converting a deprecated SDF source[data-string].\n[Err] [Publisher.cc:101] Publishing an uninitialized message on topic[/gazebo/default/ground_plane/link/sonar/sonar]. Required field [sonar.geometry] missing.\n[Err] [Publisher.cc:101] Publishing an uninitialized message on topic[/gazebo/default/ground_plane/link/sonar/sonar]. Required field [sonar.geometry] missing.\n[Dbg] [ServerFixture.cc:135] ServerFixture::Unload\nWarning [World.cpp:355] [World::removeSkeleton] Skeleton [ground_plane] is not in the world.\n</pre></div>\n\n\n<p>Here is an excerpt of the backtrace showing a dart failure in the <code>~SonarSensor</code> destructor.</p>\n<div class=\"codehilite\"><pre><span></span>#0  0x00007f7c06594574 in  () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#1  0x00007f7c06594bca in dart::dynamics::JacobianNode::~JacobianNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#2  0x00007f7c06505ee7 in dart::dynamics::FixedJacobianNode::~FixedJacobianNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#3  0x00007f7c06601b64 in dart::dynamics::CompositeNode&lt;dart::common::CompositeJoiner&lt;dart::dynamics::FixedJacobianNode, dart::dynamics::ShapeFrame&gt; &gt;::~CompositeNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#4  0x00007f7c066024d3 in dart::dynamics::ShapeNode::~ShapeNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#5  0x00007f7c066026c1 in dart::dynamics::ShapeNode::~ShapeNode() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#6  0x00007f7c065c4bc2 in dart::dynamics::NodeDestructor::~NodeDestructor() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#7  0x00007f7c064e961a in std::_Sp_counted_ptr&lt;dart::dynamics::NodeDestructor*, (__gnu_cxx::_Lock_policy)2&gt;::_M_dispose() () at /usr/lib/x86_64-linux-gnu/libdart.so.6.10\n#8  0x00007f7c0e1ade0c in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release() (this=0x558e21ebdc60) at /usr/include/c++/8/bits/shared_ptr_base.h:148\n#9  0x00007f7c0e1ade0c in std::_Sp_counted_base&lt;(__gnu_cxx::_Lock_policy)2&gt;::_M_release() (this=0x558e21ebdc60) at /usr/include/c++/8/bits/shared_ptr_base.h:148\n#10 0x00007f7c0e1ade0c in std::__shared_count&lt;(__gnu_cxx::_Lock_policy)2&gt;::~__shared_count() (this=0x558e21bf29a0, __in_chrg=&lt;optimized out&gt;) at /usr/include/c++/8/bits/shared_ptr_base.h:728\n#11 0x00007f7c0e1ade0c in std::__shared_ptr&lt;dart::dynamics::NodeDestructor, (__gnu_cxx::_Lock_policy)2&gt;::~__shared_ptr() (this=0x558e21bf2998, __in_chrg=&lt;optimized out&gt;) at /usr/include/c++/8/bits/shared_ptr_base.h:1167\n#12 0x00007f7c0e1ade0c in std::shared_ptr&lt;dart::dynamics::NodeDestructor&gt;::~shared_ptr() (this=0x558e21bf2998, __in_chrg=&lt;optimized out&gt;) at /usr/include/c++/8/bits/shared_ptr.h:103\n#13 0x00007f7c0e1ade0c in dart::dynamics::TemplateNodePtr&lt;dart::dynamics::ShapeNode, dart::dynamics::BodyNode&gt;::~TemplateNodePtr() (this=0x558e21bf2990, __in_chrg=&lt;optimized out&gt;) at /usr/include/dart/dynamics/detail/NodePtr.hpp:49\n#14 0x00007f7c0e1ade0c in gazebo::physics::DARTCollisionPrivate::~DARTCollisionPrivate() (this=0x558e21bf2990, __in_chrg=&lt;optimized out&gt;) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTCollisionPrivate.hh:40\n#15 0x00007f7c0e1ade0c in gazebo::physics::DARTCollision::~DARTCollision() (this=0x558e21d17030, __in_chrg=&lt;optimized out&gt;) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTCollision.cc:47\n#16 0x00007f7c0e1ade99 in gazebo::physics::DARTCollision::~DARTCollision() (this=0x558e21d17030, __in_chrg=&lt;optimized out&gt;) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTCollision.cc:45\n#17 0x00007f7c0e2b187a in boost::detail::sp_counted_base::release() (this=0x558e21bf2b10) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:110\n#18 0x00007f7c0e2b187a in boost::detail::sp_counted_base::release() (this=0x558e21bf2b10) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:106\n#19 0x00007f7c0e2b187a in boost::detail::shared_count::~shared_count() (this=0x558e21bf2c28, __in_chrg=&lt;optimized out&gt;) at /usr/include/boost/smart_ptr/detail/shared_count.hpp:426\n#20 0x00007f7c0e2b187a in boost::shared_ptr&lt;gazebo::physics::Collision&gt;::~shared_ptr() (this=0x558e21bf2c20, __in_chrg=&lt;optimized out&gt;) at /usr/include/boost/smart_ptr/shared_ptr.hpp:341\n#21 0x00007f7c0e2b187a in gazebo::physics::Shape::~Shape() (this=0x558e21bf2b30, __in_chrg=&lt;optimized out&gt;) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/Shape.cc:43\n#22 0x00007f7c0e1cc179 in gazebo::physics::DARTMeshShape::~DARTMeshShape() (this=0x558e21bf2b30, __in_chrg=&lt;optimized out&gt;) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/physics/dart/DARTMeshShape.cc:41\n#23 0x00007f7c0eafb5da in boost::detail::sp_counted_base::release() (this=0x558e21bf4230) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:110\n#24 0x00007f7c0eafb5da in boost::detail::sp_counted_base::release() (this=0x558e21bf4230) at /usr/include/boost/smart_ptr/detail/sp_counted_base_std_atomic.hpp:106\n#25 0x00007f7c0eb417cd in boost::detail::shared_count::~shared_count() (this=&lt;optimized out&gt;, __in_chrg=&lt;optimized out&gt;) at /usr/include/boost/smart_ptr/detail/shared_count.hpp:426\n#26 0x00007f7c0eb417cd in boost::shared_ptr&lt;gazebo::physics::MeshShape&gt;::~shared_ptr() (this=&lt;optimized out&gt;, __in_chrg=&lt;optimized out&gt;) at /usr/include/boost/smart_ptr/shared_ptr.hpp:341\n#27 0x00007f7c0eb417cd in boost::shared_ptr&lt;gazebo::physics::MeshShape&gt;::reset() (this=0x558e21c33710) at /usr/include/boost/smart_ptr/shared_ptr.hpp:693\n#28 0x00007f7c0eb417cd in gazebo::sensors::SonarSensor::~SonarSensor() (this=0x558e21ca6160, __in_chrg=&lt;optimized out&gt;) at /data_fast/scpeters/ws/gazebo8/src/gazebo/gazebo/sensors/SonarSensor.cc:63\n...\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2019-11-08T01:51:34.650895+00:00", "milestone": null, "updated_on": "2019-11-08T01:51:34.650895+00:00", "type": "issue", "id": 2669}