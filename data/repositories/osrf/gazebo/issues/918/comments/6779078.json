{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/918/comments/6779078.json"}, "html": {"href": "#!/osrf/gazebo/issues/918#comment-6779078"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/918.json"}}, "type": "issue", "id": 918, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "SimbodyLink::GetWorldAngularVel and others are not thread safe"}, "content": {"raw": "tried with display off\n~~~\nDISPLAY=:100 ../build_release/test/integration/INTEGRATION_speed --gtest_filter=\"*SpeedTest.ShapesWorld/2\"\n~~~\n\ntest fails:\n~~~\nNote: Google Test filter = *SpeedTest.ShapesWorld/2\n[==========] Running 1 test from 1 test case.\n[----------] Global test environment set-up.\n[----------] 1 test from PhysicsEngines/SpeedTest\n[ RUN      ] PhysicsEngines/SpeedTest.ShapesWorld/2\nMsg Waiting for master\nMsg Connected to gazebo master @ http://127.0.0.1:12349\nMsg Publicized address: 192.168.1.162\nError [RenderEngine.cc:636] Can't open display: :100\nWarning [RenderEngine.cc:92] Unable to create X window. Rendering will be disabled\nDbg ServerFixture load in 0.03 seconds, timeout after 60 seconds\nterminate called after throwing an instance of 'boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::lock_error> >'\n  what():  boost::lock_error\nAborted (core dumped)\n~~~\n\ngot a core file:\n~~~\n(gdb) bt\n#0  0x00007fbeaeb0a425 in __GI_raise (sig=<optimized out>)\n    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007fbeaeb0db8b in __GI_abort () at abort.c:91\n#2  0x00007fbeaf45d69d in __gnu_cxx::__verbose_terminate_handler() ()\n   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007fbeaf45b846 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007fbeaf45b873 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007fbeaf45b96e in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00000000004d2734 in boost::throw_exception<boost::lock_error> (e=...)\n    at /usr/include/boost/throw_exception.hpp:61\n#7  0x00000000004cd39b in boost::mutex::lock (this=0x7fbe301fa370)\n    at /usr/include/boost/thread/pthread/mutex.hpp:55\n#8  0x00000000004d2d38 in boost::unique_lock<boost::mutex>::lock (this=0x7fbe9488da90)\n    at /usr/include/boost/thread/locks.hpp:412\n#9  0x00000000004d2821 in boost::unique_lock<boost::mutex>::unique_lock (this=0x7fbe9488da90, \n    m_=...) at /usr/include/boost/thread/locks.hpp:290\n#10 0x00007fbeb0d96f28 in gazebo::transport::Publisher::SendMessage (this=0x7fbe301fa330)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/Publisher.cc:163\n#11 0x00007fbeb0d84d71 in gazebo::transport::Node::ProcessPublishers (this=0x7fbe3028b0f0)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/Node.cc:140\n#12 0x00007fbeb0d99ff2 in gazebo::transport::TopicManager::ProcessNodes (this=0x78c3e0, \n    _onlyOut=false) at /home/hsu/projects/gazebo_default_24/gazebo/transport/TopicManager.cc:155\n#13 0x00007fbeb0d74653 in gazebo::transport::ConnectionManager::RunUpdate (this=0x78c580)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/ConnectionManager.cc:279\n#14 0x00007fbeb0d74807 in gazebo::transport::ConnectionManager::Run (this=0x78c580)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/ConnectionManager.cc:310\n#15 0x00007fbeb0d80a3a in boost::_mfi::mf0<void, gazebo::transport::ConnectionManager>::operator() (\n    this=0x7fbe8858cb48, p=0x78c580) at /usr/include/boost/bind/mem_fn_template.hpp:49\n#16 0x00007fbeb0d7fdc4 in boost::_bi::list1<boost::_bi::value<gazebo::transport::ConnectionManager*> >::operator()<boost::_mfi::mf0<void, gazebo::transport::ConnectionManager>, boost::_bi::list0> (\n    this=0x7fbe8858cb58, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#17 0x00007fbeb0d7f54f in boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::transport::ConnectionManager>, boost::_bi::list1<boost::_bi::value<gazebo::transport::ConnectionManager*> > >::operator() (this=0x7fbe8858cb48) at /usr/include/boost/bind/bind_template.hpp:20\n#18 0x00007fbeb0da7ffc in boost::detail::thread_data<boost::_bi::bind_t<void, boost::_mfi::mf0<void, gazebo::transport::ConnectionManager>, boost::_bi::list1<boost::_bi::value<gazebo::transport::ConnectionManager*> > > >::run (this=0x7fbe8858c9c0) at /usr/include/boost/thread/detail/thread.hpp:61\n#19 0x00007fbeafd48ce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#20 0x00007fbeb0a3fe9a in start_thread (arg=0x7fbe9488e700) at pthread_create.c:308\n#21 0x00007fbeaebc83fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#22 0x0000000000000000 in ?? ()\n(gdb) \n~~~\n\nLooks like [`Publisher::SendMessage()`](#!/osrf/gazebo/src/7c5787779908c1f00f4aba331656b001adaafe7c/gazebo/transport/Publisher.cc?at=default#cl-157) might be called multiple times.", "markup": "markdown", "html": "<p>tried with display off</p>\n<div class=\"codehilite\"><pre><span></span>DISPLAY=:100 ../build_release/test/integration/INTEGRATION_speed --gtest_filter=&quot;*SpeedTest.ShapesWorld/2&quot;\n</pre></div>\n\n\n<p>test fails:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">Note</span><span class=\"o\">:</span> <span class=\"n\">Google</span> <span class=\"n\">Test</span> <span class=\"n\">filter</span> <span class=\"o\">=</span> <span class=\"o\">*</span><span class=\"n\">SpeedTest</span><span class=\"o\">.</span><span class=\"na\">ShapesWorld</span><span class=\"o\">/</span><span class=\"mi\">2</span>\n<span class=\"o\">[==========]</span> <span class=\"n\">Running</span> <span class=\"mi\">1</span> <span class=\"n\">test</span> <span class=\"n\">from</span> <span class=\"mi\">1</span> <span class=\"n\">test</span> <span class=\"k\">case</span><span class=\"o\">.</span>\n<span class=\"o\">[----------]</span> <span class=\"n\">Global</span> <span class=\"n\">test</span> <span class=\"n\">environment</span> <span class=\"kd\">set</span><span class=\"o\">-</span><span class=\"n\">up</span><span class=\"o\">.</span>\n<span class=\"o\">[----------]</span> <span class=\"mi\">1</span> <span class=\"n\">test</span> <span class=\"n\">from</span> <span class=\"n\">PhysicsEngines</span><span class=\"o\">/</span><span class=\"n\">SpeedTest</span>\n<span class=\"o\">[</span> <span class=\"n\">RUN</span>      <span class=\"o\">]</span> <span class=\"n\">PhysicsEngines</span><span class=\"sr\">/SpeedTest.ShapesWorld/</span><span class=\"mi\">2</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Waiting</span> <span class=\"k\">for</span> <span class=\"n\">master</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">gazebo</span> <span class=\"n\">master</span> <span class=\"err\">@</span> <span class=\"n\">http</span><span class=\"o\">://</span><span class=\"mf\">127.0</span><span class=\"o\">.</span><span class=\"mf\">0.1</span><span class=\"o\">:</span><span class=\"mi\">12349</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Publicized</span> <span class=\"n\">address</span><span class=\"o\">:</span> <span class=\"mf\">192.168</span><span class=\"o\">.</span><span class=\"mf\">1.162</span>\n<span class=\"n\">Error</span> <span class=\"o\">[</span><span class=\"n\">RenderEngine</span><span class=\"o\">.</span><span class=\"na\">cc</span><span class=\"o\">:</span><span class=\"mi\">636</span><span class=\"o\">]</span> <span class=\"n\">Can</span><span class=\"s1\">&#39;t open display: :100</span>\n<span class=\"s1\">Warning [RenderEngine.cc:92] Unable to create X window. Rendering will be disabled</span>\n<span class=\"s1\">Dbg ServerFixture load in 0.03 seconds, timeout after 60 seconds</span>\n<span class=\"s1\">terminate called after throwing an instance of &#39;</span><span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">exception_detail</span><span class=\"o\">::</span><span class=\"n\">clone_impl</span><span class=\"o\">&lt;</span><span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">exception_detail</span><span class=\"o\">::</span><span class=\"n\">error_info_injector</span><span class=\"o\">&lt;</span><span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">lock_error</span><span class=\"o\">&gt;</span> <span class=\"o\">&gt;</span><span class=\"err\">&#39;</span>\n  <span class=\"n\">what</span><span class=\"o\">():</span>  <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">lock_error</span>\n<span class=\"n\">Aborted</span> <span class=\"o\">(</span><span class=\"n\">core</span> <span class=\"n\">dumped</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>got a core file:</p>\n<div class=\"codehilite\"><pre><span></span>(gdb) bt\n#0  0x00007fbeaeb0a425 in __GI_raise (sig=&lt;optimized out&gt;)\n    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007fbeaeb0db8b in __GI_abort () at abort.c:91\n#2  0x00007fbeaf45d69d in __gnu_cxx::__verbose_terminate_handler() ()\n   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007fbeaf45b846 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007fbeaf45b873 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007fbeaf45b96e in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00000000004d2734 in boost::throw_exception&lt;boost::lock_error&gt; (e=...)\n    at /usr/include/boost/throw_exception.hpp:61\n#7  0x00000000004cd39b in boost::mutex::lock (this=0x7fbe301fa370)\n    at /usr/include/boost/thread/pthread/mutex.hpp:55\n#8  0x00000000004d2d38 in boost::unique_lock&lt;boost::mutex&gt;::lock (this=0x7fbe9488da90)\n    at /usr/include/boost/thread/locks.hpp:412\n#9  0x00000000004d2821 in boost::unique_lock&lt;boost::mutex&gt;::unique_lock (this=0x7fbe9488da90, \n    m_=...) at /usr/include/boost/thread/locks.hpp:290\n#10 0x00007fbeb0d96f28 in gazebo::transport::Publisher::SendMessage (this=0x7fbe301fa330)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/Publisher.cc:163\n#11 0x00007fbeb0d84d71 in gazebo::transport::Node::ProcessPublishers (this=0x7fbe3028b0f0)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/Node.cc:140\n#12 0x00007fbeb0d99ff2 in gazebo::transport::TopicManager::ProcessNodes (this=0x78c3e0, \n    _onlyOut=false) at /home/hsu/projects/gazebo_default_24/gazebo/transport/TopicManager.cc:155\n#13 0x00007fbeb0d74653 in gazebo::transport::ConnectionManager::RunUpdate (this=0x78c580)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/ConnectionManager.cc:279\n#14 0x00007fbeb0d74807 in gazebo::transport::ConnectionManager::Run (this=0x78c580)\n    at /home/hsu/projects/gazebo_default_24/gazebo/transport/ConnectionManager.cc:310\n#15 0x00007fbeb0d80a3a in boost::_mfi::mf0&lt;void, gazebo::transport::ConnectionManager&gt;::operator() (\n    this=0x7fbe8858cb48, p=0x78c580) at /usr/include/boost/bind/mem_fn_template.hpp:49\n#16 0x00007fbeb0d7fdc4 in boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::transport::ConnectionManager*&gt; &gt;::operator()&lt;boost::_mfi::mf0&lt;void, gazebo::transport::ConnectionManager&gt;, boost::_bi::list0&gt; (\n    this=0x7fbe8858cb58, f=..., a=...) at /usr/include/boost/bind/bind.hpp:253\n#17 0x00007fbeb0d7f54f in boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::transport::ConnectionManager&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::transport::ConnectionManager*&gt; &gt; &gt;::operator() (this=0x7fbe8858cb48) at /usr/include/boost/bind/bind_template.hpp:20\n#18 0x00007fbeb0da7ffc in boost::detail::thread_data&lt;boost::_bi::bind_t&lt;void, boost::_mfi::mf0&lt;void, gazebo::transport::ConnectionManager&gt;, boost::_bi::list1&lt;boost::_bi::value&lt;gazebo::transport::ConnectionManager*&gt; &gt; &gt; &gt;::run (this=0x7fbe8858c9c0) at /usr/include/boost/thread/detail/thread.hpp:61\n#19 0x00007fbeafd48ce9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#20 0x00007fbeb0a3fe9a in start_thread (arg=0x7fbe9488e700) at pthread_create.c:308\n#21 0x00007fbeaebc83fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#22 0x0000000000000000 in ?? ()\n(gdb) \n</pre></div>\n\n\n<p>Looks like <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/7c5787779908c1f00f4aba331656b001adaafe7c/gazebo/transport/Publisher.cc?at=default#cl-157\" rel=\"nofollow\"><code>Publisher::SendMessage()</code></a> might be called multiple times.</p>", "type": "rendered"}, "created_on": "2013-11-06T17:25:39.017105+00:00", "user": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "updated_on": "2013-11-06T21:31:24.957899+00:00", "type": "issue_comment", "id": 6779078}