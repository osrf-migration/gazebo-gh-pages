{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2133/comments/33900686.json"}, "html": {"href": "#!/osrf/gazebo/issues/2133#comment-33900686"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2133.json"}}, "type": "issue", "id": 2133, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Qt5: GUI overlay plugins not working?"}, "content": {"raw": "Phew, this one was a pickle to find!\n\nI got a solution now, though not sure how universal this is or if it's only on my system. The problem was in [WindowManager::CreateWindow](#!/osrf/gazebo/src/8d35d7d913a368dc6d39105fa42c4ff05a4e858e/gazebo/rendering/WindowManager.cc?at=default&fileviewer=file-view-default#WindowManager.cc-102), it affects \"parentWindowHandle\" which for me was causing the problem. If I use \"externalWindowHandle\" instead, everything works (I'm on xenial). I tried \"currentGLContext\" too but that just opens the GLWidget in a separate window.\nI haven't tested this on Windows or Mac.\n\nUnfortunately this works only with Qt::WA_PaintOnScreen enabled, otherwise I get a weird flickering. [According to this]( http://blog.qt.io/blog/2009/12/16/qt-graphics-and-performance-an-overview/) (though old post), Qt::WA_PaintOnScreen should not be used any more, and as @iche033 pointed out, it was causing test failures on Mac...\n\nLet me know what you think in terms of posting a PR to fix this. Should we maybe #ifndef out Qt::WA_PaintOnScreen for Mac only? \nCould you maybe test on your systems if it works for you with \"externalWindowHandle\" instead of \"parentWindowHandle\"?\n\n**UPDATE:**\n\nAccording to [this](http://www.ogre3d.org/docs/api/1.9/class_ogre_1_1_root.html#a537b7d1d0937f799cfe4936f6b672620) it makes sense to use external window and not parent window:\n\n* *externalWindowHandle:* External window handle, for embedding the OGRE render in an existing window \n* *parentWindowHandle:* Parent window handle, for embedding the OGRE in a child of an external window (also, there is no mention in the types/values column of Mac support?!)\n\nWe want to embed it in the GLWidget itself, so I'd guess externalWindowHandle is a valid choice, which is why it works. However one could also argue that GLWidget is a child of MainWindow, even though not a direct child because RenderWidget and RenderWidget::mainFrame are in-between parents... which lead me to find that [mainFrame doesn't have a parent](#!/osrf/gazebo/src/8d35d7d913a368dc6d39105fa42c4ff05a4e858e/gazebo/gui/RenderWidget.cc?at=default&fileviewer=file-view-default#RenderWidget.cc-50), which means the chain is broken... if this is fixed, I can actually use parentWindowHandle:\n\n```cpp\nthis->mainFrame = new QFrame(this);\n```\n\nI have updated pull request #2562 with this minor change, this works for me now, though Qt::WA_PaintOnScreen is still required, or it doesn't show up (no flickering though).\n\nNew issue: The cessna and keyboard GUI plugins create the black square which is meant to be avoided by [resizing to 0,0](#!/osrf/gazebo/src/8d35d7d913a368dc6d39105fa42c4ff05a4e858e/plugins/CessnaGUIPlugin.cc?at=default&fileviewer=file-view-default#CessnaGUIPlugin.cc-38). Solution: resize to [1,1] and move to [-1,-1] works, but it's a bit hacky (included in pull request #2562).", "markup": "markdown", "html": "<p>Phew, this one was a pickle to find!</p>\n<p>I got a solution now, though not sure how universal this is or if it's only on my system. The problem was in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/8d35d7d913a368dc6d39105fa42c4ff05a4e858e/gazebo/rendering/WindowManager.cc?at=default&amp;fileviewer=file-view-default#WindowManager.cc-102\" rel=\"nofollow\">WindowManager::CreateWindow</a>, it affects \"parentWindowHandle\" which for me was causing the problem. If I use \"externalWindowHandle\" instead, everything works (I'm on xenial). I tried \"currentGLContext\" too but that just opens the GLWidget in a separate window.\nI haven't tested this on Windows or Mac.</p>\n<p>Unfortunately this works only with Qt::WA_PaintOnScreen enabled, otherwise I get a weird flickering. <a data-is-external-link=\"true\" href=\"http://blog.qt.io/blog/2009/12/16/qt-graphics-and-performance-an-overview/\" rel=\"nofollow\">According to this</a> (though old post), Qt::WA_PaintOnScreen should not be used any more, and as @iche033 pointed out, it was causing test failures on Mac...</p>\n<p>Let me know what you think in terms of posting a PR to fix this. Should we maybe #ifndef out Qt::WA_PaintOnScreen for Mac only? \nCould you maybe test on your systems if it works for you with \"externalWindowHandle\" instead of \"parentWindowHandle\"?</p>\n<p><strong>UPDATE:</strong></p>\n<p>According to <a data-is-external-link=\"true\" href=\"http://www.ogre3d.org/docs/api/1.9/class_ogre_1_1_root.html#a537b7d1d0937f799cfe4936f6b672620\" rel=\"nofollow\">this</a> it makes sense to use external window and not parent window:</p>\n<ul>\n<li><em>externalWindowHandle:</em> External window handle, for embedding the OGRE render in an existing window </li>\n<li><em>parentWindowHandle:</em> Parent window handle, for embedding the OGRE in a child of an external window (also, there is no mention in the types/values column of Mac support?!)</li>\n</ul>\n<p>We want to embed it in the GLWidget itself, so I'd guess externalWindowHandle is a valid choice, which is why it works. However one could also argue that GLWidget is a child of MainWindow, even though not a direct child because RenderWidget and RenderWidget::mainFrame are in-between parents... which lead me to find that <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/8d35d7d913a368dc6d39105fa42c4ff05a4e858e/gazebo/gui/RenderWidget.cc?at=default&amp;fileviewer=file-view-default#RenderWidget.cc-50\" rel=\"nofollow\">mainFrame doesn't have a parent</a>, which means the chain is broken... if this is fixed, I can actually use parentWindowHandle:</p>\n<div class=\"codehilite language-cpp\"><pre><span></span><span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">mainFrame</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">QFrame</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"p\">);</span>\n</pre></div>\n\n\n<p>I have updated <a href=\"#!/osrf/gazebo/pull-requests/2562/load-gui-plugins-with-gzclient-parameter-g\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2562</a> with this minor change, this works for me now, though Qt::WA_PaintOnScreen is still required, or it doesn't show up (no flickering though).</p>\n<p>New issue: The cessna and keyboard GUI plugins create the black square which is meant to be avoided by <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/8d35d7d913a368dc6d39105fa42c4ff05a4e858e/plugins/CessnaGUIPlugin.cc?at=default&amp;fileviewer=file-view-default#CessnaGUIPlugin.cc-38\" rel=\"nofollow\">resizing to 0,0</a>. Solution: resize to [1,1] and move to [-1,-1] works, but it's a bit hacky (included in <a href=\"#!/osrf/gazebo/pull-requests/2562/load-gui-plugins-with-gzclient-parameter-g\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2562</a>).</p>", "type": "rendered"}, "created_on": "2017-01-24T06:03:06.755724+00:00", "user": {"display_name": "Jennifer Buehler", "uuid": "{5949baad-8c43-4d52-9a82-bb8c3511fed8}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5949baad-8c43-4d52-9a82-bb8c3511fed8%7D"}, "html": {"href": "https://bitbucket.org/%7B5949baad-8c43-4d52-9a82-bb8c3511fed8%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/b28ae0e95eada6ee16f0860c1fa59fdcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJB-4.png"}}, "nickname": "JenniferBuehler", "type": "user", "account_id": "557058:96bd489a-ec14-4a06-8d31-7bb6d46d1209"}, "updated_on": "2017-01-24T07:50:43.758029+00:00", "type": "issue_comment", "id": 33900686}