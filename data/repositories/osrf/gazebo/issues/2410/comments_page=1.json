{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42864730.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42864730"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "created_on": "2018-01-25T14:38:58.275427+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": null, "type": "issue_comment", "id": 42864730}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42871071.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42871071"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "Thanks for the report. I'd like to help, but it's hard without more details. If you can upload a complete model and example of your plugin, we can try to reproduce your issue.", "markup": "markdown", "html": "<p>Thanks for the report. I'd like to help, but it's hard without more details. If you can upload a complete model and example of your plugin, we can try to reproduce your issue.</p>", "type": "rendered"}, "created_on": "2018-01-25T19:44:20.615841+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 42871071}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42873405.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42873405"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "Thank you Steven. Sure I can upload them.\n\nI will upload two files \n\n* ModelPosePublisher.hh\n* ModelPosePublisher.cc\n\ncontaining the plugin that prints the position of the model (I think it's pretty standard code)\n\nand two files for the model\n\n* model.config\n* model.sdf", "markup": "markdown", "html": "<p>Thank you Steven. Sure I can upload them.</p>\n<p>I will upload two files </p>\n<ul>\n<li>ModelPosePublisher.hh</li>\n<li>ModelPosePublisher.cc</li>\n</ul>\n<p>containing the plugin that prints the position of the model (I think it's pretty standard code)</p>\n<p>and two files for the model</p>\n<ul>\n<li>model.config</li>\n<li>model.sdf</li>\n</ul>", "type": "rendered"}, "created_on": "2018-01-25T22:38:23.627289+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": "2018-01-25T22:39:21.089884+00:00", "type": "issue_comment", "id": 42873405}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42873423.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42873423"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "Implementation of plugin", "markup": "markdown", "html": "<p>Implementation of plugin</p>", "type": "rendered"}, "created_on": "2018-01-25T22:40:03.144712+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": null, "type": "issue_comment", "id": 42873423}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42873431.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42873431"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "Header of plugin", "markup": "markdown", "html": "<p>Header of plugin</p>", "type": "rendered"}, "created_on": "2018-01-25T22:40:24.480708+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": null, "type": "issue_comment", "id": 42873431}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42873455.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42873455"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "Model .config and .sdf", "markup": "markdown", "html": "<p>Model .config and .sdf</p>", "type": "rendered"}, "created_on": "2018-01-25T22:42:44.271156+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": null, "type": "issue_comment", "id": 42873455}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42873529.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42873529"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "The first thing that you could do to reproduce the problem is to select the whole model and use the Translation Mode to move it upward. When the selection is released the box and the little box on top of it falls due to gravity and then the 'z' coordinate printed in the terminal will have a very strange value. Since the plugin is attached in the nested model, inside the SDF, the position  printed by the plugin should be that of the nested model. Am I right?", "markup": "markdown", "html": "<p>The first thing that you could do to reproduce the problem is to select the whole model and use the Translation Mode to move it upward. When the selection is released the box and the little box on top of it falls due to gravity and then the 'z' coordinate printed in the terminal will have a very strange value. Since the plugin is attached in the nested model, inside the SDF, the position  printed by the plugin should be that of the nested model. Am I right?</p>", "type": "rendered"}, "created_on": "2018-01-25T22:49:43.158139+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": null, "type": "issue_comment", "id": 42873529}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42894205.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42894205"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "I was able to reproduce the error with the following CMakeLists.txt:\n\n~~~\ncmake_minimum_required(VERSION 2.8 FATAL_ERROR)\n\nproject(issue_2410)\n\n# Find packages\n\nfind_package(Gazebo REQUIRED)\n\n# include appropriate directories\ninclude_directories(${GAZEBO_INCLUDE_DIRS})\nlink_directories(${GAZEBO_LIBRARY_DIRS})\nlist(APPEND CMAKE_CXX_FLAGS \"${GAZEBO_CXX_FLAGS}\")\n\n# Create libraries and executables\n\nadd_library(gazebo_modelPosePublisher SHARED ModelPosePublisher.cc)\ntarget_link_libraries(gazebo_modelPosePublisher ${GAZEBO_LIBRARIES})\n~~~\n\nI can't see that you've done anything wrong. I tried setting gravity to up and the box floats upward, but the printed pose doesn't change at all. This is probably a bug in updating the world pose of a nested model. I last fixed a bug in this logic in Entity.cc in pull request #2702 when fixing a bug in getting the world pose of a Collision. I'm guessing that's where this bug is coming from.", "markup": "markdown", "html": "<p>I was able to reproduce the error with the following CMakeLists.txt:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nb\">cmake_minimum_required</span><span class=\"p\">(</span><span class=\"s\">VERSION</span> <span class=\"s\">2.8</span> <span class=\"s\">FATAL_ERROR</span><span class=\"p\">)</span>\n\n<span class=\"nb\">project</span><span class=\"p\">(</span><span class=\"s\">issue_2410</span><span class=\"p\">)</span>\n\n<span class=\"c\"># Find packages</span>\n\n<span class=\"nb\">find_package</span><span class=\"p\">(</span><span class=\"s\">Gazebo</span> <span class=\"s\">REQUIRED</span><span class=\"p\">)</span>\n\n<span class=\"c\"># include appropriate directories</span>\n<span class=\"nb\">include_directories</span><span class=\"p\">(</span><span class=\"o\">${</span><span class=\"nv\">GAZEBO_INCLUDE_DIRS</span><span class=\"o\">}</span><span class=\"p\">)</span>\n<span class=\"nb\">link_directories</span><span class=\"p\">(</span><span class=\"o\">${</span><span class=\"nv\">GAZEBO_LIBRARY_DIRS</span><span class=\"o\">}</span><span class=\"p\">)</span>\n<span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"s\">APPEND</span> <span class=\"s\">CMAKE_CXX_FLAGS</span> <span class=\"s2\">&quot;${GAZEBO_CXX_FLAGS}&quot;</span><span class=\"p\">)</span>\n\n<span class=\"c\"># Create libraries and executables</span>\n\n<span class=\"nb\">add_library</span><span class=\"p\">(</span><span class=\"s\">gazebo_modelPosePublisher</span> <span class=\"s\">SHARED</span> <span class=\"s\">ModelPosePublisher.cc</span><span class=\"p\">)</span>\n<span class=\"nb\">target_link_libraries</span><span class=\"p\">(</span><span class=\"s\">gazebo_modelPosePublisher</span> <span class=\"o\">${</span><span class=\"nv\">GAZEBO_LIBRARIES</span><span class=\"o\">}</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>I can't see that you've done anything wrong. I tried setting gravity to up and the box floats upward, but the printed pose doesn't change at all. This is probably a bug in updating the world pose of a nested model. I last fixed a bug in this logic in Entity.cc in <a href=\"#!/osrf/gazebo/pull-requests/2702/fix-collision-getworldpose-for-non\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #2702</a> when fixing a bug in getting the world pose of a Collision. I'm guessing that's where this bug is coming from.</p>", "type": "rendered"}, "created_on": "2018-01-27T01:47:49.026027+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 42894205}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410/comments/42899387.json"}, "html": {"href": "#!/osrf/gazebo/issues/2410#comment-42899387"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2410.json"}}, "type": "issue", "id": 2410, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Wrong gazebo::physics::Model::WorldPose() for nested models"}, "content": {"raw": "Hi @scpeters thank you for taking time to try the code that I have attached.\n\nI  tried to read the code of the class `gazebo::physics::Entity` and I have some doubts regarding the way in which the pose of a nested model is updated.\n\nIn the method `gazebo::physics::Entity::Load` the initial world pose of the nested model is assigned like this\n```C++\nvoid Entity::Load(sdf::ElementPtr _sdf)\n{\n...\n    if (this->parent && this->parentEntity)\n    {\n      this->worldPose = this->sdf->Get<ignition::math::Pose3d>(\"pose\") +\n                        this->parentEntity->worldPose;\n    }\n...\n}\n```\ni.e. it is equal to the initial pose of the parent model + the static transform between the parent model and the nested model. Using symbols \n```\nnested_pose_0 = parent_pose_0 + sdf_pose\n```\n\nSuppose now that the nested model moves __relative__ to the parent model but the parent model does not move. Then when the physics engine updates the world pose of the parent model the method `gazebo::physics::Entity::SetWorldPoseModel` is called and the world pose of the nested model is updated within the `for` cycle in the `else if (entity->HasType(MODEL))` branch as\n```C++\nvoid Entity::SetWorldPoseModel(\n    const ignition::math::Pose3d &_pose,\n    const bool _notify, const bool _publish)\n{\n  ignition::math::Pose3d oldModelWorldPose = this->worldPose;\n\n  // initialization: (no children?) set own worldPose\n  this->worldPose = _pose;\n  this->worldPose.Correct();\n\n  ...\n  \n  // force an update of all children\n  // update all children pose, moving them with the model.\n  // The outer loop updates all the links.\n  for (Base_V::iterator iter = this->children.begin();\n      iter != this->children.end(); ++iter)\n  {\n    if ((*iter)->HasType(ENTITY))\n    {\n      EntityPtr entity = boost::static_pointer_cast<Entity>(*iter);\n\n      if (entity->HasType(LINK))\n      {\n        ...\n      }\n      else if (entity->HasType(MODEL))\n      {\n        // set pose of nested models\n        entity->SetWorldPoseModel(\n            (entity->worldPose - oldModelWorldPose) + _pose, _notify, _publish);\n      }\n      else\n      {\n        ...\n      }\n    }\n  }\n}\n```\nhence the world pose of a nested model is updated like\n```\nnested_pose_1 = (nested_pose_0 - parent_pose_0) + parent_pose_1\n              =  (parent_pose_0 + sdf_pose - parent_pose_0) + parent_pose_1\n              = sdf_pose + parent_pose_1\n              = (since the parent model does not move) sdf_pose + parent_pose_0\n              = nested_pose_0\n```\ni.e. relative motions between the nested and parent model is not considered at all.\n\nIs the reasoning right or am I missing something?", "markup": "markdown", "html": "<p>Hi @scpeters thank you for taking time to try the code that I have attached.</p>\n<p>I  tried to read the code of the class <code>gazebo::physics::Entity</code> and I have some doubts regarding the way in which the pose of a nested model is updated.</p>\n<p>In the method <code>gazebo::physics::Entity::Load</code> the initial world pose of the nested model is assigned like this</p>\n<div class=\"codehilite language-C++\"><pre><span></span><span class=\"kt\">void</span> <span class=\"n\">Entity</span><span class=\"o\">::</span><span class=\"n\">Load</span><span class=\"p\">(</span><span class=\"n\">sdf</span><span class=\"o\">::</span><span class=\"n\">ElementPtr</span> <span class=\"n\">_sdf</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n<span class=\"p\">...</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">parent</span> <span class=\"o\">&amp;&amp;</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">parentEntity</span><span class=\"p\">)</span>\n    <span class=\"p\">{</span>\n      <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">worldPose</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">sdf</span><span class=\"o\">-&gt;</span><span class=\"n\">Get</span><span class=\"o\">&lt;</span><span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">math</span><span class=\"o\">::</span><span class=\"n\">Pose3d</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;pose&quot;</span><span class=\"p\">)</span> <span class=\"o\">+</span>\n                        <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">parentEntity</span><span class=\"o\">-&gt;</span><span class=\"n\">worldPose</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">...</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>i.e. it is equal to the initial pose of the parent model + the static transform between the parent model and the nested model. Using symbols </p>\n<div class=\"codehilite\"><pre><span></span>nested_pose_0 = parent_pose_0 + sdf_pose\n</pre></div>\n\n\n<p>Suppose now that the nested model moves <strong>relative</strong> to the parent model but the parent model does not move. Then when the physics engine updates the world pose of the parent model the method <code>gazebo::physics::Entity::SetWorldPoseModel</code> is called and the world pose of the nested model is updated within the <code>for</code> cycle in the <code>else if (entity-&gt;HasType(MODEL))</code> branch as</p>\n<div class=\"codehilite language-C++\"><pre><span></span><span class=\"kt\">void</span> <span class=\"n\">Entity</span><span class=\"o\">::</span><span class=\"n\">SetWorldPoseModel</span><span class=\"p\">(</span>\n    <span class=\"k\">const</span> <span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">math</span><span class=\"o\">::</span><span class=\"n\">Pose3d</span> <span class=\"o\">&amp;</span><span class=\"n\">_pose</span><span class=\"p\">,</span>\n    <span class=\"k\">const</span> <span class=\"kt\">bool</span> <span class=\"n\">_notify</span><span class=\"p\">,</span> <span class=\"k\">const</span> <span class=\"kt\">bool</span> <span class=\"n\">_publish</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">math</span><span class=\"o\">::</span><span class=\"n\">Pose3d</span> <span class=\"n\">oldModelWorldPose</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">worldPose</span><span class=\"p\">;</span>\n\n  <span class=\"c1\">// initialization: (no children?) set own worldPose</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">worldPose</span> <span class=\"o\">=</span> <span class=\"n\">_pose</span><span class=\"p\">;</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">worldPose</span><span class=\"p\">.</span><span class=\"n\">Correct</span><span class=\"p\">();</span>\n\n  <span class=\"p\">...</span>\n\n  <span class=\"c1\">// force an update of all children</span>\n  <span class=\"c1\">// update all children pose, moving them with the model.</span>\n  <span class=\"c1\">// The outer loop updates all the links.</span>\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">Base_V</span><span class=\"o\">::</span><span class=\"n\">iterator</span> <span class=\"n\">iter</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">children</span><span class=\"p\">.</span><span class=\"n\">begin</span><span class=\"p\">();</span>\n      <span class=\"n\">iter</span> <span class=\"o\">!=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">children</span><span class=\"p\">.</span><span class=\"n\">end</span><span class=\"p\">();</span> <span class=\"o\">++</span><span class=\"n\">iter</span><span class=\"p\">)</span>\n  <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">((</span><span class=\"o\">*</span><span class=\"n\">iter</span><span class=\"p\">)</span><span class=\"o\">-&gt;</span><span class=\"n\">HasType</span><span class=\"p\">(</span><span class=\"n\">ENTITY</span><span class=\"p\">))</span>\n    <span class=\"p\">{</span>\n      <span class=\"n\">EntityPtr</span> <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">boost</span><span class=\"o\">::</span><span class=\"n\">static_pointer_cast</span><span class=\"o\">&lt;</span><span class=\"n\">Entity</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">iter</span><span class=\"p\">);</span>\n\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">-&gt;</span><span class=\"n\">HasType</span><span class=\"p\">(</span><span class=\"n\">LINK</span><span class=\"p\">))</span>\n      <span class=\"p\">{</span>\n        <span class=\"p\">...</span>\n      <span class=\"p\">}</span>\n      <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">-&gt;</span><span class=\"n\">HasType</span><span class=\"p\">(</span><span class=\"n\">MODEL</span><span class=\"p\">))</span>\n      <span class=\"p\">{</span>\n        <span class=\"c1\">// set pose of nested models</span>\n        <span class=\"n\">entity</span><span class=\"o\">-&gt;</span><span class=\"n\">SetWorldPoseModel</span><span class=\"p\">(</span>\n            <span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">-&gt;</span><span class=\"n\">worldPose</span> <span class=\"o\">-</span> <span class=\"n\">oldModelWorldPose</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">_pose</span><span class=\"p\">,</span> <span class=\"n\">_notify</span><span class=\"p\">,</span> <span class=\"n\">_publish</span><span class=\"p\">);</span>\n      <span class=\"p\">}</span>\n      <span class=\"k\">else</span>\n      <span class=\"p\">{</span>\n        <span class=\"p\">...</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>hence the world pose of a nested model is updated like</p>\n<div class=\"codehilite\"><pre><span></span>nested_pose_1 = (nested_pose_0 - parent_pose_0) + parent_pose_1\n              =  (parent_pose_0 + sdf_pose - parent_pose_0) + parent_pose_1\n              = sdf_pose + parent_pose_1\n              = (since the parent model does not move) sdf_pose + parent_pose_0\n              = nested_pose_0\n</pre></div>\n\n\n<p>i.e. relative motions between the nested and parent model is not considered at all.</p>\n<p>Is the reasoning right or am I missing something?</p>", "type": "rendered"}, "created_on": "2018-01-27T16:53:38.882777+00:00", "user": {"display_name": "Nicola Piga", "uuid": "{1a21b47b-2618-4f87-b1fb-91cef424b7f1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D"}, "html": {"href": "https://bitbucket.org/%7B1a21b47b-2618-4f87-b1fb-91cef424b7f1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/66110c6026590e7303826963fe991186d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsNP-2.png"}}, "nickname": "xenvre", "type": "user", "account_id": "5a69e1cc98af772d16adbcb9"}, "updated_on": "2018-01-27T16:57:46.113426+00:00", "type": "issue_comment", "id": 42899387}], "page": 1, "size": 9}