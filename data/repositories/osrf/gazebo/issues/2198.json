{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2198/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2198.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2198/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2198/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2198/gazebo7-linking-error-with-cmake-catkin"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2198/vote"}}, "reporter": {"display_name": "Dave Coleman", "uuid": "{58f784f8-4b19-4221-b333-670219684927}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B58f784f8-4b19-4221-b333-670219684927%7D"}, "html": {"href": "https://bitbucket.org/%7B58f784f8-4b19-4221-b333-670219684927%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/0a0abfbe6bae9a1d65fe4af19493f423d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsDC-3.png"}}, "nickname": "Dave Coleman", "type": "user", "account_id": "557058:113fde7a-8d84-43e3-91d8-20354f36ec42"}, "title": "Gazebo7 Linking Error with CMake / Catkin - pthreads", "component": {"name": "build", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/132954.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "Based on discussions with @j-rivero on [this](https://github.com/ros-simulation/gazebo_ros_pkgs/pull/537#discussion_r100673551) gazebo_ros_pkgs pull request, I've isolated some sort of flag export build problem that results in the error:\r\n\r\n```\r\nCMake Error at /home/dave/ros/current/ws_gazebo_test/devel_release/share/base_pkg/cmake/base_pkgConfig.cmake:141 (message):\r\n  Project 'dummy_pkg' tried to find library '-lpthread'.  The library is\r\n  neither a target nor built/installed properly.  Did you compile project\r\n  'base_pkg'? Did you find_package() it before the subdirectory containing\r\n  its code is included?\r\nCall Stack (most recent call first):\r\n  /opt/ros/kinetic/share/catkin/cmake/catkinConfig.cmake:76 (find_package)\r\n  CMakeLists.txt:6 (find_package)\r\n```\r\n\r\nI think the problem is Gazebo7 is exporting a dependency on ``pthread`` which is suggested is bad on [StackOverflow](http://stackoverflow.com/questions/21981865/ld-library-not-found-for-lpthread).\r\n\r\nThis occurs when one catkin package depends on Gazebo, and another depends on that package:\r\n\r\n**base_pkg CMakeLists**\r\n```\r\ncmake_minimum_required(VERSION 2.8.3)\r\nproject(base_pkg)\r\n\r\nfind_package(catkin REQUIRED COMPONENTS\r\n  roscpp\r\n)\r\n\r\nfind_package(GAZEBO REQUIRED)\r\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} ${GAZEBO_CXX_FLAGS}\")\r\n\r\nfind_package(Boost REQUIRED COMPONENTS thread)\r\n\r\ninclude_directories(\r\n  ${catkin_INCLUDE_DIRS}\r\n)\r\n\r\ncatkin_package(\r\n  DEPENDS\r\n    Boost\r\n    GAZEBO\r\n)\r\n```\r\n\r\n**dependent pkg CMakeLists**\r\n```\r\ncmake_minimum_required(VERSION 2.8.3)\r\nproject(dummy_pkg)\r\n\r\nfind_package(catkin REQUIRED COMPONENTS\r\n  base_pkg\r\n)\r\n\r\ninclude_directories(\r\n  ${catkin_INCLUDE_DIRS}\r\n)\r\n\r\ncatkin_package(\r\n  CATKIN_DEPENDS\r\n    base_pkg\r\n)\r\n```\r\n\r\nThe full workspace can be tested from this barebones [test repo](https://github.com/davetcoleman/dummy_gazebo_ws) I've just created.\r\n\r\nLet me know how to fix this. This will also fix the Jenkins build failures on all gazebo_ros_pkgs pull requests.", "markup": "markdown", "html": "<p>Based on discussions with @j-rivero on <a data-is-external-link=\"true\" href=\"https://github.com/ros-simulation/gazebo_ros_pkgs/pull/537#discussion_r100673551\" rel=\"nofollow\">this</a> gazebo_ros_pkgs pull request, I've isolated some sort of flag export build problem that results in the error:</p>\n<div class=\"codehilite\"><pre><span></span>CMake Error at /home/dave/ros/current/ws_gazebo_test/devel_release/share/base_pkg/cmake/base_pkgConfig.cmake:141 (message):\n  Project &#39;dummy_pkg&#39; tried to find library &#39;-lpthread&#39;.  The library is\n  neither a target nor built/installed properly.  Did you compile project\n  &#39;base_pkg&#39;? Did you find_package() it before the subdirectory containing\n  its code is included?\nCall Stack (most recent call first):\n  /opt/ros/kinetic/share/catkin/cmake/catkinConfig.cmake:76 (find_package)\n  CMakeLists.txt:6 (find_package)\n</pre></div>\n\n\n<p>I think the problem is Gazebo7 is exporting a dependency on <code>pthread</code> which is suggested is bad on <a data-is-external-link=\"true\" href=\"http://stackoverflow.com/questions/21981865/ld-library-not-found-for-lpthread\" rel=\"nofollow\">StackOverflow</a>.</p>\n<p>This occurs when one catkin package depends on Gazebo, and another depends on that package:</p>\n<p><strong>base_pkg CMakeLists</strong></p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nb\">cmake_minimum_required</span><span class=\"p\">(</span><span class=\"s\">VERSION</span> <span class=\"s\">2.8.3</span><span class=\"p\">)</span>\n<span class=\"nb\">project</span><span class=\"p\">(</span><span class=\"s\">base_pkg</span><span class=\"p\">)</span>\n\n<span class=\"nb\">find_package</span><span class=\"p\">(</span><span class=\"s\">catkin</span> <span class=\"s\">REQUIRED</span> <span class=\"s\">COMPONENTS</span>\n  <span class=\"s\">roscpp</span>\n<span class=\"p\">)</span>\n\n<span class=\"nb\">find_package</span><span class=\"p\">(</span><span class=\"s\">GAZEBO</span> <span class=\"s\">REQUIRED</span><span class=\"p\">)</span>\n<span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"s\">CMAKE_CXX_FLAGS</span> <span class=\"s2\">&quot;${CMAKE_CXX_FLAGS} ${GAZEBO_CXX_FLAGS}&quot;</span><span class=\"p\">)</span>\n\n<span class=\"nb\">find_package</span><span class=\"p\">(</span><span class=\"s\">Boost</span> <span class=\"s\">REQUIRED</span> <span class=\"s\">COMPONENTS</span> <span class=\"s\">thread</span><span class=\"p\">)</span>\n\n<span class=\"nb\">include_directories</span><span class=\"p\">(</span>\n  <span class=\"o\">${</span><span class=\"nv\">catkin_INCLUDE_DIRS</span><span class=\"o\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"nb\">catkin_package</span><span class=\"p\">(</span>\n  <span class=\"s\">DEPENDS</span>\n    <span class=\"s\">Boost</span>\n    <span class=\"s\">GAZEBO</span>\n<span class=\"p\">)</span>\n</pre></div>\n\n\n<p><strong>dependent pkg CMakeLists</strong></p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nb\">cmake_minimum_required</span><span class=\"p\">(</span><span class=\"s\">VERSION</span> <span class=\"s\">2.8.3</span><span class=\"p\">)</span>\n<span class=\"nb\">project</span><span class=\"p\">(</span><span class=\"s\">dummy_pkg</span><span class=\"p\">)</span>\n\n<span class=\"nb\">find_package</span><span class=\"p\">(</span><span class=\"s\">catkin</span> <span class=\"s\">REQUIRED</span> <span class=\"s\">COMPONENTS</span>\n  <span class=\"s\">base_pkg</span>\n<span class=\"p\">)</span>\n\n<span class=\"nb\">include_directories</span><span class=\"p\">(</span>\n  <span class=\"o\">${</span><span class=\"nv\">catkin_INCLUDE_DIRS</span><span class=\"o\">}</span>\n<span class=\"p\">)</span>\n\n<span class=\"nb\">catkin_package</span><span class=\"p\">(</span>\n  <span class=\"s\">CATKIN_DEPENDS</span>\n    <span class=\"s\">base_pkg</span>\n<span class=\"p\">)</span>\n</pre></div>\n\n\n<p>The full workspace can be tested from this barebones <a data-is-external-link=\"true\" href=\"https://github.com/davetcoleman/dummy_gazebo_ws\" rel=\"nofollow\">test repo</a> I've just created.</p>\n<p>Let me know how to fix this. This will also fix the Jenkins build failures on all gazebo_ros_pkgs pull requests.</p>", "type": "rendered"}, "assignee": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "state": "wontfix", "version": null, "edited_on": null, "created_on": "2017-02-14T20:25:00.188602+00:00", "milestone": null, "updated_on": "2017-04-24T23:37:03.619217+00:00", "type": "issue", "id": 2198}