{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2046/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2046.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2046/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2046/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2046/heightmap-visual-without-collision-causes"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2046/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "Heightmap visual without collision causes gzclient black screen", "component": {"name": "physics", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122876.json"}}}, "votes": 1, "watches": 3, "content": {"raw": "If you open a world file that has a `<visual>` heightmap element without a `<collision>`, it will cause gzclient to hang with a black screen without loading (similar to #681). The following patch can be used to replicate the problem:\r\n\r\n~~~\r\ndiff -r bb6cc0893c9b worlds/heightmap.world\r\n--- a/worlds/heightmap.world\tThu Aug 25 15:55:30 2016 -0700\r\n+++ b/worlds/heightmap.world\tFri Sep 09 17:02:46 2016 -0700\r\n@@ -96,15 +96,6 @@\r\n     <model name=\"heightmap\">\r\n       <static>true</static>\r\n       <link name=\"link\">\r\n-        <collision name=\"collision\">\r\n-          <geometry>\r\n-            <heightmap>\r\n-              <uri>file://media/materials/textures/heightmap_bowl.png</uri>\r\n-              <size>129 129 10</size>\r\n-              <pos>0 0 0</pos>\r\n-            </heightmap>\r\n-          </geometry>\r\n-        </collision>\r\n         <visual name=\"visual_abcedf\">\r\n           <geometry>\r\n             <heightmap>\r\n~~~\r\n\r\nI halted gzclient in gdb and found the following backtrace:\r\n\r\n~~~\r\n^C\r\nProgram received signal SIGINT, Interrupt.\r\npthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185\r\n185\tin ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S\r\n(gdb) bt\r\n#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185\r\n#1  0x00007ffff5e4f2f3 in wait (m=..., this=0x7ffff6071be0 <g_responseCondition>) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\r\n#2  gazebo::transport::request (_worldName=\"default\", _request=\"heightmap_data\", _data=\"\") at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/transport/TransportIface.cc:220\r\n#3  0x00007ffff5aba428 in gazebo::rendering::Heightmap::Load (this=this@entry=0x181bbb0) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Heightmap.cc:371\r\n#4  0x00007ffff5abbb7e in gazebo::rendering::Heightmap::LoadFromMsg (this=0x181bbb0, _msg=...) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Heightmap.cc:147\r\n#5  0x00007ffff5afa699 in gazebo::rendering::Scene::ProcessVisualMsg (this=this@entry=0x1861310, _msg=..., _type=<optimized out>) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Scene.cc:2758\r\n#6  0x00007ffff5b05f25 in gazebo::rendering::Scene::PreRender (this=0x1861310) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Scene.cc:2040\r\n#7  0x00007ffff7648c95 in operator() (this=<optimized out>) at /usr/include/boost/function/function_template.hpp:767\r\n#8  gazebo::event::EventT<void ()>::Signal() (this=<optimized out>) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/Event.hh:370\r\n#9  0x00007ffff7641344 in operator() (this=<optimized out>) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/Event.hh:214\r\n#10 gazebo::gui::GLWidget::paintEvent (this=0x1846740, _e=0x7fffffffd520) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/gui/GLWidget.cc:277\r\n#11 0x00007ffff27b9300 in QWidget::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#12 0x00007ffff2769e2c in QApplicationPrivate::notify_helper(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#13 0x00007ffff27704a0 in QApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#14 0x00007ffff71b64dd in QCoreApplication::notifyInternal(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#15 0x00007ffff27b3a21 in QWidgetPrivate::drawWidget(QPaintDevice*, QRegion const&, QPoint const&, int, QPainter*, QWidgetBackingStore*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#16 0x00007ffff2974b9b in QWidgetPrivate::repaint_sys(QRegion const&) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#17 0x00007ffff27a8e47 in QWidgetPrivate::syncBackingStore() () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#18 0x00007ffff27b8e7a in QWidget::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#19 0x00007ffff2769e2c in QApplicationPrivate::notify_helper(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#20 0x00007ffff27704a0 in QApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#21 0x00007ffff71b64dd in QCoreApplication::notifyInternal(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#22 0x00007ffff71b9b3d in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#23 0x00007ffff71e3f83 in ?? () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#24 0x00007fffefdd7e04 in g_main_context_dispatch () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\r\n#25 0x00007fffefdd8048 in ?? () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\r\n#26 0x00007fffefdd80ec in g_main_context_iteration () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\r\n#27 0x00007ffff71e37a1 in QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#28 0x00007ffff280bbe6 in ?? () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\r\n#29 0x00007ffff71b50af in QEventLoop::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#30 0x00007ffff71b53a5 in QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#31 0x00007ffff71bab79 in QCoreApplication::exec() () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\r\n#32 0x00007ffff76508bb in gazebo::gui::run (_argc=_argc@entry=2, _argv=_argv@entry=0x7fffffffddd8) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/gui/GuiIface.cc:360\r\n#33 0x000000000040152a in main (_argc=2, _argv=0x7fffffffddd8) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/gui/main.cc:25\r\n(gdb)\r\n~~~\r\n\r\nIt is ultimately blocking on a `gazebo::transport::request` call (type `heightmap_data`) in [rendering::Heightmap::Load](#!/osrf/gazebo/src/bb6cc0893c9b6b160d46734c4fe9dbcbed1a1656/gazebo/rendering/Heightmap.cc?fileviewer=file-view-default#Heightmap.cc-357), which was generated by `Scene::PreRender`. Apparently, [physics::HeightmapShape](#!/osrf/gazebo/src/bb6cc0893c9b6b160d46734c4fe9dbcbed1a1656/gazebo/physics/HeightmapShape.cc?fileviewer=file-view-default#HeightmapShape.cc-70) is the only class that responds to `heightmap_data` requests. Since there is no heightmap `<collision>`, there is no `HeightmapShape` to respond to the request. Also, I believe this design prevents multiple heightmaps from being used, since they would all try to respond to the same `heightmap_data` requests.", "markup": "markdown", "html": "<p>If you open a world file that has a <code>&lt;visual&gt;</code> heightmap element without a <code>&lt;collision&gt;</code>, it will cause gzclient to hang with a black screen without loading (similar to <a href=\"#!/osrf/gazebo/issues/681/gzclient-sometimes-empty-on-start\" rel=\"nofollow\" title=\"gzclient sometimes empty on start\" class=\"ap-connect-link\">#681</a>). The following patch can be used to replicate the problem:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r bb6cc0893c9b worlds/heightmap.world</span>\n<span class=\"gd\">--- a/worlds/heightmap.world    Thu Aug 25 15:55:30 2016 -0700</span>\n<span class=\"gi\">+++ b/worlds/heightmap.world    Fri Sep 09 17:02:46 2016 -0700</span>\n<span class=\"gu\">@@ -96,15 +96,6 @@</span>\n     &lt;model name=&quot;heightmap&quot;&gt;\n       &lt;static&gt;true&lt;/static&gt;\n       &lt;link name=&quot;link&quot;&gt;\n<span class=\"gd\">-        &lt;collision name=&quot;collision&quot;&gt;</span>\n<span class=\"gd\">-          &lt;geometry&gt;</span>\n<span class=\"gd\">-            &lt;heightmap&gt;</span>\n<span class=\"gd\">-              &lt;uri&gt;file://media/materials/textures/heightmap_bowl.png&lt;/uri&gt;</span>\n<span class=\"gd\">-              &lt;size&gt;129 129 10&lt;/size&gt;</span>\n<span class=\"gd\">-              &lt;pos&gt;0 0 0&lt;/pos&gt;</span>\n<span class=\"gd\">-            &lt;/heightmap&gt;</span>\n<span class=\"gd\">-          &lt;/geometry&gt;</span>\n<span class=\"gd\">-        &lt;/collision&gt;</span>\n         &lt;visual name=&quot;visual_abcedf&quot;&gt;\n           &lt;geometry&gt;\n             &lt;heightmap&gt;\n</pre></div>\n\n\n<p>I halted gzclient in gdb and found the following backtrace:</p>\n<div class=\"codehilite\"><pre><span></span>^C\nProgram received signal SIGINT, Interrupt.\npthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185\n185 in ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S\n(gdb) bt\n#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185\n#1  0x00007ffff5e4f2f3 in wait (m=..., this=0x7ffff6071be0 &lt;g_responseCondition&gt;) at /usr/include/boost/thread/pthread/condition_variable.hpp:73\n#2  gazebo::transport::request (_worldName=&quot;default&quot;, _request=&quot;heightmap_data&quot;, _data=&quot;&quot;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/transport/TransportIface.cc:220\n#3  0x00007ffff5aba428 in gazebo::rendering::Heightmap::Load (this=this@entry=0x181bbb0) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Heightmap.cc:371\n#4  0x00007ffff5abbb7e in gazebo::rendering::Heightmap::LoadFromMsg (this=0x181bbb0, _msg=...) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Heightmap.cc:147\n#5  0x00007ffff5afa699 in gazebo::rendering::Scene::ProcessVisualMsg (this=this@entry=0x1861310, _msg=..., _type=&lt;optimized out&gt;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Scene.cc:2758\n#6  0x00007ffff5b05f25 in gazebo::rendering::Scene::PreRender (this=0x1861310) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/rendering/Scene.cc:2040\n#7  0x00007ffff7648c95 in operator() (this=&lt;optimized out&gt;) at /usr/include/boost/function/function_template.hpp:767\n#8  gazebo::event::EventT&lt;void ()&gt;::Signal() (this=&lt;optimized out&gt;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/Event.hh:370\n#9  0x00007ffff7641344 in operator() (this=&lt;optimized out&gt;) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/common/Event.hh:214\n#10 gazebo::gui::GLWidget::paintEvent (this=0x1846740, _e=0x7fffffffd520) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/gui/GLWidget.cc:277\n#11 0x00007ffff27b9300 in QWidget::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#12 0x00007ffff2769e2c in QApplicationPrivate::notify_helper(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#13 0x00007ffff27704a0 in QApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#14 0x00007ffff71b64dd in QCoreApplication::notifyInternal(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#15 0x00007ffff27b3a21 in QWidgetPrivate::drawWidget(QPaintDevice*, QRegion const&amp;, QPoint const&amp;, int, QPainter*, QWidgetBackingStore*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#16 0x00007ffff2974b9b in QWidgetPrivate::repaint_sys(QRegion const&amp;) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#17 0x00007ffff27a8e47 in QWidgetPrivate::syncBackingStore() () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#18 0x00007ffff27b8e7a in QWidget::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#19 0x00007ffff2769e2c in QApplicationPrivate::notify_helper(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#20 0x00007ffff27704a0 in QApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#21 0x00007ffff71b64dd in QCoreApplication::notifyInternal(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#22 0x00007ffff71b9b3d in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#23 0x00007ffff71e3f83 in ?? () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#24 0x00007fffefdd7e04 in g_main_context_dispatch () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\n#25 0x00007fffefdd8048 in ?? () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\n#26 0x00007fffefdd80ec in g_main_context_iteration () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\n#27 0x00007ffff71e37a1 in QEventDispatcherGlib::processEvents(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#28 0x00007ffff280bbe6 in ?? () from /usr/lib/x86_64-linux-gnu/libQtGui.so.4\n#29 0x00007ffff71b50af in QEventLoop::processEvents(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#30 0x00007ffff71b53a5 in QEventLoop::exec(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#31 0x00007ffff71bab79 in QCoreApplication::exec() () from /usr/lib/x86_64-linux-gnu/libQtCore.so.4\n#32 0x00007ffff76508bb in gazebo::gui::run (_argc=_argc@entry=2, _argv=_argv@entry=0x7fffffffddd8) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/gui/GuiIface.cc:360\n#33 0x000000000040152a in main (_argc=2, _argv=0x7fffffffddd8) at /var/lib/jenkins/workspace/gazebo7-debbuilder/build/gazebo-7.3.1/gazebo/gui/main.cc:25\n(gdb)\n</pre></div>\n\n\n<p>It is ultimately blocking on a <code>gazebo::transport::request</code> call (type <code>heightmap_data</code>) in <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/bb6cc0893c9b6b160d46734c4fe9dbcbed1a1656/gazebo/rendering/Heightmap.cc?fileviewer=file-view-default#Heightmap.cc-357\" rel=\"nofollow\">rendering::Heightmap::Load</a>, which was generated by <code>Scene::PreRender</code>. Apparently, <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/bb6cc0893c9b6b160d46734c4fe9dbcbed1a1656/gazebo/physics/HeightmapShape.cc?fileviewer=file-view-default#HeightmapShape.cc-70\" rel=\"nofollow\">physics::HeightmapShape</a> is the only class that responds to <code>heightmap_data</code> requests. Since there is no heightmap <code>&lt;collision&gt;</code>, there is no <code>HeightmapShape</code> to respond to the request. Also, I believe this design prevents multiple heightmaps from being used, since they would all try to respond to the same <code>heightmap_data</code> requests.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2016-09-10T00:12:51.224398+00:00", "milestone": null, "updated_on": "2016-09-14T19:19:57.216517+00:00", "type": "issue", "id": 2046}