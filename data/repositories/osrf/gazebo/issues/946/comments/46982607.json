{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/946/comments/46982607.json"}, "html": {"href": "#!/osrf/gazebo/issues/946#comment-46982607"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/946.json"}}, "type": "issue", "id": 946, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "gpu ray sensor vertical ranges"}, "content": {"raw": "Running on gazebo 9.2, my gzserver crahses if I'm subscribed to the GpuRaySensor's laser scan.  It goes out of bounds on [this line](#!/osrf/gazebo/src/95386dd06ece26a03738c7ebcec1a0c730b65ad9/gazebo/sensors/GpuRaySensor.cc#lines-633). \n\n```\n[libprotobuf FATAL /usr/include/google/protobuf/repeated_field.h:1092] CHECK failed: (index) < (current_size_):\nterminate called after throwing an instance of 'google::protobuf::FatalException'\n  what():  CHECK failed: (index) < (current_size_):\n\nThread 1 \"gzserver\" received signal SIGABRT, Aborted.\n__GI_raise (sig=sig@entry=6)\n    at ../sysdeps/unix/sysv/linux/raise.c:51\n51      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) backtrace\n#0  0x00007ffff62f6e97 in __GI_raise (sig=sig@entry=6)\n    at ../sysdeps/unix/sysv/linux/raise.c:51\n#1  0x00007ffff62f8801 in __GI_abort () at abort.c:79\n#2  0x00007ffff694d8fb in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007ffff6953d3a in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007ffff6953d95 in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007ffff6953fe8 in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00007ffff46ddbb8 in google::protobuf::internal::LogMessage::Finish() () at /usr/lib/x86_64-linux-gnu/libprotobuf.so.10\n#7  0x00007ffff603851a in google::protobuf::RepeatedField<double>::Set(int, double const&) (value=<synthetic pointer>: <optimized out>, index=300, this=<optimized out>)\n    at /usr/include/google/protobuf/repeated_field.h:1092\n#8  0x00007ffff603851a in gazebo::msgs::LaserScan::set_ranges(int, double) (value=-inf, index=300, this=<optimized out>)\n    at ./obj-x86_64-linux-gnu/gazebo/msgs/laserscan.pb.h:644\n---Type <return> to continue, or q <return> to quit---\n#9  0x00007ffff603851a in gazebo::sensors::GpuRaySensor::UpdateImpl(bool) (this=0x5555569c9f00) at ./gazebo/sensors/GpuRaySensor.cc:633\n#10 0x00007ffff6055129 in gazebo::sensors::Sensor::Update(bool) (this=0x5555569c9f00, _force=_force@entry=false)\n    at ./gazebo/sensors/Sensor.cc:224\n#11 0x00007ffff605b1ed in gazebo::sensors::SensorManager::SensorContainer::Update(bool) (this=0x555555dc3790, _force=<optimized out>)\n    at ./gazebo/sensors/SensorManager.cc:623\n#12 0x00007ffff605cddb in gazebo::sensors::SensorManager::Update(bool) (this=this@entry=0x7ffff62b4000 <SingletonT<gazebo::sensors::SensorManager>::GetInstance()::t>, _force=<optimized out>)\n    at ./gazebo/sensors/SensorManager.cc:190\n#13 0x00007ffff60532db in gazebo::sensors::run_once(bool) (_force=_force@entry=false) at ./gazebo/sensors/SensorsIface.cc:118\n#14 0x00007ffff7ba059f in gazebo::Server::Run() (this=0x55555581f2a0) at ./gazebo/Server.cc:587\n#15 0x0000555555557e55 in main(int, char**) (argc=3, argv=0x7fffffffdd78) at ./gazebo/server_main.cc:42\n(gdb) frame 9\n#9  gazebo::sensors::GpuRaySensor::UpdateImpl (this=0x5555569c9f00)\n    at ./gazebo/sensors/GpuRaySensor.cc:633\n633     ./gazebo/sensors/GpuRaySensor.cc: No such file or directory.\n(gdb) list\n628     in ./gazebo/sensors/GpuRaySensor.cc\n(gdb) print range\n$1 = -inf\n(gdb) print i\n$2 = 300\n(gdb) print RayCount()\n$3 = 30\n(gdb) print VerticalRayCount()\n$4 = 10\n(gdb) print dataIter\n$5 = {index = 300, data = 0x555600ea7d90, skip = 3,\n  rangeOffset = 0, intensityOffset = 1, horizontalResolution = 30}\n(gdb) print dataEnd\n$6 = {index = 360, data = 0x555600ea7d90, skip = 3,\n  rangeOffset = 0, intensityOffset = 1, horizontalResolution = 30}\n\n```\n\nIt seems the message is resized to VeritcalRayCount() * RayCount() (300 in my example), but the dataIter is size 360.\n\nThis is my sensor sdf:\n```\n                <sensor name=\"sensor_gpu_ray\" type=\"gpu_ray\">\n                    <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>\n                    <ray>\n                        <scan display=\"true\">\n                            <horizontal>\n                                <samples>30</samples>\n                                <resolution>1.0</resolution>\n                                <min_angle>-0.5236</min_angle>\n                                <max_angle>0.5236</max_angle>\n                            </horizontal>\n                            <vertical>\n                                <samples>10</samples>\n                                <resolution>1.0</resolution>\n                                <min_angle>-0.2</min_angle>\n                                <max_angle>0.2</max_angle>\n                            </vertical>\n                        </scan>\n                        <range>\n                            <min>0.05</min>\n                            <max>50.0</max>\n                        </range>\n                    </ray>\n                    <always_on>true</always_on>\n                    <update_rate>1.0</update_rate>\n                </sensor>\n```", "markup": "markdown", "html": "<p>Running on gazebo 9.2, my gzserver crahses if I'm subscribed to the GpuRaySensor's laser scan.  It goes out of bounds on <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/95386dd06ece26a03738c7ebcec1a0c730b65ad9/gazebo/sensors/GpuRaySensor.cc#lines-633\" rel=\"nofollow\">this line</a>. </p>\n<div class=\"codehilite\"><pre><span></span>[libprotobuf FATAL /usr/include/google/protobuf/repeated_field.h:1092] CHECK failed: (index) &lt; (current_size_):\nterminate called after throwing an instance of &#39;google::protobuf::FatalException&#39;\n  what():  CHECK failed: (index) &lt; (current_size_):\n\nThread 1 &quot;gzserver&quot; received signal SIGABRT, Aborted.\n__GI_raise (sig=sig@entry=6)\n    at ../sysdeps/unix/sysv/linux/raise.c:51\n51      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) backtrace\n#0  0x00007ffff62f6e97 in __GI_raise (sig=sig@entry=6)\n    at ../sysdeps/unix/sysv/linux/raise.c:51\n#1  0x00007ffff62f8801 in __GI_abort () at abort.c:79\n#2  0x00007ffff694d8fb in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007ffff6953d3a in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007ffff6953d95 in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007ffff6953fe8 in  ()\n    at /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00007ffff46ddbb8 in google::protobuf::internal::LogMessage::Finish() () at /usr/lib/x86_64-linux-gnu/libprotobuf.so.10\n#7  0x00007ffff603851a in google::protobuf::RepeatedField&lt;double&gt;::Set(int, double const&amp;) (value=&lt;synthetic pointer&gt;: &lt;optimized out&gt;, index=300, this=&lt;optimized out&gt;)\n    at /usr/include/google/protobuf/repeated_field.h:1092\n#8  0x00007ffff603851a in gazebo::msgs::LaserScan::set_ranges(int, double) (value=-inf, index=300, this=&lt;optimized out&gt;)\n    at ./obj-x86_64-linux-gnu/gazebo/msgs/laserscan.pb.h:644\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\n#9  0x00007ffff603851a in gazebo::sensors::GpuRaySensor::UpdateImpl(bool) (this=0x5555569c9f00) at ./gazebo/sensors/GpuRaySensor.cc:633\n#10 0x00007ffff6055129 in gazebo::sensors::Sensor::Update(bool) (this=0x5555569c9f00, _force=_force@entry=false)\n    at ./gazebo/sensors/Sensor.cc:224\n#11 0x00007ffff605b1ed in gazebo::sensors::SensorManager::SensorContainer::Update(bool) (this=0x555555dc3790, _force=&lt;optimized out&gt;)\n    at ./gazebo/sensors/SensorManager.cc:623\n#12 0x00007ffff605cddb in gazebo::sensors::SensorManager::Update(bool) (this=this@entry=0x7ffff62b4000 &lt;SingletonT&lt;gazebo::sensors::SensorManager&gt;::GetInstance()::t&gt;, _force=&lt;optimized out&gt;)\n    at ./gazebo/sensors/SensorManager.cc:190\n#13 0x00007ffff60532db in gazebo::sensors::run_once(bool) (_force=_force@entry=false) at ./gazebo/sensors/SensorsIface.cc:118\n#14 0x00007ffff7ba059f in gazebo::Server::Run() (this=0x55555581f2a0) at ./gazebo/Server.cc:587\n#15 0x0000555555557e55 in main(int, char**) (argc=3, argv=0x7fffffffdd78) at ./gazebo/server_main.cc:42\n(gdb) frame 9\n#9  gazebo::sensors::GpuRaySensor::UpdateImpl (this=0x5555569c9f00)\n    at ./gazebo/sensors/GpuRaySensor.cc:633\n633     ./gazebo/sensors/GpuRaySensor.cc: No such file or directory.\n(gdb) list\n628     in ./gazebo/sensors/GpuRaySensor.cc\n(gdb) print range\n$1 = -inf\n(gdb) print i\n$2 = 300\n(gdb) print RayCount()\n$3 = 30\n(gdb) print VerticalRayCount()\n$4 = 10\n(gdb) print dataIter\n$5 = {index = 300, data = 0x555600ea7d90, skip = 3,\n  rangeOffset = 0, intensityOffset = 1, horizontalResolution = 30}\n(gdb) print dataEnd\n$6 = {index = 360, data = 0x555600ea7d90, skip = 3,\n  rangeOffset = 0, intensityOffset = 1, horizontalResolution = 30}\n</pre></div>\n\n\n<p>It seems the message is resized to VeritcalRayCount() * RayCount() (300 in my example), but the dataIter is size 360.</p>\n<p>This is my sensor sdf:</p>\n<div class=\"codehilite\"><pre><span></span>                <span class=\"nt\">&lt;sensor</span> <span class=\"na\">name=</span><span class=\"s\">&quot;sensor_gpu_ray&quot;</span> <span class=\"na\">type=</span><span class=\"s\">&quot;gpu_ray&quot;</span><span class=\"nt\">&gt;</span>\n                    <span class=\"nt\">&lt;pose&gt;</span>0.0 0.0 0.0 0.0 0.0 0.0<span class=\"nt\">&lt;/pose&gt;</span>\n                    <span class=\"nt\">&lt;ray&gt;</span>\n                        <span class=\"nt\">&lt;scan</span> <span class=\"na\">display=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">&gt;</span>\n                            <span class=\"nt\">&lt;horizontal&gt;</span>\n                                <span class=\"nt\">&lt;samples&gt;</span>30<span class=\"nt\">&lt;/samples&gt;</span>\n                                <span class=\"nt\">&lt;resolution&gt;</span>1.0<span class=\"nt\">&lt;/resolution&gt;</span>\n                                <span class=\"nt\">&lt;min_angle&gt;</span>-0.5236<span class=\"nt\">&lt;/min_angle&gt;</span>\n                                <span class=\"nt\">&lt;max_angle&gt;</span>0.5236<span class=\"nt\">&lt;/max_angle&gt;</span>\n                            <span class=\"nt\">&lt;/horizontal&gt;</span>\n                            <span class=\"nt\">&lt;vertical&gt;</span>\n                                <span class=\"nt\">&lt;samples&gt;</span>10<span class=\"nt\">&lt;/samples&gt;</span>\n                                <span class=\"nt\">&lt;resolution&gt;</span>1.0<span class=\"nt\">&lt;/resolution&gt;</span>\n                                <span class=\"nt\">&lt;min_angle&gt;</span>-0.2<span class=\"nt\">&lt;/min_angle&gt;</span>\n                                <span class=\"nt\">&lt;max_angle&gt;</span>0.2<span class=\"nt\">&lt;/max_angle&gt;</span>\n                            <span class=\"nt\">&lt;/vertical&gt;</span>\n                        <span class=\"nt\">&lt;/scan&gt;</span>\n                        <span class=\"nt\">&lt;range&gt;</span>\n                            <span class=\"nt\">&lt;min&gt;</span>0.05<span class=\"nt\">&lt;/min&gt;</span>\n                            <span class=\"nt\">&lt;max&gt;</span>50.0<span class=\"nt\">&lt;/max&gt;</span>\n                        <span class=\"nt\">&lt;/range&gt;</span>\n                    <span class=\"nt\">&lt;/ray&gt;</span>\n                    <span class=\"nt\">&lt;always_on&gt;</span>true<span class=\"nt\">&lt;/always_on&gt;</span>\n                    <span class=\"nt\">&lt;update_rate&gt;</span>1.0<span class=\"nt\">&lt;/update_rate&gt;</span>\n                <span class=\"nt\">&lt;/sensor&gt;</span>\n</pre></div>", "type": "rendered"}, "created_on": "2018-07-27T20:30:01.080192+00:00", "user": {"display_name": "Kevin Allen", "uuid": "{29f672ad-72f4-434e-bb0e-c6f2f69974f2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B29f672ad-72f4-434e-bb0e-c6f2f69974f2%7D"}, "html": {"href": "https://bitbucket.org/%7B29f672ad-72f4-434e-bb0e-c6f2f69974f2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/355d0415f6040ffb168f44275ac2ee2fd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsKA-1.png"}}, "nickname": "kev-the-dev", "type": "user", "account_id": "5b04a6cf8a69f52b3ba2e5db"}, "updated_on": null, "type": "issue_comment", "id": 46982607}