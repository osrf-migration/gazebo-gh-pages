{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/925/comments/6816135.json"}, "html": {"href": "#!/osrf/gazebo/issues/925#comment-6816135"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/925.json"}}, "type": "issue", "id": 925, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "gazebo gui: disabling and then enabling shadows causes gazebo gui to segfault"}, "content": {"raw": "While reviewing pull request #772, I was seeing some strange seg-faults from Ogre that mentioned shadows. I made a workaround in 68c62c1, but here's the backtrace I saw repeatedly:\n~~~\nRepeating all tests (iteration 2) . . .\n\nNote: Google Test filter = *Sphere*/0\n[==========] Running 1 test from 1 test case.\n[----------] Global test environment set-up.\n[----------] 1 test from PhysicsEngines/PhysicsTest\n[ RUN      ] PhysicsEngines/PhysicsTest.SphereAtlasLargeError/0\n...\nDbg ServerFixture load in 0.13 seconds, timeout after 60 seconds\n...\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffdc84f700 (LWP 22494)]\n0x00007ffff06fbacc in Ogre::SharedPtr<Ogre::ShadowCameraSetup>::destroy (this=0x7fffdc84e300)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:232\n232\t/build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h: No such file or directory.\n(gdb) bt\n#0  0x00007ffff06fbacc in Ogre::SharedPtr<Ogre::ShadowCameraSetup>::destroy (this=0x7fffdc84e300)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:232\n#1  0x00007ffff06fc559 in Ogre::SharedPtr<Ogre::ShadowCameraSetup>::release (this=this@entry=0x7fffdc84e300)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:218\n#2  0x00007ffff07fbca0 in ~SharedPtr (this=0x7fffdc84e300, __in_chrg=<optimized out>)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:155\n#3  operator= (r=..., this=0x7fff800fef80) at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:120\n#4  Ogre::SceneManager::setShadowCameraSetup (this=0x7fff800fa840, shadowSetup=...)\n    at /build/buildd/ogre-1.7.4/OgreMain/src/OgreSceneManager.cpp:5917\n#5  0x00007ffff6f7ee6b in gazebo::rendering::RTShaderSystem::RemoveShadows (this=0x7ffff723b440, _scene=...)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/RTShaderSystem.cc:422\n#6  0x00007ffff6f86a80 in gazebo::rendering::Scene::SetShadowsEnabled (this=this@entry=0x7fffd1642cf0, \n    _value=false) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:2630\n#7  0x00007ffff6f93506 in gazebo::rendering::Scene::ProcessSceneMsg (this=this@entry=0x7fffd1642cf0, _msg=...)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:1389\n#8  0x00007ffff6f944df in gazebo::rendering::Scene::PreRender (this=0x7fffd1642cf0)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:1651\n#9  0x00007ffff765a44a in operator() (this=<optimized out>)\n    at /usr/include/boost/function/function_template.hpp:760\n#10 gazebo::event::EventT<void ()>::Signal() (this=0x7ffff7dd8800 <gazebo::event::Events::preRender>)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/common/Event.hh:126\n#11 0x00007ffff72c79ef in operator() (this=<optimized out>)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/common/Event.hh:119\n#12 gazebo::sensors::SensorManager::ImageSensorContainer::Update (this=0x7fffd10f22a0, _force=<optimized out>)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/sensors/SensorManager.cc:647\n#13 0x00007ffff72c884a in gazebo::sensors::SensorManager::Update (this=0x7ffff78dd980, _force=<optimized out>)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/sensors/SensorManager.cc:157\n#14 0x0000000000498c0f in gazebo::Server::Run (this=0x7fff76940ea0)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/Server.cc:490\n#15 0x0000000000482d7e in ServerFixture::RunServer (this=0x76f250, _worldFilename=..., _paused=<optimized out>, \n    _physics=...) at /home/scpeters/ws/gazebo/src/gazebo/test/ServerFixture.hh:233\n#16 0x00007ffff596b6c9 in ?? () from /usr/lib/libboost_thread.so.1.49.0\n#17 0x00007ffff65dce9a in start_thread (arg=0x7fffdc84f700) at pthread_create.c:308\n---Type <return> to continue, or q <return> to quit---\n#18 0x00007ffff47ea3fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#19 0x0000000000000000 in ?? ()\n(gdb) \n~~~", "markup": "markdown", "html": "<p>While reviewing <a href=\"#!/osrf/gazebo/pull-requests/772/ode-dynamic-inertia-modification-895\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #772</a>, I was seeing some strange seg-faults from Ogre that mentioned shadows. I made a workaround in <a href=\"#!/osrf/gazebo/commits/68c62c1\" rel=\"nofollow\" class=\"ap-connect-link\">68c62c1</a>, but here's the backtrace I saw repeatedly:</p>\n<div class=\"codehilite\"><pre><span></span>Repeating all tests (iteration 2) . . .\n\nNote: Google Test filter = *Sphere*/0\n[==========] Running 1 test from 1 test case.\n[----------] Global test environment set-up.\n[----------] 1 test from PhysicsEngines/PhysicsTest\n[ RUN      ] PhysicsEngines/PhysicsTest.SphereAtlasLargeError/0\n...\nDbg ServerFixture load in 0.13 seconds, timeout after 60 seconds\n...\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffdc84f700 (LWP 22494)]\n0x00007ffff06fbacc in Ogre::SharedPtr&lt;Ogre::ShadowCameraSetup&gt;::destroy (this=0x7fffdc84e300)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:232\n232 /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h: No such file or directory.\n(gdb) bt\n#0  0x00007ffff06fbacc in Ogre::SharedPtr&lt;Ogre::ShadowCameraSetup&gt;::destroy (this=0x7fffdc84e300)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:232\n#1  0x00007ffff06fc559 in Ogre::SharedPtr&lt;Ogre::ShadowCameraSetup&gt;::release (this=this@entry=0x7fffdc84e300)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:218\n#2  0x00007ffff07fbca0 in ~SharedPtr (this=0x7fffdc84e300, __in_chrg=&lt;optimized out&gt;)\n    at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:155\n#3  operator= (r=..., this=0x7fff800fef80) at /build/buildd/ogre-1.7.4/OgreMain/include/OgreSharedPtr.h:120\n#4  Ogre::SceneManager::setShadowCameraSetup (this=0x7fff800fa840, shadowSetup=...)\n    at /build/buildd/ogre-1.7.4/OgreMain/src/OgreSceneManager.cpp:5917\n#5  0x00007ffff6f7ee6b in gazebo::rendering::RTShaderSystem::RemoveShadows (this=0x7ffff723b440, _scene=...)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/RTShaderSystem.cc:422\n#6  0x00007ffff6f86a80 in gazebo::rendering::Scene::SetShadowsEnabled (this=this@entry=0x7fffd1642cf0, \n    _value=false) at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:2630\n#7  0x00007ffff6f93506 in gazebo::rendering::Scene::ProcessSceneMsg (this=this@entry=0x7fffd1642cf0, _msg=...)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:1389\n#8  0x00007ffff6f944df in gazebo::rendering::Scene::PreRender (this=0x7fffd1642cf0)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/rendering/Scene.cc:1651\n#9  0x00007ffff765a44a in operator() (this=&lt;optimized out&gt;)\n    at /usr/include/boost/function/function_template.hpp:760\n#10 gazebo::event::EventT&lt;void ()&gt;::Signal() (this=0x7ffff7dd8800 &lt;gazebo::event::Events::preRender&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/common/Event.hh:126\n#11 0x00007ffff72c79ef in operator() (this=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/common/Event.hh:119\n#12 gazebo::sensors::SensorManager::ImageSensorContainer::Update (this=0x7fffd10f22a0, _force=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/sensors/SensorManager.cc:647\n#13 0x00007ffff72c884a in gazebo::sensors::SensorManager::Update (this=0x7ffff78dd980, _force=&lt;optimized out&gt;)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/sensors/SensorManager.cc:157\n#14 0x0000000000498c0f in gazebo::Server::Run (this=0x7fff76940ea0)\n    at /home/scpeters/ws/gazebo/src/gazebo/gazebo/Server.cc:490\n#15 0x0000000000482d7e in ServerFixture::RunServer (this=0x76f250, _worldFilename=..., _paused=&lt;optimized out&gt;, \n    _physics=...) at /home/scpeters/ws/gazebo/src/gazebo/test/ServerFixture.hh:233\n#16 0x00007ffff596b6c9 in ?? () from /usr/lib/libboost_thread.so.1.49.0\n#17 0x00007ffff65dce9a in start_thread (arg=0x7fffdc84f700) at pthread_create.c:308\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\n#18 0x00007ffff47ea3fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#19 0x0000000000000000 in ?? ()\n(gdb) \n</pre></div>", "type": "rendered"}, "created_on": "2013-11-09T01:00:49.627714+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 6816135}