{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2279/comments/36960625.json"}, "html": {"href": "#!/osrf/gazebo/issues/2279#comment-36960625"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/2279.json"}}, "type": "issue", "id": 2279, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Core dump with gazebo 8.1 in gazebo_ros_pkgs"}, "content": {"raw": "After fighting with possible ABI breakages and get inconsistent results I've compiled the `gazebo_ros_pkgs` from source using gazebo 8.1.0 and ... the problems is still there. \n\nSo it is possible that we don't have an ABI problem but other memory related issue. Another easy way to trigger the problem is:\n```\nsudo apt-get install -y ros-kinetic-gazebo8-ros-pkgs\ngazebo -g /opt/ros/kinetic/lib/libgazebo_ros_paths_plugin.so --verbose\n```\n\nUnder gdb the stacktrace is:\n\n```\n#7  0x00007ffff7285edf in std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::assign (\n    __str=\"/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so\", this=<optimized out>) at /usr/include/c++/5/bits/basic_string.h:1095\n#8  std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::operator= (__str=\"/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so\", \n    this=<optimized out>) at /usr/include/c++/5/bits/basic_string.h:551\n#9  gazebo::PluginT<gazebo::GUIPlugin>::Create (_filename=..., _name=\"/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so\")\n    at /home/jrivero/code/gazebo/gazebo/common/Plugin.hh:199\n#10 0x00007ffff72d88f6 in gazebo::gui::RenderWidget::AddPlugin_2 (this=this@entry=0x1b9cf90, _filename=\"/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so\", \n    _elem=std::shared_ptr (count 2, weak 1) 0x5026390) at /home/jrivero/code/gazebo/gazebo/gui/RenderWidget.cc:308\n#11 0x00007ffff72d8e16 in gazebo::gui::RenderWidget::AddPlugins (this=0x1b9cf90, _pluginFilenames=std::vector of length 1, capacity 1 = {...})\n    at /home/jrivero/code/gazebo/gazebo/gui/RenderWidget.cc:293\n#12 0x00007ffff724a83b in gazebo::gui::run (_argc=<optimized out>, _argv=<optimized out>) at /home/jrivero/code/gazebo/gazebo/gui/GuiIface.cc:368\n#13 0x000000000040275c in main (_argc=3, _argv=0x7fffffffd638) at /home/jrivero/code/gazebo/gazebo/gui/main.cc:29\n```\n\nI noticed that the `libgazebo_ros_paths_plugin.so` is defined and registered as a `SystemPlugin` and we are calling it via `-g` as it was a `GUIPlugin`. If I modify it to be a `GUIPlugin` then the crash is gone (although I get a black box in the gazebo GUI).", "markup": "markdown", "html": "<p>After fighting with possible ABI breakages and get inconsistent results I've compiled the <code>gazebo_ros_pkgs</code> from source using gazebo 8.1.0 and ... the problems is still there. </p>\n<p>So it is possible that we don't have an ABI problem but other memory related issue. Another easy way to trigger the problem is:</p>\n<div class=\"codehilite\"><pre><span></span>sudo apt-get install -y ros-kinetic-gazebo8-ros-pkgs\ngazebo -g /opt/ros/kinetic/lib/libgazebo_ros_paths_plugin.so --verbose\n</pre></div>\n\n\n<p>Under gdb the stacktrace is:</p>\n<div class=\"codehilite\"><pre><span></span>#7  0x00007ffff7285edf in std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;::assign (\n    __str=&quot;/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so&quot;, this=&lt;optimized out&gt;) at /usr/include/c++/5/bits/basic_string.h:1095\n#8  std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;::operator= (__str=&quot;/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so&quot;, \n    this=&lt;optimized out&gt;) at /usr/include/c++/5/bits/basic_string.h:551\n#9  gazebo::PluginT&lt;gazebo::GUIPlugin&gt;::Create (_filename=..., _name=&quot;/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so&quot;)\n    at /home/jrivero/code/gazebo/gazebo/common/Plugin.hh:199\n#10 0x00007ffff72d88f6 in gazebo::gui::RenderWidget::AddPlugin_2 (this=this@entry=0x1b9cf90, _filename=&quot;/home/jrivero/code/ros/ws/gazebo_ros_pkgs/devel/lib/libgazebo_ros_paths_plugin.so&quot;, \n    _elem=std::shared_ptr (count 2, weak 1) 0x5026390) at /home/jrivero/code/gazebo/gazebo/gui/RenderWidget.cc:308\n#11 0x00007ffff72d8e16 in gazebo::gui::RenderWidget::AddPlugins (this=0x1b9cf90, _pluginFilenames=std::vector of length 1, capacity 1 = {...})\n    at /home/jrivero/code/gazebo/gazebo/gui/RenderWidget.cc:293\n#12 0x00007ffff724a83b in gazebo::gui::run (_argc=&lt;optimized out&gt;, _argv=&lt;optimized out&gt;) at /home/jrivero/code/gazebo/gazebo/gui/GuiIface.cc:368\n#13 0x000000000040275c in main (_argc=3, _argv=0x7fffffffd638) at /home/jrivero/code/gazebo/gazebo/gui/main.cc:29\n</pre></div>\n\n\n<p>I noticed that the <code>libgazebo_ros_paths_plugin.so</code> is defined and registered as a <code>SystemPlugin</code> and we are calling it via <code>-g</code> as it was a <code>GUIPlugin</code>. If I modify it to be a <code>GUIPlugin</code> then the crash is gone (although I get a black box in the gazebo GUI).</p>", "type": "rendered"}, "created_on": "2017-05-19T18:34:42.370349+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 36960625}