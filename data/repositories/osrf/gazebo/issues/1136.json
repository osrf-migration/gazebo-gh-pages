{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/1136/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/1136.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1136/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/1136/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/1136/sensormanager_test-seg-fault-corrupted"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/1136/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "SensorManager_TEST seg-fault: corrupted double-linked list", "component": {"name": "testing", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/128164.json"}}}, "votes": 1, "watches": 1, "content": {"raw": "I have been getting seg-faults in the UNIT_SensorManager_TEST about 30% of the time in my overnight testing. I just switched to saucy, using default ogre package 1.8.0. It happens on the gazebo_3.0 and default branches.\r\n\r\nThe `SensorManager_TEST.InitRemove` test fails during teardown (ie. after the `[Dbg] [ServerFixture.cc:95] ServerFixture::Unload` message has printed) with an error message about a corrupted double-linked list\r\n~~~\r\n119: [ RUN      ] SensorManager_TEST.InitRemove\r\n119: [Msg] Waiting for master.\r\n119: [Msg] Connected to gazebo master @ http://127.0.0.1:11345\r\n119: [Msg] Publicized address: 192.168.1.191\r\n119: [Dbg] [ServerFixture.cc:144] ServerFixture load in 2.5 seconds, timeout after 600 seconds\r\n119: Done done\r\n119: [Dbg] [ServerFixture.cc:95] ServerFixture::Unload\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::base_footprint::base_contact_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::base_footprint::base_laser] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::torso_lift_link::torso_lift_contact_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::head_mount_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::head_mount_prosilica_link_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::head_mount_prosilica_link_sim_pcd_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::narrow_stereo_gazebo_l_stereo_camera_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::narrow_stereo_gazebo_r_stereo_camera_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::wide_stereo_gazebo_l_stereo_camera_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::wide_stereo_gazebo_r_stereo_camera_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::high_def_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::l_forearm_roll_link::l_forearm_cam_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::l_gripper_l_finger_tip_link::l_gripper_l_finger_tip_contact_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::l_gripper_r_finger_tip_link::l_gripper_r_finger_tip_contact_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::laser_tilt_mount_link::laser_tilt] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::r_forearm_roll_link::r_forearm_cam_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::r_gripper_l_finger_tip_link::r_gripper_l_finger_tip_contact_sensor] because it does not exist.\r\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::r_gripper_r_finger_tip_link::r_gripper_r_finger_tip_contact_sensor] because it does not exist.\r\n119: *** Error in `/tmp/gazebo_build/source/build/gazebo/sensors/UNIT_SensorManager_TEST':\r\n corrupted double-linked list: 0x00002b52ee5c8700 ***\r\n~~~\r\nA backtrace implicates the removal of projectors in\r\n[Scene::RemoveVisual](#!/osrf/gazebo/src/d6bfa5238c7c0cb3963716df16475b97f1f0051b/gazebo/rendering/Scene.cc?at=default#cl-2689):\r\n~~~\r\nThread 2 (Thread 0x7f6dc10c7700 (LWP 7035)):\r\n#0  __lll_lock_wait_private () at ../nptl/sysdeps/unix/sysv/linux/x86_64/lowlevellock.S:95\r\n#1  0x00007f6dda400f1c in _L_lock_11850 () at malloc.c:5151\r\n#2  0x00007f6dda3fe4c5 in __GI___libc_malloc (bytes=56) at malloc.c:2856\r\n...\r\n#14 0x00007f6dda3ef515 in __libc_message (do_abort=do_abort@entry=2, \r\n    fmt=fmt@entry=0x7f6dda503240 \"*** Error in `%s': %s: 0x%s ***\\n\") at ../sysdeps/unix/sysv/linux/libc_fatal.c:178\r\n#15 0x00007f6dda3fa4c6 in malloc_printerr (action=3, str=0x7f6dda4ff1e8 \"corrupted double-linked list\", ptr=<optimized out>)\r\n    at malloc.c:4923\r\n#16 0x00007f6dda3fbcb9 in _int_free (av=0x7f6db4000020, p=0x7f6d326242d0, have_lock=0) at malloc.c:3933\r\n#17 0x00007f6ddcd9d1ff in gazebo::rendering::Scene::RemoveVisual (this=this@entry=0x7f6d3a469c10, _vis=...)\r\n    at gazebo/rendering/Scene.cc:2689\r\n#18 0x00007f6ddcda2e00 in gazebo::rendering::Scene::Clear (this=0x7f6d3a469c10)\r\n    at gazebo/rendering/Scene.cc:189\r\n#19 0x00007f6ddcd89467 in gazebo::rendering::RenderEngine::RemoveScene (\r\n    this=this@entry=0x7f6ddd30c6a0 <SingletonT<gazebo::rendering::RenderEngine>::GetInstance()::t>, _name=...)\r\n    at gazebo/rendering/RenderEngine.cc:218\r\n#20 0x00007f6ddcd89617 in gazebo::rendering::RenderEngine::Fini (\r\n    this=this@entry=0x7f6ddd30c6a0 <SingletonT<gazebo::rendering::RenderEngine>::GetInstance()::t>)\r\n    at gazebo/rendering/RenderEngine.cc:326\r\n#21 0x00007f6ddcd90121 in gazebo::rendering::fini ()\r\n    at gazebo/rendering/RenderingIface.cc:66\r\n#22 0x00007f6ddd0bc706 in gazebo::sensors::fini ()\r\n    at gazebo/sensors/SensorsIface.cc:71\r\n#23 0x0000000000462ed4 in gazebo::shutdown () at gazebo/gazebo.cc:247\r\n#24 0x00000000004563f8 in gazebo::Server::Run (this=0x7f6d4085c0a0)\r\n    at gazebo/Server.cc:479\r\n#25 0x000000000043fcc3 in ServerFixture::RunServer (this=0xa6d220, _worldFilename=..., _paused=<optimized out>, _physics=...)\r\n    at test/ServerFixture.cc:233\r\n#26 0x00007f6ddb82894a in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.53.0\r\n#27 0x00007f6ddc4c1f6e in start_thread (arg=0x7f6dc10c7700) at pthread_create.c:311\r\n#28 0x00007f6dda4759cd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:113\r\n~~~\r\n[backtrace for all threads here](https://gist.github.com/scpeters/9846432)", "markup": "markdown", "html": "<p>I have been getting seg-faults in the UNIT_SensorManager_TEST about 30% of the time in my overnight testing. I just switched to saucy, using default ogre package 1.8.0. It happens on the gazebo_3.0 and default branches.</p>\n<p>The <code>SensorManager_TEST.InitRemove</code> test fails during teardown (ie. after the <code>[Dbg] [ServerFixture.cc:95] ServerFixture::Unload</code> message has printed) with an error message about a corrupted double-linked list</p>\n<div class=\"codehilite\"><pre><span></span>119: [ RUN      ] SensorManager_TEST.InitRemove\n119: [Msg] Waiting for master.\n119: [Msg] Connected to gazebo master @ http://127.0.0.1:11345\n119: [Msg] Publicized address: 192.168.1.191\n119: [Dbg] [ServerFixture.cc:144] ServerFixture load in 2.5 seconds, timeout after 600 seconds\n119: Done done\n119: [Dbg] [ServerFixture.cc:95] ServerFixture::Unload\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::base_footprint::base_contact_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::base_footprint::base_laser] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::torso_lift_link::torso_lift_contact_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::head_mount_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::head_mount_prosilica_link_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::head_mount_prosilica_link_sim_pcd_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::narrow_stereo_gazebo_l_stereo_camera_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::narrow_stereo_gazebo_r_stereo_camera_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::wide_stereo_gazebo_l_stereo_camera_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::wide_stereo_gazebo_r_stereo_camera_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::head_tilt_link::high_def_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::l_forearm_roll_link::l_forearm_cam_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::l_gripper_l_finger_tip_link::l_gripper_l_finger_tip_contact_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::l_gripper_r_finger_tip_link::l_gripper_r_finger_tip_contact_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::laser_tilt_mount_link::laser_tilt] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::r_forearm_roll_link::r_forearm_cam_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::r_gripper_l_finger_tip_link::r_gripper_l_finger_tip_contact_sensor] because it does not exist.\n119: [Err] [SensorManager.cc:354] Unable to remove sensor[default::pr2::r_gripper_r_finger_tip_link::r_gripper_r_finger_tip_contact_sensor] because it does not exist.\n119: *** Error in `/tmp/gazebo_build/source/build/gazebo/sensors/UNIT_SensorManager_TEST&#39;:\n corrupted double-linked list: 0x00002b52ee5c8700 ***\n</pre></div>\n\n\n<p>A backtrace implicates the removal of projectors in\n<a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/d6bfa5238c7c0cb3963716df16475b97f1f0051b/gazebo/rendering/Scene.cc?at=default#cl-2689\" rel=\"nofollow\">Scene::RemoveVisual</a>:</p>\n<div class=\"codehilite\"><pre><span></span>Thread 2 (Thread 0x7f6dc10c7700 (LWP 7035)):\n#0  __lll_lock_wait_private () at ../nptl/sysdeps/unix/sysv/linux/x86_64/lowlevellock.S:95\n#1  0x00007f6dda400f1c in _L_lock_11850 () at malloc.c:5151\n#2  0x00007f6dda3fe4c5 in __GI___libc_malloc (bytes=56) at malloc.c:2856\n...\n#14 0x00007f6dda3ef515 in __libc_message (do_abort=do_abort@entry=2, \n    fmt=fmt@entry=0x7f6dda503240 &quot;*** Error in `%s&#39;: %s: 0x%s ***\\n&quot;) at ../sysdeps/unix/sysv/linux/libc_fatal.c:178\n#15 0x00007f6dda3fa4c6 in malloc_printerr (action=3, str=0x7f6dda4ff1e8 &quot;corrupted double-linked list&quot;, ptr=&lt;optimized out&gt;)\n    at malloc.c:4923\n#16 0x00007f6dda3fbcb9 in _int_free (av=0x7f6db4000020, p=0x7f6d326242d0, have_lock=0) at malloc.c:3933\n#17 0x00007f6ddcd9d1ff in gazebo::rendering::Scene::RemoveVisual (this=this@entry=0x7f6d3a469c10, _vis=...)\n    at gazebo/rendering/Scene.cc:2689\n#18 0x00007f6ddcda2e00 in gazebo::rendering::Scene::Clear (this=0x7f6d3a469c10)\n    at gazebo/rendering/Scene.cc:189\n#19 0x00007f6ddcd89467 in gazebo::rendering::RenderEngine::RemoveScene (\n    this=this@entry=0x7f6ddd30c6a0 &lt;SingletonT&lt;gazebo::rendering::RenderEngine&gt;::GetInstance()::t&gt;, _name=...)\n    at gazebo/rendering/RenderEngine.cc:218\n#20 0x00007f6ddcd89617 in gazebo::rendering::RenderEngine::Fini (\n    this=this@entry=0x7f6ddd30c6a0 &lt;SingletonT&lt;gazebo::rendering::RenderEngine&gt;::GetInstance()::t&gt;)\n    at gazebo/rendering/RenderEngine.cc:326\n#21 0x00007f6ddcd90121 in gazebo::rendering::fini ()\n    at gazebo/rendering/RenderingIface.cc:66\n#22 0x00007f6ddd0bc706 in gazebo::sensors::fini ()\n    at gazebo/sensors/SensorsIface.cc:71\n#23 0x0000000000462ed4 in gazebo::shutdown () at gazebo/gazebo.cc:247\n#24 0x00000000004563f8 in gazebo::Server::Run (this=0x7f6d4085c0a0)\n    at gazebo/Server.cc:479\n#25 0x000000000043fcc3 in ServerFixture::RunServer (this=0xa6d220, _worldFilename=..., _paused=&lt;optimized out&gt;, _physics=...)\n    at test/ServerFixture.cc:233\n#26 0x00007f6ddb82894a in ?? () from /usr/lib/x86_64-linux-gnu/libboost_thread.so.1.53.0\n#27 0x00007f6ddc4c1f6e in start_thread (arg=0x7f6dc10c7700) at pthread_create.c:311\n#28 0x00007f6dda4759cd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:113\n</pre></div>\n\n\n<p><a data-is-external-link=\"true\" href=\"https://gist.github.com/scpeters/9846432\" rel=\"nofollow\">backtrace for all threads here</a></p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2014-03-29T01:14:29.767510+00:00", "milestone": null, "updated_on": "2016-09-14T19:20:19.240426+00:00", "type": "issue", "id": 1136}