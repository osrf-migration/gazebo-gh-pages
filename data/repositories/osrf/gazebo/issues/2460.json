{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/2460/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/2460.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2460/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/2460/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/2460/simulated-time-not-stepping-properly"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/2460/vote"}}, "reporter": {"display_name": "Ignacio Abadia", "uuid": "{d9bd2b4f-f4e5-42bd-9eee-64572c4e89b4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd9bd2b4f-f4e5-42bd-9eee-64572c4e89b4%7D"}, "html": {"href": "https://bitbucket.org/%7Bd9bd2b4f-f4e5-42bd-9eee-64572c4e89b4%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/af4cbc1031566b147454bdd6b0701e7bd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsIA-6.png"}}, "nickname": "iAbaTer", "type": "user", "account_id": "5ad5ca57e378d62b3bb3f72d"}, "title": "Simulated time not stepping properly", "component": {"name": "msgs", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122880.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "Hi,\r\n\r\nI am having problems trying to control Gazebo's simulated time. I want to command Gazebo to simulate one step after some processing is done.\r\n\r\nI have created a publisher for gazebo's topic ~/world_control in order to publish a WorldControl message with \"step = true\" whenever I want Gazebo to move forward one step. However, those messages sometimes are effective (that is, Gazebo moves forward one step) and other times they have no effect. As an example, in the attached code I publish 3 times the message to advance the simulation one step, so I expect Gazebo to advance 3 steps in the simulation. However, it only moves forward one step and I can't understand why.\r\n\r\nAny explanation why this is happening? It seems to me that Gazebo is not receiving all the published messages, those messages are getting lost in the way or something like that. Any help will be very much appreciated.\r\n\r\nThanks, Ignacio\r\n\r\n\r\n```\r\n#!c++\r\n\r\n\r\n#include <gazebo/gazebo.hh>\r\n#include <gazebo/gazebo_client.hh>\r\n#include <gazebo/common/Plugin.hh>\r\n#include <gazebo/msgs/msgs.hh>\r\n#include <gazebo/transport/transport.hh>\r\n\r\nstatic bool stop_simulation;\r\n\r\nvoid rosShutdownHandler(int sig)\r\n{\r\n\tstop_simulation = true;\r\n}\r\n\r\nint main(int argc, char **argv)\r\n{\r\n\tgazebo::client::setup(argc,argv);\r\n\r\n\tgazebo::transport::NodePtr node(new gazebo::transport::Node());\r\n\tnode->Init();\r\n\r\n\t//Create publisher for topic ~/world_control\r\n\tgazebo::transport::PublisherPtr pub = node->Advertise<gazebo::msgs::WorldControl>(\"~/world_control\");\r\n\t//Create message\r\n\tgazebo::msgs::WorldControl msg_step;\r\n\r\n\tstop_simulation = false;\r\n\r\n\t//Publish to topic ~/world_control\r\n\tpub->WaitForConnection();\r\n\r\n\t//Set step to true\r\n\tmsg_step.set_step(1);\r\n\r\n\t//Publish 1st step\r\n\tpub->Publish(msg_step, true);\r\n\t//Publish 2nd step\r\n\tpub->Publish(msg_step, true);\r\n\t//Publish 3rd step\r\n\tpub->Publish(msg_step, true);\r\n\r\n\twhile (!stop_simulation){\r\n\t\tstd::cout << \"Running \\n\";\r\n\t}\r\n\r\n\tgazebo::shutdown();\r\n\treturn 0;\r\n} // end main()\r\n```", "markup": "markdown", "html": "<p>Hi,</p>\n<p>I am having problems trying to control Gazebo's simulated time. I want to command Gazebo to simulate one step after some processing is done.</p>\n<p>I have created a publisher for gazebo's topic ~/world_control in order to publish a WorldControl message with \"step = true\" whenever I want Gazebo to move forward one step. However, those messages sometimes are effective (that is, Gazebo moves forward one step) and other times they have no effect. As an example, in the attached code I publish 3 times the message to advance the simulation one step, so I expect Gazebo to advance 3 steps in the simulation. However, it only moves forward one step and I can't understand why.</p>\n<p>Any explanation why this is happening? It seems to me that Gazebo is not receiving all the published messages, those messages are getting lost in the way or something like that. Any help will be very much appreciated.</p>\n<p>Thanks, Ignacio</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/gazebo.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/gazebo_client.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/common/Plugin.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/msgs/msgs.hh&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;gazebo/transport/transport.hh&gt;</span><span class=\"cp\"></span>\n\n<span class=\"k\">static</span> <span class=\"kt\">bool</span> <span class=\"n\">stop_simulation</span><span class=\"p\">;</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">rosShutdownHandler</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">sig</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n    <span class=\"n\">stop_simulation</span> <span class=\"o\">=</span> <span class=\"nb\">true</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n    <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">client</span><span class=\"o\">::</span><span class=\"n\">setup</span><span class=\"p\">(</span><span class=\"n\">argc</span><span class=\"p\">,</span><span class=\"n\">argv</span><span class=\"p\">);</span>\n\n    <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">NodePtr</span> <span class=\"n\">node</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">Node</span><span class=\"p\">());</span>\n    <span class=\"n\">node</span><span class=\"o\">-&gt;</span><span class=\"n\">Init</span><span class=\"p\">();</span>\n\n    <span class=\"c1\">//Create publisher for topic ~/world_control</span>\n    <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">PublisherPtr</span> <span class=\"n\">pub</span> <span class=\"o\">=</span> <span class=\"n\">node</span><span class=\"o\">-&gt;</span><span class=\"n\">Advertise</span><span class=\"o\">&lt;</span><span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">WorldControl</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"s\">&quot;~/world_control&quot;</span><span class=\"p\">);</span>\n    <span class=\"c1\">//Create message</span>\n    <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">WorldControl</span> <span class=\"n\">msg_step</span><span class=\"p\">;</span>\n\n    <span class=\"n\">stop_simulation</span> <span class=\"o\">=</span> <span class=\"nb\">false</span><span class=\"p\">;</span>\n\n    <span class=\"c1\">//Publish to topic ~/world_control</span>\n    <span class=\"n\">pub</span><span class=\"o\">-&gt;</span><span class=\"n\">WaitForConnection</span><span class=\"p\">();</span>\n\n    <span class=\"c1\">//Set step to true</span>\n    <span class=\"n\">msg_step</span><span class=\"p\">.</span><span class=\"n\">set_step</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n\n    <span class=\"c1\">//Publish 1st step</span>\n    <span class=\"n\">pub</span><span class=\"o\">-&gt;</span><span class=\"n\">Publish</span><span class=\"p\">(</span><span class=\"n\">msg_step</span><span class=\"p\">,</span> <span class=\"nb\">true</span><span class=\"p\">);</span>\n    <span class=\"c1\">//Publish 2nd step</span>\n    <span class=\"n\">pub</span><span class=\"o\">-&gt;</span><span class=\"n\">Publish</span><span class=\"p\">(</span><span class=\"n\">msg_step</span><span class=\"p\">,</span> <span class=\"nb\">true</span><span class=\"p\">);</span>\n    <span class=\"c1\">//Publish 3rd step</span>\n    <span class=\"n\">pub</span><span class=\"o\">-&gt;</span><span class=\"n\">Publish</span><span class=\"p\">(</span><span class=\"n\">msg_step</span><span class=\"p\">,</span> <span class=\"nb\">true</span><span class=\"p\">);</span>\n\n    <span class=\"k\">while</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">stop_simulation</span><span class=\"p\">){</span>\n        <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">cout</span> <span class=\"o\">&lt;&lt;</span> <span class=\"s\">&quot;Running </span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">gazebo</span><span class=\"o\">::</span><span class=\"n\">shutdown</span><span class=\"p\">();</span>\n    <span class=\"k\">return</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span> <span class=\"c1\">// end main()</span>\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "7.0", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/242744.json"}}}, "edited_on": null, "created_on": "2018-04-17T10:26:28.045841+00:00", "milestone": null, "updated_on": "2018-04-17T10:26:28.045841+00:00", "type": "issue", "id": 2460}