{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/858/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/858.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/858/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/858/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/858/rayshape-getintersection-behaves"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/858/vote"}}, "reporter": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}, "title": "RayShape::GetIntersection() behaves differently in ODE and Bullet", "component": {"name": "physics", "links": {"self": {"href": "data/repositories/osrf/gazebo/components/122876.json"}}}, "votes": 1, "watches": 4, "content": {"raw": "[RayShape::GetIntersection()](#!/osrf/gazebo/src/7cfba947ed0ce203a0f156530da6888af18e4edc/gazebo/physics/RayShape.hh?at=default#cl-89) returns the distance value and the entityName of the collision point. However, ODE and BULLET have different results in the following cases:\r\n\r\n* When the two points of the ray do not collide with anything:\r\n\r\n      ODE returns 1000 and empty string.\r\n\r\n      BULLET returns 0 and empty string.\r\n\r\n* When the two points of the ray collide with an object:\r\n\r\n      ODE and BULLET returns the correct distance but a different entityName.\r\n\r\nThere is a test in 3ea9d2a that shows this behavior. This is the output of the test:\r\n\r\n```\r\n#!c++\r\n\r\ncaguero@turtlebot:~/workspace/gazebo/build$ ./gazebo/physics/UNIT_RayShape_TEST [==========] Running 4 tests from 2 test cases.\r\n[----------] Global test environment set-up.\r\n[----------] 2 tests from TestRayShapeODE/RayShape_TEST\r\n[ RUN      ] TestRayShapeODE/RayShape_TEST.EmptySpace/0\r\nMsg Waiting for master\r\nMsg Connected to gazebo master @ http://127.0.0.1:11345\r\nMsg Publicized address: 192.168.1.180\r\nDbg ServerFixture load in 0.08 seconds, timeout after 60 seconds\r\nDistance: [1000]\r\nEntity: []\r\n/home/caguero/workspace/gazebo/gazebo/physics/RayShape_TEST.cc:72: Failure\r\nValue of: dist == 0.0 && entityName == \"\"\r\n  Actual: false\r\nExpected: true\r\n[  FAILED  ] TestRayShapeODE/RayShape_TEST.EmptySpace/0, where GetParam() = \"ode\" (994 ms)\r\n[ RUN      ] TestRayShapeODE/RayShape_TEST.Obstacle/0\r\nMsg Waiting for master\r\nBullseyeCoverage 8.7.87 error 16: Cannot open /tmp/bullseye.cov. COVFILE is probably set to an incorrect path, errno=2. Executable is UNIT_RayShape_TEST\r\nMsg Connected to gazebo master @ http://127.0.0.1:11345\r\nMsg Publicized address: 192.168.1.180\r\nDbg ServerFixture load in 0.07 seconds, timeout after 60 seconds\r\nDistance: [9.5]\r\nEntity: [box::link::collision]\r\n[       OK ] TestRayShapeODE/RayShape_TEST.Obstacle/0 (988 ms)\r\n[----------] 2 tests from TestRayShapeODE/RayShape_TEST (1982 ms total)\r\n\r\n[----------] 2 tests from TestRayShapeBullet/RayShape_TEST\r\n[ RUN      ] TestRayShapeBullet/RayShape_TEST.EmptySpace/0\r\nMsg Waiting for master\r\nMsg Connected to gazebo master @ http://127.0.0.1:11345\r\nMsg Publicized address: 192.168.1.180\r\nDbg ServerFixture load in 0.07 seconds, timeout after 60 seconds\r\nDistance: [0]\r\nEntity: []\r\n[       OK ] TestRayShapeBullet/RayShape_TEST.EmptySpace/0 (969 ms)\r\n[ RUN      ] TestRayShapeBullet/RayShape_TEST.Obstacle/0\r\nMsg Waiting for master\r\nMsg Connected to gazebo master @ http://127.0.0.1:11345\r\nMsg Publicized address: 192.168.1.180\r\nDbg ServerFixture load in 0.07 seconds, timeout after 60 seconds\r\nDistance: [9.5]\r\nEntity: [box::link]\r\n[       OK ] TestRayShapeBullet/RayShape_TEST.Obstacle/0 (983 ms)\r\n[----------] 2 tests from TestRayShapeBullet/RayShape_TEST (1952 ms total)\r\n\r\n[----------] Global test environment tear-down\r\n[==========] 4 tests from 2 test cases ran. (3934 ms total)\r\n[  PASSED  ] 3 tests.\r\n[  FAILED  ] 1 test, listed below:\r\n[  FAILED  ] TestRayShapeODE/RayShape_TEST.EmptySpace/0, where GetParam() = \"ode\"\r\n\r\n 1 FAILED TEST\r\n\r\n```\r\n\r\nI believe we should unify the behavior. Should we return 0 in case of no intersection (bullet approach)? How about the collision name?", "markup": "markdown", "html": "<p><a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/7cfba947ed0ce203a0f156530da6888af18e4edc/gazebo/physics/RayShape.hh?at=default#cl-89\" rel=\"nofollow\">RayShape::GetIntersection()</a> returns the distance value and the entityName of the collision point. However, ODE and BULLET have different results in the following cases:</p>\n<ul>\n<li>\n<p>When the two points of the ray do not collide with anything:</p>\n<p>ODE returns 1000 and empty string.</p>\n<p>BULLET returns 0 and empty string.</p>\n</li>\n<li>\n<p>When the two points of the ray collide with an object:</p>\n<p>ODE and BULLET returns the correct distance but a different entityName.</p>\n</li>\n</ul>\n<p>There is a test in <a href=\"#!/osrf/gazebo/commits/3ea9d2a\" rel=\"nofollow\" class=\"ap-connect-link\">3ea9d2a</a> that shows this behavior. This is the output of the test:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"n\">caguero</span><span class=\"err\">@</span><span class=\"nl\">turtlebot</span><span class=\"p\">:</span><span class=\"o\">~/</span><span class=\"n\">workspace</span><span class=\"o\">/</span><span class=\"n\">gazebo</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"err\">$</span> <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">gazebo</span><span class=\"o\">/</span><span class=\"n\">physics</span><span class=\"o\">/</span><span class=\"n\">UNIT_RayShape_TEST</span> <span class=\"p\">[</span><span class=\"o\">==========</span><span class=\"p\">]</span> <span class=\"n\">Running</span> <span class=\"mi\">4</span> <span class=\"n\">tests</span> <span class=\"n\">from</span> <span class=\"mi\">2</span> <span class=\"n\">test</span> <span class=\"n\">cases</span><span class=\"p\">.</span>\n<span class=\"p\">[</span><span class=\"o\">----------</span><span class=\"p\">]</span> <span class=\"n\">Global</span> <span class=\"n\">test</span> <span class=\"n\">environment</span> <span class=\"n\">set</span><span class=\"o\">-</span><span class=\"n\">up</span><span class=\"p\">.</span>\n<span class=\"p\">[</span><span class=\"o\">----------</span><span class=\"p\">]</span> <span class=\"mi\">2</span> <span class=\"n\">tests</span> <span class=\"n\">from</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span>\n<span class=\"p\">[</span> <span class=\"n\">RUN</span>      <span class=\"p\">]</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">EmptySpace</span><span class=\"o\">/</span><span class=\"mi\">0</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Waiting</span> <span class=\"k\">for</span> <span class=\"n\">master</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">gazebo</span> <span class=\"n\">master</span> <span class=\"err\">@</span> <span class=\"nl\">http</span><span class=\"p\">:</span><span class=\"c1\">//127.0.0.1:11345</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Publicized</span> <span class=\"nl\">address</span><span class=\"p\">:</span> <span class=\"mf\">192.168.1.180</span>\n<span class=\"n\">Dbg</span> <span class=\"n\">ServerFixture</span> <span class=\"n\">load</span> <span class=\"n\">in</span> <span class=\"mf\">0.08</span> <span class=\"n\">seconds</span><span class=\"p\">,</span> <span class=\"n\">timeout</span> <span class=\"n\">after</span> <span class=\"mi\">60</span> <span class=\"n\">seconds</span>\n<span class=\"nl\">Distance</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mi\">1000</span><span class=\"p\">]</span>\n<span class=\"nl\">Entity</span><span class=\"p\">:</span> <span class=\"p\">[]</span>\n<span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">caguero</span><span class=\"o\">/</span><span class=\"n\">workspace</span><span class=\"o\">/</span><span class=\"n\">gazebo</span><span class=\"o\">/</span><span class=\"n\">gazebo</span><span class=\"o\">/</span><span class=\"n\">physics</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"nl\">cc</span><span class=\"p\">:</span><span class=\"mi\">72</span><span class=\"o\">:</span> <span class=\"n\">Failure</span>\n<span class=\"n\">Value</span> <span class=\"nl\">of</span><span class=\"p\">:</span> <span class=\"n\">dist</span> <span class=\"o\">==</span> <span class=\"mf\">0.0</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">entityName</span> <span class=\"o\">==</span> <span class=\"s\">&quot;&quot;</span>\n  <span class=\"nl\">Actual</span><span class=\"p\">:</span> <span class=\"nb\">false</span>\n<span class=\"nl\">Expected</span><span class=\"p\">:</span> <span class=\"nb\">true</span>\n<span class=\"p\">[</span>  <span class=\"n\">FAILED</span>  <span class=\"p\">]</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">EmptySpace</span><span class=\"o\">/</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">where</span> <span class=\"n\">GetParam</span><span class=\"p\">()</span> <span class=\"o\">=</span> <span class=\"s\">&quot;ode&quot;</span> <span class=\"p\">(</span><span class=\"mi\">994</span> <span class=\"n\">ms</span><span class=\"p\">)</span>\n<span class=\"p\">[</span> <span class=\"n\">RUN</span>      <span class=\"p\">]</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">Obstacle</span><span class=\"o\">/</span><span class=\"mi\">0</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Waiting</span> <span class=\"k\">for</span> <span class=\"n\">master</span>\n<span class=\"n\">BullseyeCoverage</span> <span class=\"mf\">8.7.87</span> <span class=\"n\">error</span> <span class=\"mi\">16</span><span class=\"o\">:</span> <span class=\"n\">Cannot</span> <span class=\"n\">open</span> <span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">bullseye</span><span class=\"p\">.</span><span class=\"n\">cov</span><span class=\"p\">.</span> <span class=\"n\">COVFILE</span> <span class=\"n\">is</span> <span class=\"n\">probably</span> <span class=\"n\">set</span> <span class=\"n\">to</span> <span class=\"n\">an</span> <span class=\"n\">incorrect</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"o\">=</span><span class=\"mf\">2.</span> <span class=\"n\">Executable</span> <span class=\"n\">is</span> <span class=\"n\">UNIT_RayShape_TEST</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">gazebo</span> <span class=\"n\">master</span> <span class=\"err\">@</span> <span class=\"nl\">http</span><span class=\"p\">:</span><span class=\"c1\">//127.0.0.1:11345</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Publicized</span> <span class=\"nl\">address</span><span class=\"p\">:</span> <span class=\"mf\">192.168.1.180</span>\n<span class=\"n\">Dbg</span> <span class=\"n\">ServerFixture</span> <span class=\"n\">load</span> <span class=\"n\">in</span> <span class=\"mf\">0.07</span> <span class=\"n\">seconds</span><span class=\"p\">,</span> <span class=\"n\">timeout</span> <span class=\"n\">after</span> <span class=\"mi\">60</span> <span class=\"n\">seconds</span>\n<span class=\"nl\">Distance</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mf\">9.5</span><span class=\"p\">]</span>\n<span class=\"nl\">Entity</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"n\">box</span><span class=\"o\">::</span><span class=\"n\">link</span><span class=\"o\">::</span><span class=\"n\">collision</span><span class=\"p\">]</span>\n<span class=\"p\">[</span>       <span class=\"n\">OK</span> <span class=\"p\">]</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">Obstacle</span><span class=\"o\">/</span><span class=\"mi\">0</span> <span class=\"p\">(</span><span class=\"mi\">988</span> <span class=\"n\">ms</span><span class=\"p\">)</span>\n<span class=\"p\">[</span><span class=\"o\">----------</span><span class=\"p\">]</span> <span class=\"mi\">2</span> <span class=\"n\">tests</span> <span class=\"n\">from</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span> <span class=\"p\">(</span><span class=\"mi\">1982</span> <span class=\"n\">ms</span> <span class=\"n\">total</span><span class=\"p\">)</span>\n\n<span class=\"p\">[</span><span class=\"o\">----------</span><span class=\"p\">]</span> <span class=\"mi\">2</span> <span class=\"n\">tests</span> <span class=\"n\">from</span> <span class=\"n\">TestRayShapeBullet</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span>\n<span class=\"p\">[</span> <span class=\"n\">RUN</span>      <span class=\"p\">]</span> <span class=\"n\">TestRayShapeBullet</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">EmptySpace</span><span class=\"o\">/</span><span class=\"mi\">0</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Waiting</span> <span class=\"k\">for</span> <span class=\"n\">master</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">gazebo</span> <span class=\"n\">master</span> <span class=\"err\">@</span> <span class=\"nl\">http</span><span class=\"p\">:</span><span class=\"c1\">//127.0.0.1:11345</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Publicized</span> <span class=\"nl\">address</span><span class=\"p\">:</span> <span class=\"mf\">192.168.1.180</span>\n<span class=\"n\">Dbg</span> <span class=\"n\">ServerFixture</span> <span class=\"n\">load</span> <span class=\"n\">in</span> <span class=\"mf\">0.07</span> <span class=\"n\">seconds</span><span class=\"p\">,</span> <span class=\"n\">timeout</span> <span class=\"n\">after</span> <span class=\"mi\">60</span> <span class=\"n\">seconds</span>\n<span class=\"nl\">Distance</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"nl\">Entity</span><span class=\"p\">:</span> <span class=\"p\">[]</span>\n<span class=\"p\">[</span>       <span class=\"n\">OK</span> <span class=\"p\">]</span> <span class=\"n\">TestRayShapeBullet</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">EmptySpace</span><span class=\"o\">/</span><span class=\"mi\">0</span> <span class=\"p\">(</span><span class=\"mi\">969</span> <span class=\"n\">ms</span><span class=\"p\">)</span>\n<span class=\"p\">[</span> <span class=\"n\">RUN</span>      <span class=\"p\">]</span> <span class=\"n\">TestRayShapeBullet</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">Obstacle</span><span class=\"o\">/</span><span class=\"mi\">0</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Waiting</span> <span class=\"k\">for</span> <span class=\"n\">master</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Connected</span> <span class=\"n\">to</span> <span class=\"n\">gazebo</span> <span class=\"n\">master</span> <span class=\"err\">@</span> <span class=\"nl\">http</span><span class=\"p\">:</span><span class=\"c1\">//127.0.0.1:11345</span>\n<span class=\"n\">Msg</span> <span class=\"n\">Publicized</span> <span class=\"nl\">address</span><span class=\"p\">:</span> <span class=\"mf\">192.168.1.180</span>\n<span class=\"n\">Dbg</span> <span class=\"n\">ServerFixture</span> <span class=\"n\">load</span> <span class=\"n\">in</span> <span class=\"mf\">0.07</span> <span class=\"n\">seconds</span><span class=\"p\">,</span> <span class=\"n\">timeout</span> <span class=\"n\">after</span> <span class=\"mi\">60</span> <span class=\"n\">seconds</span>\n<span class=\"nl\">Distance</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mf\">9.5</span><span class=\"p\">]</span>\n<span class=\"nl\">Entity</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"n\">box</span><span class=\"o\">::</span><span class=\"n\">link</span><span class=\"p\">]</span>\n<span class=\"p\">[</span>       <span class=\"n\">OK</span> <span class=\"p\">]</span> <span class=\"n\">TestRayShapeBullet</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">Obstacle</span><span class=\"o\">/</span><span class=\"mi\">0</span> <span class=\"p\">(</span><span class=\"mi\">983</span> <span class=\"n\">ms</span><span class=\"p\">)</span>\n<span class=\"p\">[</span><span class=\"o\">----------</span><span class=\"p\">]</span> <span class=\"mi\">2</span> <span class=\"n\">tests</span> <span class=\"n\">from</span> <span class=\"n\">TestRayShapeBullet</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span> <span class=\"p\">(</span><span class=\"mi\">1952</span> <span class=\"n\">ms</span> <span class=\"n\">total</span><span class=\"p\">)</span>\n\n<span class=\"p\">[</span><span class=\"o\">----------</span><span class=\"p\">]</span> <span class=\"n\">Global</span> <span class=\"n\">test</span> <span class=\"n\">environment</span> <span class=\"n\">tear</span><span class=\"o\">-</span><span class=\"n\">down</span>\n<span class=\"p\">[</span><span class=\"o\">==========</span><span class=\"p\">]</span> <span class=\"mi\">4</span> <span class=\"n\">tests</span> <span class=\"n\">from</span> <span class=\"mi\">2</span> <span class=\"n\">test</span> <span class=\"n\">cases</span> <span class=\"n\">ran</span><span class=\"p\">.</span> <span class=\"p\">(</span><span class=\"mi\">3934</span> <span class=\"n\">ms</span> <span class=\"n\">total</span><span class=\"p\">)</span>\n<span class=\"p\">[</span>  <span class=\"n\">PASSED</span>  <span class=\"p\">]</span> <span class=\"mi\">3</span> <span class=\"n\">tests</span><span class=\"p\">.</span>\n<span class=\"p\">[</span>  <span class=\"n\">FAILED</span>  <span class=\"p\">]</span> <span class=\"mi\">1</span> <span class=\"n\">test</span><span class=\"p\">,</span> <span class=\"n\">listed</span> <span class=\"nl\">below</span><span class=\"p\">:</span>\n<span class=\"p\">[</span>  <span class=\"n\">FAILED</span>  <span class=\"p\">]</span> <span class=\"n\">TestRayShapeODE</span><span class=\"o\">/</span><span class=\"n\">RayShape_TEST</span><span class=\"p\">.</span><span class=\"n\">EmptySpace</span><span class=\"o\">/</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">where</span> <span class=\"n\">GetParam</span><span class=\"p\">()</span> <span class=\"o\">=</span> <span class=\"s\">&quot;ode&quot;</span>\n\n <span class=\"mi\">1</span> <span class=\"n\">FAILED</span> <span class=\"n\">TEST</span>\n</pre></div>\n\n\n<p>I believe we should unify the behavior. Should we return 0 in case of no intersection (bullet approach)? How about the collision name?</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2013-09-27T23:06:39.668813+00:00", "milestone": null, "updated_on": "2016-09-14T19:21:36.657968+00:00", "type": "issue", "id": 858}