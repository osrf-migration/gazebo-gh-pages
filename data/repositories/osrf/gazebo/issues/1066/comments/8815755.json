{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/8815755.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-8815755"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": "I was reviewing the main point of all the issue which is: is the plugin being unloaded from the memory if we don't call dlclose? My first thought was that it was not. To test it:\n\n```\n# remove dlclose from Plugin.hh\n# compile and install\n# Run pioneer2dx which brings DiffDrivePlugin\ngzserver ~/code/gazebo/worlds/pioneer2dx.world &\n# Check that is loaded into memory\nsudo lsof | grep mem | grep \"\\.so\"| awk '{print $9}'| sort| uniq | grep Diff\n> /usr/lib/gazebo-3.0/plugins/libDiffDrivePlugin.so\n# close gazebo\n# repeat the check\nsudo lsof | grep mem | grep \"\\.so\"| awk '{print $9}'| sort| uniq | grep Diff\n# empty\n```\nLooks like the plugin is being unloaded from the memory, without the need of calling to dlclose. All this, supposing that the method to check libraries in memory is right.", "markup": "markdown", "html": "<p>I was reviewing the main point of all the issue which is: is the plugin being unloaded from the memory if we don't call dlclose? My first thought was that it was not. To test it:</p>\n<div class=\"codehilite\"><pre><span></span># remove dlclose from Plugin.hh\n# compile and install\n# Run pioneer2dx which brings DiffDrivePlugin\ngzserver ~/code/gazebo/worlds/pioneer2dx.world &amp;\n# Check that is loaded into memory\nsudo lsof | grep mem | grep &quot;\\.so&quot;| awk &#39;{print $9}&#39;| sort| uniq | grep Diff\n&gt; /usr/lib/gazebo-3.0/plugins/libDiffDrivePlugin.so\n# close gazebo\n# repeat the check\nsudo lsof | grep mem | grep &quot;\\.so&quot;| awk &#39;{print $9}&#39;| sort| uniq | grep Diff\n# empty\n</pre></div>\n\n\n<p>Looks like the plugin is being unloaded from the memory, without the need of calling to dlclose. All this, supposing that the method to check libraries in memory is right.</p>", "type": "rendered"}, "created_on": "2014-02-27T23:19:57.590569+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 8815755}