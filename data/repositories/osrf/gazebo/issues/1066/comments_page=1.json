{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/8645061.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-8645061"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": "Looking at the gdb, it is something related with plugins destructors. The error is present in different classes (Sensor, Model, ...), always calling ```this->plugins.clear().```\n\nIt is also affecting to different classes like gazebo::SensorPlugin or gazebo::ModelPlugin.\n\nThe error can be triggered simply by:\n```\nTEST_F(Foo_TEST, Foo)\n{\n  Load(\"worlds/pioneer2dx.world\");\n}\n```", "markup": "markdown", "html": "<p>Looking at the gdb, it is something related with plugins destructors. The error is present in different classes (Sensor, Model, ...), always calling <code>this-&gt;plugins.clear().</code></p>\n<p>It is also affecting to different classes like gazebo::SensorPlugin or gazebo::ModelPlugin.</p>\n<p>The error can be triggered simply by:</p>\n<div class=\"codehilite\"><pre><span></span>TEST_F(Foo_TEST, Foo)\n{\n  Load(&quot;worlds/pioneer2dx.world&quot;);\n}\n</pre></div>", "type": "rendered"}, "created_on": "2014-02-26T17:10:41.837195+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": "2014-02-26T17:12:47.874277+00:00", "type": "issue_comment", "id": 8645061}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/8674267.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-8674267"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "created_on": "2014-02-27T02:57:32.681637+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 8674267}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/8674303.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-8674303"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": "After realizing that issue #1068 was affecting my debug protocol, I just confirmed that the problem is on ```dlclose``` call. So this approach this bug to issue #1026.", "markup": "markdown", "html": "<p>After realizing that issue <a href=\"#!/osrf/gazebo/issues/1068/changes-in-pluginhh-dont-cause-plugin\" rel=\"nofollow\" title=\"Changes in Plugin.hh don&#39;t cause plugin recompilation\" class=\"ap-connect-link\"><s>#1068</s></a> was affecting my debug protocol, I just confirmed that the problem is on <code>dlclose</code> call. So this approach this bug to issue <a href=\"#!/osrf/gazebo/issues/1026/osx-seg-faults-during-plugin-teardown\" rel=\"nofollow\" title=\"OSX seg-faults during plugin teardown\" class=\"ap-connect-link\">#1026</a>.</p>", "type": "rendered"}, "created_on": "2014-02-27T03:01:50.495444+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 8674303}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/8815755.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-8815755"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": "I was reviewing the main point of all the issue which is: is the plugin being unloaded from the memory if we don't call dlclose? My first thought was that it was not. To test it:\n\n```\n# remove dlclose from Plugin.hh\n# compile and install\n# Run pioneer2dx which brings DiffDrivePlugin\ngzserver ~/code/gazebo/worlds/pioneer2dx.world &\n# Check that is loaded into memory\nsudo lsof | grep mem | grep \"\\.so\"| awk '{print $9}'| sort| uniq | grep Diff\n> /usr/lib/gazebo-3.0/plugins/libDiffDrivePlugin.so\n# close gazebo\n# repeat the check\nsudo lsof | grep mem | grep \"\\.so\"| awk '{print $9}'| sort| uniq | grep Diff\n# empty\n```\nLooks like the plugin is being unloaded from the memory, without the need of calling to dlclose. All this, supposing that the method to check libraries in memory is right.", "markup": "markdown", "html": "<p>I was reviewing the main point of all the issue which is: is the plugin being unloaded from the memory if we don't call dlclose? My first thought was that it was not. To test it:</p>\n<div class=\"codehilite\"><pre><span></span># remove dlclose from Plugin.hh\n# compile and install\n# Run pioneer2dx which brings DiffDrivePlugin\ngzserver ~/code/gazebo/worlds/pioneer2dx.world &amp;\n# Check that is loaded into memory\nsudo lsof | grep mem | grep &quot;\\.so&quot;| awk &#39;{print $9}&#39;| sort| uniq | grep Diff\n&gt; /usr/lib/gazebo-3.0/plugins/libDiffDrivePlugin.so\n# close gazebo\n# repeat the check\nsudo lsof | grep mem | grep &quot;\\.so&quot;| awk &#39;{print $9}&#39;| sort| uniq | grep Diff\n# empty\n</pre></div>\n\n\n<p>Looks like the plugin is being unloaded from the memory, without the need of calling to dlclose. All this, supposing that the method to check libraries in memory is right.</p>", "type": "rendered"}, "created_on": "2014-02-27T23:19:57.590569+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 8815755}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/30610651.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-30610651"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "created_on": "2016-09-14T19:23:09.093268+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": null, "type": "issue_comment", "id": 30610651}, {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066/comments/44022362.json"}, "html": {"href": "#!/osrf/gazebo/issues/1066#comment-44022362"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1066.json"}}, "type": "issue", "id": 1066, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Tests segfaults when calling dlclose on plugins when compiled with visibility=hidden"}, "content": {"raw": "I've not seen core dumped in tests for a while. Reopen if needed.", "markup": "markdown", "html": "<p>I've not seen core dumped in tests for a while. Reopen if needed.</p>", "type": "rendered"}, "created_on": "2018-03-19T21:47:15.827839+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": null, "type": "issue_comment", "id": 44022362}], "page": 1, "size": 6}