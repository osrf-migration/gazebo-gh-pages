{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/623/comments/3673846.json"}, "html": {"href": "#!/osrf/gazebo/issues/623#comment-3673846"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/623.json"}}, "type": "issue", "id": 623, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "ConnectionManager sleeps for 30 ms between message updates"}, "content": {"raw": "I tested this on my mac, and it failed in a different spot [NodeProcess_TBB in TopicManager.cc:42](#!/osrf/gazebo/src/dbfff75bb967041830bc084139a3fbdaa79e2dc4/gazebo/transport/TopicManager.cc?at=default#cl-42):\n~~~\nAssertion failed: (!pthread_muteAssertion failed: (!pthread_mutex_lock(&m)), function lock, filex_lock(&m)), function lock, file /usr/local/include/boost/thread /usr/local/include/boost/thread/pthread/recursive_mutex.hpp, li/pthread/recursive_mutex.hpp, line 107.\nne 107.\n\nProgram received signal SIGABRT, Aborted.\n[Switching to process 35966 thread 0x6703]\n0x00007fff85f0e212 in __pthread_kill ()\n(gdb) bt\n#0  0x00007fff85f0e212 in __pthread_kill ()\n#1  0x00007fff8aa3eb54 in pthread_kill ()\n#2  0x00007fff8aa82dce in abort ()\n#3  0x00007fff8aa83e2a in __assert_rtn ()\n#4  0x000000010001868e in boost::unique_lock<boost::recursive_mutex>::lock (this=<value temporarily unavailable, due to optimizations>) at recursive_mutex.hpp:107\n#5  0x0000000100381f64 in __gnu_cxx::__normal_iterator<boost::shared_ptr<gazebo::transport::Publisher>*, std::vector<boost::shared_ptr<gazebo::transport::Publisher>, std::allocator<boost::shared_ptr<gazebo::transport::Publisher> > > >::__normal_iterator () at lock_types.hpp:124\n#6  __gnu_cxx::__normal_iterator<boost::shared_ptr<gazebo::transport::Publisher>*, std::vector<boost::shared_ptr<gazebo::transport::Publisher>, std::allocator<boost::shared_ptr<gazebo::transport::Publisher> > > >::__normal_iterator () at stl_vector.h:653\n#7  std::vector<boost::shared_ptr<gazebo::transport::Publisher>, std::allocator<boost::shared_ptr<gazebo::transport::Publisher> > >::begin () at /usr/include/c++/4.2.1/bits/stl_vector.h:331\n#8  0x0000000100381f64 in gazebo::transport::Node::ProcessPublishers (this=0x10498c260) at stl_vector.h:124\n#9  0x00000001003931ca in tbb::interface6::internal::start_for<tbb::blocked_range<unsigned long>, NodeProcess_TBB, tbb::auto_partitioner const>::run_body () at /Users/scpeters/osrf/gazebo/gazebo/transport/TopicManager.cc:42\n#10 NodeProcess_TBB::operator() () at /usr/local/Cellar/tbb/4.1u3/include/tbb/parallel_for.h:259\n#11 0x00000001003931ca in tbb::interface6::internal::partition_type_base<tbb::interface6::internal::auto_partition_type>::execute<tbb::interface6::internal::start_for<tbb::blocked_range<unsigned long>, NodeProcess_TBB, tbb::auto_partitioner const>, tbb::blocked_range<unsigned long> > (this=0x7fff8aa43195, start=@0x10d54ba40, range=@0x10d54ba48) at /Users/scpeters/osrf/gazebo/gazebo/transport/TopicManager.cc:110\n#12 0x0000000100392f97 in tbb::interface6::internal::start_for<tbb::blocked_range<unsigned long>, NodeProcess_TBB, tbb::auto_partitioner const>::execute (this=0x0) at parallel_for.h:116\n#13 0x0000000100d858cf in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all ()\n#14 0x0000000100d8529c in tbb::internal::generic_scheduler::local_spawn_root_and_wait ()\n#15 0x0000000100392ee4 in tbb::interface6::internal::start_for<tbb::blocked_range<unsigned long>, NodeProcess_TBB, tbb::auto_partitioner const>::run (range=<value temporarily unavailable, due to optimizations>, body=<value temporarily unavailable, due to optimizations>, partitioner=@0x0) at task.h:693\n#16 0x000000010038eff3 in gazebo::transport::TopicManager::ProcessNodes (this=0x100048088, _onlyOut=false) at parallel_for.h:165\n#17 0x000000010037fa83 in TopicManagerProcessTask::execute (this=<value temporarily unavailable, due to optimizations>) at /Users/scpeters/osrf/gazebo/gazebo/transport/ConnectionManager.cc:34\n#18 0x0000000100d858cf in tbb::internal::custom_scheduler<tbb::internal::IntelSchedulerTraits>::local_wait_for_all ()\n#19 0x0000000100d83299 in tbb::internal::arena::process ()\n#20 0x0000000100d826c1 in tbb::internal::market::process ()\n#21 0x0000000100d80c27 in tbb::internal::rml::private_worker::run ()\n#22 0x0000000100d808c9 in tbb::internal::rml::private_worker::thread_routine ()\n#23 0x00007fff8aa3d7a2 in _pthread_start ()\n#24 0x00007fff8aa2a1e1 in thread_start ()\n(gdb) \n~~~", "markup": "markdown", "html": "<p>I tested this on my mac, and it failed in a different spot <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/dbfff75bb967041830bc084139a3fbdaa79e2dc4/gazebo/transport/TopicManager.cc?at=default#cl-42\" rel=\"nofollow\">NodeProcess_TBB in TopicManager.cc:42</a>:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">Assertion</span> <span class=\"nl\">failed</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">pthread_muteAssertion</span> <span class=\"nl\">failed</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">pthread_mutex_lock</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">m</span><span class=\"p\">)),</span> <span class=\"n\">function</span> <span class=\"n\">lock</span><span class=\"p\">,</span> <span class=\"n\">filex_lock</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">m</span><span class=\"p\">)),</span> <span class=\"n\">function</span> <span class=\"n\">lock</span><span class=\"p\">,</span> <span class=\"n\">file</span> <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">local</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">boost</span><span class=\"o\">/</span><span class=\"kr\">thread</span> <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">local</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">boost</span><span class=\"o\">/</span><span class=\"kr\">thread</span><span class=\"o\">/</span><span class=\"n\">pthread</span><span class=\"o\">/</span><span class=\"n\">recursive_mutex</span><span class=\"p\">.</span><span class=\"n\">hpp</span><span class=\"p\">,</span> <span class=\"n\">li</span><span class=\"o\">/</span><span class=\"n\">pthread</span><span class=\"o\">/</span><span class=\"n\">recursive_mutex</span><span class=\"p\">.</span><span class=\"n\">hpp</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mf\">107.</span>\n<span class=\"n\">ne</span> <span class=\"mf\">107.</span>\n\n<span class=\"n\">Program</span> <span class=\"n\">received</span> <span class=\"n\">signal</span> <span class=\"n\">SIGABRT</span><span class=\"p\">,</span> <span class=\"n\">Aborted</span><span class=\"p\">.</span>\n<span class=\"p\">[</span><span class=\"n\">Switching</span> <span class=\"n\">to</span> <span class=\"n\">process</span> <span class=\"mi\">35966</span> <span class=\"kr\">thread</span> <span class=\"mh\">0x6703</span><span class=\"p\">]</span>\n<span class=\"mh\">0x00007fff85f0e212</span> <span class=\"k\">in</span> <span class=\"n\">__pthread_kill</span> <span class=\"p\">()</span>\n<span class=\"p\">(</span><span class=\"n\">gdb</span><span class=\"p\">)</span> <span class=\"n\">bt</span>\n<span class=\"cp\">#0  0x00007fff85f0e212 in __pthread_kill ()</span>\n<span class=\"cp\">#1  0x00007fff8aa3eb54 in pthread_kill ()</span>\n<span class=\"cp\">#2  0x00007fff8aa82dce in abort ()</span>\n<span class=\"cp\">#3  0x00007fff8aa83e2a in __assert_rtn ()</span>\n<span class=\"cp\">#4  0x000000010001868e in boost::unique_lock&lt;boost::recursive_mutex&gt;::lock (this=&lt;value temporarily unavailable, due to optimizations&gt;) at recursive_mutex.hpp:107</span>\n<span class=\"cp\">#5  0x0000000100381f64 in __gnu_cxx::__normal_iterator&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt;*, std::vector&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt;, std::allocator&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt; &gt; &gt; &gt;::__normal_iterator () at lock_types.hpp:124</span>\n<span class=\"cp\">#6  __gnu_cxx::__normal_iterator&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt;*, std::vector&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt;, std::allocator&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt; &gt; &gt; &gt;::__normal_iterator () at stl_vector.h:653</span>\n<span class=\"cp\">#7  std::vector&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt;, std::allocator&lt;boost::shared_ptr&lt;gazebo::transport::Publisher&gt; &gt; &gt;::begin () at /usr/include</span><span class=\"cpf\">/c++/4.2.1/bits/stl_vector.h:331</span><span class=\"cp\"></span>\n<span class=\"cp\">#8  0x0000000100381f64 in gazebo::transport::Node::ProcessPublishers (this=0x10498c260) at stl_vector.h:124</span>\n<span class=\"cp\">#9  0x00000001003931ca in tbb::interface6::internal::start_for&lt;tbb::blocked_range&lt;unsigned long&gt;, NodeProcess_TBB, tbb::auto_partitioner const&gt;::run_body () at /Users/scpeters/osrf/gazebo/gazebo/transport/TopicManager.cc:42</span>\n<span class=\"cp\">#10 NodeProcess_TBB::operator() () at /usr/local/Cellar/tbb/4.1u3/include</span><span class=\"cpf\">/tbb/parallel_for.h:259</span><span class=\"cp\"></span>\n<span class=\"cp\">#11 0x00000001003931ca in tbb::interface6::internal::partition_type_base&lt;tbb::interface6::internal::auto_partition_type&gt;::execute&lt;tbb::interface6::internal::start_for&lt;tbb::blocked_range&lt;unsigned long&gt;, NodeProcess_TBB, tbb::auto_partitioner const&gt;, tbb::blocked_range&lt;unsigned long&gt; &gt; (this=0x7fff8aa43195, start=@0x10d54ba40, range=@0x10d54ba48) at /Users/scpeters/osrf/gazebo/gazebo/transport/TopicManager.cc:110</span>\n<span class=\"cp\">#12 0x0000000100392f97 in tbb::interface6::internal::start_for&lt;tbb::blocked_range&lt;unsigned long&gt;, NodeProcess_TBB, tbb::auto_partitioner const&gt;::execute (this=0x0) at parallel_for.h:116</span>\n<span class=\"cp\">#13 0x0000000100d858cf in tbb::internal::custom_scheduler&lt;tbb::internal::IntelSchedulerTraits&gt;::local_wait_for_all ()</span>\n<span class=\"cp\">#14 0x0000000100d8529c in tbb::internal::generic_scheduler::local_spawn_root_and_wait ()</span>\n<span class=\"cp\">#15 0x0000000100392ee4 in tbb::interface6::internal::start_for&lt;tbb::blocked_range&lt;unsigned long&gt;, NodeProcess_TBB, tbb::auto_partitioner const&gt;::run (range=&lt;value temporarily unavailable, due to optimizations&gt;, body=&lt;value temporarily unavailable, due to optimizations&gt;, partitioner=@0x0) at task.h:693</span>\n<span class=\"cp\">#16 0x000000010038eff3 in gazebo::transport::TopicManager::ProcessNodes (this=0x100048088, _onlyOut=false) at parallel_for.h:165</span>\n<span class=\"cp\">#17 0x000000010037fa83 in TopicManagerProcessTask::execute (this=&lt;value temporarily unavailable, due to optimizations&gt;) at /Users/scpeters/osrf/gazebo/gazebo/transport/ConnectionManager.cc:34</span>\n<span class=\"cp\">#18 0x0000000100d858cf in tbb::internal::custom_scheduler&lt;tbb::internal::IntelSchedulerTraits&gt;::local_wait_for_all ()</span>\n<span class=\"cp\">#19 0x0000000100d83299 in tbb::internal::arena::process ()</span>\n<span class=\"cp\">#20 0x0000000100d826c1 in tbb::internal::market::process ()</span>\n<span class=\"cp\">#21 0x0000000100d80c27 in tbb::internal::rml::private_worker::run ()</span>\n<span class=\"cp\">#22 0x0000000100d808c9 in tbb::internal::rml::private_worker::thread_routine ()</span>\n<span class=\"cp\">#23 0x00007fff8aa3d7a2 in _pthread_start ()</span>\n<span class=\"cp\">#24 0x00007fff8aa2a1e1 in thread_start ()</span>\n<span class=\"p\">(</span><span class=\"n\">gdb</span><span class=\"p\">)</span> \n</pre></div>", "type": "rendered"}, "created_on": "2013-04-09T00:49:27.385715+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 3673846}