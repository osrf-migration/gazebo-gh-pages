{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/623/comments/3673069.json"}, "html": {"href": "#!/osrf/gazebo/issues/623#comment-3673069"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/623.json"}}, "type": "issue", "id": 623, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "ConnectionManager sleeps for 30 ms between message updates"}, "content": {"raw": "In 1564e03 on branch issue_623_nsleep_10000, I tested reducing the sleep time from 30 ms, to 10 micro-seconds. I started getting SIGABRT's when deleting models. For example, insert a box, then right click and delete the box could cause a crash. Here's a backtrace from one of these crashes, that seems to occur at [Node::ProcessIncoming in Node.cc:150](#!/osrf/gazebo/src/dbfff75bb967041830bc084139a3fbdaa79e2dc4/gazebo/transport/Node.cc#cl-150):\n~~~\ngzserver: /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26: boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*): Assertion `!pthread_mutex_lock(m)' failed.\ngzserver: /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26: boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*): Assertion `!pthread_mutex_lock(m)' failed.\n\nProgram received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fffc8df8700 (LWP 11401)]\n0x00007ffff5227425 in __GI_raise (sig=<optimized out>) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n64\t../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) bt\n#0  0x00007ffff5227425 in __GI_raise (sig=<optimized out>)\n    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007ffff522ab8b in __GI_abort () at abort.c:91\n#2  0x00007ffff52200ee in __assert_fail_base (fmt=<optimized out>, \n    assertion=0x43d05d \"!pthread_mutex_lock(m)\", \n    file=0x43cba0 \"/usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp\", \n    line=<optimized out>, function=<optimized out>) at assert.c:94\n#3  0x00007ffff5220192 in __GI___assert_fail (assertion=0x43d05d \"!pthread_mutex_lock(m)\", \n    file=0x43cba0 \"/usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp\", line=26, \n    function=0x43daa0 \"boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*)\") at assert.c:103\n#4  0x0000000000420ce0 in boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock (\n    m_=<optimized out>, this=<optimized out>)\n    at /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26\n#5  0x000000000042caea in pthread_mutex_scoped_lock (m_=0x7fff781ca6a0, this=<synthetic pointer>)\n    at /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26\n#6  lock (this=0x7fff781ca6a0) at /usr/include/boost/thread/pthread/recursive_mutex.hpp:124\n#7  boost::unique_lock<boost::recursive_mutex>::lock (this=0x7fffc8df7a70)\n    at /usr/include/boost/thread/locks.hpp:412\n#8  0x00007ffff7619e00 in unique_lock (m_=..., this=0x7fffc8df7a70)\n    at /usr/include/boost/thread/locks.hpp:290\n#9  gazebo::transport::Node::ProcessIncoming (this=0x7fff781ca550)\n    at /home/scpeters/osrf/gazebo_default/gazebo/transport/Node.cc:150\n#10 0x00007ffff7624923 in gazebo::transport::TopicManager::ProcessNodes (this=0x64c000, \n    _onlyOut=false) at /home/scpeters/osrf/gazebo_default/gazebo/transport/TopicManager.cc:162\n#11 0x00007ffff7612cdb in TopicManagerProcessTask::execute (this=<optimized out>)\n    at /home/scpeters/osrf/gazebo_default/gazebo/transport/ConnectionManager.cc:34\n#12 0x00007ffff65a0242 in ?? () from /usr/lib/libtbb.so.2\n#13 0x00007ffff659c09d in ?? () from /usr/lib/libtbb.so.2\n#14 0x00007ffff659b54b in ?? () from /usr/lib/libtbb.so.2\n#15 0x00007ffff659908f in ?? () from /usr/lib/libtbb.so.2\n#16 0x00007ffff65992c9 in ?? () from /usr/lib/libtbb.so.2\n#17 0x00007ffff6aa5e9a in start_thread (arg=0x7fffc8df8700) at pthread_create.c:308\n#18 0x00007ffff52e4cbd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#19 0x0000000000000000 in ?? ()\n(gdb) \n~~~\n\n@nkoenig I also took video with recordmydesktop if you want to see what caused the failure.", "markup": "markdown", "html": "<p>In <a href=\"#!/osrf/gazebo/commits/1564e03\" rel=\"nofollow\" class=\"ap-connect-link\">1564e03</a> on branch issue_623_nsleep_10000, I tested reducing the sleep time from 30 ms, to 10 micro-seconds. I started getting SIGABRT's when deleting models. For example, insert a box, then right click and delete the box could cause a crash. Here's a backtrace from one of these crashes, that seems to occur at <a data-is-external-link=\"true\" href=\"#!/osrf/gazebo/src/dbfff75bb967041830bc084139a3fbdaa79e2dc4/gazebo/transport/Node.cc#cl-150\" rel=\"nofollow\">Node::ProcessIncoming in Node.cc:150</a>:</p>\n<div class=\"codehilite\"><pre><span></span>gzserver: /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26: boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*): Assertion `!pthread_mutex_lock(m)&#39; failed.\ngzserver: /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26: boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*): Assertion `!pthread_mutex_lock(m)&#39; failed.\n\nProgram received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fffc8df8700 (LWP 11401)]\n0x00007ffff5227425 in __GI_raise (sig=&lt;optimized out&gt;) at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n64  ../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) bt\n#0  0x00007ffff5227425 in __GI_raise (sig=&lt;optimized out&gt;)\n    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64\n#1  0x00007ffff522ab8b in __GI_abort () at abort.c:91\n#2  0x00007ffff52200ee in __assert_fail_base (fmt=&lt;optimized out&gt;, \n    assertion=0x43d05d &quot;!pthread_mutex_lock(m)&quot;, \n    file=0x43cba0 &quot;/usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp&quot;, \n    line=&lt;optimized out&gt;, function=&lt;optimized out&gt;) at assert.c:94\n#3  0x00007ffff5220192 in __GI___assert_fail (assertion=0x43d05d &quot;!pthread_mutex_lock(m)&quot;, \n    file=0x43cba0 &quot;/usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp&quot;, line=26, \n    function=0x43daa0 &quot;boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock(pthread_mutex_t*)&quot;) at assert.c:103\n#4  0x0000000000420ce0 in boost::pthread::pthread_mutex_scoped_lock::pthread_mutex_scoped_lock (\n    m_=&lt;optimized out&gt;, this=&lt;optimized out&gt;)\n    at /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26\n#5  0x000000000042caea in pthread_mutex_scoped_lock (m_=0x7fff781ca6a0, this=&lt;synthetic pointer&gt;)\n    at /usr/include/boost/thread/pthread/pthread_mutex_scoped_lock.hpp:26\n#6  lock (this=0x7fff781ca6a0) at /usr/include/boost/thread/pthread/recursive_mutex.hpp:124\n#7  boost::unique_lock&lt;boost::recursive_mutex&gt;::lock (this=0x7fffc8df7a70)\n    at /usr/include/boost/thread/locks.hpp:412\n#8  0x00007ffff7619e00 in unique_lock (m_=..., this=0x7fffc8df7a70)\n    at /usr/include/boost/thread/locks.hpp:290\n#9  gazebo::transport::Node::ProcessIncoming (this=0x7fff781ca550)\n    at /home/scpeters/osrf/gazebo_default/gazebo/transport/Node.cc:150\n#10 0x00007ffff7624923 in gazebo::transport::TopicManager::ProcessNodes (this=0x64c000, \n    _onlyOut=false) at /home/scpeters/osrf/gazebo_default/gazebo/transport/TopicManager.cc:162\n#11 0x00007ffff7612cdb in TopicManagerProcessTask::execute (this=&lt;optimized out&gt;)\n    at /home/scpeters/osrf/gazebo_default/gazebo/transport/ConnectionManager.cc:34\n#12 0x00007ffff65a0242 in ?? () from /usr/lib/libtbb.so.2\n#13 0x00007ffff659c09d in ?? () from /usr/lib/libtbb.so.2\n#14 0x00007ffff659b54b in ?? () from /usr/lib/libtbb.so.2\n#15 0x00007ffff659908f in ?? () from /usr/lib/libtbb.so.2\n#16 0x00007ffff65992c9 in ?? () from /usr/lib/libtbb.so.2\n#17 0x00007ffff6aa5e9a in start_thread (arg=0x7fffc8df8700) at pthread_create.c:308\n#18 0x00007ffff52e4cbd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#19 0x0000000000000000 in ?? ()\n(gdb) \n</pre></div>\n\n\n<p>@nkoenig I also took video with recordmydesktop if you want to see what caused the failure.</p>", "type": "rendered"}, "created_on": "2013-04-08T22:30:07.007821+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 3673069}