{"priority": "critical", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "links": {"attachments": {"href": "data/repositories/osrf/gazebo/issues/244/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gazebo/issues/244.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/244/watch"}, "comments": {"href": "data/repositories/osrf/gazebo/issues/244/comments_page=1.json"}, "html": {"href": "#!/osrf/gazebo/issues/244/contact-sensor-refactor"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo/issues/244/vote"}}, "reporter": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "title": "Contact sensor refactor", "component": null, "votes": 0, "watches": 1, "content": {"raw": "## From Thomas Koletschka, in reference to clearing the contact map in ContactSensor::UpdateImpl.\r\n\r\nI'm not sure whether the approach of clearing the contacts map at every time step works out well in the long run and it might actually introduce new bugs:\r\n1) The public interface for getting information about contacts will fail most of the time, unless you're lucky and the function call gets through between the calls to OnContact() and UpdateImpl(). The functions GetCollision* and GetContacts make use of the contacts map which is empty after clearing it at the end of UpdateImpl so all the calls will result in \"Contact Sensor [...] has no collision [...]\" errors as the contacts map has a high chance of being empty even though a contact exists.\r\n\r\n2) It certainly doesn't matter when you only have a few contact sensors but for example the iRobot hands have about 102 contact sensors each which results in hundreds of constructor and destructor calls every update while manipulating with both hands, which might affect performance a little I think.\r\n\r\nI'm not sure what the best way around this would be but as (1) indicates clearing the contacts map probably does not go well unless you remove the public interface (the ros fuerte bumper plugin used it to get all the contacts) and only use the messages published by UpdateImpl. A callback indicating the loss of contact would probably allow for the most unproblematic solution but I don't know whether ODE allows for that.\r\n\r\n## Other Notes\r\n\r\nAs Thomas mentions there is potentially many constructor and destructors for contact generation. A more streamlined approach is necessary.\r\n", "markup": "markdown", "html": "<h2 id=\"markdown-header-from-thomas-koletschka-in-reference-to-clearing-the-contact-map-in-contactsensorupdateimpl\">From Thomas Koletschka, in reference to clearing the contact map in ContactSensor::UpdateImpl.</h2>\n<p>I'm not sure whether the approach of clearing the contacts map at every time step works out well in the long run and it might actually introduce new bugs:\n1) The public interface for getting information about contacts will fail most of the time, unless you're lucky and the function call gets through between the calls to OnContact() and UpdateImpl(). The functions GetCollision* and GetContacts make use of the contacts map which is empty after clearing it at the end of UpdateImpl so all the calls will result in \"Contact Sensor [...] has no collision [...]\" errors as the contacts map has a high chance of being empty even though a contact exists.</p>\n<p>2) It certainly doesn't matter when you only have a few contact sensors but for example the iRobot hands have about 102 contact sensors each which results in hundreds of constructor and destructor calls every update while manipulating with both hands, which might affect performance a little I think.</p>\n<p>I'm not sure what the best way around this would be but as (1) indicates clearing the contacts map probably does not go well unless you remove the public interface (the ros fuerte bumper plugin used it to get all the contacts) and only use the messages published by UpdateImpl. A callback indicating the loss of contact would probably allow for the most unproblematic solution but I don't know whether ODE allows for that.</p>\n<h2 id=\"markdown-header-other-notes\">Other Notes</h2>\n<p>As Thomas mentions there is potentially many constructor and destructors for contact generation. A more streamlined approach is necessary.</p>", "type": "rendered"}, "assignee": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "state": "closed", "version": {"name": "all", "links": {"self": {"href": "data/repositories/osrf/gazebo/versions/225575.json"}}}, "edited_on": null, "created_on": "2012-11-21T00:16:22.958101+00:00", "milestone": null, "updated_on": "2016-09-14T19:43:52.361461+00:00", "type": "issue", "id": 244}