{"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1204/comments/10650127.json"}, "html": {"href": "#!/osrf/gazebo/issues/1204#comment-10650127"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/gazebo/issues/1204.json"}}, "type": "issue", "id": 1204, "repository": {"links": {"self": {"href": "data/repositories/osrf/gazebo.json"}, "html": {"href": "#!/osrf/gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}ts=1694483"}}, "type": "repository", "name": "gazebo", "full_name": "osrf/gazebo", "uuid": "{51a0cd5d-8697-4eb1-8b08-e919ee881e1c}"}, "title": "Trusty: remote_endpoint: Transport endpoint is not connected"}, "content": {"raw": "The backtrace implicated `Connection::OnConnect`, and I noticed that it references `socket->remote_endpoint()` in a different way than the `Connection::GetRemoteEndpoint()` function. I changed it to use the `GetRemoteEndpoint()` function with the following:\n~~~\ndiff -r 0c1dd36ccb70 gazebo/transport/Connection.cc\n--- a/gazebo/transport/Connection.cc\tTue Jun 10 14:37:23 2014 -0700\n+++ b/gazebo/transport/Connection.cc\tTue Jun 10 16:02:01 2014 -0700\n@@ -846,7 +846,7 @@\n     if (this->socket && this->socket->is_open())\n     {\n       this->remoteAddress =\n-        this->socket->remote_endpoint().address().to_string();\n+        this->GetRemoteEndpoint().address().to_string();\n     }\n     else\n     {\n~~~\n\nThis causes the test to generate a bunch of console messages and eventually hang:\n~~~\n$ tools/UNIT_gz_TEST \n[==========] Running 9 tests from 1 test case.\n[----------] Global test environment set-up.\n[----------] 9 tests from gzTest\n[ RUN      ] gzTest.Alive\n[       OK ] gzTest.Alive (130 ms)\n[ RUN      ] gzTest.Joint\n[Msg] Waiting for master.\n[Err] [Connection.cc:787] Getting remote endpoint failed\n[Err] [Connection.cc:787] Getting remote endpoint failed\n[Err] [Connection.cc:516] Connection[0] Closed during Read\n[Err] [ConnectionManager.cc:134] Unable to read from master\n/home/scpeters/ws/gazebo/src/gazebo/tools/gz_TEST.cc:108: Failure\nValue of: gazebo::transport::init()\n  Actual: false\nExpected: true\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [ConnectionManager.cc:552] Not initialized\n[Err] [Node.cc:98] No namespace found\n[Err] [ConnectionManager.cc:598] ConnectionManager is not initialized\n^C^C\n~~~\n", "markup": "markdown", "html": "<p>The backtrace implicated <code>Connection::OnConnect</code>, and I noticed that it references <code>socket-&gt;remote_endpoint()</code> in a different way than the <code>Connection::GetRemoteEndpoint()</code> function. I changed it to use the <code>GetRemoteEndpoint()</code> function with the following:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 0c1dd36ccb70 gazebo/transport/Connection.cc</span>\n<span class=\"gd\">--- a/gazebo/transport/Connection.cc    Tue Jun 10 14:37:23 2014 -0700</span>\n<span class=\"gi\">+++ b/gazebo/transport/Connection.cc    Tue Jun 10 16:02:01 2014 -0700</span>\n<span class=\"gu\">@@ -846,7 +846,7 @@</span>\n     if (this-&gt;socket &amp;&amp; this-&gt;socket-&gt;is_open())\n     {\n       this-&gt;remoteAddress =\n<span class=\"gd\">-        this-&gt;socket-&gt;remote_endpoint().address().to_string();</span>\n<span class=\"gi\">+        this-&gt;GetRemoteEndpoint().address().to_string();</span>\n     }\n     else\n     {\n</pre></div>\n\n\n<p>This causes the test to generate a bunch of console messages and eventually hang:</p>\n<div class=\"codehilite\"><pre><span></span>$ tools/UNIT_gz_TEST \n<span class=\"o\">[==========]</span> Running <span class=\"m\">9</span> tests from <span class=\"m\">1</span> <span class=\"nb\">test</span> <span class=\"k\">case</span>.\n<span class=\"o\">[</span>----------<span class=\"o\">]</span> Global <span class=\"nb\">test</span> environment set-up.\n<span class=\"o\">[</span>----------<span class=\"o\">]</span> <span class=\"m\">9</span> tests from gzTest\n<span class=\"o\">[</span> RUN      <span class=\"o\">]</span> gzTest.Alive\n<span class=\"o\">[</span>       OK <span class=\"o\">]</span> gzTest.Alive <span class=\"o\">(</span><span class=\"m\">130</span> ms<span class=\"o\">)</span>\n<span class=\"o\">[</span> RUN      <span class=\"o\">]</span> gzTest.Joint\n<span class=\"o\">[</span>Msg<span class=\"o\">]</span> Waiting <span class=\"k\">for</span> master.\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>Connection.cc:787<span class=\"o\">]</span> Getting remote endpoint failed\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>Connection.cc:787<span class=\"o\">]</span> Getting remote endpoint failed\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>Connection.cc:516<span class=\"o\">]</span> Connection<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span> Closed during Read\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:134<span class=\"o\">]</span> Unable to <span class=\"nb\">read</span> from master\n/home/scpeters/ws/gazebo/src/gazebo/tools/gz_TEST.cc:108: Failure\nValue of: gazebo::transport::init<span class=\"o\">()</span>\n  Actual: <span class=\"nb\">false</span>\nExpected: <span class=\"nb\">true</span>\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:552<span class=\"o\">]</span> Not initialized\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>Node.cc:98<span class=\"o\">]</span> No namespace found\n<span class=\"o\">[</span>Err<span class=\"o\">]</span> <span class=\"o\">[</span>ConnectionManager.cc:598<span class=\"o\">]</span> ConnectionManager is not initialized\n^C^C\n</pre></div>", "type": "rendered"}, "created_on": "2014-06-10T23:11:51.988048+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 10650127}